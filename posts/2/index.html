
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Winse Blog</title>
  <meta name="author" content="Winse Liu">

  
  <meta name="description" content="平时不是所有的改动都提交，也保留一些临时代码。今天在主干上提交了后，需要reset后退到前几天的版本，但是直接checkout是新建一个分支，如果reset sort还需要处理index，麻烦，就在eclipse中点击了reset hard，我勒个去，直接把 原来提交过的代码 改动没提交的 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://winse.github.io/posts/2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="/atom.xml" rel="alternate" title="Winse Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/libs/jquery.toc.min.js" type="text/javascript"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->

<script src="/javascripts/generate-toc.js" type="text/javascript"></script>


  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43198550-1', 'auto');
  ga('send', 'pageview');

</script>



</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Winse Blog</a></h1>
  
    <h2>走走停停, 熙熙攘攘, 忙忙碌碌, 不知何畏.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:winse.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="站内搜索"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/archives/updated.html">Updated</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2023/02/01/git-reset-hard/">记git Reset &#8211;hard</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2023-02-01T08:39:26+08:00" pubdate data-updated="true">Wed 2023-02-01 08:39</time>
		
        
		
      </p>
    
  </header>


  <div class="entry-content"><p>平时不是所有的改动都提交，也保留一些临时代码。今天在主干上提交了后，需要reset后退到前几天的版本，但是直接checkout是新建一个分支，如果reset sort还需要处理index，麻烦，就在eclipse中点击了reset hard，我勒个去，<strong>直接把 原来提交过的代码 改动没提交的 给还原了</strong>！！！</p>

<p><a href="https://stackoverflow.com/questions/9529078/how-do-i-use-git-reset-hard-head-to-revert-to-a-previous-commit">https://stackoverflow.com/questions/9529078/how-do-i-use-git-reset-hard-head-to-revert-to-a-previous-commit</a></p>

<blockquote><p>First, it&rsquo;s always worth noting that git reset &ndash;hard is a potentially dangerous command, since it throws away all your uncommitted changes. For safety, you should always check that the output of git status is clean (that is, empty) before using it.</p></blockquote>

<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2023/02/01/register-openai/">注册OpenAI</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2023-02-01T07:09:45+08:00" pubdate data-updated="true">Wed 2023-02-01 07:09</time>
		
        
		
      </p>
    
  </header>


  <div class="entry-content"><p>ChatGPT再一次火，自己也想尝试一下子。找到官网<a href="https://chat.openai.com">https://chat.openai.com</a>但注册的时刻需要手机验证码，咱国内的手机号码是不行的。</p>

<p>搜索之后找到可以通过虚拟手机号来接收短信完成注册的方法：<a href="https://cloud.tencent.com/developer/article/2190154">一文教你快速注册OpenAi（ChatGPT），国内也可以！</a></p>

<p>实操步骤如下：</p>

<h2>注册登录sms并充值</h2>

<p>1、 注册登录 <a href="https://sms-activate.org/#">https://sms-activate.org/#</a> ，可直接使用国内邮箱。</p>

<p>2、 充值的时刻，先搜一下openai服务需要的金额。</p>

<p><img src="/images/blogs/openai/openai-sms.png" alt="" /></p>

<p>然后选择又上角的余额下拉菜单的充值按钮，然后选择支付宝，充对应金额的钱（我这里是10卢布）。</p>

<p><img src="/images/blogs/openai/openai-pay.png" alt="" /></p>

<p>支付成功后，要等一小会（反正我刷了几分钟，充值页面最下面可以看充值历史），本来是充10卢布的，到账10.55卢布。</p>

<p>3、 搜openai，在提供的列表中选择一个国家购买，就能得到一个对应国家的号码</p>

<p>一开始我是选马来西亚的，但是openai注册的时刻说这个号码被注册次数太多，后面换了印度的10.5（汇率多出的0.5还是蛮好的），就可以了。</p>

<p><img src="/images/blogs/openai/openai-phone.png" alt="" /></p>

<h2>邮箱注册openai</h2>

<p>直接<a href="https://chat.openai.com/chat">https://chat.openai.com/chat</a>使用国内的邮箱注册，然后在填手机号码的页面选择sms中的国家和提供的号码，等几十秒就能在sms的页面看到6位数字的短信验证码</p>

<p>注意: 需要翻墙才能访问！！！</p>

<p><img src="/images/blogs/openai/openai.png" alt="" /></p>

<h2>玩玩</h2>

<p><img src="/images/blogs/openai/openai-e1.jpg" alt="" /></p>

<p><img src="/images/blogs/openai/openai-e2.png" alt="hello world" /></p>

<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2022/07/24/xinchuang-install-postgres/">信创环境迁移浅析-以Postgres为例</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2022-07-24T09:16:24+08:00" pubdate data-updated="true">Sun 2022-07-24 09:16</time>
		
        
		
      </p>
    
  </header>


  <div class="entry-content"><p>国内服务器操作系统主要还是在Linux各个发行版上嫁接过来的，又做了各种小改动，本来在主流的操作系统上可以比较容易安装的应用迁移带来了各种困难，路径异常的艰辛。</p>

<p>首先，纯源码编译方式这种不在我的选择之中，网上也有很多参考。不重复了，同时这种方式不具有操作简单和可脚本话的潜质！
如: <a href="https://blog.csdn.net/luo805914196/article/details/121083885">银河麒麟v10 安装 postgis</a>
主要还是寻求包管理yum/rpm的方式进行安装。
其次，寻找依赖版本时，以系统自带能适配最佳；再就是不改变系统核心前提下（gcc，glibc），使用rpmbuild重新编译依赖的src.rpm。</p>

<p>下面以kylin v10安装postgres9.6+postgis2.4为例进行说明。</p>

<h2>第一步，了解系统</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# cat /etc/os-release 
</span><span class='line'>NAME="Kylin Linux Advanced Server"
</span><span class='line'>VERSION="V10 (Tercel)"
</span><span class='line'>ID="kylin"
</span><span class='line'>VERSION_ID="V10"
</span><span class='line'>PRETTY_NAME="Kylin Linux Advanced Server V10 (Tercel)"
</span><span class='line'>ANSI_COLOR="0;31"
</span><span class='line'>
</span><span class='line'>[root@col ~]# cat /etc/kylin-release 
</span><span class='line'>Kylin Linux Advanced Server release V10 (Tercel)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[root@col ~]# uname -a 
</span><span class='line'>Linux col 4.19.90-17.ky10.aarch64 #1 SMP Sun Jun 28 14:27:40 CST 2020 aarch64 aarch64 aarch64 GNU/Linux
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[root@col ~]# tail -n10 /proc/cpuinfo  
</span><span class='line'>processor       : 15
</span><span class='line'>model name      : HUAWEI,Kunpeng 920
</span><span class='line'>BogoMIPS        : 200.00
</span><span class='line'>Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma dcpop asimddp asimdfhm
</span><span class='line'>CPU implementer : 0x48
</span><span class='line'>CPU architecture: 8
</span><span class='line'>CPU variant     : 0x1
</span><span class='line'>CPU part        : 0xd01
</span><span class='line'>CPU revision    : 0
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum list glibc
</span><span class='line'>Last metadata expiration check: 1:03:03 ago on Sat 23 Jul 2022 07:54:01 PM CST.
</span><span class='line'>Installed Packages
</span><span class='line'>glibc.aarch64                                                                     2.28-36.1.ky10                                                                     @anaconda
</span><span class='line'>[root@col ~]# yum list gcc
</span><span class='line'>Last metadata expiration check: 1:04:34 ago on Sat 23 Jul 2022 07:54:01 PM CST.
</span><span class='line'>Installed Packages
</span><span class='line'>gcc.aarch64                                                                 7.3.0-20190804.h30.ky10                                                                  @anaconda
</span><span class='line'>[root@col ~]# yum list cpp
</span><span class='line'>Last metadata expiration check: 1:04:42 ago on Sat 23 Jul 2022 07:54:01 PM CST.
</span><span class='line'>Installed Packages
</span><span class='line'>cpp.aarch64                                                                 7.3.0-20190804.h30.ky10                                                                  @anaconda</span></code></pre></td></tr></table></div></figure>


<h2>第二步 安装一下应用</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# vi /etc/yum.repos.d/pgdg-redhat-all.repo 
</span><span class='line'>[pgdg-common]
</span><span class='line'>name=PostgreSQL common RPMs for RHEL / Rocky 8 - $basearch
</span><span class='line'>baseurl=https://download.postgresql.org/pub/repos/yum/common/redhat/rhel-8-$basearch
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=0
</span><span class='line'>
</span><span class='line'>[pgdg96]
</span><span class='line'>name=PostgreSQL 9.6 for RHEL / Rocky 8 - $basearch
</span><span class='line'>baseurl=https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel-8-$basearch
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=0
</span><span class='line'>
</span><span class='line'>[epel]
</span><span class='line'>name=epel
</span><span class='line'>baseurl=https://dl.fedoraproject.org/pub/epel/8/Everything/aarch64/
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=0
</span><span class='line'>
</span><span class='line'>[pgdg96-source]
</span><span class='line'>name=PostgreSQL 9.6 for RHEL / Rocky 8 - $basearch - Source
</span><span class='line'>baseurl=https://download.postgresql.org/pub/repos/yum/srpms/9.6/redhat/rhel-8-$basearch
</span><span class='line'>enabled=0
</span><span class='line'>gpgcheck=0
</span><span class='line'>
</span><span class='line'>[pgdg96-debuginfo]
</span><span class='line'>name=PostgreSQL 9.6 for RHEL / Rocky 8 - $basearch - Debuginfo
</span><span class='line'>baseurl=https://download.postgresql.org/pub/repos/yum/debug/9.6/redhat/rhel-8-$basearch
</span><span class='line'>enabled=0
</span><span class='line'>gpgcheck=0
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install postgresql96 postgresql96-server postgis24_96
</span><span class='line'>PostgreSQL common RPMs for RHEL / Rocky 8 - aarch64                                                                                           122 kB/s | 406 kB     00:03    
</span><span class='line'>PostgreSQL 9.6 for RHEL / Rocky 8 - aarch64                                                                                                    19 kB/s | 276 kB     00:14    
</span><span class='line'>epel                                                                                                                                           13 kB/s |  12 MB     16:11    
</span><span class='line'>Error: 
</span><span class='line'> Problem: package postgis24_96-2.4.9-3.rhel8.aarch64 requires libgdal.so.28()(64bit), but none of the providers can be installed
</span><span class='line'>  - package postgis24_96-2.4.9-3.rhel8.aarch64 requires gdal32-libs &gt;= 3.2.0, but none of the providers can be installed
</span><span class='line'>  - package gdal32-libs-3.2.2-12.rhel8.aarch64 requires libhdf5.so.103()(64bit), but none of the providers can be installed
</span><span class='line'>  - package gdal32-libs-3.2.2-13.rhel8.aarch64 requires libhdf5.so.103()(64bit), but none of the providers can be installed
</span><span class='line'>  - cannot install the best candidate for the job
</span><span class='line'>  - nothing provides libgfortran.so.5()(64bit) needed by hdf5-1.10.5-4.el8.aarch64
</span><span class='line'>  - nothing provides libgfortran.so.5(GFORTRAN_8)(64bit) needed by hdf5-1.10.5-4.el8.aarch64
</span><span class='line'>(try to add '--skip-broken' to skip uninstallable packages or '--nobest' to use not only best candidate packages)</span></code></pre></td></tr></table></div></figure>


<p>如果按centos8的包管理<a href="https://centos.pkgs.org/8/epel-aarch64/hdf5-1.10.5-4.el8.aarch64.rpm.html">hdf5-1.10.5-4.el8.aarch64</a>，可以看出 <code>libgfortran.so.5(GFORTRAN_8)(64bit)</code> 依赖最终就依赖到 <code>gcc-8.5.0</code> 。gcc升级会比较复杂。</p>

<p>参照 <a href="http://c.biancheng.net/view/2921.html">Linux SRPM源码包安装</a> <a href="https://blog.csdn.net/jiajane/article/details/104409541">rpmrebuild 提取spec重新打包</a>的方式，使用rpmbuild在当前系统上重新编译打包。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# yum install rpmrebuild -y 
</span></code></pre></td></tr></table></div></figure>


<h2>hdf5</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# rpmbuild --rebuild hdf5-1.10.5-4.el8.src.rpm 
</span><span class='line'>Installing hdf5-1.10.5-4.el8.src.rpm
</span><span class='line'>warning: hdf5-1.10.5-4.el8.src.rpm: Header V3 RSA/SHA256 Signature, key ID 2f86d6a1: NOKEY
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>error: Failed build dependencies:
</span><span class='line'>        hamcrest is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        java-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        javapackages-tools is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        junit is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        krb5-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        libaec-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        mpich-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        openmpi-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        openssl-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        slf4j is needed by hdf5-1.10.5-4.ky10.ky10.aarch64</span></code></pre></td></tr></table></div></figure>


<p>查找 <code>https://pkgs.org/search/?q=hamcrest</code> 并下载java相关的模块centos8依赖：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# ll *.rpm
</span><span class='line'>-rw------- 1 root root  305031 Jul 23 22:12 cglib-3.2.4-7.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  147131 Jul 23 22:11 easymock-3.5-4.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  131075 Jul 23 22:08 hamcrest-1.3-23.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root   60043 Jul 23 22:08 hamcrest-core-1.3-23.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw-r--r-- 1 root root 8739906 Jul 22 14:57 hdf5-1.10.5-4.el8.src.rpm
</span><span class='line'>-rw------- 1 root root  307067 Jul 23 22:08 junit-4.12-9.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  457315 Jul 23 22:12 objectweb-asm-6.2-5.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  108627 Jul 23 22:12 objenesis-2.6-2.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  305655 Jul 23 22:12 qdox-2.0-3.M9.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root   78511 Jul 23 22:08 slf4j-1.7.25-4.module_el8.0.0+39+6a9b6e22.noarch.rpm
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install ./hamcrest-* ./junit-* ./slf4j-* ./easymock-* ./qdox-* ./cglib-* ./objectweb-asm-* ./objenesis-*
</span><span class='line'>Last metadata expiration check: 0:48:28 ago on Sat 23 Jul 2022 09:25:01 PM CST.
</span><span class='line'>Dependencies resolved.
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'> Package                                         Architecture                Version                                                   Repository                        Size
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> hamcrest                                        noarch                      1.3-23.module_el8.0.0+30+832da3a1                         @commandline                     128 k
</span><span class='line'> hamcrest-core                                   noarch                      1.3-23.module_el8.0.0+30+832da3a1                         @commandline                      59 k
</span><span class='line'> junit                                           noarch                      1:4.12-9.module_el8.0.0+30+832da3a1                       @commandline                     300 k
</span><span class='line'> slf4j                                           noarch                      1.7.25-4.module_el8.0.0+39+6a9b6e22                       @commandline                      77 k
</span><span class='line'> easymock                                        noarch                      3.5-4.module_el8.0.0+30+832da3a1                          @commandline                     144 k
</span><span class='line'> qdox                                            noarch                      2.0-3.M9.module_el8.0.0+30+832da3a1                       @commandline                     298 k
</span><span class='line'> cglib                                           noarch                      3.2.4-7.module_el8.0.0+30+832da3a1                        @commandline                     298 k
</span><span class='line'> objectweb-asm                                   noarch                      6.2-5.module_el8.0.0+30+832da3a1                          @commandline                     447 k
</span><span class='line'> objenesis                                       noarch                      2.6-2.module_el8.0.0+30+832da3a1                          @commandline                     106 k
</span><span class='line'>Installing dependencies:
</span><span class='line'> copy-jdk-configs                                noarch                      3.7-3.ky10                                                ks10-adv-os                       23 k
</span><span class='line'> java-1.8.0-openjdk-headless                     aarch64                     1:1.8.0.242.b08-1.h5.ky10                                 ks10-adv-os                       32 M
</span><span class='line'> javapackages-filesystem                         noarch                      5.3.0-2.ky10                                              ks10-adv-os                      9.8 k
</span><span class='line'> javapackages-tools                              noarch                      5.3.0-2.ky10                                              ks10-adv-os                       30 k
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'>Install  13 Packages
</span><span class='line'>
</span><span class='line'>Total size: 34 M
</span><span class='line'>Total download size: 32 M
</span><span class='line'>Installed size: 111 M
</span><span class='line'>Is this ok [y/N]: y
</span><span class='line'>Downloading Packages:
</span><span class='line'>(1/4): javapackages-filesystem-5.3.0-2.ky10.noarch.rpm                                                                                         36 kB/s | 9.8 kB     00:00    
</span><span class='line'>(2/4): copy-jdk-configs-3.7-3.ky10.noarch.rpm                                                                                                  72 kB/s |  23 kB     00:00    
</span><span class='line'>(3/4): javapackages-tools-5.3.0-2.ky10.noarch.rpm                                                                                             641 kB/s |  30 kB     00:00    
</span><span class='line'>(4/4): java-1.8.0-openjdk-headless-1.8.0.242.b08-1.h5.ky10.aarch64.rpm                                                                        259 kB/s |  32 MB     02:07    
</span><span class='line'>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Total                                                                                                                                         260 kB/s |  32 MB     02:07     
</span><span class='line'>Running transaction check
</span><span class='line'>Transaction check succeeded.
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded.
</span><span class='line'>Running transaction
</span><span class='line'>  Running scriptlet: copy-jdk-configs-3.7-3.ky10.noarch                                                                                                                   1/1 
</span><span class='line'>  Running scriptlet: java-1.8.0-openjdk-headless-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                        1/1 
</span><span class='line'>  Preparing        :                                                                                                                                                      1/1 
</span><span class='line'>  Installing       : javapackages-filesystem-5.3.0-2.ky10.noarch                                                                                                         1/13 
</span><span class='line'>  Installing       : copy-jdk-configs-3.7-3.ky10.noarch                                                                                                                  2/13 
</span><span class='line'>  Installing       : java-1.8.0-openjdk-headless-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                       3/13 
</span><span class='line'>  Running scriptlet: java-1.8.0-openjdk-headless-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                       3/13 
</span><span class='line'>  Installing       : hamcrest-core-1.3-23.module_el8.0.0+30+832da3a1.noarch                                                                                              4/13 
</span><span class='line'>  Installing       : javapackages-tools-5.3.0-2.ky10.noarch                                                                                                              5/13 
</span><span class='line'>  Installing       : objectweb-asm-6.2-5.module_el8.0.0+30+832da3a1.noarch                                                                                               6/13 
</span><span class='line'>  Installing       : cglib-3.2.4-7.module_el8.0.0+30+832da3a1.noarch                                                                                                     7/13 
</span><span class='line'>  Installing       : qdox-2.0-3.M9.module_el8.0.0+30+832da3a1.noarch                                                                                                     8/13 
</span><span class='line'>  Installing       : objenesis-2.6-2.module_el8.0.0+30+832da3a1.noarch                                                                                                   9/13 
</span><span class='line'>  Installing       : easymock-3.5-4.module_el8.0.0+30+832da3a1.noarch                                                                                                   10/13 
</span><span class='line'>  Installing       : hamcrest-1.3-23.module_el8.0.0+30+832da3a1.noarch                                                                                                  11/13 
</span><span class='line'>  Installing       : junit-1:4.12-9.module_el8.0.0+30+832da3a1.noarch                                                                                                   12/13 
</span><span class='line'>  Installing       : slf4j-1.7.25-4.module_el8.0.0+39+6a9b6e22.noarch                                                                                                   13/13 
</span><span class='line'>  Running scriptlet: copy-jdk-configs-3.7-3.ky10.noarch                                                                                                                 13/13 
</span><span class='line'>  Running scriptlet: slf4j-1.7.25-4.module_el8.0.0+39+6a9b6e22.noarch                                                                                                   13/13 
</span><span class='line'>  Verifying        : copy-jdk-configs-3.7-3.ky10.noarch                                                                                                                  1/13 
</span><span class='line'>  Verifying        : java-1.8.0-openjdk-headless-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                       2/13 
</span><span class='line'>  Verifying        : javapackages-filesystem-5.3.0-2.ky10.noarch                                                                                                         3/13 
</span><span class='line'>  Verifying        : javapackages-tools-5.3.0-2.ky10.noarch                                                                                                              4/13 
</span><span class='line'>  Verifying        : hamcrest-1.3-23.module_el8.0.0+30+832da3a1.noarch                                                                                                   5/13 
</span><span class='line'>  Verifying        : hamcrest-core-1.3-23.module_el8.0.0+30+832da3a1.noarch                                                                                              6/13 
</span><span class='line'>  Verifying        : junit-1:4.12-9.module_el8.0.0+30+832da3a1.noarch                                                                                                    7/13 
</span><span class='line'>  Verifying        : slf4j-1.7.25-4.module_el8.0.0+39+6a9b6e22.noarch                                                                                                    8/13 
</span><span class='line'>  Verifying        : easymock-3.5-4.module_el8.0.0+30+832da3a1.noarch                                                                                                    9/13 
</span><span class='line'>  Verifying        : qdox-2.0-3.M9.module_el8.0.0+30+832da3a1.noarch                                                                                                    10/13 
</span><span class='line'>  Verifying        : cglib-3.2.4-7.module_el8.0.0+30+832da3a1.noarch                                                                                                    11/13 
</span><span class='line'>  Verifying        : objectweb-asm-6.2-5.module_el8.0.0+30+832da3a1.noarch                                                                                              12/13 
</span><span class='line'>  Verifying        : objenesis-2.6-2.module_el8.0.0+30+832da3a1.noarch                                                                                                  13/13 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  hamcrest-1.3-23.module_el8.0.0+30+832da3a1.noarch    hamcrest-core-1.3-23.module_el8.0.0+30+832da3a1.noarch           junit-1:4.12-9.module_el8.0.0+30+832da3a1.noarch    
</span><span class='line'>  slf4j-1.7.25-4.module_el8.0.0+39+6a9b6e22.noarch     easymock-3.5-4.module_el8.0.0+30+832da3a1.noarch                 qdox-2.0-3.M9.module_el8.0.0+30+832da3a1.noarch     
</span><span class='line'>  cglib-3.2.4-7.module_el8.0.0+30+832da3a1.noarch      objectweb-asm-6.2-5.module_el8.0.0+30+832da3a1.noarch            objenesis-2.6-2.module_el8.0.0+30+832da3a1.noarch   
</span><span class='line'>  copy-jdk-configs-3.7-3.ky10.noarch                   java-1.8.0-openjdk-headless-1:1.8.0.242.b08-1.h5.ky10.aarch64    javapackages-filesystem-5.3.0-2.ky10.noarch         
</span><span class='line'>  javapackages-tools-5.3.0-2.ky10.noarch              
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>[root@col ~]# 
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install java-devel javapackages-tools krb5-devel libaec-devel mpich-devel openssl-devel
</span><span class='line'>Last metadata expiration check: 0:54:34 ago on Sat 23 Jul 2022 09:25:01 PM CST.
</span><span class='line'>Package javapackages-tools-5.3.0-2.ky10.noarch is already installed.
</span><span class='line'>Dependencies resolved.
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'> Package                                          Architecture                    Version                                           Repository                           Size
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> java-1.8.0-openjdk-devel                         aarch64                         1:1.8.0.242.b08-1.h5.ky10                         ks10-adv-os                         7.8 M
</span><span class='line'> krb5-devel                                       aarch64                         1.17-9.ky10                                       ks10-adv-os                         160 k
</span><span class='line'> libaec-devel                                     aarch64                         1.0.4-1.ky10                                      ks10-adv-os                         9.9 k
</span><span class='line'> mpich-devel                                      aarch64                         3.2.1-10.ky10                                     ks10-adv-os                         121 k
</span><span class='line'> openssl-devel                                    aarch64                         1:1.1.1d-9.ky10                                   ks10-adv-os                         1.7 M
</span><span class='line'>Installing dependencies:
</span><span class='line'> e2fsprogs-devel                                  aarch64                         1.45.3-4.p01.ky10                                 ks10-adv-os                         287 k
</span><span class='line'> hwloc                                            aarch64                         1.11.9-3.ky10                                     ks10-adv-os                         1.7 M
</span><span class='line'> java-1.8.0-openjdk                               aarch64                         1:1.8.0.242.b08-1.h5.ky10                         ks10-adv-os                         382 k
</span><span class='line'> keyutils-libs-devel                              aarch64                         1.5.10-11.ky10                                    ks10-adv-os                         9.8 k
</span><span class='line'> libaec                                           aarch64                         1.0.4-1.ky10                                      ks10-adv-os                          34 k
</span><span class='line'> libverto-devel                                   aarch64                         0.3.1-2.ky10                                      ks10-adv-os                          16 k
</span><span class='line'> lua-filesystem                                   aarch64                         1.6.3-10.ky10                                     ks10-adv-os                          17 k
</span><span class='line'> mpich                                            aarch64                         3.2.1-10.ky10                                     ks10-adv-os                         1.0 M
</span><span class='line'> Lmod                                             aarch64                         8.7.7-1.el8                                       epel                                261 k
</span><span class='line'> lua-term                                         aarch64                         0.07-9.el8                                        epel                                 16 k
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'>Install  15 Packages
</span><span class='line'>
</span><span class='line'>Total download size: 13 M
</span><span class='line'>Installed size: 60 M
</span><span class='line'>Is this ok [y/N]: y
</span><span class='line'>Downloading Packages:
</span><span class='line'>(1/15): e2fsprogs-devel-1.45.3-4.p01.ky10.aarch64.rpm                                                                                          46 kB/s | 287 kB     00:06    
</span><span class='line'>(2/15): java-1.8.0-openjdk-1.8.0.242.b08-1.h5.ky10.aarch64.rpm                                                                                 60 kB/s | 382 kB     00:06    
</span><span class='line'>(3/15): keyutils-libs-devel-1.5.10-11.ky10.aarch64.rpm                                                                                        454 kB/s | 9.8 kB     00:00    
</span><span class='line'>(4/15): krb5-devel-1.17-9.ky10.aarch64.rpm                                                                                                    7.4 MB/s | 160 kB     00:00    
</span><span class='line'>(5/15): libaec-1.0.4-1.ky10.aarch64.rpm                                                                                                       1.9 MB/s |  34 kB     00:00    
</span><span class='line'>(6/15): libaec-devel-1.0.4-1.ky10.aarch64.rpm                                                                                                 619 kB/s | 9.9 kB     00:00    
</span><span class='line'>(7/15): libverto-devel-0.3.1-2.ky10.aarch64.rpm                                                                                               1.1 MB/s |  16 kB     00:00    
</span><span class='line'>(8/15): lua-filesystem-1.6.3-10.ky10.aarch64.rpm                                                                                              1.1 MB/s |  17 kB     00:00    
</span><span class='line'>(9/15): mpich-3.2.1-10.ky10.aarch64.rpm                                                                                                       491 kB/s | 1.0 MB     00:02    
</span><span class='line'>(10/15): mpich-devel-3.2.1-10.ky10.aarch64.rpm                                                                                                3.4 MB/s | 121 kB     00:00    
</span><span class='line'>(11/15): hwloc-1.11.9-3.ky10.aarch64.rpm                                                                                                      161 kB/s | 1.7 MB     00:10    
</span><span class='line'>(12/15): openssl-devel-1.1.1d-9.ky10.aarch64.rpm                                                                                              376 kB/s | 1.7 MB     00:04    
</span><span class='line'>(13/15): lua-term-0.07-9.el8.aarch64.rpm                                                                                                       15 kB/s |  16 kB     00:01    
</span><span class='line'>(14/15): java-1.8.0-openjdk-devel-1.8.0.242.b08-1.h5.ky10.aarch64.rpm                                                                         274 kB/s | 7.8 MB     00:28    
</span><span class='line'>(15/15): Lmod-8.7.7-1.el8.aarch64.rpm                                                                                                         9.0 kB/s | 261 kB     00:29    
</span><span class='line'>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Total                                                                                                                                         346 kB/s |  13 MB     00:39     
</span><span class='line'>Running transaction check
</span><span class='line'>Transaction check succeeded.
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded.
</span><span class='line'>Running transaction
</span><span class='line'>  Preparing        :                                                                                                                                                      1/1 
</span><span class='line'>  Installing       : lua-term-0.07-9.el8.aarch64                                                                                                                         1/15 
</span><span class='line'>  Installing       : lua-filesystem-1.6.3-10.ky10.aarch64                                                                                                                2/15 
</span><span class='line'>  Installing       : Lmod-8.7.7-1.el8.aarch64                                                                                                                            3/15 
</span><span class='line'>  Running scriptlet: Lmod-8.7.7-1.el8.aarch64                                                                                                                            3/15 
</span><span class='line'>  Installing       : libverto-devel-0.3.1-2.ky10.aarch64                                                                                                                 4/15 
</span><span class='line'>  Installing       : libaec-1.0.4-1.ky10.aarch64                                                                                                                         5/15 
</span><span class='line'>  Installing       : keyutils-libs-devel-1.5.10-11.ky10.aarch64                                                                                                          6/15 
</span><span class='line'>  Installing       : java-1.8.0-openjdk-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                                7/15 
</span><span class='line'>  Running scriptlet: java-1.8.0-openjdk-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                                7/15 
</span><span class='line'>  Installing       : hwloc-1.11.9-3.ky10.aarch64                                                                                                                         8/15 
</span><span class='line'>  Installing       : mpich-3.2.1-10.ky10.aarch64                                                                                                                         9/15 
</span><span class='line'>  Running scriptlet: mpich-3.2.1-10.ky10.aarch64                                                                                                                         9/15 
</span><span class='line'>  Installing       : e2fsprogs-devel-1.45.3-4.p01.ky10.aarch64                                                                                                          10/15 
</span><span class='line'>  Running scriptlet: e2fsprogs-devel-1.45.3-4.p01.ky10.aarch64                                                                                                          10/15 
</span><span class='line'>  Installing       : krb5-devel-1.17-9.ky10.aarch64                                                                                                                     11/15 
</span><span class='line'>  Installing       : openssl-devel-1:1.1.1d-9.ky10.aarch64                                                                                                              12/15 
</span><span class='line'>  Installing       : mpich-devel-3.2.1-10.ky10.aarch64                                                                                                                  13/15 
</span><span class='line'>  Installing       : java-1.8.0-openjdk-devel-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                         14/15 
</span><span class='line'>  Running scriptlet: java-1.8.0-openjdk-devel-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                         14/15 
</span><span class='line'>  Installing       : libaec-devel-1.0.4-1.ky10.aarch64                                                                                                                  15/15 
</span><span class='line'>  Running scriptlet: java-1.8.0-openjdk-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                               15/15 
</span><span class='line'>  Running scriptlet: java-1.8.0-openjdk-devel-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                         15/15 
</span><span class='line'>  Running scriptlet: libaec-devel-1.0.4-1.ky10.aarch64                                                                                                                  15/15 
</span><span class='line'>  Verifying        : e2fsprogs-devel-1.45.3-4.p01.ky10.aarch64                                                                                                           1/15 
</span><span class='line'>  Verifying        : hwloc-1.11.9-3.ky10.aarch64                                                                                                                         2/15 
</span><span class='line'>  Verifying        : java-1.8.0-openjdk-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                                3/15 
</span><span class='line'>  Verifying        : java-1.8.0-openjdk-devel-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                          4/15 
</span><span class='line'>  Verifying        : keyutils-libs-devel-1.5.10-11.ky10.aarch64                                                                                                          5/15 
</span><span class='line'>  Verifying        : krb5-devel-1.17-9.ky10.aarch64                                                                                                                      6/15 
</span><span class='line'>  Verifying        : libaec-1.0.4-1.ky10.aarch64                                                                                                                         7/15 
</span><span class='line'>  Verifying        : libaec-devel-1.0.4-1.ky10.aarch64                                                                                                                   8/15 
</span><span class='line'>  Verifying        : libverto-devel-0.3.1-2.ky10.aarch64                                                                                                                 9/15 
</span><span class='line'>  Verifying        : lua-filesystem-1.6.3-10.ky10.aarch64                                                                                                               10/15 
</span><span class='line'>  Verifying        : mpich-3.2.1-10.ky10.aarch64                                                                                                                        11/15 
</span><span class='line'>  Verifying        : mpich-devel-3.2.1-10.ky10.aarch64                                                                                                                  12/15 
</span><span class='line'>  Verifying        : openssl-devel-1:1.1.1d-9.ky10.aarch64                                                                                                              13/15 
</span><span class='line'>  Verifying        : Lmod-8.7.7-1.el8.aarch64                                                                                                                           14/15 
</span><span class='line'>  Verifying        : lua-term-0.07-9.el8.aarch64                                                                                                                        15/15 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  java-1.8.0-openjdk-devel-1:1.8.0.242.b08-1.h5.ky10.aarch64       krb5-devel-1.17-9.ky10.aarch64                             libaec-devel-1.0.4-1.ky10.aarch64               
</span><span class='line'>  mpich-devel-3.2.1-10.ky10.aarch64                                openssl-devel-1:1.1.1d-9.ky10.aarch64                      e2fsprogs-devel-1.45.3-4.p01.ky10.aarch64       
</span><span class='line'>  hwloc-1.11.9-3.ky10.aarch64                                      java-1.8.0-openjdk-1:1.8.0.242.b08-1.h5.ky10.aarch64       keyutils-libs-devel-1.5.10-11.ky10.aarch64      
</span><span class='line'>  libaec-1.0.4-1.ky10.aarch64                                      libverto-devel-0.3.1-2.ky10.aarch64                        lua-filesystem-1.6.3-10.ky10.aarch64            
</span><span class='line'>  mpich-3.2.1-10.ky10.aarch64                                      Lmod-8.7.7-1.el8.aarch64                                   lua-term-0.07-9.el8.aarch64                     
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>[root@col ~]# 
</span><span class='line'>
</span><span class='line'>[root@col ~]# rpmbuild --rebuild hdf5-1.10.5-4.el8.src.rpm 
</span><span class='line'>Installing hdf5-1.10.5-4.el8.src.rpm
</span><span class='line'>warning: hdf5-1.10.5-4.el8.src.rpm: Header V3 RSA/SHA256 Signature, key ID 2f86d6a1: NOKEY
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>error: Failed build dependencies:
</span><span class='line'>        openmpi-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64</span></code></pre></td></tr></table></div></figure>


<h3>再编译openmpi</h3>

<p>源码<a href="https://centos.pkgs.org/8/centos-appstream-aarch64/openmpi-devel-4.1.1-2.el8.aarch64.rpm.html">查找后选择centos8的版本</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# rpmbuild --rebuild openmpi-4.1.1-2.el8.src.rpm 
</span><span class='line'>Installing openmpi-4.1.1-2.el8.src.rpm
</span><span class='line'>warning: openmpi-4.1.1-2.el8.src.rpm: Header V3 RSA/SHA256 Signature, key ID 8483c65d: NOKEY
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>error: Failed build dependencies:
</span><span class='line'>        hwloc-devel &gt;= 2.2.0 is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        libevent-devel is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        libfabric-devel is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        opensm-devel &gt; 3.3.0 is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        papi-devel is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        pmix-devel is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        rdma-core-devel is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        rpm-mpi-hooks is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        ucx-devel is needed by openmpi-4.1.1-2.ky10.ky10.aarch64</span></code></pre></td></tr></table></div></figure>


<p>下载依赖</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# ll *.rpm
</span><span class='line'>-rw------- 1 root root  305031 Jul 23 22:12 cglib-3.2.4-7.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  147131 Jul 23 22:11 easymock-3.5-4.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  131075 Jul 23 22:08 hamcrest-1.3-23.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root   60043 Jul 23 22:08 hamcrest-core-1.3-23.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw-r--r-- 1 root root 8739906 Jul 22 14:57 hdf5-1.10.5-4.el8.src.rpm
</span><span class='line'>-rw------- 1 root root  254060 Jul 23 22:32 hwloc-devel-2.2.0-3.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root   67048 Jul 23 22:32 hwloc-gui-2.2.0-3.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root 2085332 Jul 23 22:32 hwloc-libs-2.2.0-3.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root  307067 Jul 23 22:08 junit-4.12-9.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  457315 Jul 23 22:12 objectweb-asm-6.2-5.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  108627 Jul 23 22:12 objenesis-2.6-2.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root 9846455 Jul 23 22:26 openmpi-4.1.1-2.el8.src.rpm
</span><span class='line'>-rw------- 1 root root  685564 Jul 24 06:23 pmix-2.2.4rc1-1.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root   60776 Jul 24 06:23 pmix-devel-2.2.4rc1-1.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root  305655 Jul 23 22:12 qdox-2.0-3.M9.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root   13320 Jul 23 22:27 rpm-mpi-hooks-8-2.el8.noarch.rpm
</span><span class='line'>-rw------- 1 root root   78511 Jul 23 22:08 slf4j-1.7.25-4.module_el8.0.0+39+6a9b6e22.noarch.rpm
</span><span class='line'>-rw------- 1 root root  541892 Jul 23 22:27 ucx-1.10.1-2.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root  162896 Jul 23 22:27 ucx-devel-1.10.1-2.el8.aarch64.rpm
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install ./rpm-mpi-hooks-8-2.el8.noarch.rpm ./ucx-* 
</span><span class='line'>Last metadata expiration check: 1:03:14 ago on Sat 23 Jul 2022 09:25:01 PM CST.
</span><span class='line'>Dependencies resolved.
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'> Package                                    Architecture                         Version                                      Repository                                 Size
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> rpm-mpi-hooks                              noarch                               8-2.el8                                      @commandline                               13 k
</span><span class='line'> ucx                                        aarch64                              1.10.1-2.el8                                 @commandline                              529 k
</span><span class='line'> ucx-devel                                  aarch64                              1.10.1-2.el8                                 @commandline                              159 k
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'>Install  3 Packages
</span><span class='line'>
</span><span class='line'>Total size: 701 k
</span><span class='line'>Installed size: 2.5 M
</span><span class='line'>Is this ok [y/N]: y
</span><span class='line'>Downloading Packages:
</span><span class='line'>Running transaction check
</span><span class='line'>Transaction check succeeded.
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded.
</span><span class='line'>Running transaction
</span><span class='line'>  Preparing        :                                                                                                                                                      1/1 
</span><span class='line'>  Installing       : ucx-1.10.1-2.el8.aarch64                                                                                                                             1/3 
</span><span class='line'>  Running scriptlet: ucx-1.10.1-2.el8.aarch64                                                                                                                             1/3 
</span><span class='line'>  Installing       : ucx-devel-1.10.1-2.el8.aarch64                                                                                                                       2/3 
</span><span class='line'>  Installing       : rpm-mpi-hooks-8-2.el8.noarch                                                                                                                         3/3 
</span><span class='line'>  Running scriptlet: rpm-mpi-hooks-8-2.el8.noarch                                                                                                                         3/3 
</span><span class='line'>  Verifying        : rpm-mpi-hooks-8-2.el8.noarch                                                                                                                         1/3 
</span><span class='line'>  Verifying        : ucx-1.10.1-2.el8.aarch64                                                                                                                             2/3 
</span><span class='line'>  Verifying        : ucx-devel-1.10.1-2.el8.aarch64                                                                                                                       3/3 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  rpm-mpi-hooks-8-2.el8.noarch                              ucx-1.10.1-2.el8.aarch64                              ucx-devel-1.10.1-2.el8.aarch64                             
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum remove hwloc
</span><span class='line'>Dependencies resolved.
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'> Package                                  Architecture                         Version                                       Repository                                 Size
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Removing:
</span><span class='line'> hwloc                                    aarch64                              1.11.9-3.ky10                                 @ks10-adv-os                              3.2 M
</span><span class='line'>Removing dependent packages:
</span><span class='line'> hwloc-devel                              aarch64                              1.11.9-3.ky10                                 @ks10-adv-os                              405 k
</span><span class='line'> pmix-devel                               aarch64                              3.1.4-2.oe1                                   @ks10-adv-os                              295 k
</span><span class='line'>Removing unused dependencies:
</span><span class='line'> munge                                    aarch64                              0.5.13-3.oe1                                  @ks10-adv-os                              442 k
</span><span class='line'> pmix                                     aarch64                              3.1.4-2.oe1                                   @ks10-adv-os                              2.7 M
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Remove  5 Packages
</span><span class='line'>
</span><span class='line'>Freed space: 7.0 M
</span><span class='line'>Is this ok [y/N]: y
</span><span class='line'>Running transaction check
</span><span class='line'>Transaction check succeeded.
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded.
</span><span class='line'>Running transaction
</span><span class='line'>  Preparing        :                                                                                                                                                     1/1 
</span><span class='line'>  Erasing          : pmix-devel-3.1.4-2.oe1.aarch64                                                                                                                      1/5 
</span><span class='line'>  Running scriptlet: pmix-devel-3.1.4-2.oe1.aarch64                                                                                                                      1/5 
</span><span class='line'>  Erasing          : hwloc-devel-1.11.9-3.ky10.aarch64                                                                                                                   2/5 
</span><span class='line'>  Erasing          : pmix-3.1.4-2.oe1.aarch64                                                                                                                            3/5 
</span><span class='line'>  Running scriptlet: pmix-3.1.4-2.oe1.aarch64                                                                                                                            3/5 
</span><span class='line'>  Erasing          : hwloc-1.11.9-3.ky10.aarch64                                                                                                                         4/5 
</span><span class='line'>  Running scriptlet: munge-0.5.13-3.oe1.aarch64                                                                                                                          5/5 
</span><span class='line'>  Erasing          : munge-0.5.13-3.oe1.aarch64                                                                                                                          5/5 
</span><span class='line'>  Running scriptlet: munge-0.5.13-3.oe1.aarch64                                                                                                                          5/5 
</span><span class='line'>  Verifying        : hwloc-1.11.9-3.ky10.aarch64                                                                                                                         1/5 
</span><span class='line'>  Verifying        : hwloc-devel-1.11.9-3.ky10.aarch64                                                                                                                   2/5 
</span><span class='line'>  Verifying        : munge-0.5.13-3.oe1.aarch64                                                                                                                          3/5 
</span><span class='line'>  Verifying        : pmix-3.1.4-2.oe1.aarch64                                                                                                                            4/5 
</span><span class='line'>  Verifying        : pmix-devel-3.1.4-2.oe1.aarch64                                                                                                                      5/5 
</span><span class='line'>
</span><span class='line'>Removed:
</span><span class='line'>  hwloc-1.11.9-3.ky10.aarch64      hwloc-devel-1.11.9-3.ky10.aarch64      pmix-devel-3.1.4-2.oe1.aarch64      munge-0.5.13-3.oe1.aarch64      pmix-3.1.4-2.oe1.aarch64     
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>[root@col ~]# 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install libevent-devel libfabric-devel papi-devel rdma-core-devel opensm-devel ./hwloc-libs-2.2.0-3.el8.aarch64.rpm ./hwloc-devel-2.2.0-3.el8.aarch64.rpm ./hwloc-gui-2.2.0-3.el8.aarch64.rpm ./pmix-2.2.4rc1-1.el8.aarch64.rpm ./pmix-devel-2.2.4rc1-1.el8.aarch64.rpm            
</span><span class='line'>
</span><span class='line'>[root@col ~]# rpmbuild --rebuild openmpi-4.1.1-2.el8.src.rpm 
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install ~/rpmbuild/RPMS/aarch64/openmpi-4.1.1-2.ky10.ky10.aarch64.rpm ~/rpmbuild/RPMS/aarch64/openmpi-devel-4.1.1-2.ky10.ky10.aarch64.rpm 
</span></code></pre></td></tr></table></div></figure>


<h3>mpich</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# rpmbuild --rebuild hdf5-1.10.5-4.el8.src.rpm   
</span><span class='line'>Installing hdf5-1.10.5-4.el8.src.rpm
</span><span class='line'>warning: hdf5-1.10.5-4.el8.src.rpm: Header V3 RSA/SHA256 Signature, key ID 2f86d6a1: NOKEY
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>error: Failed build dependencies:
</span><span class='line'>        mpich-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>      
</span><span class='line'>[root@col ~]# yum install mpich-devel mpich 
</span><span class='line'>Last metadata expiration check: 1:55:24 ago on Sun 24 Jul 2022 04:56:06 AM CST.
</span><span class='line'>Error: 
</span><span class='line'> Problem 1: package hwloc-1.11.9-3.ky10.aarch64 obsoletes hwloc-libs provided by hwloc-libs-2.2.0-3.el8.aarch64
</span><span class='line'>  - package mpich-3.2.1-10.ky10.aarch64 requires libhwloc.so.5()(64bit), but none of the providers can be installed
</span><span class='line'>  - package openmpi-4.1.1-2.ky10.ky10.aarch64 requires libhwloc.so.15()(64bit), but none of the providers can be installed
</span><span class='line'>  - conflicting requests
</span><span class='line'>  - problem with installed package openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'> Problem 2: package mpich-3.2.1-10.ky10.aarch64 requires libhwloc.so.5()(64bit), but none of the providers can be installed
</span><span class='line'>  - package hwloc-1.11.9-3.ky10.aarch64 obsoletes hwloc-libs provided by hwloc-libs-2.2.0-3.el8.aarch64
</span><span class='line'>  - package mpich-devel-3.2.1-10.ky10.aarch64 requires mpich = 3.2.1-10.ky10, but none of the providers can be installed
</span><span class='line'>  - package openmpi-devel-4.1.1-2.ky10.ky10.aarch64 requires libhwloc.so.15()(64bit), but none of the providers can be installed
</span><span class='line'>  - conflicting requests
</span><span class='line'>  - problem with installed package openmpi-devel-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>(try to add '--skip-broken' to skip uninstallable packages or '--nobest' to use not only best candidate packages)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[root@col ~]# ll *.rpm
</span><span class='line'>-rw------- 1 root root   305031 Jul 23 22:12 cglib-3.2.4-7.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root   147131 Jul 23 22:11 easymock-3.5-4.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root   131075 Jul 23 22:08 hamcrest-1.3-23.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root    60043 Jul 23 22:08 hamcrest-core-1.3-23.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw-r--r-- 1 root root  8739906 Jul 22 14:57 hdf5-1.10.5-4.el8.src.rpm
</span><span class='line'>-rw------- 1 root root   254060 Jul 23 22:32 hwloc-devel-2.2.0-3.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root    67048 Jul 23 22:32 hwloc-gui-2.2.0-3.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root  2085332 Jul 23 22:32 hwloc-libs-2.2.0-3.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root   307067 Jul 23 22:08 junit-4.12-9.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root 30515938 Jul 24 06:55 mpich-3.4.1-1.el8.src.rpm
</span><span class='line'>-rw------- 1 root root   457315 Jul 23 22:12 objectweb-asm-6.2-5.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root   108627 Jul 23 22:12 objenesis-2.6-2.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  9846455 Jul 23 22:26 openmpi-4.1.1-2.el8.src.rpm
</span><span class='line'>-rw------- 1 root root   685564 Jul 24 06:23 pmix-2.2.4rc1-1.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root    60776 Jul 24 06:23 pmix-devel-2.2.4rc1-1.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root   305655 Jul 23 22:12 qdox-2.0-3.M9.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root    13320 Jul 23 22:27 rpm-mpi-hooks-8-2.el8.noarch.rpm
</span><span class='line'>-rw------- 1 root root    78511 Jul 23 22:08 slf4j-1.7.25-4.module_el8.0.0+39+6a9b6e22.noarch.rpm
</span><span class='line'>-rw------- 1 root root   541892 Jul 23 22:27 ucx-1.10.1-2.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root   162896 Jul 23 22:27 ucx-devel-1.10.1-2.el8.aarch64.rpm
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[root@col ~]# rpmbuild --rebuild --nocheck mpich-3.4.1-1.el8.src.rpm                                                                                    
</span><span class='line'>
</span><span class='line'>[root@col ~]# rpm -ivh --force ~/rpmbuild/RPMS/aarch64/mpich-3.4.1-1.ky10.ky10.aarch64.rpm ~/rpmbuild/RPMS/aarch64/mpich-devel-3.4.1-1.ky10.ky10.aarch64.rpm           
</span><span class='line'>error: Failed dependencies:
</span><span class='line'>        redhat-rpm-config is needed by mpich-devel-3.4.1-1.ky10.ky10.aarch64
</span><span class='line'>[root@col ~]# rpm -ivh --force --nodeps ~/rpmbuild/RPMS/aarch64/mpich-3.4.1-1.ky10.ky10.aarch64.rpm ~/rpmbuild/RPMS/aarch64/mpich-devel-3.4.1-1.ky10.ky10.aarch64.rpm
</span><span class='line'>Verifying...                          ################################# [100%]
</span><span class='line'>Preparing...                          ################################# [100%]
</span><span class='line'>Updating / installing...
</span><span class='line'>   1:mpich-3.4.1-1.ky10.ky10          ################################# [ 50%]
</span><span class='line'>   2:mpich-devel-3.4.1-1.ky10.ky10    ################################# [100%]
</span></code></pre></td></tr></table></div></figure>


<p>这次终于可以编译hdf5了，时间会相对长一点，慢慢等。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# rpmbuild --rebuild hdf5-1.10.5-4.el8.src.rpm
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install ~/rpmbuild/RPMS/aarch64/hdf5-1.10.5-4.ky10.ky10.aarch64.rpm ~/rpmbuild/RPMS/aarch64/hdf5-devel-1.10.5-4.ky10.ky10.aarch64.rpm 
</span></code></pre></td></tr></table></div></figure>


<h2>armadillo</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# yum install postgresql96 postgresql96-server postgis24_96                                  
</span><span class='line'>Last metadata expiration check: 0:46:44 ago on Sun 24 Jul 2022 07:56:56 AM CST.
</span><span class='line'>Error: 
</span><span class='line'> Problem: package postgis24_96-2.4.9-3.rhel8.aarch64 requires libgdal.so.28()(64bit), but none of the providers can be installed
</span><span class='line'>  - package postgis24_96-2.4.9-3.rhel8.aarch64 requires gdal32-libs &gt;= 3.2.0, but none of the providers can be installed
</span><span class='line'>  - package gdal32-libs-3.2.2-12.rhel8.aarch64 requires libhdf5.so.103()(64bit), but none of the providers can be installed
</span><span class='line'>  - package gdal32-libs-3.2.2-13.rhel8.aarch64 requires libhdf5.so.103()(64bit), but none of the providers can be installed
</span><span class='line'>  - cannot install both hdf5-1.8.20-7.ky10.aarch64 and hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>  - package armadillo-9.600.6-3.oe1.aarch64 requires libhdf5.so.10()(64bit), but none of the providers can be installed
</span><span class='line'>  - package gdal32-libs-3.2.2-12.rhel8.aarch64 requires libarmadillo.so.9()(64bit), but none of the providers can be installed
</span><span class='line'>  - package gdal32-libs-3.2.2-13.rhel8.aarch64 requires libarmadillo.so.9()(64bit), but none of the providers can be installed
</span><span class='line'>  - cannot install the best candidate for the job
</span><span class='line'>  - nothing provides libgfortran.so.5()(64bit) needed by hdf5-1.10.5-4.el8.aarch64
</span><span class='line'>  - nothing provides libgfortran.so.5(GFORTRAN_8)(64bit) needed by hdf5-1.10.5-4.el8.aarch64
</span><span class='line'>(try to add '--allowerasing' to command line to replace conflicting packages or '--skip-broken' to skip uninstallable packages or '--nobest' to use not only best candidate packages)
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum list armadillo --showduplicates
</span><span class='line'>Last metadata expiration check: 0:47:59 ago on Sun 24 Jul 2022 07:56:56 AM CST.
</span><span class='line'>Available Packages
</span><span class='line'>armadillo.aarch64                                                                  9.600.6-3.oe1                                                                  ks10-adv-os
</span><span class='line'>armadillo.aarch64                                                                  10.8.2-1.el8                                                                   epel       
</span></code></pre></td></tr></table></div></figure>


<p>gdal32-libs 依赖的是 libarmadillo.so.9 ，直接找openEuler的版本<a href="https://cmcc.mirrors.ustc.edu.cn/openeuler/openEuler-20.03-LTS-SP1/update/source/Packages/">armadillo-9.600.6-4.oe1.src.rpm</a> 。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# rpmbuild --rebuild armadillo-9.600.6-4.oe1.src.rpm 
</span><span class='line'>Installing armadillo-9.600.6-4.oe1.src.rpm
</span><span class='line'>warning: armadillo-9.600.6-4.oe1.src.rpm: Header V3 RSA/SHA1 Signature, key ID b25e7f66: NOKEY
</span><span class='line'>error: bad date in %changelog: Fri 26 Mar 2021 sunguoshuai &lt;sunguoshuai@huawei.com&gt; - 9.600.6-4
</span><span class='line'>error: Failed build dependencies:
</span><span class='line'>        SuperLU-devel is needed by armadillo-9.600.6-4.ky10.aarch64
</span><span class='line'>        arpack-devel is needed by armadillo-9.600.6-4.ky10.aarch64
</span><span class='line'>        lapack-devel is needed by armadillo-9.600.6-4.ky10.aarch64
</span><span class='line'>        openblas-devel is needed by armadillo-9.600.6-4.ky10.aarch64
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install SuperLU-devel arpack-devel-3.5.0
</span><span class='line'>Last metadata expiration check: 0:55:00 ago on Sun 24 Jul 2022 07:56:56 AM CST.
</span><span class='line'>Dependencies resolved.
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'> Package                                     Architecture                         Version                                     Repository                                Size
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> SuperLU-devel                               aarch64                              5.2.1-6.oe1                                 ks10-adv-os                               22 k
</span><span class='line'> arpack-devel                                aarch64                              3.5.0-7.oe1                                 ks10-adv-os                              8.2 k
</span><span class='line'>Installing dependencies:
</span><span class='line'> SuperLU                                     aarch64                              5.2.1-6.oe1                                 ks10-adv-os                              139 k
</span><span class='line'> arpack                                      aarch64                              3.5.0-7.oe1                                 ks10-adv-os                              141 k
</span><span class='line'> openblas                                    aarch64                              0.3.3-3.ky10                                ks10-adv-os                               46 M
</span><span class='line'> openblas-devel                              aarch64                              0.3.3-3.ky10                                ks10-adv-os                               83 k
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Install  6 Packages
</span><span class='line'>
</span><span class='line'>Total download size: 47 M
</span><span class='line'>Installed size: 286 M
</span><span class='line'>Is this ok [y/N]: y
</span><span class='line'>Downloading Packages:
</span><span class='line'>(1/6): SuperLU-devel-5.2.1-6.oe1.aarch64.rpm                                                                                                 3.5 kB/s |  22 kB     00:06    
</span><span class='line'>(2/6): arpack-3.5.0-7.oe1.aarch64.rpm                                                                                                         11 kB/s | 141 kB     00:12    
</span><span class='line'>(3/6): SuperLU-5.2.1-6.oe1.aarch64.rpm                                                                                                        11 kB/s | 139 kB     00:12    
</span><span class='line'>(4/6): arpack-devel-3.5.0-7.oe1.aarch64.rpm                                                                                                  1.4 kB/s | 8.2 kB     00:06    
</span><span class='line'>(5/6): openblas-devel-0.3.3-3.ky10.aarch64.rpm                                                                                               2.6 MB/s |  83 kB     00:00    
</span><span class='line'>(6/6): openblas-0.3.3-3.ky10.aarch64.rpm                                                                                                     258 kB/s |  46 MB     03:03    
</span><span class='line'>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Total                                                                                                                                        244 kB/s |  47 MB     03:15     
</span><span class='line'>Running transaction check
</span><span class='line'>Transaction check succeeded.
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded.
</span><span class='line'>Running transaction
</span><span class='line'>  Preparing        :                                                                                                                                                     1/1 
</span><span class='line'>  Installing       : openblas-devel-0.3.3-3.ky10.aarch64                                                                                                                 1/6 
</span><span class='line'>  Installing       : openblas-0.3.3-3.ky10.aarch64                                                                                                                       2/6 
</span><span class='line'>  Running scriptlet: openblas-0.3.3-3.ky10.aarch64                                                                                                                       2/6 
</span><span class='line'>  Installing       : SuperLU-5.2.1-6.oe1.aarch64                                                                                                                         3/6 
</span><span class='line'>  Running scriptlet: SuperLU-5.2.1-6.oe1.aarch64                                                                                                                         3/6 
</span><span class='line'>  Installing       : arpack-3.5.0-7.oe1.aarch64                                                                                                                          4/6 
</span><span class='line'>  Running scriptlet: arpack-3.5.0-7.oe1.aarch64                                                                                                                          4/6 
</span><span class='line'>  Installing       : arpack-devel-3.5.0-7.oe1.aarch64                                                                                                                    5/6 
</span><span class='line'>  Installing       : SuperLU-devel-5.2.1-6.oe1.aarch64                                                                                                                   6/6 
</span><span class='line'>  Running scriptlet: SuperLU-devel-5.2.1-6.oe1.aarch64                                                                                                                   6/6 
</span><span class='line'>  Verifying        : SuperLU-5.2.1-6.oe1.aarch64                                                                                                                         1/6 
</span><span class='line'>  Verifying        : SuperLU-devel-5.2.1-6.oe1.aarch64                                                                                                                   2/6 
</span><span class='line'>  Verifying        : arpack-3.5.0-7.oe1.aarch64                                                                                                                          3/6 
</span><span class='line'>  Verifying        : arpack-devel-3.5.0-7.oe1.aarch64                                                                                                                    4/6 
</span><span class='line'>  Verifying        : openblas-0.3.3-3.ky10.aarch64                                                                                                                       5/6 
</span><span class='line'>  Verifying        : openblas-devel-0.3.3-3.ky10.aarch64                                                                                                                 6/6 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  SuperLU-devel-5.2.1-6.oe1.aarch64      arpack-devel-3.5.0-7.oe1.aarch64    SuperLU-5.2.1-6.oe1.aarch64    arpack-3.5.0-7.oe1.aarch64    openblas-0.3.3-3.ky10.aarch64   
</span><span class='line'>  openblas-devel-0.3.3-3.ky10.aarch64   
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>[root@col ~]# 
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install lapack-devel 
</span><span class='line'>Last metadata expiration check: 0:59:07 ago on Sun 24 Jul 2022 07:56:56 AM CST.
</span><span class='line'>Dependencies resolved.
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'> Package                                   Architecture                         Version                                       Repository                                Size
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> lapack-devel                              aarch64                              3.8.0-16.ky10                                 ks10-adv-os                              4.7 M
</span><span class='line'>Installing dependencies:
</span><span class='line'> lapack                                    aarch64                              3.8.0-16.ky10                                 ks10-adv-os                              4.5 M
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Install  2 Packages
</span><span class='line'>
</span><span class='line'>Total download size: 9.2 M
</span><span class='line'>Installed size: 47 M
</span><span class='line'>Is this ok [y/N]: y
</span><span class='line'>Downloading Packages:
</span><span class='line'>(1/2): lapack-3.8.0-16.ky10.aarch64.rpm                                                                                                      176 kB/s | 4.5 MB     00:26    
</span><span class='line'>(2/2): lapack-devel-3.8.0-16.ky10.aarch64.rpm                                                                                                184 kB/s | 4.7 MB     00:26    
</span><span class='line'>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Total                                                                                                                                        360 kB/s | 9.2 MB     00:26     
</span><span class='line'>Running transaction check
</span><span class='line'>Transaction check succeeded.
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded.
</span><span class='line'>Running transaction
</span><span class='line'>  Preparing        :                                                                                                                                                     1/1 
</span><span class='line'>  Installing       : lapack-3.8.0-16.ky10.aarch64                                                                                                                        1/2 
</span><span class='line'>  Running scriptlet: lapack-3.8.0-16.ky10.aarch64                                                                                                                        1/2 
</span><span class='line'>  Installing       : lapack-devel-3.8.0-16.ky10.aarch64                                                                                                                  2/2 
</span><span class='line'>  Running scriptlet: lapack-devel-3.8.0-16.ky10.aarch64                                                                                                                  2/2 
</span><span class='line'>  Verifying        : lapack-3.8.0-16.ky10.aarch64                                                                                                                        1/2 
</span><span class='line'>  Verifying        : lapack-devel-3.8.0-16.ky10.aarch64                                                                                                                  2/2 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  lapack-devel-3.8.0-16.ky10.aarch64                                                       lapack-3.8.0-16.ky10.aarch64                                                      
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>[root@col ~]# 
</span><span class='line'>
</span><span class='line'>[root@col ~]# rpmbuild --rebuild armadillo-9.600.6-4.oe1.src.rpm 
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install ~/rpmbuild/RPMS/aarch64/armadillo-9.600.6-4.ky10.aarch64.rpm 
</span></code></pre></td></tr></table></div></figure>


<h2>安装</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# yum install postgresql96 postgresql96-server postgis24_96                                                                                                      
</span><span class='line'>Last metadata expiration check: 1:00:42 ago on Sun 24 Jul 2022 07:56:56 AM CST.
</span><span class='line'>Dependencies resolved.
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'> Package                                         Architecture                      Version                                       Repository                             Size
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> postgis24_96                                    aarch64                           2.4.9-3.rhel8                                 pgdg96                                3.2 M
</span><span class='line'> postgresql96                                    aarch64                           9.6.24-1PGDG.rhel8                            pgdg96                                1.5 M
</span><span class='line'> postgresql96-server                             aarch64                           9.6.24-1PGDG.rhel8                            pgdg96                                4.5 M
</span><span class='line'>Upgrading:
</span><span class='line'> minizip                                         aarch64                           2.8.9-2.el8                                   epel                                  119 k
</span><span class='line'>Installing dependencies:
</span><span class='line'> boost-atomic                                    aarch64                           1.66.0-18.ky10                                ks10-adv-os                            11 k
</span><span class='line'> boost-chrono                                    aarch64                           1.66.0-18.ky10                                ks10-adv-os                            20 k
</span><span class='line'> boost-date-time                                 aarch64                           1.66.0-18.ky10                                ks10-adv-os                            26 k
</span><span class='line'> boost-serialization                             aarch64                           1.66.0-18.ky10                                ks10-adv-os                           105 k
</span><span class='line'> boost-system                                    aarch64                           1.66.0-18.ky10                                ks10-adv-os                            15 k
</span><span class='line'> boost-thread                                    aarch64                           1.66.0-18.ky10                                ks10-adv-os                            53 k
</span><span class='line'> cfitsio                                         aarch64                           3.450-5.oe1                                   ks10-adv-os                           508 k
</span><span class='line'> jasper-libs                                     aarch64                           2.0.14-7.ky10                                 ks10-adv-os                           146 k
</span><span class='line'> libdap                                          aarch64                           3.19.1-3.oe1                                  ks10-adv-os                           562 k
</span><span class='line'> libusb                                          aarch64                           1:0.1.5-15.ky10                               ks10-adv-os                            32 k
</span><span class='line'> protobuf                                        aarch64                           3.9.0-7.ky10                                  ks10-adv-os                           1.5 M
</span><span class='line'> protobuf-c                                      aarch64                           1.3.2-2.ky10                                  ks10-adv-os                           103 k
</span><span class='line'> CGAL                                            aarch64                           4.14-1.rhel8                                  pgdg-common                           473 k
</span><span class='line'> SFCGAL                                          aarch64                           1.3.8-1.rhel8                                 pgdg-common                            20 k
</span><span class='line'> SFCGAL-libs                                     aarch64                           1.3.8-1.rhel8                                 pgdg-common                           1.6 M
</span><span class='line'> gdal32-libs                                     aarch64                           3.2.2-13.rhel8                                pgdg-common                           7.4 M
</span><span class='line'> geos39                                          aarch64                           3.9.2-1.rhel8                                 pgdg-common                           619 k
</span><span class='line'> libgeotiff16                                    aarch64                           1.6.0-6.rhel8                                 pgdg-common                            98 k
</span><span class='line'> libgeotiff16-devel                              aarch64                           1.6.0-6.rhel8                                 pgdg-common                            33 k
</span><span class='line'> librttopo                                       aarch64                           1.1.0-1.rhel8                                 pgdg-common                           161 k
</span><span class='line'> libspatialite50                                 aarch64                           5.0.1-2.rhel8                                 pgdg-common                           2.7 M
</span><span class='line'> libspatialite50-devel                           aarch64                           5.0.1-2.rhel8                                 pgdg-common                            99 k
</span><span class='line'> ogdi41                                          aarch64                           4.1.0-3.rhel8                                 pgdg-common                           220 k
</span><span class='line'> proj72                                          aarch64                           7.2.1-1.rhel8                                 pgdg-common                           2.4 M
</span><span class='line'> proj80                                          aarch64                           8.0.1-1.rhel8                                 pgdg-common                           2.4 M
</span><span class='line'> postgresql96-contrib                            aarch64                           9.6.24-1PGDG.rhel8                            pgdg96                                576 k
</span><span class='line'> postgresql96-libs                               aarch64                           9.6.24-1PGDG.rhel8                            pgdg96                                339 k
</span><span class='line'> freexl                                          aarch64                           1.0.6-4.el8                                   epel                                   33 k
</span><span class='line'> gpsbabel                                        aarch64                           1.6.0-3.el8                                   epel                                  892 k
</span><span class='line'> hdf                                             aarch64                           4.2.14-5.el8                                  epel                                  615 k
</span><span class='line'> libbsd                                          aarch64                           0.9.1-4.el8                                   epel                                  104 k
</span><span class='line'> libgta                                          aarch64                           1.2.1-1.el8                                   epel                                   33 k
</span><span class='line'> minizip1.2                                      aarch64                           1.2.11-24.el8                                 epel                                   32 k
</span><span class='line'> netcdf                                          aarch64                           4.7.0-2.el8                                   epel                                  617 k
</span><span class='line'> shapelib                                        aarch64                           1.5.0-1.el8                                   epel                                   78 k
</span><span class='line'> xerces-c                                        aarch64                           3.2.2-3.el8                                   epel                                  861 k
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Install  39 Packages
</span><span class='line'>Upgrade   1 Package
</span><span class='line'>
</span><span class='line'>Total download size: 35 M
</span><span class='line'>Is this ok [y/N]: y
</span><span class='line'>Downloading Packages:
</span><span class='line'>(1/40): boost-atomic-1.66.0-18.ky10.aarch64.rpm                                                                                               51 kB/s |  11 kB     00:00    
</span><span class='line'>(2/40): boost-chrono-1.66.0-18.ky10.aarch64.rpm                                                                                               85 kB/s |  20 kB     00:00    
</span><span class='line'>(3/40): boost-date-time-1.66.0-18.ky10.aarch64.rpm                                                                                           108 kB/s |  26 kB     00:00    
</span><span class='line'>(4/40): boost-system-1.66.0-18.ky10.aarch64.rpm                                                                                              996 kB/s |  15 kB     00:00    
</span><span class='line'>(5/40): boost-thread-1.66.0-18.ky10.aarch64.rpm                                                                                              2.4 MB/s |  53 kB     00:00    
</span><span class='line'>(6/40): boost-serialization-1.66.0-18.ky10.aarch64.rpm                                                                                       2.4 MB/s | 105 kB     00:00    
</span><span class='line'>(7/40): jasper-libs-2.0.14-7.ky10.aarch64.rpm                                                                                                3.3 MB/s | 146 kB     00:00    
</span><span class='line'>(8/40): libusb-0.1.5-15.ky10.aarch64.rpm                                                                                                     1.8 MB/s |  32 kB     00:00    
</span><span class='line'>(9/40): cfitsio-3.450-5.oe1.aarch64.rpm                                                                                                      4.5 MB/s | 508 kB     00:00    
</span><span class='line'>(10/40): protobuf-c-1.3.2-2.ky10.aarch64.rpm                                                                                                 3.1 MB/s | 103 kB     00:00    
</span><span class='line'>(11/40): libdap-3.19.1-3.oe1.aarch64.rpm                                                                                                     3.9 MB/s | 562 kB     00:00    
</span><span class='line'>(12/40): SFCGAL-1.3.8-1.rhel8.aarch64.rpm                                                                                                     16 kB/s |  20 kB     00:01    
</span><span class='line'>(13/40): CGAL-4.14-1.rhel8.aarch64.rpm                                                                                                       220 kB/s | 473 kB     00:02    
</span><span class='line'>(14/40): SFCGAL-libs-1.3.8-1.rhel8.aarch64.rpm                                                                                               1.2 MB/s | 1.6 MB     00:01    
</span><span class='line'>(15/40): gdal32-libs-3.2.2-13.rhel8.aarch64.rpm                                                                                              4.4 MB/s | 7.4 MB     00:01    
</span><span class='line'>(16/40): protobuf-3.9.0-7.ky10.aarch64.rpm                                                                                                   385 kB/s | 1.5 MB     00:04    
</span><span class='line'>(17/40): geos39-3.9.2-1.rhel8.aarch64.rpm                                                                                                    452 kB/s | 619 kB     00:01    
</span><span class='line'>(18/40): libgeotiff16-1.6.0-6.rhel8.aarch64.rpm                                                                                              438 kB/s |  98 kB     00:00    
</span><span class='line'>(19/40): libgeotiff16-devel-1.6.0-6.rhel8.aarch64.rpm                                                                                        152 kB/s |  33 kB     00:00    
</span><span class='line'>(20/40): librttopo-1.1.0-1.rhel8.aarch64.rpm                                                                                                 602 kB/s | 161 kB     00:00    
</span><span class='line'>(21/40): libspatialite50-5.0.1-2.rhel8.aarch64.rpm                                                                                           4.2 MB/s | 2.7 MB     00:00    
</span><span class='line'>(22/40): libspatialite50-devel-5.0.1-2.rhel8.aarch64.rpm                                                                                     202 kB/s |  99 kB     00:00    
</span><span class='line'>(23/40): ogdi41-4.1.0-3.rhel8.aarch64.rpm                                                                                                    499 kB/s | 220 kB     00:00    
</span><span class='line'>(24/40): proj72-7.2.1-1.rhel8.aarch64.rpm                                                                                                    5.1 MB/s | 2.4 MB     00:00    
</span><span class='line'>(25/40): proj80-8.0.1-1.rhel8.aarch64.rpm                                                                                                    2.8 MB/s | 2.4 MB     00:00    
</span><span class='line'>(26/40): postgis24_96-2.4.9-3.rhel8.aarch64.rpm                                                                                              2.2 MB/s | 3.2 MB     00:01    
</span><span class='line'>(27/40): postgresql96-contrib-9.6.24-1PGDG.rhel8.aarch64.rpm                                                                                 961 kB/s | 576 kB     00:00    
</span><span class='line'>(28/40): postgresql96-9.6.24-1PGDG.rhel8.aarch64.rpm                                                                                         1.2 MB/s | 1.5 MB     00:01    
</span><span class='line'>(29/40): postgresql96-libs-9.6.24-1PGDG.rhel8.aarch64.rpm                                                                                    1.5 MB/s | 339 kB     00:00    
</span><span class='line'>(30/40): postgresql96-server-9.6.24-1PGDG.rhel8.aarch64.rpm                                                                                  5.3 MB/s | 4.5 MB     00:00    
</span><span class='line'>(31/40): freexl-1.0.6-4.el8.aarch64.rpm                                                                                                       17 kB/s |  33 kB     00:01    
</span><span class='line'>(32/40): libbsd-0.9.1-4.el8.aarch64.rpm                                                                                                       43 kB/s | 104 kB     00:02    
</span><span class='line'>(33/40): libgta-1.2.1-1.el8.aarch64.rpm                                                                                                       17 kB/s |  33 kB     00:01    
</span><span class='line'>(34/40): minizip1.2-1.2.11-24.el8.aarch64.rpm                                                                                                 16 kB/s |  32 kB     00:02    
</span><span class='line'>(35/40): hdf-4.2.14-5.el8.aarch64.rpm                                                                                                         18 kB/s | 615 kB     00:33    
</span><span class='line'>(36/40): shapelib-1.5.0-1.el8.aarch64.rpm                                                                                                     21 kB/s |  78 kB     00:03    
</span><span class='line'>(37/40): gpsbabel-1.6.0-3.el8.aarch64.rpm                                                                                                     21 kB/s | 892 kB     00:42    
</span><span class='line'>(38/40): minizip-2.8.9-2.el8.aarch64.rpm                                                                                                      26 kB/s | 119 kB     00:04    
</span><span class='line'>(39/40): netcdf-4.7.0-2.el8.aarch64.rpm                                                                                                       11 kB/s | 617 kB     00:55    
</span><span class='line'>(40/40): xerces-c-3.2.2-3.el8.aarch64.rpm                                                                                                     12 kB/s | 861 kB     01:09    
</span><span class='line'>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Total                                                                                                                                        310 kB/s |  35 MB     01:53     
</span><span class='line'>Running transaction check
</span><span class='line'>Transaction check succeeded.
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded.
</span><span class='line'>Running transaction
</span><span class='line'>  Preparing        :                                                                                                                                                     1/1 
</span><span class='line'>  Installing       : postgresql96-libs-9.6.24-1PGDG.rhel8.aarch64                                                                                                       1/41 
</span><span class='line'>  Running scriptlet: postgresql96-libs-9.6.24-1PGDG.rhel8.aarch64                                                                                                       1/41 
</span><span class='line'>  Installing       : geos39-3.9.2-1.rhel8.aarch64                                                                                                                       2/41 
</span><span class='line'>  Running scriptlet: geos39-3.9.2-1.rhel8.aarch64                                                                                                                       2/41 
</span><span class='line'>  Installing       : boost-system-1.66.0-18.ky10.aarch64                                                                                                                3/41 
</span><span class='line'>  Installing       : postgresql96-9.6.24-1PGDG.rhel8.aarch64                                                                                                            4/41 
</span><span class='line'>  Running scriptlet: postgresql96-9.6.24-1PGDG.rhel8.aarch64                                                                                                            4/41 
</span><span class='line'>  Installing       : proj80-8.0.1-1.rhel8.aarch64                                                                                                                       5/41 
</span><span class='line'>  Running scriptlet: proj80-8.0.1-1.rhel8.aarch64                                                                                                                       5/41 
</span><span class='line'>  Installing       : libgeotiff16-1.6.0-6.rhel8.aarch64                                                                                                                 6/41 
</span><span class='line'>  Running scriptlet: libgeotiff16-1.6.0-6.rhel8.aarch64                                                                                                                 6/41 
</span><span class='line'>  Installing       : boost-chrono-1.66.0-18.ky10.aarch64                                                                                                                7/41 
</span><span class='line'>  Installing       : boost-thread-1.66.0-18.ky10.aarch64                                                                                                                8/41 
</span><span class='line'>  Installing       : xerces-c-3.2.2-3.el8.aarch64                                                                                                                       9/41 
</span><span class='line'>  Installing       : hdf-4.2.14-5.el8.aarch64                                                                                                                          10/41 
</span><span class='line'>  Installing       : freexl-1.0.6-4.el8.aarch64                                                                                                                        11/41 
</span><span class='line'>  Installing       : boost-date-time-1.66.0-18.ky10.aarch64                                                                                                            12/41 
</span><span class='line'>  Installing       : boost-atomic-1.66.0-18.ky10.aarch64                                                                                                               13/41 
</span><span class='line'>  Installing       : CGAL-4.14-1.rhel8.aarch64                                                                                                                         14/41 
</span><span class='line'>  Running scriptlet: CGAL-4.14-1.rhel8.aarch64                                                                                                                         14/41 
</span><span class='line'>  Installing       : netcdf-4.7.0-2.el8.aarch64                                                                                                                        15/41 
</span><span class='line'>  Installing       : libgeotiff16-devel-1.6.0-6.rhel8.aarch64                                                                                                          16/41 
</span><span class='line'>  Running scriptlet: postgresql96-server-9.6.24-1PGDG.rhel8.aarch64                                                                                                    17/41 
</span><span class='line'>  Installing       : postgresql96-server-9.6.24-1PGDG.rhel8.aarch64                                                                                                    17/41 
</span><span class='line'>  Running scriptlet: postgresql96-server-9.6.24-1PGDG.rhel8.aarch64                                                                                                    17/41 
</span><span class='line'>  Installing       : postgresql96-contrib-9.6.24-1PGDG.rhel8.aarch64                                                                                                   18/41 
</span><span class='line'>  Installing       : librttopo-1.1.0-1.rhel8.aarch64                                                                                                                   19/41 
</span><span class='line'>  Installing       : shapelib-1.5.0-1.el8.aarch64                                                                                                                      20/41 
</span><span class='line'>  Installing       : libgta-1.2.1-1.el8.aarch64                                                                                                                        21/41 
</span><span class='line'>  Installing       : libbsd-0.9.1-4.el8.aarch64                                                                                                                        22/41 
</span><span class='line'>  Upgrading        : minizip-2.8.9-2.el8.aarch64                                                                                                                       23/41 
</span><span class='line'>  Running scriptlet: minizip-2.8.9-2.el8.aarch64                                                                                                                       23/41 
</span><span class='line'>  Installing       : libspatialite50-5.0.1-2.rhel8.aarch64                                                                                                             24/41 
</span><span class='line'>  Running scriptlet: libspatialite50-5.0.1-2.rhel8.aarch64                                                                                                             24/41 
</span><span class='line'>  Installing       : libspatialite50-devel-5.0.1-2.rhel8.aarch64                                                                                                       25/41 
</span><span class='line'>  Running scriptlet: libspatialite50-devel-5.0.1-2.rhel8.aarch64                                                                                                       25/41 
</span><span class='line'>  Installing       : proj72-7.2.1-1.rhel8.aarch64                                                                                                                      26/41 
</span><span class='line'>  Running scriptlet: proj72-7.2.1-1.rhel8.aarch64                                                                                                                      26/41 
</span><span class='line'>  Installing       : ogdi41-4.1.0-3.rhel8.aarch64                                                                                                                      27/41 
</span><span class='line'>  Installing       : protobuf-3.9.0-7.ky10.aarch64                                                                                                                     28/41 
</span><span class='line'>  Installing       : protobuf-c-1.3.2-2.ky10.aarch64                                                                                                                   29/41 
</span><span class='line'>  Running scriptlet: protobuf-c-1.3.2-2.ky10.aarch64                                                                                                                   29/41 
</span><span class='line'>  Installing       : libusb-1:0.1.5-15.ky10.aarch64                                                                                                                    30/41 
</span><span class='line'>  Running scriptlet: libusb-1:0.1.5-15.ky10.aarch64                                                                                                                    30/41 
</span><span class='line'>  Installing       : gpsbabel-1.6.0-3.el8.aarch64                                                                                                                      31/41 
</span><span class='line'>  Installing       : libdap-3.19.1-3.oe1.aarch64                                                                                                                       32/41 
</span><span class='line'>  Running scriptlet: libdap-3.19.1-3.oe1.aarch64                                                                                                                       32/41 
</span><span class='line'>  Installing       : jasper-libs-2.0.14-7.ky10.aarch64                                                                                                                 33/41 
</span><span class='line'>  Installing       : cfitsio-3.450-5.oe1.aarch64                                                                                                                       34/41 
</span><span class='line'>  Running scriptlet: cfitsio-3.450-5.oe1.aarch64                                                                                                                       34/41 
</span><span class='line'>  Installing       : boost-serialization-1.66.0-18.ky10.aarch64                                                                                                        35/41 
</span><span class='line'>  Installing       : SFCGAL-libs-1.3.8-1.rhel8.aarch64                                                                                                                 36/41 
</span><span class='line'>  Running scriptlet: SFCGAL-libs-1.3.8-1.rhel8.aarch64                                                                                                                 36/41 
</span><span class='line'>  Installing       : SFCGAL-1.3.8-1.rhel8.aarch64                                                                                                                      37/41 
</span><span class='line'>  Running scriptlet: SFCGAL-1.3.8-1.rhel8.aarch64                                                                                                                      37/41 
</span><span class='line'>  Installing       : gdal32-libs-3.2.2-13.rhel8.aarch64                                                                                                                38/41 
</span><span class='line'>  Running scriptlet: gdal32-libs-3.2.2-13.rhel8.aarch64                                                                                                                38/41 
</span><span class='line'>  Installing       : postgis24_96-2.4.9-3.rhel8.aarch64                                                                                                                39/41 
</span><span class='line'>  Running scriptlet: postgis24_96-2.4.9-3.rhel8.aarch64                                                                                                                39/41 
</span><span class='line'>  Installing       : minizip1.2-1.2.11-24.el8.aarch64                                                                                                                  40/41 
</span><span class='line'>  Cleanup          : minizip-1.2.11-17.1.ky10.aarch64                                                                                                                  41/41 
</span><span class='line'>  Running scriptlet: minizip-1.2.11-17.1.ky10.aarch64                                                                                                                  41/41 
</span><span class='line'>  Verifying        : boost-atomic-1.66.0-18.ky10.aarch64                                                                                                                1/41 
</span><span class='line'>  Verifying        : boost-chrono-1.66.0-18.ky10.aarch64                                                                                                                2/41 
</span><span class='line'>  Verifying        : boost-date-time-1.66.0-18.ky10.aarch64                                                                                                             3/41 
</span><span class='line'>  Verifying        : boost-serialization-1.66.0-18.ky10.aarch64                                                                                                         4/41 
</span><span class='line'>  Verifying        : boost-system-1.66.0-18.ky10.aarch64                                                                                                                5/41 
</span><span class='line'>  Verifying        : boost-thread-1.66.0-18.ky10.aarch64                                                                                                                6/41 
</span><span class='line'>  Verifying        : cfitsio-3.450-5.oe1.aarch64                                                                                                                        7/41 
</span><span class='line'>  Verifying        : jasper-libs-2.0.14-7.ky10.aarch64                                                                                                                  8/41 
</span><span class='line'>  Verifying        : libdap-3.19.1-3.oe1.aarch64                                                                                                                        9/41 
</span><span class='line'>  Verifying        : libusb-1:0.1.5-15.ky10.aarch64                                                                                                                    10/41 
</span><span class='line'>  Verifying        : protobuf-3.9.0-7.ky10.aarch64                                                                                                                     11/41 
</span><span class='line'>  Verifying        : protobuf-c-1.3.2-2.ky10.aarch64                                                                                                                   12/41 
</span><span class='line'>  Verifying        : CGAL-4.14-1.rhel8.aarch64                                                                                                                         13/41 
</span><span class='line'>  Verifying        : SFCGAL-1.3.8-1.rhel8.aarch64                                                                                                                      14/41 
</span><span class='line'>  Verifying        : SFCGAL-libs-1.3.8-1.rhel8.aarch64                                                                                                                 15/41 
</span><span class='line'>  Verifying        : gdal32-libs-3.2.2-13.rhel8.aarch64                                                                                                                16/41 
</span><span class='line'>  Verifying        : geos39-3.9.2-1.rhel8.aarch64                                                                                                                      17/41 
</span><span class='line'>  Verifying        : libgeotiff16-1.6.0-6.rhel8.aarch64                                                                                                                18/41 
</span><span class='line'>  Verifying        : libgeotiff16-devel-1.6.0-6.rhel8.aarch64                                                                                                          19/41 
</span><span class='line'>  Verifying        : librttopo-1.1.0-1.rhel8.aarch64                                                                                                                   20/41 
</span><span class='line'>  Verifying        : libspatialite50-5.0.1-2.rhel8.aarch64                                                                                                             21/41 
</span><span class='line'>  Verifying        : libspatialite50-devel-5.0.1-2.rhel8.aarch64                                                                                                       22/41 
</span><span class='line'>  Verifying        : ogdi41-4.1.0-3.rhel8.aarch64                                                                                                                      23/41 
</span><span class='line'>  Verifying        : proj72-7.2.1-1.rhel8.aarch64                                                                                                                      24/41 
</span><span class='line'>  Verifying        : proj80-8.0.1-1.rhel8.aarch64                                                                                                                      25/41 
</span><span class='line'>  Verifying        : postgis24_96-2.4.9-3.rhel8.aarch64                                                                                                                26/41 
</span><span class='line'>  Verifying        : postgresql96-9.6.24-1PGDG.rhel8.aarch64                                                                                                           27/41 
</span><span class='line'>  Verifying        : postgresql96-contrib-9.6.24-1PGDG.rhel8.aarch64                                                                                                   28/41 
</span><span class='line'>  Verifying        : postgresql96-libs-9.6.24-1PGDG.rhel8.aarch64                                                                                                      29/41 
</span><span class='line'>  Verifying        : postgresql96-server-9.6.24-1PGDG.rhel8.aarch64                                                                                                    30/41 
</span><span class='line'>  Verifying        : freexl-1.0.6-4.el8.aarch64                                                                                                                        31/41 
</span><span class='line'>  Verifying        : gpsbabel-1.6.0-3.el8.aarch64                                                                                                                      32/41 
</span><span class='line'>  Verifying        : hdf-4.2.14-5.el8.aarch64                                                                                                                          33/41 
</span><span class='line'>  Verifying        : libbsd-0.9.1-4.el8.aarch64                                                                                                                        34/41 
</span><span class='line'>  Verifying        : libgta-1.2.1-1.el8.aarch64                                                                                                                        35/41 
</span><span class='line'>  Verifying        : minizip1.2-1.2.11-24.el8.aarch64                                                                                                                  36/41 
</span><span class='line'>  Verifying        : netcdf-4.7.0-2.el8.aarch64                                                                                                                        37/41 
</span><span class='line'>  Verifying        : shapelib-1.5.0-1.el8.aarch64                                                                                                                      38/41 
</span><span class='line'>  Verifying        : xerces-c-3.2.2-3.el8.aarch64                                                                                                                      39/41 
</span><span class='line'>  Verifying        : minizip-2.8.9-2.el8.aarch64                                                                                                                       40/41 
</span><span class='line'>  Verifying        : minizip-1.2.11-17.1.ky10.aarch64                                                                                                                  41/41 
</span><span class='line'>
</span><span class='line'>Upgraded:
</span><span class='line'>  minizip-2.8.9-2.el8.aarch64                                                                                                                                                
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  postgis24_96-2.4.9-3.rhel8.aarch64                     postgresql96-9.6.24-1PGDG.rhel8.aarch64                    postgresql96-server-9.6.24-1PGDG.rhel8.aarch64           
</span><span class='line'>  boost-atomic-1.66.0-18.ky10.aarch64                    boost-chrono-1.66.0-18.ky10.aarch64                        boost-date-time-1.66.0-18.ky10.aarch64                   
</span><span class='line'>  boost-serialization-1.66.0-18.ky10.aarch64             boost-system-1.66.0-18.ky10.aarch64                        boost-thread-1.66.0-18.ky10.aarch64                      
</span><span class='line'>  cfitsio-3.450-5.oe1.aarch64                            jasper-libs-2.0.14-7.ky10.aarch64                          libdap-3.19.1-3.oe1.aarch64                              
</span><span class='line'>  libusb-1:0.1.5-15.ky10.aarch64                         protobuf-3.9.0-7.ky10.aarch64                              protobuf-c-1.3.2-2.ky10.aarch64                          
</span><span class='line'>  CGAL-4.14-1.rhel8.aarch64                              SFCGAL-1.3.8-1.rhel8.aarch64                               SFCGAL-libs-1.3.8-1.rhel8.aarch64                        
</span><span class='line'>  gdal32-libs-3.2.2-13.rhel8.aarch64                     geos39-3.9.2-1.rhel8.aarch64                               libgeotiff16-1.6.0-6.rhel8.aarch64                       
</span><span class='line'>  libgeotiff16-devel-1.6.0-6.rhel8.aarch64               librttopo-1.1.0-1.rhel8.aarch64                            libspatialite50-5.0.1-2.rhel8.aarch64                    
</span><span class='line'>  libspatialite50-devel-5.0.1-2.rhel8.aarch64            ogdi41-4.1.0-3.rhel8.aarch64                               proj72-7.2.1-1.rhel8.aarch64                             
</span><span class='line'>  proj80-8.0.1-1.rhel8.aarch64                           postgresql96-contrib-9.6.24-1PGDG.rhel8.aarch64            postgresql96-libs-9.6.24-1PGDG.rhel8.aarch64             
</span><span class='line'>  freexl-1.0.6-4.el8.aarch64                             gpsbabel-1.6.0-3.el8.aarch64                               hdf-4.2.14-5.el8.aarch64                                 
</span><span class='line'>  libbsd-0.9.1-4.el8.aarch64                             libgta-1.2.1-1.el8.aarch64                                 minizip1.2-1.2.11-24.el8.aarch64                         
</span><span class='line'>  netcdf-4.7.0-2.el8.aarch64                             shapelib-1.5.0-1.el8.aarch64                               xerces-c-3.2.2-3.el8.aarch64                             
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>[root@col ~]# 
</span></code></pre></td></tr></table></div></figure>


<p>打包备份：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# tar zcf kylin-postgres96.tgz *.rpm rpmbuild /etc/yum.repos.d/
</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2022/04/19/k8s-nfs-run-example/">K8S官方例子NFS</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2022-04-19T18:34:01+08:00" pubdate data-updated="true">Tue 2022-04-19 18:34</time>
		
        
		
      </p>
    
  </header>


  <div class="entry-content"><h2>参考</h2>

<p>源码</p>

<ul>
<li><a href="https://github.com/kubernetes/examples/tree/master/staging/volumes/nfs">https://github.com/kubernetes/examples/tree/master/staging/volumes/nfs</a></li>
<li><a href="https://github.com/kubernetes/examples/blob/master/staging/volumes/nfs/nfs-server-deployment.yaml">https://github.com/kubernetes/examples/blob/master/staging/volumes/nfs/nfs-server-deployment.yaml</a></li>
</ul>


<p>本地volumn</p>

<ul>
<li><a href="https://kubernetes.io/zh/docs/concepts/storage/volumes/#local">https://kubernetes.io/zh/docs/concepts/storage/volumes/#local</a></li>
</ul>


<h2>运行</h2>

<h3>目录结构</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ git clone https://github.com/kubernetes/examples
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ cd examples/staging/volumes/nfs/
</span><span class='line'>[ec2-user@k8s nfs]$ ls -l
</span><span class='line'>total 48
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user  823 Apr 19 20:34 nfs-busybox-deployment.yaml
</span><span class='line'>drwxrwxr-x 2 ec2-user ec2-user   77 Apr 19 20:34 nfs-data
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user  193 Apr 19 20:34 nfs-pvc.yaml
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user 9379 Apr 19 20:34 nfs-pv.png
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user  234 Apr 19 20:34 nfs-pv.yaml
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user  729 Apr 19 20:34 nfs-server-deployment.yaml
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user  212 Apr 19 20:34 nfs-server-service.yaml
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user  673 Apr 19 20:34 nfs-web-deployment.yaml
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user  120 Apr 19 20:34 nfs-web-service.yaml
</span><span class='line'>drwxrwxr-x 2 ec2-user ec2-user   98 Apr 19 20:34 provisioner
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user 6540 Apr 19 20:34 README.md
</span><span class='line'>[ec2-user@k8s nfs]$ ls -l provisioner/
</span><span class='line'>total 12
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user 291 Apr 19 20:34 nfs-server-azure-pv.yaml
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user 324 Apr 19 20:34 nfs-server-cdk-pv.yaml
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user 215 Apr 19 20:34 nfs-server-gce-pv.yaml
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>nfs-data 是nfs-server镜像构建Dockerfile相关文件。</li>
<li>nfs-server：

<ul>
<li>nfs-server-deployment.yaml</li>
<li>nfs-server-service.yaml</li>
<li>provisioner</li>
</ul>
</li>
<li>web

<ul>
<li>nfs-pv.yaml</li>
<li>nfs-pvc.yaml</li>
<li>nfs-web-deployment.yaml</li>
<li>nfs-web-service.yaml</li>
<li>nfs-busybox-deployment.yaml</li>
</ul>
</li>
</ul>


<p>按照结构，一步步的来进行配置和运行。</p>

<h3>搭建NFS Server的本地存储卷</h3>

<ul>
<li><a href="https://kubernetes.io/zh/docs/concepts/storage/volumes/#local">https://kubernetes.io/zh/docs/concepts/storage/volumes/#local</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ sudo mkdir /nfs
</span><span class='line'>[ec2-user@k8s ~]$ sudo chmod 777 /nfs
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ cat server-pv.yml 
</span><span class='line'>apiVersion: v1
</span><span class='line'>kind: PersistentVolume
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs-pv
</span><span class='line'>spec:
</span><span class='line'>  capacity:
</span><span class='line'>    storage: 10Gi
</span><span class='line'>  volumeMode: Filesystem
</span><span class='line'>  accessModes:
</span><span class='line'>  - ReadWriteOnce
</span><span class='line'># https://kubernetes.io/docs/concepts/storage/persistent-volumes/#reclaiming
</span><span class='line'>  persistentVolumeReclaimPolicy: Delete
</span><span class='line'>  storageClassName: local-storage
</span><span class='line'>  local:
</span><span class='line'>    path: /nfs
</span><span class='line'>  nodeAffinity:
</span><span class='line'>    required:
</span><span class='line'>      nodeSelectorTerms:
</span><span class='line'>      - matchExpressions:
</span><span class='line'>        - key: kubernetes.io/hostname
</span><span class='line'>          operator: In
</span><span class='line'>          values:
</span><span class='line'>          - k8s
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl apply -f server-pv.yml
</span><span class='line'>persistentvolume/nfs-pv created
</span></code></pre></td></tr></table></div></figure>


<p>创建server pvc：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs]$ kubectl create namespace nfs
</span><span class='line'>namespace/nfs-server created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ cat provisioner/nfs-server-gce-pv.yaml   
</span><span class='line'>apiVersion: v1
</span><span class='line'>kind: PersistentVolumeClaim
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs-pv-provisioning-demo
</span><span class='line'>  labels:
</span><span class='line'>    demo: nfs-pv-provisioning
</span><span class='line'>spec:
</span><span class='line'>  accessModes: [ "ReadWriteOnce" ]
</span><span class='line'>  resources:
</span><span class='line'>    requests:
</span><span class='line'>      storage: 10Gi
</span><span class='line'>  storageClassName: local-storage
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl apply -f provisioner/nfs-server-gce-pv.yaml -n nfs
</span><span class='line'>persistentvolumeclaim/nfs-pv-provisioning-demo created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl get pv 
</span><span class='line'>NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                          STORAGECLASS    REASON   AGE
</span><span class='line'>nfs-pv   10Gi       RWO            Delete           Bound    nfs/nfs-pv-provisioning-demo   local-storage            21s
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl get pvc -n nfs 
</span><span class='line'>NAME                       STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS    AGE
</span><span class='line'>nfs-pv-provisioning-demo   Bound    nfs-pv   10Gi       RWO            local-storage   18s
</span></code></pre></td></tr></table></div></figure>


<h3>启动nfs-server</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 下载镜像要代理的，可以替换image或者下载后改tag
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ cat nfs-server-deployment.yaml
</span><span class='line'>apiVersion: apps/v1
</span><span class='line'>kind: Deployment
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs-server
</span><span class='line'>spec:
</span><span class='line'>  replicas: 1
</span><span class='line'>  selector:
</span><span class='line'>    matchLabels:
</span><span class='line'>      role: nfs-server
</span><span class='line'>  template:
</span><span class='line'>    metadata:
</span><span class='line'>      labels:
</span><span class='line'>        role: nfs-server
</span><span class='line'>    spec:
</span><span class='line'>      containers:
</span><span class='line'>      - name: nfs-server
</span><span class='line'>        image: k8s.gcr.io/volume-nfs:0.8
</span><span class='line'>        ports:
</span><span class='line'>          - name: nfs
</span><span class='line'>            containerPort: 2049
</span><span class='line'>          - name: mountd
</span><span class='line'>            containerPort: 20048
</span><span class='line'>          - name: rpcbind
</span><span class='line'>            containerPort: 111
</span><span class='line'>        securityContext:
</span><span class='line'>          privileged: true
</span><span class='line'>        volumeMounts:
</span><span class='line'>          - mountPath: /exports
</span><span class='line'>            name: mypvc
</span><span class='line'>      volumes:
</span><span class='line'>        - name: mypvc
</span><span class='line'>          persistentVolumeClaim:
</span><span class='line'>            claimName: nfs-pv-provisioning-demo
</span><span class='line'>[ec2-user@k8s nfs]$ cat nfs-server-service.yaml
</span><span class='line'>kind: Service
</span><span class='line'>apiVersion: v1
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs-server
</span><span class='line'>spec:
</span><span class='line'>  ports:
</span><span class='line'>    - name: nfs
</span><span class='line'>      port: 2049
</span><span class='line'>    - name: mountd
</span><span class='line'>      port: 20048
</span><span class='line'>    - name: rpcbind
</span><span class='line'>      port: 111
</span><span class='line'>  selector:
</span><span class='line'>    role: nfs-server
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl apply -f nfs-server-deployment.yaml -f nfs-server-service.yaml -n nfs
</span><span class='line'>deployment.apps/nfs-server created
</span><span class='line'>service/nfs-server created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl get all -n nfs -o wide
</span><span class='line'>NAME                              READY   STATUS    RESTARTS   AGE   IP             NODE   NOMINATED NODE   READINESS GATES
</span><span class='line'>pod/nfs-server-64886b598f-57mnx   1/1     Running   0          18s   10.244.0.146   k8s    &lt;none&gt;           &lt;none&gt;
</span><span class='line'>
</span><span class='line'>NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                      AGE   SELECTOR
</span><span class='line'>service/nfs-server   ClusterIP   10.111.29.73   &lt;none&gt;        2049/TCP,20048/TCP,111/TCP   18s   role=nfs-server
</span><span class='line'>
</span><span class='line'>NAME                         READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                      SELECTOR
</span><span class='line'>deployment.apps/nfs-server   1/1     1            1           18s   nfs-server   k8s.gcr.io/volume-nfs:0.8   role=nfs-server
</span><span class='line'>
</span><span class='line'>NAME                                    DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES                      SELECTOR
</span><span class='line'>replicaset.apps/nfs-server-64886b598f   1         1         1       18s   nfs-server   k8s.gcr.io/volume-nfs:0.8   pod-template-hash=64886b598f,role=nfs-server
</span></code></pre></td></tr></table></div></figure>


<p>根据nodeAffinity容器部署在了k8s的机器。</p>

<h3>启动web应用</h3>

<p>创建容器使用的卷：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 不知为何，后面容器挂载卷的时刻识别不了域名... 
</span><span class='line'># mount的时刻可能是在node节点上执行的，所以解析不了域名。
</span><span class='line'># 把主机的 nameserver设置为（/etc/resolv.conf） nameserver 10.96.0.10 就可以了。
</span><span class='line'>[ec2-user@k8s nfs]$ cat nfs-pv.yaml 
</span><span class='line'>apiVersion: v1
</span><span class='line'>kind: PersistentVolume
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs
</span><span class='line'>spec:
</span><span class='line'>  capacity:
</span><span class='line'>    storage: 1Mi
</span><span class='line'>  accessModes:
</span><span class='line'>    - ReadWriteMany
</span><span class='line'>  nfs:
</span><span class='line'>    server: nfs-server.nfs.svc.cluster.local
</span><span class='line'>    path: "/"
</span><span class='line'>  mountOptions:
</span><span class='line'>    - nfsvers=4.2
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl apply -f nfs-pv.yaml 
</span><span class='line'>persistentvolume/nfs created
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl get pv nfs
</span><span class='line'>NAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE
</span><span class='line'>nfs    1Mi        RWX            Retain           Available                                   12s
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ cat nfs-pvc.yaml 
</span><span class='line'>apiVersion: v1
</span><span class='line'>kind: PersistentVolumeClaim
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs
</span><span class='line'>spec:
</span><span class='line'>  accessModes:
</span><span class='line'>    - ReadWriteMany
</span><span class='line'>  storageClassName: ""
</span><span class='line'>  resources:
</span><span class='line'>    requests:
</span><span class='line'>      storage: 1Mi
</span><span class='line'>  volumeName: nfs
</span><span class='line'>  
</span><span class='line'># kubectl get pv | tail -n+2 | awk '$5 == "Released" {print $1}' | xargs -I{} kubectl patch pv {} --type='merge' -p '{"spec":{"claimRef": null}}
</span><span class='line'># 
</span><span class='line'># [ec2-user@k8s nfs]$ kubectl patch pv nfs -p '{"spec":{"claimRef": null}}'                
</span><span class='line'># persistentvolume/nfs patched
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl apply -f nfs-pvc.yaml
</span><span class='line'>persistentvolumeclaim/nfs created
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl get pv 
</span><span class='line'>NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                          STORAGECLASS    REASON   AGE
</span><span class='line'>nfs      1Mi        RWX            Retain           Bound    default/nfs                                                 56s
</span><span class='line'>nfs-pv   10Gi       RWO            Delete           Bound    nfs/nfs-pv-provisioning-demo   local-storage            3m8s
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl get pvc -A 
</span><span class='line'>NAMESPACE   NAME                       STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS    AGE
</span><span class='line'>nfs         nfs                        Bound    nfs      1Mi        RWX                            22s
</span><span class='line'>nfs         nfs-pv-provisioning-demo   Bound    nfs-pv   10Gi       RWO            local-storage   3m
</span></code></pre></td></tr></table></div></figure>


<p>部署web应用的容器：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs]$ cat nfs-web-deployment.yaml 
</span><span class='line'># This pod mounts the nfs volume claim into /usr/share/nginx/html and
</span><span class='line'># serves a simple web page.
</span><span class='line'>
</span><span class='line'>apiVersion: apps/v1
</span><span class='line'>kind: Deployment
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs-web
</span><span class='line'>spec:
</span><span class='line'>  replicas: 2
</span><span class='line'>  selector:
</span><span class='line'>    matchLabels:
</span><span class='line'>      role: web-frontend
</span><span class='line'>  template:
</span><span class='line'>    metadata:
</span><span class='line'>      labels:
</span><span class='line'>        role: web-frontend
</span><span class='line'>    spec:
</span><span class='line'>      containers:
</span><span class='line'>      - name: web
</span><span class='line'>        image: nginx
</span><span class='line'>        ports:
</span><span class='line'>          - name: web
</span><span class='line'>            containerPort: 80
</span><span class='line'>        volumeMounts:
</span><span class='line'>            # name must match the volume name below
</span><span class='line'>            - name: nfs
</span><span class='line'>              mountPath: "/usr/share/nginx/html"
</span><span class='line'>      volumes:
</span><span class='line'>      - name: nfs
</span><span class='line'>        persistentVolumeClaim:
</span><span class='line'>          claimName: nfs
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ cat nfs-web-service.yaml
</span><span class='line'>kind: Service
</span><span class='line'>apiVersion: v1
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs-web
</span><span class='line'>spec:
</span><span class='line'>  ports:
</span><span class='line'>    - port: 80
</span><span class='line'>  selector:
</span><span class='line'>    role: web-frontend
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl apply -f nfs-web-deployment.yaml -f nfs-web-service.yaml
</span><span class='line'>deployment.apps/nfs-web created
</span><span class='line'>service/nfs-web created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl get all
</span><span class='line'>NAME                           READY   STATUS    RESTARTS   AGE
</span><span class='line'>pod/nfs-web-5554f77845-6rq5p   1/1     Running   0          4m56s
</span><span class='line'>pod/nfs-web-5554f77845-8r885   1/1     Running   0          4m56s
</span><span class='line'>
</span><span class='line'>NAME                 TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
</span><span class='line'>service/kubernetes   ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP   33d
</span><span class='line'>service/nfs-web      ClusterIP   10.108.129.153   &lt;none&gt;        80/TCP    4m56s
</span><span class='line'>
</span><span class='line'>NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
</span><span class='line'>deployment.apps/nfs-web   2/2     2            2           4m56s
</span><span class='line'>
</span><span class='line'>NAME                                 DESIRED   CURRENT   READY   AGE
</span><span class='line'>replicaset.apps/nfs-web-5554f77845   2         2         2       4m56s
</span></code></pre></td></tr></table></div></figure>


<p>测试：deployment创建两个busybox，会在nfs共享目录下创建修改index.html，内容为：时间和主机名。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs]$ kubectl apply -f nfs-busybox-deployment.yaml 
</span><span class='line'>deployment.apps/nfs-busybox created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ curl nfs-web.default.svc.cluster.local 
</span><span class='line'>Wed Apr 20 00:15:20 UTC 2022
</span><span class='line'>nfs-busybox-55c668489c-dxqcx
</span><span class='line'>[ec2-user@k8s nfs]$ curl nfs-web.default.svc.cluster.local
</span><span class='line'>Wed Apr 20 00:16:51 UTC 2022
</span><span class='line'>nfs-busybox-55c668489c-sl7jz
</span></code></pre></td></tr></table></div></figure>


<h3>清理</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs]$ kubectl delete -f nfs-busybox-deployment.yaml -f nfs-web-deployment.yaml -f nfs-web-service.yaml -f nfs-pvc.yaml -f nfs-pv.yaml 
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl delete ns nfs 
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl delete -f server-pv.yml 
</span></code></pre></td></tr></table></div></figure>


<h2>问题</h2>

<h3>NFS服务器的域名解析不了</h3>

<p>一开始没有改节点的dns，会出现域名解析不了的情况：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs]$ kubectl describe pod nfs-web-7bc965b94f-k6mrj -n nfs 
</span><span class='line'>...
</span><span class='line'>Events:
</span><span class='line'>  Type     Reason       Age               From               Message
</span><span class='line'>  ----     ------       ----              ----               -------
</span><span class='line'>  Normal   Scheduled    43s               default-scheduler  Successfully assigned nfs/nfs-web-7bc965b94f-k6mrj to worker1
</span><span class='line'>  Warning  FailedMount  1s (x7 over 35s)  kubelet            MountVolume.SetUp failed for volume "nfs" : mount failed: exit status 32
</span><span class='line'>Mounting command: mount
</span><span class='line'>Mounting arguments: -t nfs -o nfsvers=4.2 nfs-server.nfs.svc.cluster.local:/ /var/lib/kubelet/pods/03049217-ded3-4d31-86e8-6a13c0f5b12f/volumes/kubernetes.io~nfs/nfs
</span><span class='line'>Output: mount.nfs: Failed to resolve server nfs-server.nfs.svc.cluster.local: Name or service not known
</span><span class='line'>mount.nfs: Operation already in progress
</span></code></pre></td></tr></table></div></figure>


<p>容器内是可以通过域名访问的，mount的时刻可能是在node节点上执行的，所以解析不了域名。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl run -ti test --rm --image busybox -n nfs -- sh  
</span><span class='line'>/ # ping nfs-server.nfs.svc.cluster.local
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl run -ti test --rm --image busybox -- sh
</span><span class='line'>
</span><span class='line'>/ # cat /etc/resolv.conf 
</span><span class='line'>nameserver 10.96.0.10
</span><span class='line'>search default.svc.cluster.local svc.cluster.local cluster.local localdomain
</span><span class='line'>options ndots:5
</span></code></pre></td></tr></table></div></figure>


<p>把所有节点的dns设置为 kube-dns 的 10.96.0.10 就可以了。</p>

<h3>集群出问题</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs]$ kubectl get pods -A 
</span><span class='line'>,,,
</span><span class='line'>ingress-nginx          ingress-nginx-controller-755447bb4d-55hjz    0/1     CrashLoopBackOff       32 (2m19s ago)   17d
</span><span class='line'>kube-system            coredns-64897985d-4d5rx                      0/1     CrashLoopBackOff       40 (4m30s ago)   33d
</span><span class='line'>kube-system            coredns-64897985d-m9p9q                      0/1     CrashLoopBackOff       40 (4m15s ago)   33d
</span><span class='line'>,,,
</span><span class='line'>kubernetes-dashboard   dashboard-metrics-scraper-799d786dbf-rj8rl   0/1     CrashLoopBackOff       33 (116s ago)    17d
</span><span class='line'>kubernetes-dashboard   kubernetes-dashboard-fb8648fd9-22krh         0/1     CrashLoopBackOff       32 (3m35s ago)   17d
</span></code></pre></td></tr></table></div></figure>


<p>把所有的容器都清理了，然后重启服务器（或者kubelet）</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs]$ docker ps -a |  awk '{print $1}' | while read i ; do docker rm -f $i ; done 
</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2022/04/14/k8s-nfs/">k8s共享存储使用NFS</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2022-04-14T01:23:14+08:00" pubdate data-updated="true">Thu 2022-04-14 01:23</time>
		
        
		
      </p>
    
  </header>


  <div class="entry-content"><p>容器中的应用数据得保存下来，使用local/hostPath可以临时用用，还是得有一个共享的存储。</p>

<ul>
<li><a href="https://kubernetes.io/zh/docs/concepts/storage/volumes/#volume-types">https://kubernetes.io/zh/docs/concepts/storage/volumes/#volume-types</a></li>
<li><a href="https://kubernetes.io/zh/docs/concepts/storage/_print/#types-of-persistent-volumes">https://kubernetes.io/zh/docs/concepts/storage/_print/#types-of-persistent-volumes</a></li>
<li><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#provisioner">https://kubernetes.io/docs/concepts/storage/storage-classes/#provisioner</a></li>
<li><a href="https://kubernetes.io/docs/concepts/storage/volumes/#hostpath">https://kubernetes.io/docs/concepts/storage/volumes/#hostpath</a></li>
<li><a href="https://kubernetes.io/zh/docs/concepts/storage/volumes/#local">https://kubernetes.io/zh/docs/concepts/storage/volumes/#local</a></li>
<li><a href="https://kubernetes.io/zh/docs/concepts/storage/volumes/#cephfs">https://kubernetes.io/zh/docs/concepts/storage/volumes/#cephfs</a></li>
</ul>


<p>先使用最简单的NFS分区/卷。</p>

<ul>
<li><a href="http://www.lishuai.fun/2021/08/12/k8s-nfs-pv">http://www.lishuai.fun/2021/08/12/k8s-nfs-pv</a></li>
</ul>


<h2>安装NFS server on aws ec2</h2>

<ul>
<li><a href="https://segmentfault.com/a/1190000024512057">https://segmentfault.com/a/1190000024512057</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#所有node节点安装nfs客户端
</span><span class='line'>#yum -y install nfs-utils
</span><span class='line'>#systemctl start nfs && systemctl enable nfs
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ sudo yum install nfs-utils 
</span><span class='line'>Loaded plugins: langpacks, priorities, update-motd
</span><span class='line'>amzn2-core                                                                                                                     | 3.7 kB  00:00:00     
</span><span class='line'>Package 1:nfs-utils-1.3.0-0.54.amzn2.0.2.x86_64 already installed and latest version
</span><span class='line'>Nothing to do
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ sudo mkdir /backup
</span><span class='line'>[ec2-user@k8s ~]$ sudo chmod -R 755 /backup
</span><span class='line'>[ec2-user@k8s ~]$ sudo chown nfsnobody:nfsnobody /backup
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ sudo vi /etc/exports
</span><span class='line'>[ec2-user@k8s ~]$ cat /etc/exports    
</span><span class='line'>/backup 192.168.191.0/24(rw,sync,no_root_squash,no_all_squash)
</span><span class='line'>
</span><span class='line'># /k8s-fs *(rw,sync,no_root_squash,no_all_squash)
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ sudo service nfs-server restart 
</span><span class='line'>Redirecting to /bin/systemctl restart nfs-server.service
</span><span class='line'>[ec2-user@k8s ~]$ 
</span><span class='line'>[ec2-user@k8s ~]$ sudo exportfs
</span><span class='line'>/backup         192.168.191.0/24
</span><span class='line'>[ec2-user@k8s ~]$ sudo exportfs -arv 
</span><span class='line'>exporting 192.168.191.0/24:/backup
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ rpcinfo -p localhost
</span><span class='line'>   program vers proto   port  service
</span><span class='line'>    100000    4   tcp    111  portmapper
</span><span class='line'>    100000    3   tcp    111  portmapper
</span><span class='line'>    100000    2   tcp    111  portmapper
</span><span class='line'>    100000    4   udp    111  portmapper
</span><span class='line'>    100000    3   udp    111  portmapper
</span><span class='line'>    100000    2   udp    111  portmapper
</span><span class='line'>    100024    1   udp  56847  status
</span><span class='line'>    100024    1   tcp  60971  status
</span><span class='line'>    100005    1   udp  20048  mountd
</span><span class='line'>    100005    1   tcp  20048  mountd
</span><span class='line'>    100005    2   udp  20048  mountd
</span><span class='line'>    100005    2   tcp  20048  mountd
</span><span class='line'>    100005    3   udp  20048  mountd
</span><span class='line'>    100005    3   tcp  20048  mountd
</span><span class='line'>    100003    3   tcp   2049  nfs
</span><span class='line'>    100003    4   tcp   2049  nfs
</span><span class='line'>    100227    3   tcp   2049  nfs_acl
</span><span class='line'>    100003    3   udp   2049  nfs
</span><span class='line'>    100227    3   udp   2049  nfs_acl
</span><span class='line'>    100021    1   udp  47545  nlockmgr
</span><span class='line'>    100021    3   udp  47545  nlockmgr
</span><span class='line'>    100021    4   udp  47545  nlockmgr
</span><span class='line'>    100021    1   tcp  40703  nlockmgr
</span><span class='line'>    100021    3   tcp  40703  nlockmgr
</span><span class='line'>    100021    4   tcp  40703  nlockmgr
</span><span class='line'>[ec2-user@k8s ~]$ showmount -e 192.168.191.131
</span><span class='line'>Export list for 192.168.191.131:
</span><span class='line'>/backup 192.168.191.0/24
</span></code></pre></td></tr></table></div></figure>


<p>也可以通过docker来启动nfs server：</p>

<ul>
<li><a href="https://blog.ruanbekker.com/blog/2020/09/20/setup-a-nfs-server-with-docker/">https://blog.ruanbekker.com/blog/2020/09/20/setup-a-nfs-server-with-docker/</a></li>
<li><a href="https://westzq1.github.io/k8s/2019/06/28/nfs-server-on-K8S.html">https://westzq1.github.io/k8s/2019/06/28/nfs-server-on-K8S.html</a></li>
<li><a href="https://github.com/kubernetes/examples/blob/master/staging/volumes/nfs/nfs-server-deployment.yaml">https://github.com/kubernetes/examples/blob/master/staging/volumes/nfs/nfs-server-deployment.yaml</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ sudo mkdir -p /data/kubernetes-volumes
</span><span class='line'>[ec2-user@k8s ~]$ docker run --privileged -itd --name nfs -p 2049:2049 -e SHARED_DIRECTORY=/data -v /data/kubernetes-volumes:/data itsthenetwork/nfs-server-alpine:12 
</span><span class='line'>f84b70dcca6bd5abb275fbee50fd161d8befdd709ce6523b3a514f04b7af8677
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ docker logs f84b70dcca6bd5abb2 
</span><span class='line'>Writing SHARED_DIRECTORY to /etc/exports file
</span><span class='line'>The PERMITTED environment variable is unset or null, defaulting to '*'.
</span><span class='line'>This means any client can mount.
</span><span class='line'>The READ_ONLY environment variable is unset or null, defaulting to 'rw'.
</span><span class='line'>Clients have read/write access.
</span><span class='line'>The SYNC environment variable is unset or null, defaulting to 'async' mode.
</span><span class='line'>Writes will not be immediately written to disk.
</span><span class='line'>Displaying /etc/exports contents:
</span><span class='line'>/data *(rw,fsid=0,async,no_subtree_check,no_auth_nlm,insecure,no_root_squash)
</span><span class='line'>
</span><span class='line'>Starting rpcbind...
</span><span class='line'>Displaying rpcbind status...
</span><span class='line'>   program version netid     address                service    owner
</span><span class='line'>    100000    4    tcp6      ::.0.111               -          superuser
</span><span class='line'>    100000    3    tcp6      ::.0.111               -          superuser
</span><span class='line'>    100000    4    udp6      ::.0.111               -          superuser
</span><span class='line'>    100000    3    udp6      ::.0.111               -          superuser
</span><span class='line'>    100000    4    tcp       0.0.0.0.0.111          -          superuser
</span><span class='line'>    100000    3    tcp       0.0.0.0.0.111          -          superuser
</span><span class='line'>    100000    2    tcp       0.0.0.0.0.111          -          superuser
</span><span class='line'>    100000    4    udp       0.0.0.0.0.111          -          superuser
</span><span class='line'>    100000    3    udp       0.0.0.0.0.111          -          superuser
</span><span class='line'>    100000    2    udp       0.0.0.0.0.111          -          superuser
</span><span class='line'>    100000    4    local     /var/run/rpcbind.sock  -          superuser
</span><span class='line'>    100000    3    local     /var/run/rpcbind.sock  -          superuser
</span><span class='line'>Starting NFS in the background...
</span><span class='line'>rpc.nfsd: knfsd is currently down
</span><span class='line'>rpc.nfsd: Writing version string to kernel: -2 -3 +4 +4.1 +4.2
</span><span class='line'>rpc.nfsd: Created AF_INET TCP socket.
</span><span class='line'>rpc.nfsd: Created AF_INET6 TCP socket.
</span><span class='line'>Exporting File System...
</span><span class='line'>exporting *:/data
</span><span class='line'>/data           &lt;world&gt;
</span><span class='line'>Starting Mountd in the background...These
</span><span class='line'>Startup successful.
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ sudo mount -v -o vers=4,loud 127.0.0.1:/ nfsmnt
</span><span class='line'>mount.nfs: timeout set for Thu Apr 14 08:26:48 2022
</span><span class='line'>mount.nfs: trying text-based options 'vers=4.1,addr=127.0.0.1,clientaddr=127.0.0.1'
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ df -h | grep nfsmnt
</span><span class='line'>127.0.0.1:/      25G  9.8G   16G  39% /home/ec2-user/nfsmnt
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ touch nfsmnt/$(hostname).txt
</span><span class='line'>[ec2-user@k8s ~]$ ls -l nfsmnt/
</span><span class='line'>total 0
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user 0 Apr 14 08:25 k8s.txt
</span><span class='line'>[ec2-user@k8s ~]$ ls -l /data/kubernetes-volumes/
</span><span class='line'>total 0
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user 0 Apr 14 08:25 k8s.txt
</span><span class='line'>[ec2-user@k8s ~]$ 
</span><span class='line'>
</span><span class='line'># vi /etc/fstab
</span><span class='line'># 192.168.0.4:/   /mnt   nfs4    _netdev,auto  0  0
</span><span class='line'>
</span><span class='line'>### pod
</span><span class='line'># kubectl create -f nfs-server.yml
</span><span class='line'>apiVersion: extensions/v1beta1
</span><span class='line'>kind: Deployment
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs-server
</span><span class='line'>spec:
</span><span class='line'>  replicas: 1           # &lt;- no more replicas
</span><span class='line'>  template:
</span><span class='line'>    metadata:
</span><span class='line'>      labels:
</span><span class='line'>        app: nfs-server
</span><span class='line'>    spec:
</span><span class='line'>      nodeSelector:     # &lt;- use selector to fix nfs-server on k8s2.zhangqiaoc.com
</span><span class='line'>        kubernetes.io/hostname: k8s2.zhangqiaoc.com
</span><span class='line'>      containers:
</span><span class='line'>      - name: nfs-server
</span><span class='line'>        image: itsthenetwork/nfs-server-alpine:latest
</span><span class='line'>        volumeMounts:
</span><span class='line'>        - name: nfs-storage
</span><span class='line'>          mountPath: /nfsshare
</span><span class='line'>        env:
</span><span class='line'>        - name: SHARED_DIRECTORY
</span><span class='line'>          value: "/nfsshare"
</span><span class='line'>        ports:
</span><span class='line'>        - name: nfs  
</span><span class='line'>          containerPort: 2049   # &lt;- export port
</span><span class='line'>        securityContext:
</span><span class='line'>          privileged: true      # &lt;- privileged mode is mandentory.
</span><span class='line'>      volumes:
</span><span class='line'>      - name: nfs-storage  
</span><span class='line'>        hostPath:               # &lt;- the folder on the host machine.
</span><span class='line'>          path: /root/fileshare
</span><span class='line'># kubectl expose deployment nfs-server --type=ClusterIP
</span><span class='line'># kubectl get svc
</span><span class='line'>
</span><span class='line'># yum install -y nfs-utils
</span><span class='line'># mkdir /root/nfsmnt
</span><span class='line'># mount -v 10.101.117.226:/ /root/nfsmnt
</span></code></pre></td></tr></table></div></figure>


<p>client</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 所有work节点安装 nfs-utils rpcbind
</span><span class='line'>[ec2-user@worker1 ~]$ sudo yum install nfs-utils 
</span><span class='line'>Loaded plugins: langpacks, priorities, update-motd
</span><span class='line'>amzn2-core                                                                                                                                        | 3.7 kB  00:00:00     
</span><span class='line'>Package 1:nfs-utils-1.3.0-0.54.amzn2.0.2.x86_64 already installed and latest version
</span><span class='line'>Nothing to do
</span><span class='line'>
</span><span class='line'>[ec2-user@worker1 ~]$ sudo systemctl status nfs
</span><span class='line'>● nfs-server.service - NFS server and services
</span><span class='line'>   Loaded: loaded (/usr/lib/systemd/system/nfs-server.service; disabled; vendor preset: disabled)
</span><span class='line'>   Active: inactive (dead)
</span><span class='line'>[ec2-user@worker1 ~]$ sudo systemctl status rpcbind
</span><span class='line'>● rpcbind.service - RPC bind service
</span><span class='line'>   Loaded: loaded (/usr/lib/systemd/system/rpcbind.service; enabled; vendor preset: enabled)
</span><span class='line'>   Active: active (running) since Wed 2022-04-13 20:44:34 CST; 1h 51min ago
</span><span class='line'>  Process: 6979 ExecStart=/sbin/rpcbind -w $RPCBIND_ARGS (code=exited, status=0/SUCCESS)
</span><span class='line'> Main PID: 7025 (rpcbind)
</span><span class='line'>    Tasks: 1
</span><span class='line'>   Memory: 2.1M
</span><span class='line'>   CGroup: /system.slice/rpcbind.service
</span><span class='line'>           └─7025 /sbin/rpcbind -w
</span><span class='line'>
</span><span class='line'>Apr 13 20:44:34 worker1 systemd[1]: Starting RPC bind service...
</span><span class='line'>Apr 13 20:44:34 worker1 systemd[1]: Started RPC bind service.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@worker1 ~]$ sudo mkdir -p /data
</span><span class='line'>[ec2-user@worker1 ~]$ sudo chmod 777 /data 
</span><span class='line'>[ec2-user@worker1 ~]$ sudo mount -t nfs 192.168.191.131:/backup /data
</span><span class='line'>[ec2-user@worker1 ~]$ df -h | grep 192.168.191.131
</span><span class='line'>192.168.191.131:/backup   25G  9.6G   16G  39% /data
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># vi /etc/fstab
</span><span class='line'># 172.17.30.22:/backup /data nfs defaults 0 0
</span></code></pre></td></tr></table></div></figure>


<h2>k8s中使用NFS</h2>

<ul>
<li><a href="http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/">http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/</a></li>
</ul>


<h3>容器直接挂载NFS</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ cat nginx-1.yml 
</span><span class='line'>apiVersion: apps/v1
</span><span class='line'>kind: Deployment
</span><span class='line'>metadata:
</span><span class='line'>  name: nginx-deployment
</span><span class='line'>  labels:
</span><span class='line'>    app: nginx
</span><span class='line'>spec:
</span><span class='line'>  replicas: 3
</span><span class='line'>  selector:
</span><span class='line'>    matchLabels:
</span><span class='line'>      app: nginx
</span><span class='line'>  template:
</span><span class='line'>    metadata:
</span><span class='line'>      labels:
</span><span class='line'>        app: nginx
</span><span class='line'>    spec:
</span><span class='line'>      containers:
</span><span class='line'>      - name: nginx
</span><span class='line'>        image: nginx:1.14.2
</span><span class='line'>        ports:
</span><span class='line'>        - containerPort: 80
</span><span class='line'>        volumeMounts:
</span><span class='line'>        - name: data
</span><span class='line'>          mountPath: /usr/share/nginx/html
</span><span class='line'>      volumes:
</span><span class='line'>      - name: data
</span><span class='line'>        nfs:
</span><span class='line'>          path: /backup
</span><span class='line'>          server: 192.168.191.131
</span><span class='line'>        
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f nginx-1.yml
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get all 
</span><span class='line'>NAME                                   READY   STATUS    RESTARTS   AGE
</span><span class='line'>pod/nginx-deployment-67dcb957c-g2h8x   1/1     Running   0          2m50s
</span><span class='line'>pod/nginx-deployment-67dcb957c-gfv28   1/1     Running   0          2m50s
</span><span class='line'>pod/nginx-deployment-67dcb957c-rqwjs   1/1     Running   0          2m50s
</span><span class='line'>
</span><span class='line'>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
</span><span class='line'>service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   27d
</span><span class='line'>
</span><span class='line'>NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
</span><span class='line'>deployment.apps/nginx-deployment   3/3     3            3           2m50s
</span><span class='line'>
</span><span class='line'>NAME                                         DESIRED   CURRENT   READY   AGE
</span><span class='line'>replicaset.apps/nginx-deployment-67dcb957c   3         3         3       2m50s
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl exec -ti pod/nginx-deployment-67dcb957c-g2h8x -- bash 
</span><span class='line'>root@nginx-deployment-67dcb957c-g2h8x:/# echo $(hostname) &gt;/usr/share/nginx/html/1.txt
</span><span class='line'>
</span><span class='line'>root@nginx-deployment-67dcb957c-g2h8x:/# mount | grep 192
</span><span class='line'>192.168.191.131:/backup on /usr/share/nginx/html type nfs4 (rw,relatime,vers=4.1,rsize=524288,wsize=524288,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.191.132,local_lock=none,addr=192.168.191.131)
</span><span class='line'>root@nginx-deployment-67dcb957c-g2h8x:/# 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># 服务端查看文件内容
</span><span class='line'>[ec2-user@k8s ~]$ cat /backup/1.txt 
</span><span class='line'>nginx-deployment-67dcb957c-g2h8x
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl delete -f nginx-1.yml 
</span><span class='line'>deployment.apps "nginx-deployment" deleted
</span></code></pre></td></tr></table></div></figure>


<h3>pvc</h3>

<ul>
<li><a href="https://segmentfault.com/a/1190000040785500">https://segmentfault.com/a/1190000040785500</a></li>
<li><a href="http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/#%E5%88%9B%E5%BB%BA%E7%B1%BB%E5%9E%8B%E4%B8%BAnfs%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E5%8D%B7">http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/#%E5%88%9B%E5%BB%BA%E7%B1%BB%E5%9E%8B%E4%B8%BAnfs%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E5%8D%B7</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ vi pv-nfs.yaml 
</span><span class='line'>[ec2-user@k8s ~]$ cat pv-nfs.yaml 
</span><span class='line'>apiVersion: v1
</span><span class='line'>kind: PersistentVolume
</span><span class='line'>metadata:
</span><span class='line'>  name: pv-nfs
</span><span class='line'>spec:
</span><span class='line'>  capacity:
</span><span class='line'>    storage: 10Gi
</span><span class='line'>  accessModes:
</span><span class='line'>    - ReadWriteMany 
</span><span class='line'>  nfs:
</span><span class='line'>    path: /backup
</span><span class='line'>    server: 192.168.191.131
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f pv-nfs.yaml 
</span><span class='line'>persistentvolume/pv-nfs created
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pv 
</span><span class='line'>NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE
</span><span class='line'>pv-nfs   10Gi       RWX            Retain           Available                                   5s
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ vi pvc-nfs.yaml 
</span><span class='line'>[ec2-user@k8s ~]$ cat pvc-nfs.yaml 
</span><span class='line'>kind: PersistentVolumeClaim
</span><span class='line'>apiVersion: v1
</span><span class='line'>metadata:
</span><span class='line'>  name: pvc-nfs
</span><span class='line'>spec:
</span><span class='line'>  accessModes:
</span><span class='line'>    - ReadWriteMany
</span><span class='line'>  resources:
</span><span class='line'>    requests:
</span><span class='line'>      storage: 10Gi
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f pvc-nfs.yaml 
</span><span class='line'>persistentvolumeclaim/pvc-nfs created
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pvc
</span><span class='line'>NAME      STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
</span><span class='line'>pvc-nfs   Bound    pv-nfs   10Gi       RWX                           7s
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pv 
</span><span class='line'>NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM             STORAGECLASS   REASON   AGE
</span><span class='line'>pv-nfs   10Gi       RWX            Retain           Bound    default/pvc-nfs                           79s
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ vi dp-pvc.yaml
</span><span class='line'>[ec2-user@k8s ~]$ cat dp-pvc.yaml 
</span><span class='line'>apiVersion: apps/v1
</span><span class='line'>kind: Deployment
</span><span class='line'>metadata:
</span><span class='line'>  name: busybox
</span><span class='line'>  labels:
</span><span class='line'>    app: busybox
</span><span class='line'>spec:
</span><span class='line'>  replicas: 1
</span><span class='line'>  selector:
</span><span class='line'>    matchLabels:
</span><span class='line'>      app: busybox
</span><span class='line'>  template:
</span><span class='line'>    metadata:
</span><span class='line'>      labels:
</span><span class='line'>        app: busybox
</span><span class='line'>    spec:
</span><span class='line'>      containers:
</span><span class='line'>      - name: busybox
</span><span class='line'>        image: busybox
</span><span class='line'>        command: ['sh', '-c', 'echo "Hello, Kubernetes!" && sleep 3600']
</span><span class='line'>        volumeMounts:
</span><span class='line'>        - name: data
</span><span class='line'>          mountPath: /data
</span><span class='line'>      volumes:
</span><span class='line'>      - name: data
</span><span class='line'>        persistentVolumeClaim:
</span><span class='line'>          claimName: pvc-nfs
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f dp-pvc.yaml 
</span><span class='line'>deployment.apps/busybox created
</span><span class='line'>[ec2-user@k8s ~]$ 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get all 
</span><span class='line'>NAME                           READY   STATUS    RESTARTS   AGE
</span><span class='line'>pod/busybox-6b99c495c9-qnvlp   1/1     Running   0          47s
</span><span class='line'>
</span><span class='line'>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
</span><span class='line'>service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   27d
</span><span class='line'>
</span><span class='line'>NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
</span><span class='line'>deployment.apps/busybox   1/1     1            1           47s
</span><span class='line'>
</span><span class='line'>NAME                                 DESIRED   CURRENT   READY   AGE
</span><span class='line'>replicaset.apps/busybox-6b99c495c9   1         1         1       47s
</span><span class='line'>
</span><span class='line'># 查看NFS中原来的数据
</span><span class='line'>[ec2-user@k8s ~]$ kubectl exec -ti busybox-6b99c495c9-qnvlp -- cat /data/1.txt 
</span><span class='line'>nginx-deployment-67dcb957c-g2h8x
</span></code></pre></td></tr></table></div></figure>


<p>测一下subPathExpr：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl delete -f dp-pvc.yaml 
</span><span class='line'>deployment.apps "busybox" deleted
</span><span class='line'>[ec2-user@k8s ~]$ 
</span><span class='line'>[ec2-user@k8s ~]$ vi dp-pvc.yaml 
</span><span class='line'>[ec2-user@k8s ~]$ cat dp-pvc.yaml 
</span><span class='line'>apiVersion: apps/v1
</span><span class='line'>kind: Deployment
</span><span class='line'>metadata:
</span><span class='line'>  name: busybox
</span><span class='line'>  labels:
</span><span class='line'>    app: busybox
</span><span class='line'>spec:
</span><span class='line'>  replicas: 1
</span><span class='line'>  selector:
</span><span class='line'>    matchLabels:
</span><span class='line'>      app: busybox
</span><span class='line'>  template:
</span><span class='line'>    metadata:
</span><span class='line'>      labels:
</span><span class='line'>        app: busybox
</span><span class='line'>    spec:
</span><span class='line'>      containers:
</span><span class='line'>      - name: busybox
</span><span class='line'>        image: busybox
</span><span class='line'>        command: ['sh', '-c', 'echo "Hello, Kubernetes!" && sleep 3600']
</span><span class='line'>        env:
</span><span class='line'>        - name: POD_NAME
</span><span class='line'>          valueFrom:
</span><span class='line'>            fieldRef:
</span><span class='line'>              apiVersion: v1
</span><span class='line'>              fieldPath: metadata.name
</span><span class='line'>        volumeMounts:
</span><span class='line'>        - name: data
</span><span class='line'>          mountPath: /data
</span><span class='line'>          subPathExpr: $(POD_NAME)
</span><span class='line'>      volumes:
</span><span class='line'>      - name: data
</span><span class='line'>        persistentVolumeClaim:
</span><span class='line'>          claimName: pvc-nfs
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f dp-pvc.yaml 
</span><span class='line'>deployment.apps/busybox created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get all 
</span><span class='line'>NAME                           READY   STATUS    RESTARTS   AGE
</span><span class='line'>pod/busybox-5497486bf5-csr6q   1/1     Running   0          7s
</span><span class='line'>
</span><span class='line'>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
</span><span class='line'>service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   27d
</span><span class='line'>
</span><span class='line'>NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
</span><span class='line'>deployment.apps/busybox   1/1     1            1           7s
</span><span class='line'>
</span><span class='line'>NAME                                 DESIRED   CURRENT   READY   AGE
</span><span class='line'>replicaset.apps/busybox-5497486bf5   1         1         1       7s
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl exec -ti pod/busybox-5497486bf5-csr6q -- sh 
</span><span class='line'>/ # ls /data
</span><span class='line'>/ # echo $(hostname) &gt; /data/pvc.txt
</span><span class='line'>/ # exit
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># 查看服务端目录下数据
</span><span class='line'>[ec2-user@k8s ~]$ ll /backup/
</span><span class='line'>total 4
</span><span class='line'>-rw-r--r-- 1 root root 33 Apr 14 00:37 1.txt
</span><span class='line'>drwxr-xr-x 2 root root 21 Apr 14 00:51 busybox-5497486bf5-csr6q
</span><span class='line'>[ec2-user@k8s ~]$ cat /backup/busybox-5497486bf5-csr6q/pvc.txt   
</span><span class='line'>busybox-5497486bf5-csr6q
</span></code></pre></td></tr></table></div></figure>


<p>把replicas改成2，再试试：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f dp-pvc.yaml 
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pods
</span><span class='line'>NAME                       READY   STATUS    RESTARTS   AGE
</span><span class='line'>busybox-5497486bf5-fkzls   1/1     Running   0          3m8s
</span><span class='line'>busybox-5497486bf5-rv7k7   1/1     Running   0          3m8s
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl exec busybox-5497486bf5-fkzls -- sh -c 'echo $(hostname) &gt;/data/$(hostname).txt'
</span><span class='line'>[ec2-user@k8s ~]$ kubectl exec busybox-5497486bf5-rv7k7 -- sh -c 'echo $(hostname) &gt;/data/$(hostname).txt'                        
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># 查看服务端目录结构
</span><span class='line'>[ec2-user@k8s ~]$ ll -R /backup/
</span><span class='line'>/backup/:
</span><span class='line'>total 4
</span><span class='line'>-rw-r--r-- 1 root root 33 Apr 14 00:37 1.txt
</span><span class='line'>drwxr-xr-x 2 root root 21 Apr 14 00:51 busybox-5497486bf5-csr6q
</span><span class='line'>drwxr-xr-x 2 root root 42 Apr 14 01:20 busybox-5497486bf5-fkzls
</span><span class='line'>drwxr-xr-x 2 root root 42 Apr 14 01:20 busybox-5497486bf5-rv7k7
</span><span class='line'>
</span><span class='line'>/backup/busybox-5497486bf5-csr6q:
</span><span class='line'>total 4
</span><span class='line'>-rw-r--r-- 1 root root 25 Apr 14 00:51 pvc.txt
</span><span class='line'>
</span><span class='line'>/backup/busybox-5497486bf5-fkzls:
</span><span class='line'>total 4
</span><span class='line'>-rw-r--r-- 1 root root 25 Apr 14 01:20 busybox-5497486bf5-fkzls.txt
</span><span class='line'>
</span><span class='line'>/backup/busybox-5497486bf5-rv7k7:
</span><span class='line'>total 4
</span><span class='line'>-rw-r--r-- 1 root root 25 Apr 14 01:20 busybox-5497486bf5-rv7k7.txt
</span><span class='line'>[ec2-user@k8s ~]$ 
</span></code></pre></td></tr></table></div></figure>


<h3>NFS Subdir External Provisioner</h3>

<ul>
<li><a href="http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/#NFS-Subdir-External-Provisioner">http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/#NFS-Subdir-External-Provisioner</a></li>
<li><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#nfs">https://kubernetes.io/docs/concepts/storage/storage-classes/#nfs</a></li>
<li><a href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner">https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner</a></li>
</ul>


<p>NFS subdir external provisioner 使用现有的的NFS 服务器来支持通过 Persistent Volume Claims 动态供应 Kubernetes Persistent Volumes。持久卷默认被配置为${namespace}-${pvcName}-${pvName}，使用这个必须已经拥有 NFS 服务器。</p>

<ul>
<li><a href="http://dockone.io/article/2598">http://dockone.io/article/2598</a> External NFS驱动的工作原理</li>
</ul>


<blockquote><p>K8S的外部NFS驱动，可以按照其工作方式（是作为NFS server还是NFS client）分为两类：</p>

<p>1.nfs-client:</p>

<p>也就是我们接下来演示的这一类，它通过K8S的内置的NFS驱动挂载远端的NFS服务器到本地目录；然后将自身作为storage provider，关联storage class。当用户创建对应的PVC来申请PV时，该provider就将PVC的要求与自身的属性比较，一旦满足就在本地挂载好的NFS目录中创建PV所属的子目录，为Pod提供动态的存储服务。</p>

<p>2.nfs:
与nfs-client不同，该驱动并不使用k8s的NFS驱动来挂载远端的NFS到本地再分配，而是直接将本地文件映射到容器内部，然后在容器内使用ganesha.nfsd来对外提供NFS服务；在每次创建PV的时候，直接在本地的NFS根目录中创建对应文件夹，并export出该子目录。</p>

<p>接下来我们来操作一个nfs-client驱动的例子，先对其有个直观的认识！</p>

<p>External NFS驱动的部署实例</p>

<p>这里，我们将nfs-client驱动做一个deployment部署到K8S集群中，然后对外提供存储服务。</p>

<p>1.部署nfs-client-provisioner</p>

<p>环境变量的PROVISIONER_NAME、NFS服务器地址、NFS对外提供服务的路径信息等需要设置好；部署所使用的yaml文件关键代码如下所示：</p>

<p>2.创建Storage Class</p>

<p>storage class的定义，需要注意的是：provisioner属性要等于驱动所传入的环境变量PROVISIONER_NAME的值。否则，驱动不知道知道如何绑定storage class。</p>

<p>3.创建PVC</p>

<p>这里指定了其对应的storage-class的名字为wise2c-nfs-storage，如下：</p>

<p>4.创建pod</p>

<p>指定该pod使用我们刚刚创建的PVC：henry-claim：</p>

<p>完成之后，如果attach到pod中执行一些文件的读写操作，就可以确定pod的/mnt已经使用了NFS的存储服务了。</p></blockquote>

<ul>
<li><a href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner#without-helm">https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner#without-helm</a></li>
</ul>


<p>官方文档中的脚本：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Set the subject of the RBAC objects to the current namespace where the provisioner is being deployed
</span><span class='line'>$ NS=$(kubectl config get-contexts|grep -e "^\*" |awk '{print $5}')
</span><span class='line'>$ NAMESPACE=${NS:-default}
</span><span class='line'>$ sed -i'' "s/namespace:.*/namespace: $NAMESPACE/g" ./deploy/rbac.yaml ./deploy/deployment.yaml
</span><span class='line'>$ kubectl create -f deploy/rbac.yaml</span></code></pre></td></tr></table></div></figure>


<p>操作步骤：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ git clone https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner/
</span><span class='line'>[ec2-user@k8s ~]$ cd nfs-subdir-external-provisioner/
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ NS=$(kubectl config get-contexts|grep -e "^\*" |awk '{print $5}')
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ NAMESPACE=${NS:-default}
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ sed -i'' "s/namespace:.*/namespace: $NAMESPACE/g" ./deploy/rbac.yaml ./deploy/deployment.yaml
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ kubectl create -f deploy/rbac.yaml
</span><span class='line'>serviceaccount/nfs-client-provisioner created
</span><span class='line'>clusterrole.rbac.authorization.k8s.io/nfs-client-provisioner-runner created
</span><span class='line'>clusterrolebinding.rbac.authorization.k8s.io/run-nfs-client-provisioner created
</span><span class='line'>role.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created
</span><span class='line'>rolebinding.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>$ vi deploy/deployment.yaml
</span><span class='line'>
</span><span class='line'>            - name: NFS_SERVER
</span><span class='line'>              value: 192.168.191.131
</span><span class='line'>            - name: NFS_PATH
</span><span class='line'>              value: /backup
</span><span class='line'>      volumes:
</span><span class='line'>        - name: nfs-client-root
</span><span class='line'>          nfs:
</span><span class='line'>            server: 192.168.191.131
</span><span class='line'>            path: /backup
</span><span class='line'>
</span><span class='line'>$ vi deploy/class.yaml
</span><span class='line'>
</span><span class='line'>parameters:
</span><span class='line'>  archiveOnDelete: "false"
</span><span class='line'>#Specifies a template for creating a directory path via PVC metadata's such as labels, annotations, name or namespace. To specify metadata use ${.PVC.&lt;metadata&gt;}. Example: If folder should be named like &lt;pvc-namespace&gt;-&lt;pvc-name&gt;, use ${.PVC.namespace}-${.PVC.name} as pathPattern.
</span><span class='line'>#  pathPattern: "${.PVC.namespace}/${.PVC.annotations.nfs.io/storage-path}" # waits for nfs.io/storage-path annotation, if not specified will accept as empty string.
</span><span class='line'>#  onDelete: delete
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># 先把镜像拉下来 k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ kubectl apply -f deploy/deployment.yaml 
</span><span class='line'>deployment.apps/nfs-client-provisioner created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ kubectl apply -f deploy/class.yaml 
</span><span class='line'>storageclass.storage.k8s.io/nfs-client created
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>测试：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># PVC内容
</span><span class='line'># https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner/blob/master/deploy/test-claim.yaml
</span><span class='line'>kind: PersistentVolumeClaim
</span><span class='line'>apiVersion: v1
</span><span class='line'>metadata:
</span><span class='line'>  name: test-claim
</span><span class='line'>spec:
</span><span class='line'>  storageClassName: nfs-client
</span><span class='line'>  accessModes:
</span><span class='line'>    - ReadWriteMany
</span><span class='line'>  resources:
</span><span class='line'>    requests:
</span><span class='line'>      storage: 1Mi
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ kubectl create -f deploy/test-claim.yaml -f deploy/test-pod.yaml
</span><span class='line'>persistentvolumeclaim/test-claim created
</span><span class='line'>pod/test-pod created
</span><span class='line'>
</span><span class='line'># kubectl delete -f deploy/test-pod.yaml -f deploy/test-claim.yaml
</span></code></pre></td></tr></table></div></figure>


<p><code>test pod</code> 在共享文件系统下写了一个 <code>touch /mnt/SUCCESS</code> 文件：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ ll /backup/default-test-claim-pvc-9857153a-6c2b-42d7-b464-aa5fc2acbf90/
</span><span class='line'>total 0
</span><span class='line'>-rw-r--r-- 1 root root 0 Apr 14 02:14 SUCCESS
</span></code></pre></td></tr></table></div></figure>


<h3>NFS Ganesha server and external provisioner</h3>

<ul>
<li><a href="https://github.com/kubernetes-sigs/nfs-ganesha-server-and-external-provisioner">https://github.com/kubernetes-sigs/nfs-ganesha-server-and-external-provisioner</a></li>
<li><a href="http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/#nfs-ganesha-server-and-external-provisioner">http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/#nfs-ganesha-server-and-external-provisioner</a></li>
</ul>


<p>就是直接在k8s集群中装一个NFS server。感觉没有直接在系统安装NFS管理方便，先搁置了。</p>

<p>&ndash;END</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/3">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/index.html">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>佛爷</h1>
  <p>来之不易, 且等且珍惜. <br>得之我幸; 不得<span style="display:none">-争-复争-且不得</span>, 命也, 乐享天命, 福也. </p>
  <p><a href="https://github.com/winse"><i class="fa fa-github-alt">winse</i></a>&nbsp;&nbsp;<a href="http://weibo.com/winseliu"><i class="fa fa-weibo">winseliu</i></a></p>
</section>
<section>
  <h1><a class='category' href='/blog/categories/recommend/'>Recommend</a></h1>
	<ul role="list">
		
			<li class="post">
				<a href="/blog/2019/04/10/try-k8s/">Try K8s</a>
			</li>
		
			<li class="post">
				<a href="/blog/2018/08/25/video-auto-translate/">视频自动翻译</a>
			</li>
		
			<li class="post">
				<a href="/blog/2018/06/09/reasonable-way-to-access-the-internet/">科学上网（续）</a>
			</li>
		
			<li class="post">
				<a href="/blog/2017/11/16/sphinx-generate-docs/">使用Sphinx生成/管理文档</a>
			</li>
		
			<li class="post">
				<a href="/blog/2017/10/30/windows-run-ubuntu/">Windows Run Ubuntu</a>
			</li>
		
			<li class="post">
				<a href="/blog/2017/07/30/kubeadm-install-kubenetes-on-centos7/">Kubeadm部署kubernetes</a>
			</li>
		
			<li class="post">
				<a href="/blog/2017/07/08/casperjs-crawler/">爬虫之CasperJS</a>
			</li>
		
			<li class="post">
				<a href="/blog/2016/09/19/163-open-movies-download/">批量下载163-open的视频</a>
			</li>
		
			<li class="post">
				<a href="/blog/2016/04/23/hadoop-guide-catalog/">[整理] Hadoop入门</a>
			</li>
		
			<li class="post">
				<a href="/blog/2016/04/04/rpm-build-your-package/">RPM打包</a>
			</li>
		
			<li class="post">
				<a href="/blog/2015/11/22/gfw-ladder/">搭梯笔记</a>
			</li>
		
			<li class="post">
				<a href="/blog/2015/08/24/manual-install-supervisor/">Supervisor安装配置</a>
			</li>
		
			<li class="post">
				<a href="/blog/2014/07/27/start-redis/">[读读书]Redis入门指南</a>
			</li>
		
			<li class="post">
				<a href="/blog/2014/04/21/hadoop2-windows-startguide/">Windows下部署/配置/调试hadoop2</a>
			</li>
		
			<li class="post">
				<a href="/blog/2014/03/30/git-cheatsheet/">GIT操作记录手册</a>
			</li>
		
			<li class="post">
				<a href="/blog/2014/02/23/quickly-open-program-in-windows/">[Windows运行]快速打开程序</a>
			</li>
		
	</ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2023/04/09/dingtalk-with-openai/">钉钉群机器人对接ChatGPT</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/03/26/clash-on-raspberry4/">树莓派4安装Clash</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/03/25/reinstall-raspberry2/">重新折腾raspberry2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/03/25/mirror-request/">请求复制/镜像</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/03/18/wechat-on-openai/">微信对接OpenAI</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/02/01/git-reset-hard/">记git Reset &#8211;hard</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/02/01/register-openai/">注册OpenAI</a>
      </li>
    
      <li class="post">
        <a href="/blog/2022/07/24/xinchuang-install-postgres/">信创环境迁移浅析-以Postgres为例</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>

	 
	<ul role="list">
		
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/0/'>0</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/alluxio/'>alluxio</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/android/'>android</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/bigdata/'>bigdata</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/blabla/'>blabla</a> (7) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/books/'>books</a> (5) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/clash/'>clash</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/debug/'>debug</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/deprecated/'>deprecated</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/devops/'>devops</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/docker/'>docker</a> (16) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/elasticsearch/'>elasticsearch</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/es/'>es</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/flume/'>flume</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/ganglia/'>ganglia</a> (5) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/git/'>git</a> (4) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/hadoop/'>hadoop</a> (44) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/hbase/'>hbase</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/hive/'>hive</a> (8) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/hole/'>hole</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/java/'>java</a> (13) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/jekyll/'>jekyll</a> (8) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/jenkins/'>jenkins</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/jeykll/'>jeykll</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/k2/'>k2</a> (2) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/k8s/'>k8s</a> (15) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/kafka/'>kafka</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/kubeadm/'>kubeadm</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/logstash/'>logstash</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/map/'>map</a> (2) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/nfs/'>nfs</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/nginx/'>nginx</a> (5) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/openai/'>openai</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/openeuler/'>openeuler</a> (2) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/openvpn/'>openvpn</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/puppet/'>puppet</a> (11) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/r4a/'>r4a</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/raspberry/'>raspberry</a> (5) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/recommend/'>recommend</a> (16) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/redis/'>redis</a> (7) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/scala/'>scala</a> (4) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/shell/'>shell</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/spark/'>spark</a> (13) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/staf/'>staf</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/tachyon/'>tachyon</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/tez/'>tez</a> (2) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/tools/'>tools</a> (70) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/topics/'>topics</a> (2) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/vagrant/'>vagrant</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/vnc/'>vnc</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/wsl/'>wsl</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/zookeeper/'>zookeeper</a> (1) 
		</li>
		
		
		<li style="clear:both; width: 1px; margin: 0; padding: 0;"></li>
		<li class="category"><a href="/blog/archives">All categories</a> (235)</li>
	</ul>
	
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/winse">@winse</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'winse',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
<!--
  <h1>Softs, I&#8217;m using</h1>
  <ul>
    <li class="post">
		<a href="http://hadoop.apache.org/releases.html">hadoop-2.6.3</a>
	</li>
	<li class="post">
		<a href="https://issues.apache.org/jira/browse/HBASE/?selectedTab=com.atlassian.jira.jira-projects-plugin:changelog-panel">hbase-0.96.0</a>
	</li>
	<li class="post">
		<a href="https://hive.apache.org/downloads.html">hive-1.2.1</a>
	</li>
	<li class="post">
		<a href="https://issues.apache.org/jira/browse/TEZ/?selectedTab=com.atlassian.jira.jira-projects-plugin:summary-panel">tez-0.7.0</a>
    </li>
  </ul>
&#8211;>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2023 - Winse Liu -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1253103971'%3E%3C/span%3E%3Cscript src='https://s19.cnzz.com/z_stat.php%3Fid%3D1253103971%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</p>

</footer>
  


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

<script>

var time=location.pathname.substring(6).substring(0,11);
var eName=location.pathname.substring(17);
var gitalk = new Gitalk({
  clientID: 'c14f68eac6330d15d984',
  clientSecret: '73b7c1fffa98e299ff0cdd332821201933858e6e',
  repo: 'winse.github.com',
  owner: 'winse',
  admin: ['winse'],
  id: eName,
  labels: ['Gitalk', time],
  body: "http://winse.github.io" + location.pathname,
  createIssueManually: true,
  
  // facebook-like distraction free mode
  distractionFreeMode: false
})

gitalk.render('gitalk-container')

</script>



<script>
/*
$.ajax({
  type: "POST",
  url: "http://log.winseliu.com:20000",
  data: JSON.stringify({
    title: document.title,
    location: JSON.stringify(location),
    referrer: document.referrer,
    userAgent: navigator.userAgent
  }),
  contentType: "application/json; charset=utf-8",
  dataType: "json"
});
*/
</script>











</body>
</html>
