
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Winse Blog</title>
  <meta name="author" content="Winse Liu">

  
  <meta name="description" content="以前有使用FlameGraph做Java程序的堆栈（热点代码）的显示。其实磁盘也可以使用类似的方式来显示查看占用情况，找出没用的数据。 1
2
3
4
5
$ git clone https://github.com/brendangregg/FlameGraph.git #使用管理员权限运行 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://winseliu.com/posts/3">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="/atom.xml" rel="alternate" title="Winse Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->


  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43198550-1', 'auto');
  ga('send', 'pageview');

</script>



</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Winse Blog</a></h1>
  
    <h2>走走停停, 熙熙攘攘, 忙忙碌碌, 不知何畏.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:winseliu.com" />
    <input class="search" type="text" name="q" results="0" placeholder="站内搜索"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/archives/updated.html">Updated</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/28/flamegraph-display-how-disk-be-used/">使用Flamegraph查看磁盘使用情况</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-10-28T19:08:14+08:00" pubdate data-updated="true">Sat 2017-10-28 19:08</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>以前有使用FlameGraph做Java程序的堆栈（热点代码）的显示。其实磁盘也可以使用类似的方式来显示查看占用情况，找出没用的数据。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/brendangregg/FlameGraph.git
</span><span class='line'>
</span><span class='line'>#使用管理员权限运行
</span><span class='line'>winse@Lenovo-PC /cygdrive/e/git/FlameGraph
</span><span class='line'>$ ./files.pl /cygdrive/c/ | ./flamegraph.pl --hash --countname=bytes &gt; /cygdrive/r/c.svg
</span></code></pre></td></tr></table></div></figure>


<p>然后浏览器查看即可，主要还是查看占用比。（但是不一定所有文件都包括在SVG里面）。</p>

<p>当然，默认官网提供的 files.pl 是获取所有的目录。我们可以做下层级控制，代码修改如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git diff
</span><span class='line'>diff --git a/files.pl b/files.pl
</span><span class='line'>index 27654be..5d1012e 100755
</span><span class='line'>--- a/files.pl
</span><span class='line'>+++ b/files.pl
</span><span class='line'>@@ -29,7 +29,16 @@ sub usage {
</span><span class='line'> usage() if @ARGV == 0 or $ARGV[0] eq "--help" or $ARGV[0] eq "-h";
</span><span class='line'>
</span><span class='line'> foreach my $dir (@ARGV) {
</span><span class='line'>-    find(\&wanted, $dir);
</span><span class='line'>+    find({
</span><span class='line'>+       preprocess =&gt; \&preprocess,
</span><span class='line'>+       wanted =&gt; \&wanted,
</span><span class='line'>+    }, $dir);
</span><span class='line'>+}
</span><span class='line'>+
</span><span class='line'>+sub preprocess {
</span><span class='line'>+       my $depth = $File::Find::dir =~ tr[/][];
</span><span class='line'>+       return @_ if $depth &lt; 8;
</span><span class='line'>+       return ;
</span><span class='line'> }
</span><span class='line'>
</span><span class='line'> sub wanted {
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/blogs/flamegraph_disk.png" alt="" /></p>

<p>下列的文件夹可以排查下进行处理：</p>

<ul>
<li>C:\pagefile.sys C:\swapfile.sys : 系统属性-高级-性能选项-虚拟内存</li>
<li>C:\hiberfil.sys : powercfg -h -zie 60% ; powercfg.exe /hibernate off</li>
<li>C:\ProgramData\Package Cache</li>
</ul>


<h2>参考</h2>

<ul>
<li><a href="http://www.brendangregg.com/blog/2016-01-20/ebpf-offcpu-flame-graph.html">http://www.brendangregg.com/blog/2016-01-20/ebpf-offcpu-flame-graph.html</a></li>
<li><a href="https://support.microsoft.com/en-us/help/920730/how-to-disable-and-re-enable-hibernation-on-a-computer-that-is-running">https://support.microsoft.com/en-us/help/920730/how-to-disable-and-re-enable-hibernation-on-a-computer-that-is-running</a></li>
<li><a href="http://www.intowindows.com/how-to-reduce-hibernate-file-size-in-windows-7/">http://www.intowindows.com/how-to-reduce-hibernate-file-size-in-windows-7/</a></li>
<li><a href="http://www.brendangregg.com/blog/2017-02-05/file-system-flame-graph.html">http://www.brendangregg.com/blog/2017-02-05/file-system-flame-graph.html</a></li>
</ul>


<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/08/docker-network-via-macvlan/">Docker多主机网络配置 - Macvlan</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-10-08T10:27:54+08:00" pubdate data-updated="true">Sun 2017-10-08 10:27</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>参考</h2>

<ul>
<li><a href="https://docs.docker.com/engine/userguide/networking/get-started-macvlan/#macvlan-bridge-mode-example-usage">Get started with Macvlan network driver</a></li>
<li><a href="https://github.com/alfredhuang211/study-docker-doc/blob/master/docker%E8%B7%A8%E4%B8%BB%E6%9C%BAmacvlan%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE.md">docker跨主机macvlan网络配置</a></li>
<li><a href="https://blog.jessfraz.com/post/ips-for-all-the-things/">ip static</a></li>
<li><a href="https://stackoverflow.com/questions/35742807/docker-1-10-containers-ip-in-lan/39285950#39285950">Docker 1.12+ container&rsquo;s IP in LAN</a></li>
<li><a href="http://hustcat.github.io/docker-macvlan/">Docker自定义网络——MacVLAN</a> 这篇内容有点类似pipework。</li>
</ul>


<blockquote><p>Note: In Macvlan you are not able to ping or communicate with the default namespace IP address. For example, if you create a container and try to ping the Docker host’s eth0 it will not work. That traffic is explicitly filtered by the kernel modules themselves to offer additional provider isolation and security.</p></blockquote>

<h2>主机</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@kube-master140 ~]# ip addr show ens33
</span><span class='line'>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
</span><span class='line'>    link/ether 00:0c:29:40:2d:15 brd ff:ff:ff:ff:ff:ff
</span><span class='line'>    inet 192.168.191.140/24 brd 192.168.191.255 scope global dynamic ens33
</span><span class='line'>       valid_lft 1765sec preferred_lft 1765sec
</span><span class='line'>    inet6 fe80::1186:2fe5:9ee5:8790/64 scope link 
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>
</span><span class='line'>[root@kube-worker141 ~]# ip addr show ens33
</span><span class='line'>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
</span><span class='line'>    link/ether 00:0c:29:2e:67:4d brd ff:ff:ff:ff:ff:ff
</span><span class='line'>    inet 192.168.191.141/24 brd 192.168.191.255 scope global dynamic ens33
</span><span class='line'>       valid_lft 1779sec preferred_lft 1779sec
</span><span class='line'>    inet6 fe80::dd23:1df6:b37:efae/64 scope link 
</span><span class='line'>       valid_lft forever preferred_lft forever</span></code></pre></td></tr></table></div></figure>


<h2>创建网络</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@kube-worker141 ~]# docker network create \
</span><span class='line'>-d macvlan \
</span><span class='line'>--subnet=192.168.191.0/24 \
</span><span class='line'>--gateway=192.168.191.2 \
</span><span class='line'>-o parent=ens33 pub_net
</span><span class='line'>4370998ed03024bc0057a894f1280d5b0fcdba526fd9e8da612a3abb0dbc884b
</span><span class='line'>
</span><span class='line'>[root@kube-worker141 ~]# docker network list 
</span><span class='line'>NETWORK ID          NAME                DRIVER              SCOPE
</span><span class='line'>eee9236a36ba        bridge              bridge              local               
</span><span class='line'>ddc7f59215c1        host                host                local               
</span><span class='line'>d8dc7fbc40a6        none                null                local               
</span><span class='line'>4370998ed030        pub_net             macvlan             local               
</span><span class='line'>
</span><span class='line'>[root@kube-worker141 ~]# docker network inspect pub_net
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<h2>使用</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker rm -f $( docker ps -a | grep -v IMAGE | awk '{print $1}' ) 
</span><span class='line'>
</span><span class='line'>[root@kube-worker141 ~]# docker run --net=pub_net --ip=192.168.191.200 --name c200 -tid busybox /bin/sh
</span><span class='line'>2e0a2ede40e80a2f1739330bb3a6c45b91ea08d78d26d165ad13945bedbea40f
</span><span class='line'>
</span><span class='line'>[root@kube-worker141 ~]# docker ps 
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span><span class='line'>2e0a2ede40e8        busybox             "/bin/sh"           13 seconds ago      Up 11 seconds                           c200
</span><span class='line'>[root@kube-worker141 ~]# docker exec c200 ifconfig 
</span><span class='line'>eth0      Link encap:Ethernet  HWaddr 02:42:C0:A8:BF:C8  
</span><span class='line'>          inet addr:192.168.191.200  Bcast:0.0.0.0  Mask:255.255.255.0
</span><span class='line'>          inet6 addr: fe80::42:c0ff:fea8:bfc8/64 Scope:Link
</span><span class='line'>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
</span><span class='line'>          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
</span><span class='line'>          TX packets:8 errors:0 dropped:0 overruns:0 carrier:0
</span><span class='line'>          collisions:0 txqueuelen:0 
</span><span class='line'>          RX bytes:0 (0.0 B)  TX bytes:648 (648.0 B)
</span><span class='line'>
</span><span class='line'>lo        Link encap:Local Loopback  
</span><span class='line'>          inet addr:127.0.0.1  Mask:255.0.0.0
</span><span class='line'>          inet6 addr: ::1/128 Scope:Host
</span><span class='line'>          UP LOOPBACK RUNNING  MTU:65536  Metric:1
</span><span class='line'>          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
</span><span class='line'>          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
</span><span class='line'>          collisions:0 txqueuelen:1 
</span><span class='line'>          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
</span><span class='line'>
</span><span class='line'>[root@kube-worker141 ~]# docker exec c200 route -n
</span><span class='line'>Kernel IP routing table
</span><span class='line'>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
</span><span class='line'>0.0.0.0         192.168.191.2   0.0.0.0         UG    0      0        0 eth0
</span><span class='line'>192.168.191.0   0.0.0.0         255.255.255.0   U     0      0        0 eth0
</span><span class='line'>[root@kube-worker141 ~]# docker exec c200 ping baidu.com 
</span><span class='line'>PING baidu.com (111.13.101.208): 56 data bytes
</span><span class='line'>64 bytes from 111.13.101.208: seq=0 ttl=128 time=45.029 ms
</span><span class='line'>64 bytes from 111.13.101.208: seq=1 ttl=128 time=44.616 ms
</span><span class='line'>
</span><span class='line'>#201
</span><span class='line'>[root@kube-worker141 ~]# docker run --net=pub_net --ip=192.168.191.201 -tid busybox /bin/sh 
</span><span class='line'>c8cfd3443f2b7b3973a06470cb95442eadface8d89c8cb1749ad73ebbd7e9e39
</span><span class='line'>
</span><span class='line'>##本地容器互通: 
</span><span class='line'>#: HOST141-200 ping HOST141-201
</span><span class='line'>[root@kube-worker141 ~]# docker exec c200 ping -W 10 192.168.191.201
</span><span class='line'>PING 192.168.191.201 (192.168.191.201): 56 data bytes
</span><span class='line'>64 bytes from 192.168.191.201: seq=0 ttl=64 time=0.523 ms
</span><span class='line'>
</span><span class='line'>#210 
</span><span class='line'>[root@kube-master ~]# docker run --net=pub_net --ip=192.168.191.210 -tid busybox /bin/sh 
</span><span class='line'>7929c136c3dbc646b68b3b7302e8525a25fe2f583db2246fea0da85a448b7b78
</span><span class='line'>
</span><span class='line'>##B访问A主机的容器: 
</span><span class='line'>#: HOST140 ping HOST141-201 
</span><span class='line'>[root@kube-master140 ~]# ping 192.168.191.201 
</span><span class='line'>PING 192.168.191.201 (192.168.191.201) 56(84) bytes of data.
</span><span class='line'>64 bytes from 192.168.191.201: icmp_seq=1 ttl=64 time=1.44 ms
</span><span class='line'>
</span><span class='line'>##A主机容器访问B主机容器: 
</span><span class='line'>#: HOST141-200 ping HOST140-210
</span><span class='line'>[root@kube-worker141 ~]# docker exec c200 ping -W 10 192.168.191.210
</span><span class='line'>PING 192.168.191.210 (192.168.191.210): 56 data bytes
</span><span class='line'>64 bytes from 192.168.191.210: seq=0 ttl=64 time=2.049 ms
</span><span class='line'>64 bytes from 192.168.191.210: seq=1 ttl=64 time=0.993 ms
</span><span class='line'>
</span><span class='line'>#主机与所在容器互相不能访问 (--!): 
</span><span class='line'>#: HOST141 ping HOST141-200
</span><span class='line'>[root@kube-worker141 ~]# ping 192.168.191.200
</span><span class='line'>PING 192.168.191.200 (192.168.191.200) 56(84) bytes of data.
</span><span class='line'>From 192.168.191.141 icmp_seq=1 Destination Host Unreachable
</span><span class='line'>From 192.168.191.141 icmp_seq=2 Destination Host Unreachable
</span><span class='line'>#: HOST141-200 ping HOST141
</span><span class='line'>[root@kube-worker1 ~]# docker exec c200 ping 192.168.191.141
</span></code></pre></td></tr></table></div></figure>


<p>针对主机与本机容器不能互通的问题，可以增加一张默认的网卡：<a href="https://success.docker.com/KBase/Multiple_Docker_Networks">Multiple Docker Networks</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#先通过默认网络创建
</span><span class='line'>[root@kube-worker1 ~]# docker run --name c200 -tid busybox /bin/sh                                   
</span><span class='line'>47b7c1813b95cbec471b1a6de6a870e5537cfa70d54120873a5edb4e444b373b
</span><span class='line'>#然后连接pub_net！
</span><span class='line'>[root@kube-worker1 ~]# docker network connect --ip=192.168.191.200 pub_net c200        
</span><span class='line'>[root@kube-worker1 ~]# docker exec c200 ip a
</span><span class='line'>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1
</span><span class='line'>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span><span class='line'>    inet 127.0.0.1/8 scope host lo
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>    inet6 ::1/128 scope host 
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>14: eth0@if15: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue 
</span><span class='line'>    link/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff
</span><span class='line'>    inet 172.18.0.2/16 scope global eth0
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>    inet6 fe80::42:acff:fe12:2/64 scope link 
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>16: eth1@if2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue 
</span><span class='line'>    link/ether 02:42:c0:a8:bf:c8 brd ff:ff:ff:ff:ff:ff
</span><span class='line'>    inet 192.168.191.200/24 scope global eth1
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>    inet6 fe80::42:c0ff:fea8:bfc8/64 scope link 
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>       </span></code></pre></td></tr></table></div></figure>


<p>方式1：</p>

<p>与主机的通信，通过 172.18.0.0/24 的网络。其他的通过 192.168.191.0/24 。还是感觉有点鸡肋！！</p>

<p>方式2：</p>

<p>增加route：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#route add -host $container_ip gw $lan_router_ip $if_device_nic2
</span><span class='line'>
</span><span class='line'>[root@kube-worker1 ~]# route add -net 192.168.191.200 gw 172.18.0.1 netmask 255.255.255.255 dev docker0
</span><span class='line'>[root@kube-worker1 ~]# route -n
</span><span class='line'>Kernel IP routing table
</span><span class='line'>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
</span><span class='line'>0.0.0.0         192.168.191.2   0.0.0.0         UG    100    0        0 ens33
</span><span class='line'>172.17.3.0      192.168.191.140 255.255.255.0   UG    100    0        0 ens33
</span><span class='line'>172.17.4.0      0.0.0.0         255.255.255.0   U     425    0        0 kbr0
</span><span class='line'>172.18.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0
</span><span class='line'>192.168.191.0   0.0.0.0         255.255.255.0   U     100    0        0 ens33
</span><span class='line'>192.168.191.200 172.18.0.1      255.255.255.255 UGH   0      0        0 docker0
</span><span class='line'>[root@kube-worker1 ~]# ping 192.168.191.200
</span><span class='line'>PING 192.168.191.200 (192.168.191.200) 56(84) bytes of data.
</span><span class='line'>64 bytes from 192.168.191.200: icmp_seq=1 ttl=64 time=0.239 ms
</span><span class='line'>64 bytes from 192.168.191.200: icmp_seq=2 ttl=64 time=0.106 ms
</span><span class='line'>^C
</span><span class='line'>--- 192.168.191.200 ping statistics ---
</span><span class='line'>2 packets transmitted, 2 received, 0% packet loss, time 1000ms
</span><span class='line'>rtt min/avg/max/mdev = 0.106/0.172/0.239/0.067 ms
</span></code></pre></td></tr></table></div></figure>


<p>通过操作与pipework比较，互有优劣：</p>

<ul>
<li>pipework会创建网卡，然后所有的ip都是互通的，但是绑定、还得把主机的ip配置到br0上。</li>
<li>而docker-network的方式与主机互通需要做额外的配置。</li>
</ul>


<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/07/docker-network-via-pipework/">Docker多主机网络配置 - Pipework</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-10-07T23:24:23+08:00" pubdate data-updated="true">Sat 2017-10-07 23:24</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前面使用nat+route的方式手动连通两台机器上的docker容器。pipework是通过脚本的方式（手动）设置网络以及修改路由来进行配置的。</p>

<p>参考：</p>

<ul>
<li><a href="http://www.infoq.com/cn/articles/docker-network-and-pipework-open-source-explanation-practice">Docker网络详解及pipework源码解读与实践</a></li>
<li><a href="http://hongge.blog.51cto.com/2083180/1843169">docker技术剖析&ndash;docker网络（二）docker宿主机之间容器互通 for centos7.2</a> 步骤更详细一点</li>
<li><a href="http://tonybai.com/2016/02/15/understanding-docker-multi-host-networking/">理解Docker跨多主机容器网络</a></li>
</ul>


<blockquote><p>2、将物理网卡桥接到虚拟网桥，使得容器与宿主机配置在同一网段下</p>

<p>在各个宿主机上都建立一个新虚拟网桥设备br0，将各自物理网卡eth0桥接br0上，eth0的IP地址赋给br0；同时修改Docker daemon的DOCKER_OPTS，设置-b=br0（替代docker0），并限制Container IP地址的分配范围为同物理段地址（–fixed-cidr）。重启各个主机的Docker Daemon后，处于与宿主机在同一网段的Docker容器就可以实现跨主机访问了。这个方案同样存在局限和扩展性差的问题：比如需将物理网段的地址划分 成小块，分布到各个主机上，防止IP冲突；子网划分依赖物理交换机设置；Docker容器的主机地址空间大小依赖物理网络划分等。</p></blockquote>

<p>原理就是建立一条连接link，一端 <strong> 在主机 </strong> 一端 <strong> 在容器 </strong> ；然后手动配置容器ip和路由；最后把主机Ethernet和新建的Bridge桥接连接到物理网络。</p>

<p>容器的ip地址和主机的ip地址在一个网段内，所以在同一交换机下的所有主机、里面的容器都互通。</p>

<h2>查看原网络的信息：</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@kube-worker1 ~]# nmcli d show ens33 
</span><span class='line'>GENERAL.DEVICE:                         ens33
</span><span class='line'>GENERAL.TYPE:                           ethernet
</span><span class='line'>GENERAL.HWADDR:                         00:0C:29:2E:67:4D
</span><span class='line'>GENERAL.MTU:                            1500
</span><span class='line'>GENERAL.STATE:                          100 (connected)
</span><span class='line'>GENERAL.CONNECTION:                     ens33
</span><span class='line'>GENERAL.CON-PATH:                       /org/freedesktop/NetworkManager/ActiveConnection/0
</span><span class='line'>WIRED-PROPERTIES.CARRIER:               on
</span><span class='line'>IP4.ADDRESS[1]:                         192.168.191.141/24
</span><span class='line'>IP4.GATEWAY:                            192.168.191.2
</span><span class='line'>IP4.ROUTE[1]:                           dst = 172.17.3.0/24, nh = 192.168.191.140, mt = 100
</span><span class='line'>IP4.DNS[1]:                             192.168.191.2
</span><span class='line'>IP4.DOMAIN[1]:                          localdomain
</span><span class='line'>IP6.ADDRESS[1]:                         fe80::3995:4490:e2e7:1d0f/64
</span><span class='line'>IP6.GATEWAY:                            </span></code></pre></td></tr></table></div></figure>


<h2>安装pipework</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://github.com/jpetazzo/pipework
</span><span class='line'>cp ~/pipework/pipework /usr/local/bin/</span></code></pre></td></tr></table></div></figure>


<h2>运行docker</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#设置ip转发
</span><span class='line'>echo 1 &gt; /proc/sys/net/ipv4/ip_forward
</span><span class='line'>
</span><span class='line'>vi /etc/sysctl.conf
</span><span class='line'>net.ipv4.ip_forward = 1  
</span><span class='line'>
</span><span class='line'>NAME=test1
</span><span class='line'>
</span><span class='line'>#如不需要安装软件，可以加 --net none
</span><span class='line'>docker run -itd --name $NAME centos /bin/bash
</span><span class='line'>
</span><span class='line'>#docker ps -a -f name=$NAME | grep $NAME && docker start $NAME 
</span><span class='line'>#docker exec test1 yum install -y iproute net-tools </span></code></pre></td></tr></table></div></figure>


<h2>配置网络</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>function docker_container_ip () {
</span><span class='line'>  local name=$1
</span><span class='line'>  local ip=$2
</span><span class='line'>  local gateway=${3:-$GATEWAY}
</span><span class='line'>  
</span><span class='line'>  pipework br0 $name $ip@$gateway
</span><span class='line'>  #docker exec $name ifconfig 
</span><span class='line'>  #docker exec $name route -n 
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function docker_hosted_bridge_network_reset () {
</span><span class='line'>  local ip=$1
</span><span class='line'>  local gateway=$2
</span><span class='line'>  local iface=$3
</span><span class='line'>  
</span><span class='line'>  if nmcli d show $iface | grep -i ethernet ; then
</span><span class='line'>    #把地址给网桥，然后把ethernet和bridge连起来：(SSH连接操作的话，需要一条命令搞定！修改br0地址后route会变)
</span><span class='line'>    ip addr add $ip dev br0 ; \
</span><span class='line'>    ip addr del $ip dev $iface ; \
</span><span class='line'>    brctl addif br0 $iface ; \
</span><span class='line'>    #ip route del default ; \
</span><span class='line'>    ip route add default via $gateway 
</span><span class='line'>  fi 
</span><span class='line'>  
</span><span class='line'>  brctl show br0
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>GATEWAY=$( route -n | grep '^0.0.0.0' | awk '{print $2}' )
</span><span class='line'>IFACE=$( route -n | grep '^0.0.0.0' | awk '{print $8}' )
</span><span class='line'>HOSTED_IPADDR=$( ip addr show $IFACE | grep "inet " | awk '{print $2}' )
</span></code></pre></td></tr></table></div></figure>


<p>设置容器的IP：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NAME=test1
</span><span class='line'>IP=192.168.191.210/24
</span><span class='line'>
</span><span class='line'>docker_container_ip $NAME $IP $GATEWAY
</span><span class='line'>docker_hosted_bridge_network_reset $HOSTED_IPADDR $GATEWAY $IFACE</span></code></pre></td></tr></table></div></figure>


<p>上面的方式配置方式<strong>重启就失效</strong>的，可以通过写配置文件的方式来永久生效。如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@kube-worker1 ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens33 
</span><span class='line'>TYPE=Ethernet
</span><span class='line'>DEVICE=ens33
</span><span class='line'>BRIDGE=br0
</span><span class='line'>[root@kube-worker1 ~]# cat /etc/sysconfig/network-scripts/ifcfg-br0 
</span><span class='line'>DEVICE=br0
</span><span class='line'>TYPE=Bridge
</span><span class='line'>ONBOOT=yes
</span><span class='line'>BOOTPROTO=static
</span><span class='line'>IPADDR=192.168.191.141
</span><span class='line'>NETMASK=255.255.255.0
</span><span class='line'>GATEWAY=192.168.191.2
</span><span class='line'>DNS1=192.168.191.2
</span><span class='line'>
</span><span class='line'>USERCTL=no</span></code></pre></td></tr></table></div></figure>


<h2>测试</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@kube-worker1 ~]# screen
</span><span class='line'>
</span><span class='line'>  GATEWAY=$( route -n | grep '^0.0.0.0' | awk '{print $2}' )
</span><span class='line'>  IFACE=$( route -n | grep '^0.0.0.0' | awk '{print $8}' )
</span><span class='line'>  HOSTED_IPADDR=$( ip addr show $IFACE | grep "inet " | awk '{print $2}' )
</span><span class='line'>
</span><span class='line'>  docker run -itd --name test21 centos /bin/bash
</span><span class='line'>  docker run -itd --name test22 centos /bin/bash
</span><span class='line'>
</span><span class='line'>  docker_container_ip test21 192.168.191.231/24 $GATEWAY
</span><span class='line'>  docker_container_ip test22 192.168.191.232/24 $GATEWAY
</span><span class='line'>
</span><span class='line'>  docker exec test21 ping  192.168.191.140
</span><span class='line'>  docker exec test21 ping  192.168.191.141
</span><span class='line'>
</span><span class='line'>[root@kube-master ~]# screen #会话"不断"
</span><span class='line'>
</span><span class='line'>  docker_container_ip test11 192.168.191.221/24 $GATEWAY 
</span><span class='line'>  docker_container_ip test12 192.168.191.222/24 $GATEWAY
</span><span class='line'>
</span><span class='line'>  docker_hosted_bridge_network_reset $HOSTED_IPADDR $GATEWAY $IFACE
</span><span class='line'>
</span><span class='line'>  docker exec test11 ping 192.168.191.233</span></code></pre></td></tr></table></div></figure>


<p>注意：容器重启后，这些配置的网卡/路由都没有了，要重新配置：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@kube-worker1 ~]# docker stop test21
</span><span class='line'>test21
</span><span class='line'>[root@kube-worker1 ~]# docker start test21
</span><span class='line'>test21
</span><span class='line'>[root@kube-worker1 ~]# pipework route test21 show 
</span><span class='line'>default via 172.18.0.1 dev eth0 
</span><span class='line'>172.18.0.0/16 dev eth0  proto kernel  scope link  src 172.18.0.2 
</span><span class='line'>
</span><span class='line'>[root@kube-worker1 ~]# docker_container_ip test21 192.168.191.231/24 $GATEWAY
</span><span class='line'>[root@kube-worker1 ~]# pipework route test21 show                            
</span><span class='line'>default via 192.168.191.2 dev eth1 
</span><span class='line'>172.18.0.0/16 dev eth0  proto kernel  scope link  src 172.18.0.2 
</span><span class='line'>192.168.191.0/24 dev eth1  proto kernel  scope link  src 192.168.191.231 
</span><span class='line'>
</span><span class='line'>[root@kube-worker1 ~]# docker exec test21 ping 192.168.191.140</span></code></pre></td></tr></table></div></figure>


<p>了解原理后，操作起来还是比较容易的。就是每次重启都要重新配置比较烦。可以写成脚本，启动docker容器的时刻就执行下网络配置。</p>

<p>pipework还可以用来配置vlan，暂时没这个需求，并且基本的操作都类似就没有实际操作了。</p>

<p>话说，<strong> pipework还可以用来创建多网卡的容器。用docker network connect其实更简单。 </strong></p>

<h2>后记</h2>

<p>除了通过pipework来实现共享物理网络外，docker network也可以实现这个功能：</p>

<ul>
<li><a href="https://stackoverflow.com/questions/35742807/docker-1-10-containers-ip-in-lan/35799206#35799206">Docker 1.10 container&rsquo;s IP in LAN</a></li>
<li><p><a href="https://gist.github.com/dreamcat4/bc202ae175b367bcbe693da7a52851af">using bridge driver and brctrl.md</a> 感觉原理也类似pipework，就是那一堆的netns让 docker network + docker run &ndash;net 实现了而已。</p></li>
<li><p>建立并配置Bridge：</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#中间会导致网络断掉，一条命令搞定才行
</span><span class='line'>docker network create --gateway=192.168.191.141 --subnet 192.168.191.0/24 --aux-address "DefaultGatewayIPv4=192.168.191.2" -o com.docker.network.bridge.name=br-home-net homenet ; \
</span><span class='line'>ip addr del 192.168.191.141/24 dev ens33 ; \
</span><span class='line'>brctl addif br-home-net ens33 
</span><span class='line'>
</span><span class='line'>#主机不上外网可以不加
</span><span class='line'>ip route add default via 192.168.191.2 ; 
</span><span class='line'>echo "nameserver 114.114.114.114" &gt;&gt;/etc/resolv.conf ; </span></code></pre></td></tr></table></div></figure>


<ul>
<li>测试 docker-net + bridge：</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@kube-worker1 ~]# ip a
</span><span class='line'>...
</span><span class='line'>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master br-home-net state UP qlen 1000
</span><span class='line'>    link/ether 00:0c:29:2e:67:4d brd ff:ff:ff:ff:ff:ff
</span><span class='line'>4: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN 
</span><span class='line'>    link/ether 02:42:44:ef:32:28 brd ff:ff:ff:ff:ff:ff
</span><span class='line'>    inet 172.18.0.1/16 scope global docker0
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>11: br-home-net: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP 
</span><span class='line'>    link/ether 02:42:84:97:c2:25 brd ff:ff:ff:ff:ff:ff
</span><span class='line'>    inet 192.168.191.141/24 scope global br-home-net
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>    inet6 fe80::42:84ff:fe97:c225/64 scope link 
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>       
</span><span class='line'>[root@kube-worker1 ~]# docker run -tid --name c200 --net homenet --ip 192.168.191.200 busybox /bin/sh 
</span><span class='line'>2579c2ddd18d23322eb1e145ad630205933dbc527b8981169ec6b125da8d8f1e
</span><span class='line'>
</span><span class='line'>[root@kube-worker1 ~]# docker exec -ti c200 sh 
</span><span class='line'>/ # ip a
</span><span class='line'>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1
</span><span class='line'>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span><span class='line'>    inet 127.0.0.1/8 scope host lo
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>12: eth0@if13: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue 
</span><span class='line'>    link/ether 02:42:c0:a8:bf:c8 brd ff:ff:ff:ff:ff:ff
</span><span class='line'>    inet 192.168.191.200/24 scope global eth0
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>/ # route -n
</span><span class='line'>Kernel IP routing table
</span><span class='line'>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
</span><span class='line'>0.0.0.0         192.168.191.2   0.0.0.0         UG    0      0        0 eth0
</span><span class='line'>192.168.191.0   0.0.0.0         255.255.255.0   U     0      0        0 eth0
</span><span class='line'>/ # ping baidu.com 
</span><span class='line'>PING baidu.com (111.13.101.208): 56 data bytes
</span><span class='line'>64 bytes from 111.13.101.208: seq=0 ttl=128 time=48.225 ms
</span><span class='line'>^C
</span><span class='line'>--- baidu.com ping statistics ---
</span><span class='line'>1 packets transmitted, 1 packets received, 0% packet loss
</span><span class='line'>round-trip min/avg/max = 48.225/48.225/48.225 ms
</span><span class='line'>/ # ping 192.169.191.140
</span><span class='line'>PING 192.169.191.140 (192.169.191.140): 56 data bytes
</span><span class='line'>^C
</span><span class='line'>--- 192.169.191.140 ping statistics ---
</span><span class='line'>4 packets transmitted, 0 packets received, 100% packet loss
</span><span class='line'>/ # ping 192.168.191.140
</span><span class='line'>PING 192.168.191.140 (192.168.191.140): 56 data bytes
</span><span class='line'>64 bytes from 192.168.191.140: seq=0 ttl=64 time=2.572 ms
</span><span class='line'>64 bytes from 192.168.191.140: seq=1 ttl=64 time=1.076 ms
</span><span class='line'>^C
</span><span class='line'>--- 192.168.191.140 ping statistics ---
</span><span class='line'>2 packets transmitted, 2 packets received, 0% packet loss
</span><span class='line'>round-trip min/avg/max = 1.076/1.824/2.572 ms
</span><span class='line'>/ # ping 192.168.191.141
</span><span class='line'>PING 192.168.191.141 (192.168.191.141): 56 data bytes
</span><span class='line'>64 bytes from 192.168.191.141: seq=0 ttl=64 time=0.474 ms
</span><span class='line'>64 bytes from 192.168.191.141: seq=1 ttl=64 time=0.138 ms
</span><span class='line'>^C
</span><span class='line'>--- 192.168.191.141 ping statistics ---
</span><span class='line'>2 packets transmitted, 2 packets received, 0% packet loss
</span><span class='line'>round-trip min/avg/max = 0.138/0.306/0.474 ms
</span><span class='line'>/ # ping 192.168.191.1
</span><span class='line'>PING 192.168.191.1 (192.168.191.1): 56 data bytes
</span><span class='line'>64 bytes from 192.168.191.1: seq=0 ttl=128 time=1.068 ms
</span><span class='line'>64 bytes from 192.168.191.1: seq=1 ttl=128 time=0.603 ms
</span><span class='line'>^C
</span><span class='line'>--- 192.168.191.1 ping statistics ---
</span><span class='line'>2 packets transmitted, 2 packets received, 0% packet loss
</span><span class='line'>round-trip min/avg/max = 0.603/0.835/1.068 ms
</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/06/staf-start-guide/">STAF Start Guide</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-10-06T08:07:49+08:00" pubdate data-updated="true">Fri 2017-10-06 08:07</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>STAF(Software Testing Automation Framework) 是用来构建自动化测试的框架，用来部署测试环境。包括跨平台自动化部署的各种组件：config、process、handle、fs、log、monitor、queue、var、security等各种服务，还可以轻松的扩展。机器通过STAFProc启动的端口来进行通讯（set、query等）。</p>

<blockquote><p>STAF的作用实际上就是提供了机器之间的通信通道并提供基于这个通道的基础服务。</p></blockquote>

<h2>安装</h2>

<ul>
<li><a href="http://staf.sourceforge.net/current/STAFInstall.pdf">http://staf.sourceforge.net/current/STAFInstall.pdf</a></li>
<li><a href="http://blog.csdn.net/lsj6730960/article/details/6186861">STAF的原理及使用</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/opensource/os-test-stafstax/index.html">使用 STAF/STAX 实现测试自动化和持续集成</a></li>
</ul>


<p>直接用 <a href="http://staf.sourceforge.net/getcurrent.php">InstallAnywhere（IA）</a> 的方式安装。文档介绍了整个安装过程中做的所有事情，非常非常的详细。下面针对Linux的安装配置步骤：</p>

<ul>
<li>安装配置项（选项），三种方式选一种：
  交互方式
  文件方式
  默认值</li>
<li>环境变量：使用InstallAnywhere的方式会把环境变量配置好，文档中介绍了使用的环境变量。</li>
<li>启动：shell脚本、开机启动（centos7的服务配置可以参考文档的[Fedora 15 and later]部分）</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#安装（默认值）
</span><span class='line'>./STAF3426-setup-linux-amd64-NoJVM.bin -i silent -DACCEPT_LICENSE=1
</span><span class='line'>
</span><span class='line'>#启动
</span><span class='line'>su -
</span><span class='line'>/usr/local/staf/bin/STAFProc
</span><span class='line'>或者
</span><span class='line'>./startSTAFProc.sh 
</span><span class='line'>
</span><span class='line'>#测试
</span><span class='line'>[root@cdb1 staf]# staf local ping ping
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>PONG
</span><span class='line'>[root@cdb1 staf]# staf local process start command ifconfig
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>5
</span><span class='line'>#程序运行产生的输出是在运行的机器上的！
</span><span class='line'>[root@cdb1 staf]# less nohup.out 
</span><span class='line'>
</span><span class='line'>Machine          : cdb1
</span><span class='line'>Machine nickname : cdb1
</span><span class='line'>Startup time     : 20171006-08:50:55
</span><span class='line'>
</span><span class='line'>STAFProc version 3.4.26 initialized
</span><span class='line'>ens192: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
</span><span class='line'>        inet 192.168.193.101  netmask 255.255.192.0  broadcast 192.168.255.255
</span><span class='line'>        inet6 fe80::932a:7b98:cc20:f791  prefixlen 64  scopeid 0x20&lt;link&gt;
</span><span class='line'>        inet6 fe80::9ba3:ce9e:cc9c:477d  prefixlen 64  scopeid 0x20&lt;link&gt;
</span><span class='line'>        inet6 fe80::7d8c:b318:d441:70b2  prefixlen 64  scopeid 0x20&lt;link&gt;
</span><span class='line'>        ether 00:50:56:92:26:93  txqueuelen 1000  (Ethernet)
</span><span class='line'>        RX packets 11020400  bytes 3439058707 (3.2 GiB)
</span><span class='line'>        RX errors 0  dropped 717  overruns 0  frame 0
</span><span class='line'>        TX packets 9067587  bytes 3110097659 (2.8 GiB)
</span><span class='line'>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span><span class='line'>
</span><span class='line'>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
</span><span class='line'>        inet 127.0.0.1  netmask 255.0.0.0
</span><span class='line'>        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;
</span><span class='line'>        loop  txqueuelen 1  (Local Loopback)
</span><span class='line'>        RX packets 70483  bytes 10164575 (9.6 MiB)
</span><span class='line'>        RX errors 0  dropped 0  overruns 0  frame 0
</span><span class='line'>        TX packets 70483  bytes 10164575 (9.6 MiB)
</span><span class='line'>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>#多机测试
</span><span class='line'>[root@cdb2 staf]# vi bin/STAF.cfg
</span><span class='line'>trust machine 192.168.193.101 level 5
</span><span class='line'>
</span><span class='line'>[root@cdb1 staf]# staf cdb2 ping ping 
</span><span class='line'>[root@cdb1 staf]# staf cdb2 process start command ifconfig 
</span><span class='line'>[root@cdb2 staf]# less nohup.out 
</span><span class='line'>
</span><span class='line'>#安全退出
</span><span class='line'>STAF local SHUTDOWN SHUTDOWN
</span><span class='line'>C:\STAF\bin\STAF.exe local SHUTDOWN SHUTDOWN
</span></code></pre></td></tr></table></div></figure>


<h2>Getting Started</h2>

<p><a href="http://staf.sourceforge.net/current/STAFGS.pdf">http://staf.sourceforge.net/current/STAFGS.pdf</a></p>

<p>STAFGS 对所有的知识点都做了简单的介绍和归纳。更详细的需要看 User Guide 文档。</p>

<p>STAF is an Open Source automation framework designed around the idea of reusable components. It is intended to make it
easier to create automated testcases and workloads. STAF can help you increase the efficiency, productivity, and quality of
your testing by improving your level of automation and reuse in your individual testcases as well as your overall test
environment.</p>

<p>STAF operates in a peer-to-peer environment; in other words, there is no client-server hierarchy among machines
running STAF.</p>

<h4>Basic STAF Concepts</h4>

<p>STAF Instances
Since multiple instances of STAF can be run at the same time on the same system, a STAF Instance name is used to
specify a name for each STAF instance. You specify the instance name to be used by setting the environment variable
STAF_INSTANCE_NAME. The default instance name is &ldquo;STAF&rdquo;.</p>

<p>A basic description of each level follows</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Level 0 - No access
</span><span class='line'>Level 1 - Restricted access. Only PING and helps available.
</span><span class='line'>Level 2 - Limited access. Only query/view facilities available.
</span><span class='line'>Level 3 - Standard access. Non-destructive updates allowed, e.g., logging.
</span><span class='line'>Level 4 - Advanced access. Update abilities, e.g., copying files, deleting log files.
</span><span class='line'>Level 5 - All access, e.g., SHUTDOWN, Process invocation, Trust definition manipulation</span></code></pre></td></tr></table></div></figure>


<p>STAF requests submitted from the command line are generally used to query information from STAF services.</p>

<h4>STAF Commands</h4>

<p>You can also start STAFProc by simply typing STAFProc at a command prompt
window. ( /usr/local/staf/bin is in your PATH )</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>STAF  &lt;Endpoint&gt;/[&lt;Interface&gt;://]&lt;System Identifier&gt;[@&lt;Port&gt;]  &lt;Service&gt; &lt;Request&gt;
</span><span class='line'>
</span><span class='line'>[root@cdb1 staf]# staf local ping ping 
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>PONG
</span><span class='line'>#没运行
</span><span class='line'>[root@cdb1 staf]# staf cdb2 ping ping 
</span><span class='line'>Error submitting request, RC: 16
</span><span class='line'>Additional info
</span><span class='line'>---------------
</span><span class='line'>STAFConnectionProviderConnect: Error performing test read on connected endpoint: recv() RC=111: 22, Endpoint: ssl://cdb2
</span><span class='line'>[root@cdb1 staf]# staf cdb2 ping ping 
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>PONG
</span><span class='line'>
</span><span class='line'>[root@cdb1 staf]# staf local service help 
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>*** SERVICE Service Help ***
</span><span class='line'>
</span><span class='line'>LIST    [ SERVICES | SERVICELOADERS | AUTHENTICATORS |
</span><span class='line'>          REQUESTS &lt;[PENDING] [COMPLETE] [LONG]&gt; | [SUMMARY] ]
</span><span class='line'>QUERY   SERVICE &lt;Service Name&gt; | SERVICELOADER &lt;ServiceLoader Name&gt; |
</span><span class='line'>        AUTHENTICATOR &lt;Authenticator Name&gt; | REQUEST &lt;Request Number&gt;
</span><span class='line'>ADD     SERVICE &lt;Service Name&gt; LIBRARY &lt;Library Name&gt;
</span><span class='line'>        [EXECUTE &lt;Executable&gt;] [OPTION &lt;Name[=Value]&gt;]...
</span><span class='line'>        [PARMS &lt;Parameters&gt;]
</span><span class='line'>REMOVE  SERVICE &lt;Service Name&gt;
</span><span class='line'>FREE    REQUEST &lt;Request Number&gt; [FORCE]
</span><span class='line'>HELP
</span><span class='line'>
</span><span class='line'>[root@cdb1 staf]# staf local shutdown help 
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>*** SHUTDOWN Service Help ***
</span><span class='line'>
</span><span class='line'>SHUTDOWN
</span><span class='line'>
</span><span class='line'>NOTIFY REGISTER   [MACHINE &lt;Machine&gt;] [HANDLE &lt;Handle&gt; | NAME &lt;Name&gt;]
</span><span class='line'>                  [PRIORITY &lt;Priority&gt;]
</span><span class='line'>NOTIFY UNREGISTER [MACHINE &lt;Machine&gt;] [HANDLE &lt;Handle&gt; | NAME &lt;Name&gt;]
</span><span class='line'>                  [PRIORITY &lt;Priority&gt;]
</span><span class='line'>NOTIFY LIST
</span><span class='line'>
</span><span class='line'>HELP
</span><span class='line'>
</span><span class='line'>&gt;&gt;&gt;&gt; The information returned by Help show us the options we can place after "STAF local shutdown ....." 
</span><span class='line'>in command requests
</span><span class='line'>
</span><span class='line'>[root@cdb1 staf]# staf local service list 
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>Name      Library    Executable
</span><span class='line'>--------- ---------- ----------
</span><span class='line'>CONFIG    &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>DELAY     &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>DIAG      &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>ECHO      &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>FS        &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>HANDLE    &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>HELP      &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>LIFECYCLE &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>MISC      &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>PING      &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>PROCESS   &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>QUEUE     &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>SEM       &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>SERVICE   &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>SHUTDOWN  &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>TRACE     &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>TRUST     &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>VAR       &lt;Internal&gt; &lt;None&gt;    
</span><span class='line'>
</span><span class='line'>[root@cdb1 staf]# staf local var list 
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>STAF/Config/BootDrive             : /
</span><span class='line'>STAF/Config/CodePage              : UTF-8
</span><span class='line'>STAF/Config/ConfigFile            : /usr/local/staf/bin/STAF.cfg
</span><span class='line'>STAF/Config/DefaultAuthenticator  : none
</span><span class='line'>STAF/Config/DefaultInterface      : ssl
</span><span class='line'>STAF/Config/InstanceName          : STAF
</span><span class='line'>STAF/Config/Machine               : cdb1
</span><span class='line'>STAF/Config/MachineNickname       : cdb1
</span><span class='line'>STAF/Config/Mem/Physical/Bytes    : 3974971392
</span><span class='line'>STAF/Config/Mem/Physical/KB       : 3881808
</span><span class='line'>STAF/Config/Mem/Physical/MB       : 3790
</span><span class='line'>STAF/Config/OS/MajorVersion       : 3.10.0-693.el7.x86_64
</span><span class='line'>STAF/Config/OS/MinorVersion       : #1 SMP Tue Aug 22 21:09:27 UTC 2017
</span><span class='line'>STAF/Config/OS/Name               : Linux
</span><span class='line'>STAF/Config/OS/Revision           : x86_64
</span><span class='line'>STAF/Config/Processor/NumAvail    : 4
</span><span class='line'>STAF/Config/Sep/Command           : ;
</span><span class='line'>STAF/Config/Sep/File              : /
</span><span class='line'>STAF/Config/Sep/Line              : 
</span><span class='line'>
</span><span class='line'>STAF/Config/Sep/Path              : :
</span><span class='line'>STAF/Config/STAFRoot              : /usr/local/staf
</span><span class='line'>STAF/Config/StartupTime           : 20171006-10:33:42
</span><span class='line'>STAF/DataDir                      : /usr/local/staf/data/STAF
</span><span class='line'>STAF/Env/_                        : /usr/bin/nohup
</span><span class='line'>STAF/Env/CLASSPATH                : /usr/local/staf/lib/JSTAF.jar:/usr/local/staf/samples/demo/STAFDemo.jar:/usr/local/staf/samples/demo/STAFDemo.jar:/usr/local/staf/lib/JSTAF.jar:
</span><span class='line'>STAF/Env/HISTCONTROL              : ignoredups
</span><span class='line'>STAF/Env/HISTSIZE                 : 1000
</span><span class='line'>STAF/Env/HOME                     : /root
</span><span class='line'>STAF/Env/HOSTNAME                 : cdb1
</span><span class='line'>STAF/Env/JAVA_HOME                : /usr/local/jdk
</span><span class='line'>STAF/Env/LANG                     : en_US.UTF-8
</span><span class='line'>STAF/Env/LD_LIBRARY_PATH          : /usr/local/staf/lib:/usr/local/staf/lib:
</span><span class='line'>STAF/Env/LESSOPEN                 : ||/usr/bin/lesspipe.sh %s
</span><span class='line'>STAF/Env/LOGNAME                  : root
</span><span class='line'>STAF/Env/LS_COLORS                : rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=01;05;37;41:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=01;36:*.au=01;36:*.flac=01;36:*.mid=01;36:*.midi=01;36:*.mka=01;36:*.mp3=01;36:*.mpc=01;36:*.ogg=01;36:*.ra=01;36:*.wav=01;36:*.axa=01;36:*.oga=01;36:*.spx=01;36:*.xspf=01;36:
</span><span class='line'>STAF/Env/MAIL                     : /var/spool/mail/root
</span><span class='line'>STAF/Env/PATH                     : /usr/local/staf/bin:/usr/local/staf/bin:/usr/local/jdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
</span><span class='line'>STAF/Env/PWD                      : /usr/local/staf
</span><span class='line'>STAF/Env/SELINUX_LEVEL_REQUESTED  : 
</span><span class='line'>STAF/Env/SELINUX_ROLE_REQUESTED   : 
</span><span class='line'>STAF/Env/SELINUX_USE_CURRENT_RANGE: 
</span><span class='line'>STAF/Env/SHELL                    : /bin/bash
</span><span class='line'>STAF/Env/SHLVL                    : 2
</span><span class='line'>STAF/Env/SSH_AUTH_SOCK            : /tmp/ssh-yEmD907zdB/agent.28259
</span><span class='line'>STAF/Env/SSH_CLIENT               : 192.168.193.10 34774 22
</span><span class='line'>STAF/Env/SSH_CONNECTION           : 192.168.193.10 34774 192.168.193.101 22
</span><span class='line'>STAF/Env/SSH_TTY                  : /dev/pts/2
</span><span class='line'>STAF/Env/STAF_INSTANCE_NAME       : STAF
</span><span class='line'>STAF/Env/STAFCONVDIR              : /usr/local/staf/codepage
</span><span class='line'>STAF/Env/TERM                     : vt100
</span><span class='line'>STAF/Env/USER                     : root
</span><span class='line'>STAF/Env/XDG_DATA_DIRS            : /root/.local/share/flatpak/exports/share/:/var/lib/flatpak/exports/share/:/usr/local/share/:/usr/share/
</span><span class='line'>STAF/Env/XDG_RUNTIME_DIR          : /run/user/0
</span><span class='line'>STAF/Env/XDG_SESSION_ID           : 2080
</span><span class='line'>STAF/Version                      : 3.4.26
</span><span class='line'>
</span><span class='line'>&gt;&gt;&gt;&gt; STAF predefines many useful variables, including information about the machine's Operating System 
</span><span class='line'>and File/Line/Path separators. 
</span><span class='line'>
</span><span class='line'>[root@cdb1 staf]# staf local var resolve system string {STAF/Config/Sep/File}
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>/
</span><span class='line'>
</span><span class='line'>[root@cdb1 staf]# staf local handle list handles
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>Handle Handle Name                     State      Last Used Date-Time
</span><span class='line'>------ ------------------------------- ---------- -------------------
</span><span class='line'>1      STAF_Process                    InProcess  20171006-10:33:42  
</span><span class='line'>2      STAF/Service/STAFServiceLoader1 InProcess  20171006-10:33:42  
</span><span class='line'>11     STAF/Client                     Registered 20171006-10:41:39  
</span><span class='line'>
</span><span class='line'>&gt;&gt;&gt;&gt; handle 1 is assigned to STAFProc. Each of the STAF/Client requests represent each 
</span><span class='line'>of the three "STAF local handle list handles" commands you submitted. Note that each request is assigned a new handle
</span><span class='line'>number, and that the previous handles have been deleted 
</span></code></pre></td></tr></table></div></figure>


<h4>Configuring STAF</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@cdb1 staf]# staf local log log  machine logname log1 level info message test-message
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>
</span><span class='line'>[root@cdb1 staf]# staf local log list machines
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>cdb1
</span><span class='line'>
</span><span class='line'>[root@cdb1 staf]# staf local log query machine cdb1 logname log1 
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>Date-Time         Level Message     
</span><span class='line'>----------------- ----- ------------
</span><span class='line'>20171006-10:54:33 Info  test-message
</span><span class='line'>
</span><span class='line'>#配置
</span><span class='line'>[root@cdb1 staf]# echo "MACHINENICKNAME cdb1.dev" &gt;&gt;bin/STAF.cfg 
</span><span class='line'>[root@cdb1 staf]# staf local shutdown shutdown 
</span><span class='line'>[root@cdb1 staf]# ./startSTAFProc.sh 
</span><span class='line'>
</span><span class='line'>[root@cdb1 staf]# staf local log log  machine logname log3 level info message test-message
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>
</span><span class='line'>[root@cdb1 staf]# staf local log list machines
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>cdb1
</span><span class='line'>cdb1.dev
</span><span class='line'>[root@cdb1 staf]# staf local log query machine cdb1.dev logname log3
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>Date-Time         Level Message     
</span><span class='line'>----------------- ----- ------------
</span><span class='line'>20171006-10:57:59 Info  test-message
</span><span class='line'>
</span><span class='line'>&gt;&gt;&gt;&gt; This primarily effects the data stored by
</span><span class='line'>services such as the Log and Monitor services, which store data based on the machine from which it came by using the
</span><span class='line'>STAF/Config/MachineNickname system variable as part of the directory path when creating logs and monitor data. By
</span><span class='line'>allowing the STAF/Config/MachineNickname system variable to be overridden, it allows you to better manage your
</span><span class='line'>data.
</span><span class='line'>Note that the machine nickname is not used to communicate with other systems and does not have any effect on trust. 
</span><span class='line'>
</span><span class='line'>#配置
</span><span class='line'>echo "SET DATADIR /data" &gt;&gt;bin/STAF.cfg
</span><span class='line'>...
</span><span class='line'>SET SYSTEM VAR Test/TestABC=websphere
</span><span class='line'>SET SYSTEM VAR Test/TestXYZ=150
</span><span class='line'>
</span><span class='line'>restart STAFProc and from a command prompt, try the STAF local var list command
</span><span class='line'>
</span><span class='line'>TRUST LEVEL 2 DEFAULT
</span><span class='line'>TRUST LEVEL 5 MACHINE 192.168.193.*
</span><span class='line'>TRUST LEVEL 4 MACHINE tcp://9.3.41.*
</span><span class='line'>TRUST LEVEL 5 MACHINE tcP://9.41.53.147
</span><span class='line'>
</span><span class='line'>[root@cdb1 staf]# staf local trust list 
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>Type    Entry             Trust Level
</span><span class='line'>------- ----------------- -----------
</span><span class='line'>Default &lt;None&gt;            2          
</span><span class='line'>Machine *://192.168.193.* 5          
</span><span class='line'>Machine local://local     5          
</span><span class='line'>Machine tcp://9.3.41.*    4          
</span><span class='line'>Machine tcP://9.41.53.147 5          
</span></code></pre></td></tr></table></div></figure>


<h4>Using the Help Service</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@cdb1 staf]# staf local help help 
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>*** HELP Service Help ***
</span><span class='line'>
</span><span class='line'>REGISTER   SERVICE &lt;Name&gt; ERROR &lt;Number&gt; INFO &lt;String&gt; DESCRIPTION &lt;String&gt;
</span><span class='line'>
</span><span class='line'>UNREGISTER SERVICE &lt;Name&gt; ERROR &lt;Number&gt;
</span><span class='line'>
</span><span class='line'>[SERVICE &lt;Name&gt;] ERROR &lt;Number&gt;
</span><span class='line'>
</span><span class='line'>LIST SERVICES | [SERVICE &lt;Name&gt;] ERRORS
</span><span class='line'>
</span><span class='line'>HELP
</span><span class='line'>
</span><span class='line'>#错误码详情
</span><span class='line'>[root@cdb1 staf]# staf local error list 
</span><span class='line'>Error submitting request, RC: 2
</span><span class='line'>Additional info
</span><span class='line'>---------------
</span><span class='line'>error
</span><span class='line'>[root@cdb1 staf]# staf local help error 2
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>Description: Unknown service
</span><span class='line'>Details    : You have tried to submit a request to a service that is unknown to STAFProc.  Verify that you have correctly registered the service.
</span></code></pre></td></tr></table></div></figure>


<h4>Registering STAF Services</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http://staf.sourceforge.net/getservices.php 下载EventV315.tar
</span><span class='line'>[root@cdb1 staf]# tar xf EventV315.tar 
</span><span class='line'>
</span><span class='line'>[root@cdb1 staf]# vi bin/STAF.cfg 
</span><span class='line'>...
</span><span class='line'>service Event library JSTAF execute /usr/local/staf/event/STAFEvent.jar
</span><span class='line'>
</span><span class='line'>[root@cdb1 staf]# staf local shutdown shutdown 
</span><span class='line'>[root@cdb1 staf]# ./startSTAFProc.sh 
</span><span class='line'>[root@cdb1 staf]# staf local service list 
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>Name      Library    Executable                         
</span><span class='line'>--------- ---------- -----------------------------------
</span><span class='line'>...
</span><span class='line'>EVENT     JSTAF      /usr/local/staf/event/STAFEvent.jar
</span><span class='line'>...
</span><span class='line'>
</span><span class='line'>#帮助文档： http://staf.sourceforge.net/current/event.htm
</span></code></pre></td></tr></table></div></figure>


<h4>STAF Demo（<strong> 前提得安装上面的EVENT，并且STAFProc也得在图形界面Terminal启动！！ </strong>）</h4>

<ol>
<li>each machine must give the other machine a TRUST level of 5</li>
<li>samples\demo\STAFDemo.jar在CLASSPATH里面.</li>
<li>java STAFDemoController是图形界面程序！！</li>
<li>弹出的窗口【An Arbitrary Process:Handle X】的标题（界面没看到的话，可能是被遮住了）。</li>
</ol>


<p><strong> However, the STAFProcess window should be displayed on your remote machine。</strong></p>

<p>具体的代码解析查阅【8.2. STAF Demo Code - Leveraging STAF】这个章节。</p>

<h2>User&rsquo;s Guide</h2>

<ul>
<li><a href="http://staf.sourceforge.net/current/STAFUG.htm">http://staf.sourceforge.net/current/STAFUG.htm</a></li>
<li><a href="http://staf.sourceforge.net/current/STAFUG.htm#HDRJVMCFG">4.4.2 JSTAF service proxy library</a></li>
</ul>


<h2>STAX Getting Started</h2>

<p><a href="http://staf.sourceforge.net/current/staxgs.pdf">http://staf.sourceforge.net/current/staxgs.pdf</a></p>

<p>Verify that the CLASSPATH environment variable contains the JSTAF.jar file. JSTAF.jar contains the STAF Java APIs
to communicate with STAF from Java programs and is required to register STAF services written in Java.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@cdb1 staf]# tar xf ~/STAXV3517.tar 
</span><span class='line'>[root@cdb1 staf]# vi bin/STAF.cfg 
</span><span class='line'>...
</span><span class='line'>SERVICE STAX LIBRARY JSTAF EXECUTE {STAF/Config/STAFRoot}/stax/STAX.jar OPTION J2=-Xmx2048m
</span><span class='line'>SERVICE EVENT LIBRARY JSTAF EXECUTE {STAF/Config/STAFRoot}/stax/STAFEvent.jar
</span><span class='line'>SET MAXQUEUESIZE 10000
</span></code></pre></td></tr></table></div></figure>


<p>If you do not want to include the JVM bin directory in your PATH, then you can use the
&ldquo;OPTION JVM=xxx&rdquo; to specify which Java executable to use for the services.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@cdb1 staf]# staf local stax version 
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>3.5.17
</span><span class='line'>[root@cdb1 staf]# staf local stax version jython
</span><span class='line'>Response
</span><span class='line'>--------
</span><span class='line'>2.5.2-staf-v1
</span><span class='line'>[root@cdb1 staf]# 
</span></code></pre></td></tr></table></div></figure>


<p>Errors that occur when running the STAX service will be stored in its JVM log. This log is data/STAF/lang/java/jvm/STAFJVM1/JVMLog.1 in
your root STAF directory</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>source /etc/profile
</span><span class='line'>cd stax
</span><span class='line'>java -jar STAXMon.jar
</span><span class='line'>
</span><span class='line'>&gt;&gt;&gt;&gt; You use script elements within your STAX jobs to define Python variables and execute Python code. However, also note that in most cases, all of
</span><span class='line'>the element content and element attributes in your STAX jobs will also be evaluated as Python code. 
</span><span class='line'>
</span><span class='line'>&lt;script&gt;testName = 'CoolTest1'&lt;/script&gt;
</span><span class='line'>&lt;testcase name="testName"&gt;
</span><span class='line'>&lt;testcase name="'%s Part A' % testName"&gt;
</span><span class='line'>&lt;testcase name="'%s Part A on machine %s' % (testName, machineName)"&gt;
</span><span class='line'>
</span><span class='line'>#DoesNothing.xml 
</span><span class='line'>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
</span><span class='line'>&lt;!DOCTYPE stax SYSTEM "stax.dtd"&gt;
</span><span class='line'>
</span><span class='line'>&lt;stax&gt;
</span><span class='line'>
</span><span class='line'>  &lt;defaultcall function="main"/&gt;
</span><span class='line'>
</span><span class='line'>  &lt;function name="main"&gt;
</span><span class='line'>    &lt;nop/&gt;
</span><span class='line'>  &lt;/function&gt;
</span><span class='line'>
</span><span class='line'>&lt;/stax&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>#generate dtd for xml editor
</span><span class='line'>set STAF_QUIET_MODE=1 (or if on Unix: export STAF_QUIET_MODE=1)
</span><span class='line'>STAF local STAX GET DTD &gt; stax.dtd
</span><span class='line'>set STAF_QUIET_MODE= (or if on Unix: unset STAF_QUIET_MODE)
</span><span class='line'>
</span><span class='line'>#RunNotepadProcess.xml
</span><span class='line'>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
</span><span class='line'>&lt;!DOCTYPE stax SYSTEM "stax.dtd"&gt;
</span><span class='line'>
</span><span class='line'>&lt;stax&gt;
</span><span class='line'>
</span><span class='line'>  &lt;defaultcall function="main"/&gt;
</span><span class='line'>
</span><span class='line'>  &lt;function name="main"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;process&gt;
</span><span class='line'>      &lt;location&gt;'local'&lt;/location&gt;
</span><span class='line'>      &lt;command&gt;'notepad'&lt;/command&gt;
</span><span class='line'>    &lt;/process&gt;
</span><span class='line'>
</span><span class='line'>  &lt;/function&gt;
</span><span class='line'>
</span><span class='line'>&lt;/stax&gt;</span></code></pre></td></tr></table></div></figure>


<p>结束任务，打开的程序也会被kill掉！！！</p>

<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/05/respberrypi-connected-via/">连接树莓派</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-10-05T17:04:24+08:00" pubdate data-updated="true">Thu 2017-10-05 17:04</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>启动树莓派后，总得连上去操作才能告诉它做事情。最常用的就是通过SSH远程控制，前提是能连上网络、知道树莓派获取到的地址。下来把了解到的，以及自实践的连接方式做下小结。</p>

<h4>通过路由器</h4>

<p>网线、无线连接后，通过 <strong> 显示器 </strong> 、<strong> 路由管理界面 </strong> 获取树莓派的地址（在管理web界面有明确的respberrypi的字样）。</p>

<h4>通过USB</h4>

<ol>
<li>USB转COM</li>
</ol>


<p>USB连接电脑，连树莓派的GPIO对应的针。然后通过COM口协议与树莓派通信</p>

<ol>
<li>USB共享网络</li>
</ol>


<p>使用手机的USB共享网络。</p>

<p>USB连树莓派，Micro口连手机。手机上打开USB网络共享，树莓派中会建立一个usb0的网卡。这样就能通过这个网卡进行上网了（网上也有说同时打开wifi热点，没啥用啊，usb和wlan是两个不同的网段）。</p>

<p>手机上安装一个ssh的工具（juicessh等），先连上本地的shell，然后执行 <code>cat /proc/net/arp</code> 或者 <code>busybox arp -a</code> 查看与 rndis0 同一个网段的ip（一般就是连接到树莓派的地址了）。</p>

<p>在手机上安装一个IP扫描软件应该也行，但 <strong> 通过ARP是最简单最高效的方式了。</strong></p>

<p><img src="/images/blogs/raspberrypi-phone-usb-network.png" alt="" /></p>

<p>注意：busybox感觉像一个工具集，包含了很多linux的命令，并且有些命令参数比系统提供的更全，如 <code>tar -j</code> 。可以用 <code>busybox --help</code> 查看帮助。</p>

<h4>网线互联</h4>

<p>一跟网线直接连电脑和树莓派。</p>

<p>互传数据应该有用。当前感觉，这种方式没啥优势，有点鸡肋。上网比较麻烦：手动设置IP、域名解析、还要在电脑上面搞网卡绑定。</p>

<p>下面自动获取的方法（没试，应该是可以的吧）：</p>

<blockquote><p>网线直接把树莓派与电脑连接起来，电脑需要连wifi（如果不连接无法使用网络共享让树莓派获取到ip地址），在 设置->网络->wlan->网络与共享中心->wlan->属性->共享->允许​其它用户通过它来连接->确定。</p>

<p>稍等片刻树莓派应该就获取到一个ip地址了，此时打开命令提示符（我用的Xshell），运行arp -a命令，应该就可以看到​一个局域网段，如192.168.xx.1，通常以192.168开头，最后一位是1的那个接口，下面多出来的一条动态记录就是树莓派的。</p></blockquote>

<h2>参考：</h2>

<ul>
<li><a href="https://jingyan.baidu.com/article/676629977483b154d51b848e.html">使用Android手机作为树莓派的屏幕</a></li>
<li><a href="http://www.jianshu.com/p/f2e0a02c01d9">http://www.jianshu.com/p/f2e0a02c01d9</a></li>
<li><a href="http://blog.163.com/elliot_alderson/blog/static/26832905920161122104246919/">http://blog.163.com/elliot_alderson/blog/static/26832905920161122104246919/</a> 添加过ifcfg-usb0，但需要重启网卡才是设置IP地址，麻烦。</li>
<li><a href="http://blog.163.com/elliot_alderson/blog/static/268329059201611925543687/">树莓派安装kali linux （系统安装和初步配置）</a> 安装、gparted扩容</li>
</ul>


<h2>键盘输入、手机显示</h2>

<p>前提：安装screen。</p>

<ul>
<li>连接USB键盘，启动树莓派。</li>
<li>键盘盲打登录（输入：root回车centos回车screen -S pi）。</li>
<li>然后手机上ssh连接，进入pi的会话（screen -x pi）</li>
</ul>


<p>这样就能用键盘敲、手机看了！觉得挺好玩的。</p>

<h2>重新折腾树莓派</h2>

<ul>
<li>安装centos7: 密码root/centos</li>
</ul>


<p><a href="http://www.21ic.com/evm/trick/201605/675705.htm">http://www.21ic.com/evm/trick/201605/675705.htm</a></p>

<ul>
<li>扩大容量：</li>
</ul>


<p><a href="http://blog.csdn.net/qq_20480611/article/details/48657827">http://blog.csdn.net/qq_20480611/article/details/48657827</a></p>

<p>fdisk删掉分区然后重新加，重启后执行resize2fs</p>

<ul>
<li>安装wiringpi</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://git.drogon.net/wiringPi
</span><span class='line'>cd wiringPi
</span><span class='line'>./build
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>epel</li>
</ul>


<p><a href="https://hobo.house/2016/03/03/installing-centos-on-the-raspberry-pi-2/">https://hobo.house/2016/03/03/installing-centos-on-the-raspberry-pi-2/</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat &gt; /etc/yum.repos.d/epel-unsigned.repo &lt;&lt; EOF
</span><span class='line'>[epel]
</span><span class='line'>name=Epel rebuild for armhfp
</span><span class='line'>baseurl=https://armv7.dev.centos.org/repodir/epel-pass-1/
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=0
</span><span class='line'>
</span><span class='line'>EOF
</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/4">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/2">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>佛爷</h1>
  <p>来之不易, 且等且珍惜. <br>得之我幸; 不得<span style="display:none">-争-复争-且不得</span>, 命也, 乐享天命, 福也. </p>
  <p><a href="https://github.com/winse"><i class="fa fa-github-alt">winse</i></a>&nbsp;&nbsp;<a href="http://weibo.com/winseliu"><i class="fa fa-weibo">winseliu</i></a></p>
</section>
<section>
  <h1><a class='category' href='/blog/categories/recommend/'>Recommend</a></h1>
	<ul role="list">
		
			<li class="post">
				<a href="/blog/2018/01/20/gitalk-on-octopress/">Gitalk on Octopress</a>
			</li>
		
			<li class="post">
				<a href="/blog/2017/11/16/sphinx-generate-docs/">使用Sphinx生成/管理文档</a>
			</li>
		
			<li class="post">
				<a href="/blog/2017/08/10/java-bytecode-security/">保护/加密JAVA代码</a>
			</li>
		
			<li class="post">
				<a href="/blog/2017/07/30/kubeadm-install-kubenetes-on-centos7/">Kubeadm部署kubernetes</a>
			</li>
		
			<li class="post">
				<a href="/blog/2017/07/08/casperjs-crawler/">爬虫之CasperJS</a>
			</li>
		
			<li class="post">
				<a href="/blog/2017/05/23/spark-on-hive-speculation-shit-bug/">Hive on Spark预测性执行BUG一枚</a>
			</li>
		
			<li class="post">
				<a href="/blog/2016/04/23/hadoop-guide-catalog/">[整理] Hadoop入门</a>
			</li>
		
			<li class="post">
				<a href="/blog/2016/03/28/hive-on-spark/">Hive on Spark</a>
			</li>
		
			<li class="post">
				<a href="/blog/2016/01/23/install-and-config-ganglia-on-redhat-2/">安装配置Ganglia(2)</a>
			</li>
		
			<li class="post">
				<a href="/blog/2015/08/24/manual-install-supervisor/">Supervisor安装配置</a>
			</li>
		
			<li class="post">
				<a href="/blog/2014/10/16/spark-build-and-configuration/">编译/搭建Spark环境</a>
			</li>
		
			<li class="post">
				<a href="/blog/2014/08/25/step-by-step-found-java-oom-error/">查找逐步定位Java程序OOM的异常实践</a>
			</li>
		
			<li class="post">
				<a href="/blog/2014/07/30/hadoop2-snappy-compress/">Hadoop2 Snappy Compress</a>
			</li>
		
			<li class="post">
				<a href="/blog/2014/07/27/start-redis/">[读读书]Redis入门指南</a>
			</li>
		
			<li class="post">
				<a href="/blog/2014/04/21/hadoop2-windows-startguide/">Windows下部署/配置/调试hadoop2</a>
			</li>
		
			<li class="post">
				<a href="/blog/2014/03/30/git-cheatsheet/">GIT操作记录手册</a>
			</li>
		
			<li class="post">
				<a href="/blog/2014/03/18/jekyll-edit-link-in-web-page/">Jekyll页面添加编辑按钮</a>
			</li>
		
			<li class="post">
				<a href="/blog/2013/09/19/let-shell-command-efficient/">让敲Shell命令高效起来</a>
			</li>
		
	</ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/01/30/map-started-guide/">Map入门指南</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/01/26/proxy-on-java-via-shandowsocks/">Java中使用代理-基于Shandowsocks</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/01/20/logstash-monitor-myself-blog-accesslog/">Logstash采集网站的访问日志</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/01/20/gitalk-on-octopress/">Gitalk on Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/11/20/sed-debug-sedsed/">Sed Debug: Sedsed</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/11/20/gitlab-on-docker/">Gitlab on Docker</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/11/16/sphinx-generate-docs/">使用Sphinx生成/管理文档</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/11/04/teamviewer-vpn-on-windows/">使用TeamviewerVPN访问公司内网</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>

	 
	<ul role="list">
		
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/alluxio/'>alluxio</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/android/'>android</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/bigdata/'>bigdata</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/blabla/'>blabla</a> (6) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/books/'>books</a> (6) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/debug/'>debug</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/docker/'>docker</a> (15) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/elasticsearch/'>elasticsearch</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/es/'>es</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/flume/'>flume</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/ganglia/'>ganglia</a> (5) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/git/'>git</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/hadoop/'>hadoop</a> (44) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/hbase/'>hbase</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/hive/'>hive</a> (8) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/hole/'>hole</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/java/'>java</a> (10) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/jekyll/'>jekyll</a> (8) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/jenkins/'>jenkins</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/k8s/'>k8s</a> (8) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/kafka/'>kafka</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/kubeadm/'>kubeadm</a> (2) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/logstash/'>logstash</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/map/'>map</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/nginx/'>nginx</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/puppet/'>puppet</a> (11) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/recommend/'>recommend</a> (18) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/redis/'>redis</a> (7) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/scala/'>scala</a> (4) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/shell/'>shell</a> (4) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/spark/'>spark</a> (12) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/staf/'>staf</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/tachyon/'>tachyon</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/tez/'>tez</a> (2) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/tools/'>tools</a> (62) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/topics/'>topics</a> (2) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/vagrant/'>vagrant</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/zookeeper/'>zookeeper</a> (1) 
		</li>
		
		
		<li style="clear:both; width: 1px; margin: 0; padding: 0;"></li>
		<li class="category"><a href="/blog/archives">All categories</a> (203)</li>
	</ul>
	
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/winse">@winse</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'winse',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <h1>Softs, I&#8217;m using</h1>
  <ul>
    <li class="post">
		<a href="http://hadoop.apache.org/releases.html">hadoop-2.6.3</a>
	</li>
	<li class="post">
		<a href="https://issues.apache.org/jira/browse/HBASE/?selectedTab=com.atlassian.jira.jira-projects-plugin:changelog-panel">hbase-0.96.0</a>
	</li>
	<li class="post">
		<a href="https://hive.apache.org/downloads.html">hive-1.2.1</a>
	</li>
	<li class="post">
		<a href="https://issues.apache.org/jira/browse/TEZ/?selectedTab=com.atlassian.jira.jira-projects-plugin:summary-panel">tez-0.7.0</a>
    </li>
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - Winse Liu -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253461959'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/z_stat.php%3Fid%3D1253461959%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</p>

</footer>
  


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

<script>

var gitalk = new Gitalk({
  clientID: 'c14f68eac6330d15d984',
  clientSecret: '73b7c1fffa98e299ff0cdd332821201933858e6e',
  repo: 'winse.github.com',
  owner: 'winse',
  admin: ['winse'],
  id: location.pathname,
  labels: ['Gitalk'],
  body: "http://winseliu.com" + location.pathname,
  createIssueManually: true,
  
  // facebook-like distraction free mode
  distractionFreeMode: false
})

gitalk.render('gitalk-container')

</script>



<script>

$.ajax({
  type: "POST",
  url: "http://log.winseliu.com:20000",
  data: JSON.stringify({
    title: document.title,
    location: JSON.stringify(location),
    referrer: document.referrer,
    userAgent: navigator.userAgent
  }),
  contentType: "application/json; charset=utf-8",
  dataType: "json"
});

</script>









</body>
</html>
