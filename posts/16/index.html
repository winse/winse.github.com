
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Winse Blog</title>
  <meta name="author" content="Winse Liu">

  
  <meta name="description" content="代理 关于http代理服务器的搭建，如果有外（国）网机器，直接用squid建就行了 使用Squid3搭建Docker镜像下载代理 。
如果已有shadowsocks的代理，可以用privoxy转成http代理服务器。 网上参考 http://nknu.net/proxy-configuration &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://winse.github.io/posts/16">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="/atom.xml" rel="alternate" title="Winse Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/libs/jquery.toc.min.js" type="text/javascript"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->

<script src="/javascripts/generate-toc.js" type="text/javascript"></script>


  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D3G1YVNBK4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-D3G1YVNBK4');
</script>

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Winse Blog</a></h1>
  
    <h2>走走停停都是风景, 熙熙攘攘都向最好, 忙忙碌碌都为明朝, 何畏之.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:winse.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="站内搜索"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
  <li><a href="/blog/archives/updated.html">Updated</a></li>
  <li><a href="/tool/">Tools</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/02/06/docker-http-proxy-and-save-reload/">Docker代理配置以及导入导出</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-02-06T08:40:09+08:00" pubdate data-updated="true">Mon 2017-02-06 08:40</time>
		
        
		
      </p>
    
  </header>



  <div class="entry-content"><h2>代理</h2>

<p>关于http代理服务器的搭建，如果有外（国）网机器，直接用squid建就行了 <a href="http://dockone.io/article/1380">使用Squid3搭建Docker镜像下载代理</a> 。
如果已有shadowsocks的代理，可以用privoxy转成http代理服务器。</p>

<ul>
<li>网上参考</li>
</ul>


<p><a href="http://nknu.net/proxy-configuration-for-docker-on-centos-7/">http://nknu.net/proxy-configuration-for-docker-on-centos-7/</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Edit /etc/sysconfig/docker and add the following lines:
</span><span class='line'>HTTP_PROXY='http://user:password@proxy-host:proxy-port'
</span><span class='line'>HTTPS_PROXY='http://user:password@proxy-host:proxy-port'
</span><span class='line'>
</span><span class='line'>For those settings to be taken into account, you’ll need to restart your docker daemon:
</span><span class='line'># systemctl restart docker</span></code></pre></td></tr></table></div></figure>


<ul>
<li>官网文档</li>
</ul>


<p><a href="https://docs.docker.com/engine/admin/systemd/#http-proxy">https://docs.docker.com/engine/admin/systemd/#http-proxy</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@k8s docker.service.d]# pwd
</span><span class='line'>/etc/systemd/system/docker.service.d
</span><span class='line'>[root@k8s docker.service.d]# cat http-proxy.conf 
</span><span class='line'>[Service]
</span><span class='line'>Environment="HTTP_PROXY=http://127.0.0.1:8118/" "NO_PROXY=localhost,127.0.0.1"
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>查看配置的环境变量是否生效
</span><span class='line'>$ sudo systemctl daemon-reload
</span><span class='line'>$ sudo service docker start
</span><span class='line'>$ sudo systemctl show --property Environment docker
</span><span class='line'>
</span><span class='line'>配置代理后下载google容器杠杠的
</span><span class='line'>[root@k8s docker-multinode]# docker pull gcr.io/google_containers/etcd-amd64:3.0.4
</span></code></pre></td></tr></table></div></figure>


<p>如果是自己编译的docker，自启动脚本配置可以参考：<a href="https://github.com/docker/docker/blob/master/contrib/init/systemd/docker.socket">https://github.com/docker/docker/blob/master/contrib/init/systemd/docker.socket</a></p>

<h2>导入导出</h2>

<p><a href="https://tuhrig.de/difference-between-save-and-export-in-docker/">https://tuhrig.de/difference-between-save-and-export-in-docker/</a></p>

<p>对于已经通过代理下载的docker，可以通过导入导出到另外的机器。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@k8s ~]# docker save `docker images | grep -v TAG | awk '{print $1":"$2}'` &gt;k8s.tar
</span><span class='line'>
</span><span class='line'>[root@k8s data]# docker load &lt;k8s.tar
</span><span class='line'>0341ae9b0004: Loading layer [==================================================&gt;]  89.1 MB/89.1 MB
</span><span class='line'>Loaded image: gcr.io/google_containers/kubernetes-dashboard-amd64:v1.5.0
</span><span class='line'>011b303988d2: Loading layer [==================================================&gt;]  5.05 MB/5.05 MB
</span><span class='line'>5f70bf18a086: Loading layer [==================================================&gt;] 1.024 kB/1.024 kB
</span><span class='line'>596242791254: Loading layer [==================================================&gt;] 792.1 kB/792.1 kB
</span><span class='line'>4e504f64df23: Loading layer [==================================================&gt;]  5.29 MB/5.29 MB
</span><span class='line'>2897536d1f1f: Loading layer [==================================================&gt;] 3.584 kB/3.584 kB
</span><span class='line'>ae11e34e71e6: Loading layer [==================================================&gt;] 10.75 kB/10.75 kB
</span><span class='line'>81620de5436f: Loading layer [==================================================&gt;]  2.56 kB/2.56 kB
</span><span class='line'>77cb0f2fbaed: Loading layer [==================================================&gt;] 50.33 MB/50.33 MB
</span><span class='line'>Loaded image: gcr.io/google_containers/kube-addon-manager-amd64:v6.1
</span><span class='line'>9007f5987db3: Loading layer [==================================================&gt;]  5.05 MB/5.05 MB
</span><span class='line'>5f70bf18a086: Loading layer [==================================================&gt;] 1.024 kB/1.024 kB
</span><span class='line'>d41159f2130e: Loading layer [==================================================&gt;] 9.201 MB/9.201 MB
</span><span class='line'>Loaded image: gcr.io/google_containers/dnsmasq-metrics-amd64:1.0
</span><span class='line'>2c84284818d1: Loading layer [==================================================&gt;] 1.312 MB/1.312 MB
</span><span class='line'>5f70bf18a086: Loading layer [==================================================&gt;] 1.024 kB/1.024 kB
</span><span class='line'>5e47621858b3: Loading layer [==================================================&gt;] 38.51 MB/38.51 MB
</span><span class='line'>Loaded image: gcr.io/google_containers/etcd-amd64:3.0.4
</span><span class='line'>b6ca02dfe5e6: Loading layer [==================================================&gt;] 128.9 MB/128.9 MB
</span><span class='line'>c2c974a0ae12: Loading layer [==================================================&gt;] 231.6 MB/231.6 MB
</span><span class='line'>88e4c6b7e766: Loading layer [==================================================&gt;] 25.09 kB/25.09 kB
</span><span class='line'>96257390754d: Loading layer [==================================================&gt;] 10.75 kB/10.75 kB
</span><span class='line'>36bd77066b3a: Loading layer [==================================================&gt;]  7.68 kB/7.68 kB
</span><span class='line'>6e833518b289: Loading layer [==================================================&gt;] 28.16 kB/28.16 kB
</span><span class='line'>88d2c1399894: Loading layer [==================================================&gt;] 11.78 kB/11.78 kB
</span><span class='line'>b857f858f4ad: Loading layer [==================================================&gt;] 46.08 kB/46.08 kB
</span><span class='line'>13da16246a77: Loading layer [==================================================&gt;] 56.58 MB/56.58 MB
</span><span class='line'>98a8cc89f2d0: Loading layer [==================================================&gt;] 4.608 kB/4.608 kB
</span><span class='line'>1b7eeaac3364: Loading layer [==================================================&gt;]  5.12 kB/5.12 kB
</span><span class='line'>c85758bfcfdf: Loading layer [==================================================&gt;] 153.9 MB/153.9 MB
</span><span class='line'>Loaded image: gcr.io/google_containers/hyperkube-amd64:v1.5.2
</span><span class='line'>3fc666989c1d: Loading layer [==================================================&gt;] 5.046 MB/5.046 MB
</span><span class='line'>5f70bf18a086: Loading layer [==================================================&gt;] 1.024 kB/1.024 kB
</span><span class='line'>9eed5e14d7fb: Loading layer [==================================================&gt;] 348.7 kB/348.7 kB
</span><span class='line'>00dc4ffe8624: Loading layer [==================================================&gt;]  2.56 kB/2.56 kB
</span><span class='line'>Loaded image: gcr.io/google_containers/kube-dnsmasq-amd64:1.4
</span><span class='line'>8ac8bfaff55a: Loading layer [==================================================&gt;] 1.293 MB/1.293 MB
</span><span class='line'>5f70bf18a086: Loading layer [==================================================&gt;] 1.024 kB/1.024 kB
</span><span class='line'>dc978cfc3e09: Loading layer [==================================================&gt;] 7.279 MB/7.279 MB
</span><span class='line'>99740866972b: Loading layer [==================================================&gt;] 7.168 kB/7.168 kB
</span><span class='line'>Loaded image: gcr.io/google_containers/exechealthz-amd64:1.2
</span><span class='line'>5f70bf18a086: Loading layer [==================================================&gt;] 1.024 kB/1.024 kB
</span><span class='line'>41ff149e94f2: Loading layer [==================================================&gt;] 748.5 kB/748.5 kB
</span><span class='line'>Loaded image: gcr.io/google_containers/pause-amd64:3.0
</span><span class='line'>b79219965469: Loading layer [==================================================&gt;] 45.91 MB/45.91 MB
</span><span class='line'>Loaded image: gcr.io/google_containers/kubedns-amd64:1.9</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/02/04/privoxy-http-proxy-for-shadowsocks/">使用Privoxy把shadowsocks转换为Http代理</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-02-04T15:36:08+08:00" pubdate data-updated="true">Sat 2017-02-04 15:36</time>
		
        
		
      </p>
    
  </header>



  <div class="entry-content"><p><a href="https://program-think.blogspot.com/2014/12/gfw-privoxy.html">https://program-think.blogspot.com/2014/12/gfw-privoxy.html</a></p>

<p>Privoxy是一个代理辅助工具，这里用Privoxy把Shadowsocks socks5代理转换为http代理。</p>

<p>kubernetes的docker容器需要访问google的服务，docker暂时只支持http代理，而我手上有的代理是 <a href="http://99ss.in">shadowsocks</a> 的。这里通过Privoxy把socks5转成http代理。</p>

<p>阿里云的主机优化：<a href="https://promotion.aliyun.com/ntms/act/qwbk.html">https://promotion.aliyun.com/ntms/act/qwbk.html</a></p>

<h2>安装Shadowsocks</h2>

<ul>
<li><a href="http://blog.lxx1.com/1420">http://blog.lxx1.com/1420</a></li>
<li><a href="https://shadowsocks.org/en/download/clients.html">https://shadowsocks.org/en/download/clients.html</a></li>
<li><a href="https://github.com/shadowsocks/shadowsocks/wiki/Shadowsocks-%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E">Shadowsocks 使用说明</a></li>
<li><a href="https://github.com/shadowsocks/shadowsocks/wiki/Configuration-via-Config-File">Configuration via Config File</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@k8s ~]# yum install epel-release python-pip -y
</span><span class='line'>
</span><span class='line'>[root@k8s ~]# pip install shadowsocks
</span><span class='line'>Collecting shadowsocks
</span><span class='line'>  Downloading shadowsocks-2.8.2.tar.gz
</span><span class='line'>Installing collected packages: shadowsocks
</span><span class='line'>  Running setup.py install for shadowsocks ... done
</span><span class='line'>Successfully installed shadowsocks-2.8.2
</span><span class='line'>You are using pip version 8.1.2, however version 9.0.1 is available.
</span><span class='line'>You should consider upgrading via the 'pip install --upgrade pip' command.
</span><span class='line'>
</span><span class='line'>上面软件已经安装好了, 推荐更新下pip.
</span><span class='line'>[root@k8s ~]# pip install --upgrade pip
</span><span class='line'>Collecting pip
</span><span class='line'>  Downloading pip-9.0.1-py2.py3-none-any.whl (1.3MB)
</span><span class='line'>    100% |████████████████████████████████| 1.3MB 46kB/s 
</span><span class='line'>Installing collected packages: pip
</span><span class='line'>  Found existing installation: pip 8.1.2
</span><span class='line'>    Uninstalling pip-8.1.2:
</span><span class='line'>      Successfully uninstalled pip-8.1.2
</span><span class='line'>Successfully installed pip-9.0.1
</span></code></pre></td></tr></table></div></figure>


<p>填写shadowsocks服务端信息以及本地映射端口，启动Shandowsocks的客户端：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@k8s ~]# cat /etc/shadowsocks.json 
</span><span class='line'>{
</span><span class='line'>"server": "xxxxxx",
</span><span class='line'>"server_port": xxx,
</span><span class='line'>"local_port": 1080,
</span><span class='line'>"password": "xxxxxxxx",
</span><span class='line'>"timeout": 600,
</span><span class='line'>"method": "rc4-md5",
</span><span class='line'>"fast_open": false,
</span><span class='line'>"workers": 1
</span><span class='line'>}
</span><span class='line'>[root@k8s ~]# sslocal -c /etc/shadowsocks.json </span></code></pre></td></tr></table></div></figure>


<p>配置防火墙（如果其他主机也需要用这个代理的话）</p>

<p><a href="https://havee.me/linux/2015-01/using-firewalls-on-centos-7.html">https://havee.me/linux/2015-01/using-firewalls-on-centos-7.html</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@bigdata-dev ~]# firewall-cmd --zone=public --add-port=1080/tcp --permanent
</span><span class='line'>[root@bigdata-dev ~]# firewall-cmd --reload</span></code></pre></td></tr></table></div></figure>


<h2>安装privoxy</h2>

<ul>
<li><a href="https://www.privoxy.org/sf-download-mirror/Win32/3.0.26%20%28stable%29/">windows版本下载地址</a></li>
<li><a href="http://www.ttlsa.com/linux/privoxy-convert-socks-proxy-to-http/">http://www.ttlsa.com/linux/privoxy-convert-socks-proxy-to-http/</a></li>
<li><a href="https://blog.phpgao.com/privoxy-shadowsocks.html">https://blog.phpgao.com/privoxy-shadowsocks.html</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@k8s ~]# yum install privoxy -y
</span><span class='line'>
</span><span class='line'>查找listen-address行注释掉，在最后添加如下两行
</span><span class='line'>[root@k8s docker.service.d]# vi /etc/privoxy/config 
</span><span class='line'>...
</span><span class='line'>forward-socks5 / 127.0.0.1:1080 .
</span><span class='line'>listen-address k8s:8118
</span><span class='line'>
</span><span class='line'># 启动
</span><span class='line'>[root@k8s ~]# systemctl start privoxy
</span><span class='line'># 查看状态
</span><span class='line'>[root@k8s ~]# systemctl status privoxy
</span><span class='line'>
</span><span class='line'>[root@k8s ~]# systemctl enable privoxy
</span><span class='line'>Created symlink from /etc/systemd/system/multi-user.target.wants/privoxy.service to /usr/lib/systemd/system/privoxy.service.
</span><span class='line'>
</span><span class='line'>如果其他机器需要用到代理的话，需要配置防火墙开放端口
</span><span class='line'>[root@k8s ~]# firewall-cmd --zone=public --add-port=8118/tcp --permanent
</span><span class='line'>[root@k8s ~]# firewall-cmd --reload </span></code></pre></td></tr></table></div></figure>


<p>通过curl加代理参数：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@k8s ~]# curl google.com
</span><span class='line'>curl: (7) Failed to connect to 2404:6800:4008:802::200e: Network is unreachable
</span><span class='line'>[root@k8s ~]# 
</span><span class='line'>[root@k8s ~]# curl -x localhost:8118 google.com
</span><span class='line'>&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv="content-type" content="text/html;charset=utf-8"&gt;
</span><span class='line'>&lt;TITLE&gt;301 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;
</span><span class='line'>&lt;H1&gt;301 Moved&lt;/H1&gt;
</span><span class='line'>The document has moved
</span><span class='line'>&lt;A HREF="http://www.google.com/"&gt;here&lt;/A&gt;.
</span><span class='line'>&lt;/BODY&gt;&lt;/HTML&gt;</span></code></pre></td></tr></table></div></figure>


<p>或者安装桌面环境，在本机调试会方便点，</p>

<p><a href="http://unix.stackexchange.com/questions/181503/how-to-install-desktop-environments-on-centos-7">http://unix.stackexchange.com/questions/181503/how-to-install-desktop-environments-on-centos-7</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum -y groups install "GNOME Desktop" </span></code></pre></td></tr></table></div></figure>


<p>然后firefox安装autoproxy，配置http代理。（firefox自带的代理有点抽风，不太好用）</p>

<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/01/27/vnc-server-on-centos7/">在Centos7上安装VNC Server</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-01-27T16:43:51+08:00" pubdate data-updated="true">Fri 2017-01-27 16:43</time>
		
        
		
      </p>
    
  </header>



  <div class="entry-content"><h2>安装</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@bigdata-dev ~]# yum install -y tigervnc-server
</span><span class='line'>
</span><span class='line'>首先查看原来的默认配置
</span><span class='line'>[root@bigdata-dev ~]# cat /lib/systemd/system/vncserver@.service 
</span><span class='line'>
</span><span class='line'>[Service]
</span><span class='line'>Type=forking
</span><span class='line'># Clean any existing files in /tmp/.X11-unix environment
</span><span class='line'>ExecStartPre=/bin/sh -c '/usr/bin/vncserver -kill %i &gt; /dev/null 2&gt;&1 || :'
</span><span class='line'>ExecStart=/usr/sbin/runuser -l &lt;USER&gt; -c "/usr/bin/vncserver %i"
</span><span class='line'>PIDFile=/home/&lt;USER&gt;/.vnc/%H%i.pid
</span><span class='line'>ExecStop=/bin/sh -c '/usr/bin/vncserver -kill %i &gt; /dev/null 2&gt;&1 || :'
</span><span class='line'>
</span><span class='line'>复制一份修改，已root用户为例。其他用户类推
</span><span class='line'>[root@bigdata-dev system]# cp vncserver@.service vncserver@:1.service 
</span><span class='line'>[root@bigdata-dev system]# vi vncserver@\:1.service 
</span><span class='line'>
</span><span class='line'>[Service]
</span><span class='line'>Type=forking
</span><span class='line'># Clean any existing files in /tmp/.X11-unix environment
</span><span class='line'>ExecStartPre=/bin/sh -c '/usr/bin/vncserver -kill %i &gt; /dev/null 2&gt;&1 || :'
</span><span class='line'>ExecStart=/usr/sbin/runuser -l root -c "/usr/bin/vncserver %i"
</span><span class='line'>PIDFile=/root/.vnc/%H%i.pid
</span><span class='line'>ExecStop=/bin/sh -c '/usr/bin/vncserver -kill %i &gt; /dev/null 2&gt;&1 || :'
</span><span class='line'>
</span><span class='line'>[root@bigdata-dev system]# systemctl daemon-reload
</span><span class='line'>[root@bigdata-dev system]# systemctl enable vncserver@:1.service
</span><span class='line'>Created symlink from /etc/systemd/system/multi-user.target.wants/vncserver@:1.service to /etc/systemd/system/vncserver@:1.service.
</span><span class='line'>[root@bigdata-dev system]# systemctl start vncserver@:1.service
</span><span class='line'>[root@bigdata-dev system]# systemctl status vncserver@:1.service
</span><span class='line'>● vncserver@:1.service - Remote desktop service (VNC)
</span><span class='line'>   Loaded: loaded (/etc/systemd/system/vncserver@:1.service; enabled; vendor preset: disabled)
</span><span class='line'>   Active: active (running) since Wed 2017-01-25 14:28:04 CST; 27s ago
</span><span class='line'>   
</span><span class='line'>[root@bigdata-dev system]# vncpasswd 
</span><span class='line'>Password:
</span><span class='line'>Verify:
</span><span class='line'>[root@bigdata-dev system]# 
</span><span class='line'>[root@bigdata-dev system]# 
</span><span class='line'>[root@bigdata-dev system]# systemctl restart vncserver@:1.service
</span><span class='line'>http://www.aboutyun.com/thread-17535-1-1.html
</span><span class='line'>[root@bigdata-dev system]# systemctl status firewalld.service
</span><span class='line'>● firewalld.service - firewalld - dynamic firewall daemon
</span><span class='line'>   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)
</span><span class='line'>   Active: inactive (dead)
</span><span class='line'>     Docs: man:firewalld(1)</span></code></pre></td></tr></table></div></figure>


<h2>下载客户端并访问</h2>

<p><a href="https://www.realvnc.com/download/viewer/">https://www.realvnc.com/download/viewer/</a> 访问VNC服务的地址 HOST:5901</p>

<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/01/25/develop-environment-prepare/">Develop Environment Prepare</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-01-25T00:00:00+08:00" pubdate data-updated="true"></time>
		
        
		
      </p>
    
  </header>



  <div class="entry-content"><p>layout: post
title: [整理] 环境准备工具集
date: 2017-01-25 10:57:18 +0800
comments: true</p>

<h2>categories: [efficity]</h2>

<p>工具其实很重要，不仅仅是帮你把东西管理起来，而是工具是一整套的解决方案，是前辈多年总结实践的成果。</p>

<p>初出茅庐的时刻，总觉得工具麻烦，写个java程序还得写个pom，直接把jar放到lib下然后加入classpath就好了。殊不知，后面还有打包，进阶后还要看源码等等问题接踵而来。慢慢把maven用起来，又觉得apache的访问太慢（忍了），项目组内部分功能，开始全部放一个parent下面（也还行）。但后面编译打包太麻烦，尝试在项目组自己建立maven私有仓库。</p>

<p>这里把这几年使用的工具罗列下：</p>

<p>私有仓库：</p>

<ul>
<li>Nexus 如：项目组私有仓库</li>
<li>YUM repo: createrepo <a href="/blog/2016/06/17/ganglia-install-on-centos-with-puppet/">使用Puppet安装配置Ganglia</a> 如：生产环境YUM仓库</li>
<li><a href="/blog/2016/04/04/rpm-build-your-package/">RPM打包</a></li>
<li>Docker register [TODO]</li>
<li><a href="/blog/2016/03/11/install-and-config-openvpn/">OpenVPN</a> 如：访问只能内网访问的服务组（OA、SSH）</li>
</ul>


<p>软件使用：</p>

<ul>
<li><a href="/images/blogs/linux-101-hacks-review-securecrt-config.png">SecureCRT</a> 如：访问只能内网访问的单服务（无依赖）</li>
<li><a href="/blog/2015/11/22/gfw-ladder/">翻墙</a> google值得拥有</li>
<li><a href="/blog/2015/04/12/optimize-system-ramdisk/">内存盘</a></li>
<li><a href="/blog/2012/10/08/eclipse-remote-debugging-java-applications/">远程调试</a> <a href="/blog/2014/04/22/remote-debug-hadoop2/">远程调试hadoop2以及错误处理方法</a></li>
<li><a href="/blog/2014/02/23/quickly-open-program-in-windows/">WIN + R 快速打开程序</a></li>
<li><a href="/blog/2013/09/19/let-shell-command-efficient/">Shell</a></li>
<li><a href="/blog/2014/10/18/docker-dnsmasq-handler-hosts-build-hadoop-cluster/">Dnsmasq</a></li>
<li><a href="/blog/2015/09/06/squid-http-proxy-server-install/">squid</a></li>
</ul>


<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/01/21/jarsperreports-pdf-chinese/">jarsperreports生成PDF中文问题</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-01-21T12:06:31+08:00" pubdate data-updated="true">Sat 2017-01-21 12:06</time>
		
        
		
      </p>
    
  </header>



  <div class="entry-content"><ul>
<li><a href="http://blog.csdn.net/magicboylinw/article/details/8574202">JasperReport Studio生成PDF中文乱码的解决方案</a></li>
</ul>


<p>上个月弄JarsperReport报表，当时就有中文不能显示的问题。由于比较忙一直没有处理(能显示English基本能满足要求)，最近又遇到决定把它倒腾倒腾解决掉。</p>

<p>这里简单罗列下步骤，清楚怎么弄了其实非常简单。</p>

<ol>
<li>添加Jasperreport需要的字体（注意不是系统字体哦）： Window - Preferences - Jaspersoft Studio - Fonts - Add按钮</li>
<li>编辑弹出框Font Family：Family Name简单易记的就行（相当于唯一标识），添加Normal/Bold字体TTF的（微软雅黑是ttc的可以网上找工具转成ttf），PDF Details选择Identity-H、以及Embed this font in PDF document.</li>
<li>在报表jrxml中设置需要显示中文的文字字体为 <strong> 微软雅黑 </strong>（刚刚设置的名称），重新编译生成jasper文件。预览导出PDF已经可以正常显示中文了。</li>
<li><strong>导出字体为jar</strong>：回到Preferences字体配置页面，点击Export按钮把字体导出为jar。</li>
<li>把上面导出的jar放到应用的lib目录下。</li>
</ol>


<p>完成上面的步骤PDF就能展示中文了。</p>

<p>字体比较大，可以直接把jar加启动tomcat的classpath: Debug Configurations - Apache Tomcat - Classpath - User Entries 。</p>

<p>&ndash;END</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/17">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/15">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>佛爷</h1>
  <p>来之不易, 且等且珍惜. <br>得之我幸; 不得<span style="display:none">-争-复争-且不得</span>, 命也, 乐享天命, 福也. </p>
  <p><a href="https://github.com/winse"><i class="fa fa-github-alt">winse</i></a>&nbsp;&nbsp;<a href="http://weibo.com/winseliu"><i class="fa fa-weibo">winseliu</i></a></p>
</section>
<section>



</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2023/11/18/reinstall-redmine-on-respberry2/">Reinstall Redmine on Raspberry2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/04/09/dingtalk-with-openai/">钉钉群机器人对接ChatGPT</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/03/26/clash-on-raspberry4/">树莓派4安装Clash</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/03/25/reinstall-raspberry2/">重新折腾raspberry2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/03/25/mirror-request/">请求复制/镜像</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/03/18/wechat-on-openai/">微信对接OpenAI</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/02/01/git-reset-hard/">记git Reset &#8211;hard</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/02/01/register-openai/">注册OpenAI</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>

<!-- key -->
	 
	<ul role="list">
		
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/hadoop/'>hadoop</a> (68) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/efficity/'>efficity</a> (23) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/java/'>java</a> (16) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/k8s/'>k8s</a> (15) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/docker/'>docker</a> (15) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/spark/'>spark</a> (13) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/puppet/'>puppet</a> (11) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/blog/'>blog</a> (11) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/hive/'>hive</a> (8) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/redis/'>redis</a> (7) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/jekyll/'>jekyll</a> (7) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/raspberry/'>raspberry</a> (6) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/nginx/'>nginx</a> (6) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/books/'>books</a> (6) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/ganglia/'>ganglia</a> (5) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/scala/'>scala</a> (4) 
		</li>
		
		
		<li style="clear:both; width: 1px; margin: 0; padding: 0;"></li>
		<li class="category"><a href="/blog/archives">All categories</a> (236)</li>
	</ul>
	
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/winse">@winse</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'winse',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
<!--
  <h1>Softs, I&#8217;m using</h1>
  <ul>
    <li class="post">
		<a href="http://hadoop.apache.org/releases.html">hadoop-2.6.3</a>
	</li>
	<li class="post">
		<a href="https://issues.apache.org/jira/browse/HBASE/?selectedTab=com.atlassian.jira.jira-projects-plugin:changelog-panel">hbase-0.96.0</a>
	</li>
	<li class="post">
		<a href="https://hive.apache.org/downloads.html">hive-1.2.1</a>
	</li>
	<li class="post">
		<a href="https://issues.apache.org/jira/browse/TEZ/?selectedTab=com.atlassian.jira.jira-projects-plugin:summary-panel">tez-0.7.0</a>
    </li>
  </ul>
&#8211;>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2024 - Winse Liu -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

<script>

var time=location.pathname.substring(6).substring(0,11);
var eName=location.pathname.substring(17);
var gitalk = new Gitalk({
  clientID: 'c14f68eac6330d15d984',
  clientSecret: '73b7c1fffa98e299ff0cdd332821201933858e6e',
  repo: 'winse.github.com',
  owner: 'winse',
  admin: ['winse'],
  id: eName,
  labels: ['Gitalk', time],
  body: "http://winse.github.io" + location.pathname,
  createIssueManually: true,
  
  // facebook-like distraction free mode
  distractionFreeMode: false
})

gitalk.render('gitalk-container')

</script>



<script>
/*
$.ajax({
  type: "POST",
  url: "http://log.winseliu.com:20000",
  data: JSON.stringify({
    title: document.title,
    location: JSON.stringify(location),
    referrer: document.referrer,
    userAgent: navigator.userAgent
  }),
  contentType: "application/json; charset=utf-8",
  dataType: "json"
});
*/
</script>









</body>
</html>
