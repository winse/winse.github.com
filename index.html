
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Winse Blog</title>
  <meta name="author" content="Winse Liu">

  
  <meta name="description" content="年前把树莓派拯救了回来 重新折腾raspberry2 由于年底了新平台慢慢成型，可能会用到BUG跟踪，想着不能浪费，能用则用能省者省的原则，把老古董用起来。 原来在树莓派2上安装过redmine的 在树莓派上部署redmine 不过有些年头了，一开始想着刻舟求剑的方法能参照绝不死脑细胞的原则， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://winse.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="/atom.xml" rel="alternate" title="Winse Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/libs/jquery.toc.min.js" type="text/javascript"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->

<script src="/javascripts/generate-toc.js" type="text/javascript"></script>


  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D3G1YVNBK4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-D3G1YVNBK4');
</script>

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Winse Blog</a></h1>
  
    <h2>走走停停, 熙熙攘攘, 忙忙碌碌, 不知何畏.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:winse.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="站内搜索"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/archives/updated.html">Updated</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2023/11/18/reinstall-redmine-on-respberry2/">Reinstall Redmine on Respberry2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2023-11-18T09:55:24+08:00" pubdate data-updated="true">Sat 2023-11-18 09:55</time>
		
        
		
      </p>
    
  </header>


  <div class="entry-content"><p>年前把树莓派拯救了回来 <a href="https://winse.github.io/blog/2023/03/25/reinstall-raspberry2/">重新折腾raspberry2</a> 由于年底了新平台慢慢成型，可能会用到BUG跟踪，想着不能浪费，能用则用能省者省的原则，把老古董用起来。</p>

<p>原来在树莓派2上安装过redmine的 <a href="https://winse.github.io/blog/2020/05/11/redmine-on-arm-pi/">在树莓派上部署redmine</a> 不过有些年头了，一开始想着刻舟求剑的方法能参照绝不死脑细胞的原则，现实则是四处碰壁。</p>

<p>这个配置确实有点拿不出手了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>top - 14:01:28 up 1 min,  1 user,  load average: 1.87, 0.63, 0.22
</span><span class='line'>Tasks: 130 total,   1 running, 129 sleeping,   0 stopped,   0 zombie
</span><span class='line'>%Cpu0  :  0.0 us,  0.0 sy,  0.0 ni, 99.7 id,  0.0 wa,  0.0 hi,  0.3 si,  0.0 st
</span><span class='line'>%Cpu1  :  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
</span><span class='line'>%Cpu2  :  0.3 us,  0.3 sy,  0.0 ni, 99.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
</span><span class='line'>%Cpu3  :  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
</span><span class='line'>MiB Mem :    922.0 total,    643.8 free,     79.7 used,    198.5 buff/cache
</span><span class='line'>MiB Swap:    100.0 total,    100.0 free,      0.0 used.    788.3 avail Mem 
</span></code></pre></td></tr></table></div></figure>


<h2>参照学习</h2>

<p>原来老版本安装的是 postgres9.6 + redmine3.4 的版本，2020年的时刻这些版本都还当时热乎着的，当时也用上了原来的数据以及插件都还想和原来一样使用。现在再来安装这个版本已经时过境迁了，官方的postgres9.6已经归档了。</p>

<p>1、ubuntu-14官方不支持以后，postgresql官网和各种镜像的网站的都没有该版本的9.6的源码。</p>

<p>2、找一个相对旧一些的操作系统ubuntu-20(focal)支持postgres9.6的，然后试着按原来源码编译的方式打包postgres-9.6 armv7的版本。</p>

<p>安装编译的依赖，编译打包除了慢一点（一个通宵）看起来都通过了（中间过程漫长有冗长没细细的看）。</p>

<p>打包好deb，等安装的时刻，就出现依赖不对找不到了。齐了怪了，编译都“通过”了，安装就不行，perl缺的依赖又找不到对应的版本。又重新弄了两遍！！！这个时间和精神消耗，我这身子骨已经跟它耗不起了。改变方式。</p>

<p>3、docker postgres有镜像也是11之后的，更别说是armv7的9.6了。</p>

<p>4、经过几天的折腾，狠狠心咬咬牙，换最新版本。只能最后再迁移数据，这样估计快一点。</p>

<h2>实践与改进</h2>

<p>确定使用最新的版本后，找到 <a href="https://github.com/sameersbn/docker-redmine/releases/tag/5.1.0">sameersbn/redmine:5.10</a> 然后用的是postgres-15数据库。在上面折腾的过程中，已经找过armv7的postgres数据库了，这次直接基于官方armv7-postgres-15作为基础来构建我这个应用数据库的镜像。</p>

<h3>postgres</h3>

<p>编译 armv7-postgres15 除了在LANG上有一些些错之外，其他都是挺顺利的。修改的内容以及Dockerfile内容如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@raspberrypi:/opt/docker-postgresql-15-20230628# vim runtime/functions 
</span><span class='line'>
</span><span class='line'>300         if [[ -z $(psql -U ${PG_USER} -Atc "SELECT 1 FROM pg_catalog.pg_user WHERE usename = '${DB_USER}'";) ]]; then
</span><span class='line'>301           #psql -U ${PG_USER} -c "CREATE ROLE \"${DB_USER}\" with LOGIN CREATEDB PASSWORD '${DB_PASS}';" &gt;/dev/null
</span><span class='line'>302           psql -U ${PG_USER} -c "CREATE ROLE \"${DB_USER}\" SUPERUSER CREATEDB CREATEROLE LOGIN PASSWORD '${DB_PASS}';" &gt;/dev/null
</span><span class='line'>303         fi
</span><span class='line'>
</span><span class='line'>root@raspberrypi:/opt/docker-postgresql-15-20230628# cat Dockerfile 
</span><span class='line'>FROM arm32v7/postgres:15-bullseye
</span><span class='line'>
</span><span class='line'>LABEL maintainer="sameer@damagehead.com"
</span><span class='line'>
</span><span class='line'>ENV LC_ALL="en_US.UTF-8" \
</span><span class='line'>    LC_CTYPE="en_US.UTF-8"
</span><span class='line'>
</span><span class='line'>ENV PG_APP_HOME="/etc/docker-postgresql" \
</span><span class='line'>    PG_VERSION=15 \
</span><span class='line'>    PG_USER=postgres \
</span><span class='line'>    PG_HOME=/var/lib/postgresql \
</span><span class='line'>    PG_RUNDIR=/run/postgresql \
</span><span class='line'>    PG_LOGDIR=/var/log/postgresql \
</span><span class='line'>    PG_CERTDIR=/etc/postgresql/certs
</span><span class='line'>
</span><span class='line'>ENV PG_BINDIR=/usr/lib/postgresql/${PG_VERSION}/bin \
</span><span class='line'>    PG_DATADIR=${PG_HOME}/${PG_VERSION}/main
</span><span class='line'>
</span><span class='line'>RUN echo "LC_ALL=en_US.UTF-8" &gt;&gt; /etc/environment
</span><span class='line'>RUN echo "en_US.UTF-8 UTF-8" &gt;&gt; /etc/locale.gen
</span><span class='line'>RUN echo "LANG=en_US.UTF-8" &gt; /etc/locale.conf
</span><span class='line'>
</span><span class='line'>RUN sed -i 's@http://deb.debian.org@http://mirrors.aliyun.com@g' /etc/apt/sources.list \
</span><span class='line'> && apt-get update \
</span><span class='line'> && DEBIAN_FRONTEND=noninteractive apt-get install -y acl sudo locales \
</span><span class='line'> && update-locale LANG=C.UTF-8 LC_MESSAGES=POSIX \
</span><span class='line'> && locale-gen en_US.UTF-8 \
</span><span class='line'> && DEBIAN_FRONTEND=noninteractive dpkg-reconfigure locales \
</span><span class='line'> && mkdir -p /etc/postgresql/${PG_VERSION}/main \
</span><span class='line'> && ln -sf ${PG_DATADIR}/postgresql.conf /etc/postgresql/${PG_VERSION}/main/postgresql.conf \
</span><span class='line'> && ln -sf ${PG_DATADIR}/pg_hba.conf /etc/postgresql/${PG_VERSION}/main/pg_hba.conf \
</span><span class='line'> && ln -sf ${PG_DATADIR}/pg_ident.conf /etc/postgresql/${PG_VERSION}/main/pg_ident.conf \
</span><span class='line'> && rm -rf ${PG_HOME} \
</span><span class='line'> && rm -rf /var/lib/apt/lists/*
</span><span class='line'>
</span><span class='line'>COPY runtime/ ${PG_APP_HOME}/
</span><span class='line'>
</span><span class='line'>COPY entrypoint.sh /sbin/entrypoint.sh
</span><span class='line'>
</span><span class='line'>RUN chmod 755 /sbin/entrypoint.sh
</span><span class='line'>
</span><span class='line'>EXPOSE 5432/tcp
</span><span class='line'>
</span><span class='line'>WORKDIR ${PG_HOME}
</span><span class='line'>
</span><span class='line'>ENTRYPOINT ["/sbin/entrypoint.sh"]
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<h3>redmine</h3>

<p>再编译redmine，这个构建镜像的时刻下载依赖太慢了，可能是安装的这些软件对树莓派2要求有点过高了，多次没响应远程断掉导致要重新弄。用了screen也没有效果。</p>

<ol>
<li>开一个screen的窗口，再启动一个容器。</li>
<li>在容器里面手动安装先把依赖搞定后，最后把容器提交作为一个镜像。</li>
<li>在这个镜像的基础上再构建redmine应用的镜像。</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@raspberrypi:~/docker-redmine-5.1.0# docker run -ti arm32v7/ruby:2.7.8-bullseye bash 
</span><span class='line'>
</span><span class='line'>root@e76bef6f1a9c:/# 
</span><span class='line'>wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - 
</span><span class='line'>echo 'deb http://apt.postgresql.org/pub/repos/apt/ bullseye-pgdg main' &gt; /etc/apt/sources.list.d/pgdg.list 
</span><span class='line'>
</span><span class='line'>sed -i 's@http://deb.debian.org@https://mirrors.aliyun.com@g' /etc/apt/sources.list && apt-get update
</span><span class='line'>#sed -i 's@http://deb.debian.org@https://mirrors.ustc.edu.cn@g' /etc/apt/sources.list && apt-get update
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># 去掉mysql和ruby依赖
</span><span class='line'>apt-get install --no-install-recommends -y \
</span><span class='line'>      supervisor logrotate nginx postgresql-client ca-certificates sudo tzdata \
</span><span class='line'>      imagemagick subversion git cvs bzr mercurial darcs rsync locales openssh-client \
</span><span class='line'>      gcc g++ make patch pkg-config gettext-base libc6-dev zlib1g-dev libxml2-dev \
</span><span class='line'>      libpq5 libyaml-0-2 libcurl4 libssl1.1 uuid-dev xz-utils \
</span><span class='line'>      libxslt1.1 libffi7 zlib1g gsfonts vim-tiny ghostscript sqlite3 libsqlite3-dev 
</span><span class='line'>  
</span><span class='line'>update-locale LANG=C.UTF-8 LC_MESSAGES=POSIX
</span><span class='line'>
</span><span class='line'>gem install --no-document bundler
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># 修改redmine的安装脚本
</span><span class='line'># @see https://mirrors.tuna.tsinghua.edu.cn/help/rubygems/
</span><span class='line'>root@raspberrypi:/opt/docker-redmine-5.1.0# vi assets/build/install.sh 
</span><span class='line'>  7 BUILD_DEPENDENCIES="wget libcurl4-openssl-dev libssl-dev libmagickcore-dev libmagickwand-dev \
</span><span class='line'>  8                     libpq-dev libxslt1-dev libffi-dev libyaml-dev \
</span><span class='line'>  9                     libsqlite3-dev"
</span><span class='line'>
</span><span class='line'> 41   exec_as_redmine wget --no-check-certificate "http://www.redmine.org/releases/redmine-${REDMINE_VERSION}.tar.gz" -O /tmp/redmine-${RE    DMINE_VERSION}.tar.gz
</span><span class='line'> 
</span><span class='line'>104 exec_as_redmine gem sources --add https://mirrors.tuna.tsinghua.edu.cn/rubygems/ --remove https://rubygems.org/
</span><span class='line'>105 exec_as_redmine bundle config mirror.https://rubygems.org https://mirrors.tuna.tsinghua.edu.cn/rubygems
</span><span class='line'>106 exec_as_redmine bundle install -j$(nproc)
</span><span class='line'>
</span><span class='line'># 拷贝到容器安装redmine
</span><span class='line'>root@raspberrypi:~/docker-redmine-5.1.0# docker cp assets/build/install.sh  e76bef6f1a9c:/opt/
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>root@e76bef6f1a9c:/# cd /opt/
</span><span class='line'>export RUBY_VERSION=2.7 \
</span><span class='line'>   REDMINE_VERSION=5.1.0 \
</span><span class='line'>   REDMINE_USER="redmine" \
</span><span class='line'>   REDMINE_HOME="/home/redmine" \
</span><span class='line'>   REDMINE_LOG_DIR="/var/log/redmine" \
</span><span class='line'>   REDMINE_ASSETS_DIR="/etc/docker-redmine" \
</span><span class='line'>   RAILS_ENV=production
</span><span class='line'>
</span><span class='line'>export REDMINE_INSTALL_DIR="${REDMINE_HOME}/redmine" \
</span><span class='line'>   REDMINE_DATA_DIR="${REDMINE_HOME}/data" \
</span><span class='line'>   REDMINE_BUILD_ASSETS_DIR="${REDMINE_ASSETS_DIR}/build" \
</span><span class='line'>   REDMINE_RUNTIME_ASSETS_DIR="${REDMINE_ASSETS_DIR}/runtime"
</span><span class='line'>
</span><span class='line'>root@e76bef6f1a9c:/# bash -x install.sh
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># 安装好后，停掉容器提交作为镜像
</span><span class='line'>root@raspberrypi:~/docker-redmine-5.1.0# docker stop e76bef6f1a9c
</span><span class='line'>root@raspberrypi:~/docker-redmine-5.1.0# docker commit e76bef6f1a9c arm32v7/ruby:2.7.8-bullseye-redmine-base
</span><span class='line'>
</span><span class='line'>root@raspberrypi:/opt/docker-redmine-5.1.0# cat Dockerfile 
</span><span class='line'>#FROM arm32v7/ruby:2.7.8-bullseye AS add-apt-repositories
</span><span class='line'>#
</span><span class='line'>#RUN sed -i 's@http://deb.debian.org@https://mirrors.aliyun.com@g' /etc/apt/sources.list \
</span><span class='line'># && apt-get update \
</span><span class='line'># && DEBIAN_FRONTEND=noninteractive apt-get install -y wget gnupg2 \
</span><span class='line'># && apt-key adv --keyserver keyserver.ubuntu.com --recv E1DD270288B4E6030699E45FA1715D88E1DF1F24 \
</span><span class='line'># && apt-key adv --keyserver keyserver.ubuntu.com --recv 80F70E11F0F0D5F10CB20E62F5DA5F09C3173AA6 \
</span><span class='line'># && apt-key adv --keyserver keyserver.ubuntu.com --recv 8B3981E7A6852F782CC4951600A6F0A3C300EE8C \
</span><span class='line'># && wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - \
</span><span class='line'># && echo 'deb http://apt.postgresql.org/pub/repos/apt/ bullseye-pgdg main' &gt; /etc/apt/sources.list.d/pgdg.list 
</span><span class='line'>
</span><span class='line'>FROM arm32v7/ruby:2.7.8-bullseye-redmine-base
</span><span class='line'>
</span><span class='line'>LABEL maintainer="sameer@damagehead.com"
</span><span class='line'>
</span><span class='line'>ENV RUBY_VERSION=2.7 \
</span><span class='line'>    REDMINE_VERSION=5.1.0 \
</span><span class='line'>    REDMINE_USER="redmine" \
</span><span class='line'>    REDMINE_HOME="/home/redmine" \
</span><span class='line'>    REDMINE_LOG_DIR="/var/log/redmine" \
</span><span class='line'>    REDMINE_ASSETS_DIR="/etc/docker-redmine" \
</span><span class='line'>    RAILS_ENV=production
</span><span class='line'>
</span><span class='line'>ENV REDMINE_INSTALL_DIR="${REDMINE_HOME}/redmine" \
</span><span class='line'>    REDMINE_DATA_DIR="${REDMINE_HOME}/data" \
</span><span class='line'>    REDMINE_BUILD_ASSETS_DIR="${REDMINE_ASSETS_DIR}/build" \
</span><span class='line'>    REDMINE_RUNTIME_ASSETS_DIR="${REDMINE_ASSETS_DIR}/runtime"
</span><span class='line'>
</span><span class='line'>#COPY --from=add-apt-repositories /etc/apt/trusted.gpg /etc/apt/trusted.gpg
</span><span class='line'>#
</span><span class='line'>#COPY --from=add-apt-repositories /etc/apt/sources.list /etc/apt/sources.list
</span><span class='line'>#COPY --from=add-apt-repositories /etc/apt/sources.list.d/pgdg.list /etc/apt/sources.list.d/
</span><span class='line'>#
</span><span class='line'>#RUN sed -i 's@http://deb.debian.org@https://mirrors.aliyun.com@g' /etc/apt/sources.list \
</span><span class='line'># && apt-get update \
</span><span class='line'># && DEBIAN_FRONTEND=noninteractive apt-get install --no-install-recommends -y \
</span><span class='line'>#      supervisor logrotate nginx postgresql-client ca-certificates sudo tzdata \
</span><span class='line'>#      imagemagick subversion git cvs rsync locales openssh-client \
</span><span class='line'>#      gcc g++ make patch pkg-config gettext-base libxml2-dev \
</span><span class='line'>#      python3-pil python3-scour libimage-exiftool-perl ffmpegthumbnailer \
</span><span class='line'>#      libpq5 libyaml-0-2 libcurl4 libssl1.1 uuid-dev xz-utils \
</span><span class='line'>#      libxslt1.1 vim-tiny sqlite3 libsqlite3-dev \
</span><span class='line'># && update-locale LANG=C.UTF-8 LC_MESSAGES=POSIX \
</span><span class='line'># && gem install --no-document bundler \
</span><span class='line'># && rm -rf /var/lib/apt/lists/*
</span><span class='line'>
</span><span class='line'>#COPY assets/build/ ${REDMINE_BUILD_ASSETS_DIR}/
</span><span class='line'>#
</span><span class='line'>#RUN bash ${REDMINE_BUILD_ASSETS_DIR}/install.sh
</span><span class='line'>
</span><span class='line'>COPY assets/runtime/ ${REDMINE_RUNTIME_ASSETS_DIR}/
</span><span class='line'>
</span><span class='line'>COPY assets/tools/ /usr/bin/
</span><span class='line'>
</span><span class='line'>COPY entrypoint.sh /sbin/entrypoint.sh
</span><span class='line'>
</span><span class='line'>COPY VERSION /VERSION
</span><span class='line'>
</span><span class='line'>RUN chmod 755 /sbin/entrypoint.sh \
</span><span class='line'> && sed -i '/session    required     pam_loginuid.so/c\#session    required   pam_loginuid.so' /etc/pam.d/cron
</span><span class='line'>
</span><span class='line'>EXPOSE 80/tcp 443/tcp
</span><span class='line'>
</span><span class='line'>WORKDIR ${REDMINE_INSTALL_DIR}
</span><span class='line'>
</span><span class='line'>ENTRYPOINT ["/sbin/entrypoint.sh"]
</span><span class='line'>
</span><span class='line'>CMD ["app:start"]
</span><span class='line'>
</span><span class='line'>root@raspberrypi:/opt/docker-redmine-5.1.0# make build
</span><span class='line'>
</span><span class='line'>root@raspberrypi:/opt/docker-redmine-5.1.0# docker images 
</span><span class='line'>REPOSITORY             TAG                           IMAGE ID       CREATED        SIZE
</span><span class='line'>sameersbn/postgresql   15-20230628                   cedece0ace69   1 hours ago   324MB
</span><span class='line'>sameersbn/redmine      latest                        f1ab03480a1e   1 hours ago   953MB
</span><span class='line'>arm32v7/ruby           2.7.8-bullseye-redmine-base   3ee3b95c4c85   1 hours ago   953MB
</span><span class='line'>arm32v7/postgres       15-bullseye                   c8e0db9da7af   8 days ago     314MB
</span><span class='line'>arm32v7/ruby           2.7.8-bullseye                8100b7e215f8   6 months ago   667MB
</span></code></pre></td></tr></table></div></figure>


<h3>redmine-3.4的数据迁移到redmine-5.1</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@1cd14c92899a:/var/lib/postgresql# docker ps 
</span><span class='line'>CONTAINER ID   IMAGE                        COMMAND                  CREATED        STATUS      PORTS                                 NAMES
</span><span class='line'>458df7209e1b   sameersbn/redmine:3.4.6      "/sbin/entrypoint.sh…"   6 months ago   Up 2 days   443/tcp, 172.21.37.204:8081-&gt;80/tcp   redmine_redmine_1
</span><span class='line'>884a04c9f985   sameersbn/postgresql:9.6-2   "/sbin/entrypoint.sh"    2 years ago    Up 2 days   5432/tcp                              redmine_postgresql_1
</span><span class='line'>
</span><span class='line'>root@1cd14c92899a:/var/lib/postgresql# pg_dump -U postgres -Cc -d redmine_production &gt;redmine.dump 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># 把redmine-5.1的也导出来一份对照，把库里已有的数据保留，在旧sql里面去掉5存在的记录（不然导入报逐渐冲突导入失败的）。
</span><span class='line'>
</span><span class='line'># 配置数据导入，增加旧版本需要的字段。
</span><span class='line'>ALTER TABLE projects
</span><span class='line'>  ADD COLUMN customers_deploys_notifications_emails character varying,
</span><span class='line'>  ADD COLUMN deploys_notifications_emails character varying,
</span><span class='line'>  ADD COLUMN abbreviation character varying
</span><span class='line'>  ;
</span><span class='line'>
</span><span class='line'>ALTER TABLE trackers
</span><span class='line'>  ADD COLUMN is_in_chlog boolean DEFAULT false NOT NULL
</span><span class='line'>  ;
</span><span class='line'>
</span><span class='line'>ALTER TABLE users
</span><span class='line'>  ADD COLUMN identity_url character varying
</span><span class='line'>  ;
</span><span class='line'>
</span><span class='line'>删掉空的表和数据还原部分。把需要的，保留有数据的表。
</span></code></pre></td></tr></table></div></figure>


<p>数据库备份处理不好要重新做的话，要删除对应的文件内容，然后重启即可。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@raspberrypi:~/docker-redmine-5.1.0# docker-compose down 
</span><span class='line'>root@raspberrypi:~/docker-redmine-5.1.0# rm -rf /srv/docker/redmine
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~/docker-redmine-5.1.0# docker-compose up 
</span></code></pre></td></tr></table></div></figure>


<h3>图片附件解压文件</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@raspberrypi:/# tar zxvf srv-docker-redmine.tar.gz /srv/docker/redmine/redmine/files 
</span></code></pre></td></tr></table></div></figure>


<h3>redmine插件</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@raspberrypi:/srv/docker/redmine/redmine/plugins# unzip clipboard_image_paste-1.13.zip 
</span><span class='line'>root@raspberrypi:/srv/docker/redmine/redmine/plugins# mv clipboard_image_paste-1.13 clipboard_image_paste
</span><span class='line'>root@raspberrypi:/srv/docker/redmine/redmine/plugins# rm clipboard_image_paste-1.13.zip 
</span><span class='line'>root@raspberrypi:~/docker-redmine-5.1.0# docker-compose up -d 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>root@raspberrypi:/srv/docker/redmine/redmine/plugins# less clipboard_image_paste/init.rb
</span><span class='line'> 30 # @see https://github.com/paginagmbh/redmine_lightbox2/blob/master/init.rb
</span><span class='line'> 31 if Rails::VERSION::MAJOR &gt;= 5
</span><span class='line'> 32   ActiveSupport::Reloader.to_prepare do
</span><span class='line'> 33     require_dependency 'clipboard_image_paste/hooks'
</span><span class='line'> 34     require_dependency 'clipboard_image_paste/attachment_patch'
</span><span class='line'> 35   end 
</span><span class='line'> 36 elsif Rails::VERSION::MAJOR &gt;= 3
</span><span class='line'>
</span><span class='line'># @see https://github.com/peclik/clipboard_image_paste/pull/91/commits/570acebeb5dded80f24e7b01ffddbec09c9eccb6
</span><span class='line'>root@raspberrypi:/srv/docker/redmine/redmine/plugins# less clipboard_image_paste/lib/clipboard_image_paste/attachment_patch.rb
</span><span class='line'> 25       #alias_method_chain :save_attachments, :pasted_images
</span><span class='line'> 26       alias_method :save_attachmenets_without_pasted_images, :save_attachments
</span><span class='line'> 27       alias_method :save_attachments, :save_attachments_with_pasted_images
</span><span class='line'> 
</span><span class='line'>root@raspberrypi:~/docker-redmine-5.1.0# docker-compose restart redmine 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>lightbox2
</span><span class='line'>https://github.com/theforeman/redmine_lightbox2/commit/9c8b41f6893d4a92bb30923684bad7a1b40fdb62
</span><span class='line'>
</span><span class='line'>apijs
</span><span class='line'>https://www.luigifab.fr/en/redmine/apijs.php
</span><span class='line'>
</span><span class='line'>pi@raspberrypi:/srv/docker/redmine/redmine-logs $ docker logs -n 50 1e966fec7f9b
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<h3>docker-compose</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># @see https://github.com/docker/compose/releases/
</span><span class='line'>
</span><span class='line'>root@raspberrypi:/usr/local/bin# ln -s docker-compose-linux-armv7 docker-compose
</span></code></pre></td></tr></table></div></figure>


<h2>反思与深思</h2>

<p>搞搞简单的文字还行，图片大了要计算的话就卡了！！！还是用4吧！！！</p>

<p>pi4上安装简单多了，直接在机器上编译一下镜像就可以了：</p>

<ol>
<li>postgres的用户修改下权限;</li>
<li>redmine去掉mysql的依赖。</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>#@ pi2
</span><span class='line'>root@1cd14c92899a:/var/lib/postgresql# pg_dump -U redmine -Cc -d redmine_production &gt;redmine.dump        
</span><span class='line'>
</span><span class='line'>#@ pi4
</span><span class='line'>root@d744a148ea59:/var/lib/postgresql# psql -U redmine -d postgres -f redmine.dump 
</span><span class='line'>
</span><span class='line'># srv的话，只需要复制redmine下的files、plugins。
</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2023/04/09/dingtalk-with-openai/">钉钉群机器人对接ChatGPT</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2023-04-09T19:25:42+08:00" pubdate data-updated="true">Sun 2023-04-09 19:25</time>
		
        
		
      </p>
    
  </header>


  <div class="entry-content"><p>前面一段时刻，通过 <a href="https://github.com/zhayujie/bot-on-anything">https://github.com/zhayujie/bot-on-anything</a> 对接过个人微信的群，但是没过多久微信就被警告不能扫码了，前几天更新了钉钉机器人的对接方法，尝试了一下感觉还行马马虎虎。</p>

<p>当然过程是揪心的：钉钉文档在更新升级，bot这边的文档太简单，需要对着代码，然后对着dingtalk官方的文档对照着去排查。</p>

<h2>第一步 首先是创建企业内部机器人，获取Secret</h2>

<p>平时对接的告警机器人是只能发消息的，不能接收消息。</p>

<p>在钉钉APP中创建一个组织，然后在以这个组织登录 <a href="https://open-dev.dingtalk.com/v1/fe/old#/corprobot">https://open-dev.dingtalk.com/v1/fe/old#/corprobot</a> 然后再点击 创建机器人：</p>

<p>其中基础信息中的AppSecret后面会用到，对应dingtalk_secret：</p>

<p><img src="/images/blogs/openai/dingtalk1.png" alt="机器人基础信息" /></p>

<p>然后配置接受消息的地址：就是钉钉服务器收到消息后，把消息转发到你的服务器（公网可访问的）地址。服务器出口IP：就是你部署服务器的公网IP，为了验证信息的合法性的一个参数。</p>

<p><img src="/images/blogs/openai/dingtalk2.png" alt="服务配置" /></p>

<p>创建好机器人后，在版本管理和发布页签中，上线机器人。这样我们在组织的群里面就能选择这个机器人了。</p>

<h2>第二步 把机器人加入组织群，获取Token</h2>

<p>选择 群设置 - 机器人 - 添加机器人，把刚刚创建的机器人加入到我们组织/公司群，然后查看机器人的设置，会提供一个webhook的地址，这一串地址中就包括了一个access_token的字符串参数，就是后面需要用的dingtalk_token。</p>

<p><img src="/images/blogs/openai/dingtalk3.png" alt="机器人管理" /></p>

<p><img src="/images/blogs/openai/dingtalk4.png" alt="机器人设置/配置页面" /></p>

<h2>第三步 配置bot，启动服务</h2>

<p>配置bot-on-anything的config.json，修改 channel - type 的类型为 dingtalk，dingtalk的参数为：机器人应用凭证的AppSecret对应dingtalk_secret；发布机器人，把机器人加入到群后，机器人设置页面的webhook地址上的access_token对应的是dingtalk_token。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>"channel": {
</span><span class='line'>    "type": "dingtalk",
</span><span class='line'>    "single_chat_prefix": ["bot", "@bot"],
</span><span class='line'>    "single_chat_reply_prefix": "[bot] ",
</span><span class='line'>    "group_chat_prefix": ["@bot"],
</span><span class='line'>    "group_name_white_list": ["ChatGPT测试群"],
</span><span class='line'>    "image_create_prefix": ["画", "看", "找一张"],
</span><span class='line'>
</span><span class='line'>    "wechat": {
</span><span class='line'>    },
</span><span class='line'>
</span><span class='line'>    "wechat_mp": {
</span><span class='line'>      "token": "2023...",
</span><span class='line'>      "port": "3000"
</span><span class='line'>    },
</span><span class='line'>
</span><span class='line'>    "dingtalk": {
</span><span class='line'>      "image_create_prefix": ["画", "draw", "Draw"],
</span><span class='line'>      "port": "3000",
</span><span class='line'>      "dingtalk_token": "d55566a9e90...",
</span><span class='line'>      "dingtalk_post_token": "",
</span><span class='line'>      "dingtalk_secret": "PUMsK......"
</span><span class='line'>    },
</span><span class='line'>  </span></code></pre></td></tr></table></div></figure>


<p>启动服务，愉快的耍起来。</p>

<h2>第四步 小小改进</h2>

<ul>
<li>fix images <a href="https://github.com/zhayujie/bot-on-anything/issues/274#issuecomment-1501081485">https://github.com/zhayujie/bot-on-anything/issues/274#issuecomment-1501081485</a></li>
<li>add groups <a href="https://github.com/zhayujie/bot-on-anything/issues/274#issuecomment-1508274056">https://github.com/zhayujie/bot-on-anything/issues/274#issuecomment-1508274056</a></li>
</ul>


<p>在测试图片消息的时刻，发现还不太支持，还有回复消息at提问的人也小小改进了一下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat dingtalk_channel.py 
</span><span class='line'># encoding:utf-8
</span><span class='line'>import json
</span><span class='line'>import hmac
</span><span class='line'>import hashlib
</span><span class='line'>import base64
</span><span class='line'>import time
</span><span class='line'>import requests
</span><span class='line'>from urllib.parse import quote_plus
</span><span class='line'>from common import log
</span><span class='line'>from flask import Flask, request, render_template, make_response
</span><span class='line'>from common import const
</span><span class='line'>from common import functions
</span><span class='line'>from config import channel_conf
</span><span class='line'>from config import channel_conf_val
</span><span class='line'>from channel.channel import Channel
</span><span class='line'>
</span><span class='line'>class DingTalkChannel(Channel):
</span><span class='line'>    def __init__(self):
</span><span class='line'>        self.dingtalk_token = channel_conf(const.DINGTALK).get('dingtalk_token')
</span><span class='line'>        self.dingtalk_post_token = channel_conf(const.DINGTALK).get('dingtalk_post_token')
</span><span class='line'>        self.dingtalk_secret = channel_conf(const.DINGTALK).get('dingtalk_secret')
</span><span class='line'>        log.info("[DingTalk] dingtalk_secret={}, dingtalk_token={} dingtalk_post_token={}".format(self.dingtalk_secret, self.dingtalk_token, self.dingtalk_post_token))
</span><span class='line'>
</span><span class='line'>    def startup(self):
</span><span class='line'>        http_app.run(host='0.0.0.0', port=channel_conf(const.DINGTALK).get('port'))
</span><span class='line'>        
</span><span class='line'>    def notify_dingtalk(self, data):
</span><span class='line'>        timestamp = round(time.time() * 1000)
</span><span class='line'>        secret_enc = bytes(self.dingtalk_secret, encoding='utf-8')
</span><span class='line'>        string_to_sign = '{}\n{}'.format(timestamp, self.dingtalk_secret)
</span><span class='line'>        string_to_sign_enc = bytes(string_to_sign, encoding='utf-8')
</span><span class='line'>        hmac_code = hmac.new(secret_enc, string_to_sign_enc,
</span><span class='line'>                             digestmod=hashlib.sha256).digest()
</span><span class='line'>        sign = quote_plus(base64.b64encode(hmac_code))
</span><span class='line'>
</span><span class='line'>        notify_url = f"https://oapi.dingtalk.com/robot/send?access_token={self.dingtalk_token}&timestamp={timestamp}&sign={sign}"
</span><span class='line'>        try:
</span><span class='line'>            r = requests.post(notify_url, json=data)
</span><span class='line'>            reply = r.json()
</span><span class='line'>            # log.info("[DingTalk] reply={}".format(str(reply)))
</span><span class='line'>        except Exception as e:
</span><span class='line'>            log.error(e)
</span><span class='line'>
</span><span class='line'>    def handle(self, resp):
</span><span class='line'>        reply = "您好，有什么我可以帮助您解答的问题吗？"
</span><span class='line'>        prompt = resp['text']['content']
</span><span class='line'>        prompt = prompt.strip()
</span><span class='line'>        if str(prompt) != 0:
</span><span class='line'>            conversation_id = resp['conversationId']
</span><span class='line'>            sender_id = resp['senderId']
</span><span class='line'>            context = dict()
</span><span class='line'>            img_match_prefix = functions.check_prefix(
</span><span class='line'>                prompt, channel_conf_val(const.DINGTALK, 'image_create_prefix'))
</span><span class='line'>            if img_match_prefix:
</span><span class='line'>                prompt = prompt.split(img_match_prefix, 1)[1].strip()
</span><span class='line'>                context['type'] = 'IMAGE_CREATE'
</span><span class='line'>            id = sender_id
</span><span class='line'>            nick = resp['senderNick']
</span><span class='line'>            staffid = resp['senderStaffId']
</span><span class='line'>            context['from_user_id'] = str(id)
</span><span class='line'>            reply = super().build_reply_content(prompt, context)
</span><span class='line'>        if img_match_prefix and isinstance(reply, list):
</span><span class='line'>            images = ""
</span><span class='line'>            for url in reply:
</span><span class='line'>                images += f"!['IMAGE_CREATE']({url})\n"
</span><span class='line'>            reply = images
</span><span class='line'>            resp = {
</span><span class='line'>                "msgtype": "markdown",
</span><span class='line'>                "markdown": {
</span><span class='line'>                    "title": "IMAGE @" + nick + " ", 
</span><span class='line'>                    "text": images + " \n " + "@" + nick
</span><span class='line'>                },
</span><span class='line'>                "at": {
</span><span class='line'>                    "atUserIds": [
</span><span class='line'>                        staffid
</span><span class='line'>                    ],
</span><span class='line'>                    "isAtAll": False
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        else:
</span><span class='line'>            resp = {
</span><span class='line'>                "msgtype": "text",
</span><span class='line'>                "text": {
</span><span class='line'>                    "content": reply
</span><span class='line'>                },
</span><span class='line'>                "at": {
</span><span class='line'>                    "atUserIds": [
</span><span class='line'>                       staffid 
</span><span class='line'>                    ],
</span><span class='line'>                    "isAtAll": False
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        return resp 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>dd = DingTalkChannel()
</span><span class='line'>http_app = Flask(__name__,)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>@http_app.route("/", methods=['POST'])
</span><span class='line'>def chat():
</span><span class='line'>    log.info("[DingTalk] chat_headers={}".format(str(request.headers)))
</span><span class='line'>    log.info("[DingTalk] chat={}".format(str(request.data)))
</span><span class='line'>    token = request.headers.get('token')
</span><span class='line'>    if dd.dingtalk_post_token and token != dd.dingtalk_post_token:
</span><span class='line'>        return {'ret': 203}
</span><span class='line'>    data = json.loads(request.data)
</span><span class='line'>    if data:
</span><span class='line'>        content = data['text']['content']
</span><span class='line'>        if not content:
</span><span class='line'>            return
</span><span class='line'>        reply = dd.handle(resp=data);
</span><span class='line'>        dd.notify_dingtalk(reply)
</span><span class='line'>        return {'ret': 200}
</span><span class='line'>    return {'ret': 201}
</span></code></pre></td></tr></table></div></figure>


<h2>后续</h2>

<p>增加单聊，多机器人配置</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>"dingtalk": {
</span><span class='line'>  "image_create_prefix": ["画", "draw", "Draw"],
</span><span class='line'>  "port": "3000",
</span><span class='line'>  "dingtalk_token": "方式1",
</span><span class='line'>  "dingtalk_post_token": "",
</span><span class='line'>  "dingtalk_secret": "",
</span><span class='line'>  "dingtalk_robots": ["方式2-key123", "方式2-group123"],
</span><span class='line'>  "方式2-key123": {
</span><span class='line'>      "dingtalk_key": "AppKey",
</span><span class='line'>      "dingtalk_secret": "AppSecret",
</span><span class='line'>      "dingtalk_token": "webhook-access-token",
</span><span class='line'>      "dingtalk_post_token": ""
</span><span class='line'>  },
</span><span class='line'>  "方式2-group123": { 
</span><span class='line'>      "dingtalk_group": "群名",
</span><span class='line'>      "dingtalk_secret": "AppSecret",
</span><span class='line'>      "dingtalk_token": "webhook-access-token",
</span><span class='line'>      "dingtalk_post_token": ""
</span><span class='line'>  }
</span><span class='line'>},
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>源代码</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># encoding:utf-8
</span><span class='line'>import json
</span><span class='line'>import hmac
</span><span class='line'>import hashlib
</span><span class='line'>import base64
</span><span class='line'>import time
</span><span class='line'>import requests
</span><span class='line'>from urllib.parse import quote_plus
</span><span class='line'>from common import log
</span><span class='line'>from flask import Flask, request, render_template, make_response
</span><span class='line'>from common import const
</span><span class='line'>from common import functions
</span><span class='line'>from config import channel_conf
</span><span class='line'>from config import channel_conf_val
</span><span class='line'>from channel.channel import Channel
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>class DingTalkHandler():
</span><span class='line'>    def __init__(self, config):
</span><span class='line'>        self.dingtalk_key = config.get('dingtalk_key')
</span><span class='line'>        self.dingtalk_secret = config.get('dingtalk_secret')
</span><span class='line'>        self.dingtalk_token = config.get('dingtalk_token')
</span><span class='line'>        self.dingtalk_post_token = config.get('dingtalk_post_token')
</span><span class='line'>        self.access_token = None
</span><span class='line'>        log.info("[DingTalk] AppKey={}, AppSecret={} Token={} post Token={}".format(self.dingtalk_key, self.dingtalk_secret, self.dingtalk_token, self.dingtalk_post_token))
</span><span class='line'>
</span><span class='line'>    def notify_dingtalk_webhook(self, data):
</span><span class='line'>        timestamp = round(time.time() * 1000)
</span><span class='line'>        secret_enc = bytes(self.dingtalk_secret, encoding='utf-8')
</span><span class='line'>        string_to_sign = '{}\n{}'.format(timestamp, self.dingtalk_secret)
</span><span class='line'>        string_to_sign_enc = bytes(string_to_sign, encoding='utf-8')
</span><span class='line'>        hmac_code = hmac.new(secret_enc, string_to_sign_enc,
</span><span class='line'>                             digestmod=hashlib.sha256).digest()
</span><span class='line'>        sign = quote_plus(base64.b64encode(hmac_code))
</span><span class='line'>
</span><span class='line'>        notify_url = f"https://oapi.dingtalk.com/robot/send?access_token={self.dingtalk_token}&timestamp={timestamp}&sign={sign}"
</span><span class='line'>        try:
</span><span class='line'>            log.info("[DingTalk] url={}".format(str(notify_url)))
</span><span class='line'>            r = requests.post(notify_url, json=data)
</span><span class='line'>            reply = r.json()
</span><span class='line'>            log.info("[DingTalk] reply={}".format(str(reply)))
</span><span class='line'>        except Exception as e:
</span><span class='line'>            log.error(e)
</span><span class='line'>
</span><span class='line'>    def get_token_internal(self):
</span><span class='line'>        access_token_url = 'https://api.dingtalk.com/v1.0/oauth2/accessToken'
</span><span class='line'>        try:
</span><span class='line'>            r = requests.post(access_token_url, json={"appKey": self.dingtalk_key, "appSecret": self.dingtalk_secret})
</span><span class='line'>        except:
</span><span class='line'>            raise Exception("DingTalk token获取失败!!!")
</span><span class='line'>
</span><span class='line'>        data = json.loads(r.content)
</span><span class='line'>        access_token = data['accessToken']
</span><span class='line'>        expire_in = data['expireIn']
</span><span class='line'>        
</span><span class='line'>        self.access_token = access_token
</span><span class='line'>        self.expire_at = int(expire_in) + time.time()
</span><span class='line'>
</span><span class='line'>        return self.access_token
</span><span class='line'>    
</span><span class='line'>    def get_token(self):
</span><span class='line'>        if self.access_token is None or self.expire_at &lt;= time.time():
</span><span class='line'>            self.get_token_internal()
</span><span class='line'>        
</span><span class='line'>        return self.access_token
</span><span class='line'>    
</span><span class='line'>    def get_post_url(self, data):
</span><span class='line'>        type = data['conversationType']
</span><span class='line'>        if type == "1":
</span><span class='line'>            return f"https://api.dingtalk.com/v1.0/robot/oToMessages/batchSend"
</span><span class='line'>        else:
</span><span class='line'>            return f"https://api.dingtalk.com/v1.0/robot/groupMessages/send"
</span><span class='line'>    
</span><span class='line'>    def build_response(self, reply, data):
</span><span class='line'>        type = data['conversationType']
</span><span class='line'>        if type == "1":
</span><span class='line'>            return self.build_oto_response(reply, data)
</span><span class='line'>        else:
</span><span class='line'>            return self.build_group_response(reply, data)
</span><span class='line'>
</span><span class='line'>    def build_oto_response(self, reply, data):
</span><span class='line'>        conversation_id = data['conversationId']
</span><span class='line'>        prompt = data['text']['content']
</span><span class='line'>        prompt = prompt.strip()
</span><span class='line'>        img_match_prefix = functions.check_prefix(
</span><span class='line'>            prompt, channel_conf_val(const.DINGTALK, 'image_create_prefix'))
</span><span class='line'>        nick = data['senderNick']
</span><span class='line'>        staffid = data['senderStaffId']
</span><span class='line'>        robotCode = data['robotCode']
</span><span class='line'>        if img_match_prefix and isinstance(reply, list):
</span><span class='line'>            images = ""
</span><span class='line'>            for url in reply:
</span><span class='line'>                images += f"!['IMAGE_CREATE']({url})\n"
</span><span class='line'>            reply = images
</span><span class='line'>            resp = {
</span><span class='line'>                "msgKey": "sampleMarkdown",
</span><span class='line'>                "msgParam": json.dumps({
</span><span class='line'>                    "title": "IMAGE @" + nick + " ", 
</span><span class='line'>                    "text": images + " \n " + "@" + nick
</span><span class='line'>                }),
</span><span class='line'>                "robotCode": robotCode,
</span><span class='line'>                "userIds": [staffid]
</span><span class='line'>            }
</span><span class='line'>        else:
</span><span class='line'>            resp = {
</span><span class='line'>                "msgKey": "sampleText",
</span><span class='line'>                "msgParam": json.dumps({
</span><span class='line'>                    "content": reply
</span><span class='line'>                }),
</span><span class='line'>                "robotCode": robotCode,
</span><span class='line'>                "userIds": [staffid]
</span><span class='line'>            }
</span><span class='line'>        return resp
</span><span class='line'>    
</span><span class='line'>    def build_group_response(self, reply, data):
</span><span class='line'>        conversation_id = data['conversationId']
</span><span class='line'>        prompt = data['text']['content']
</span><span class='line'>        prompt = prompt.strip()
</span><span class='line'>        img_match_prefix = functions.check_prefix(
</span><span class='line'>            prompt, channel_conf_val(const.DINGTALK, 'image_create_prefix'))
</span><span class='line'>        nick = data['senderNick']
</span><span class='line'>        staffid = data['senderStaffId']
</span><span class='line'>        robot_code = data['robotCode']
</span><span class='line'>        if img_match_prefix and isinstance(reply, list):
</span><span class='line'>            images = ""
</span><span class='line'>            for url in reply:
</span><span class='line'>                images += f"!['IMAGE_CREATE']({url})\n"
</span><span class='line'>            reply = images
</span><span class='line'>            resp = {
</span><span class='line'>                "msgKey": "sampleMarkdown",
</span><span class='line'>                "msgParam": json.dumps({
</span><span class='line'>                    "title": "IMAGE @" + nick + " ", 
</span><span class='line'>                    "text": images + " \n " + "@" + nick
</span><span class='line'>                }),
</span><span class='line'>                "robotCode": robot_code,
</span><span class='line'>                "openConversationId": conversation_id,
</span><span class='line'>                "at": {
</span><span class='line'>                    "atUserIds": [
</span><span class='line'>                        staffid
</span><span class='line'>                    ],
</span><span class='line'>                    "isAtAll": False
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        else:
</span><span class='line'>            resp = {
</span><span class='line'>                "msgKey": "sampleText",
</span><span class='line'>                "msgParam": json.dumps({
</span><span class='line'>                    "content": reply + " \n " + "@" + nick
</span><span class='line'>                }),
</span><span class='line'>                "robotCode": robot_code,
</span><span class='line'>                "openConversationId": conversation_id,
</span><span class='line'>                "at": {
</span><span class='line'>                    "atUserIds": [
</span><span class='line'>                       staffid 
</span><span class='line'>                    ],
</span><span class='line'>                    "isAtAll": False
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        return resp
</span><span class='line'>    
</span><span class='line'>    
</span><span class='line'>    def build_webhook_response(self, reply, data):
</span><span class='line'>        conversation_id = data['conversationId']
</span><span class='line'>        prompt = data['text']['content']
</span><span class='line'>        prompt = prompt.strip()
</span><span class='line'>        img_match_prefix = functions.check_prefix(
</span><span class='line'>            prompt, channel_conf_val(const.DINGTALK, 'image_create_prefix'))
</span><span class='line'>        nick = data['senderNick']
</span><span class='line'>        staffid = data['senderStaffId']
</span><span class='line'>        robotCode = data['robotCode']
</span><span class='line'>        if img_match_prefix and isinstance(reply, list):
</span><span class='line'>            images = ""
</span><span class='line'>            for url in reply:
</span><span class='line'>                images += f"!['IMAGE_CREATE']({url})\n"
</span><span class='line'>            reply = images
</span><span class='line'>            resp = {
</span><span class='line'>                "msgtype": "markdown",
</span><span class='line'>                "markdown": {
</span><span class='line'>                    "title": "IMAGE @" + nick + " ", 
</span><span class='line'>                    "text": images + " \n " + "@" + nick
</span><span class='line'>                },
</span><span class='line'>                "at": {
</span><span class='line'>                    "atUserIds": [
</span><span class='line'>                        staffid
</span><span class='line'>                    ],
</span><span class='line'>                    "isAtAll": False
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        else:
</span><span class='line'>            resp = {
</span><span class='line'>                "msgtype": "text",
</span><span class='line'>                "text": {
</span><span class='line'>                    "content": reply
</span><span class='line'>                },
</span><span class='line'>                "at": {
</span><span class='line'>                    "atUserIds": [
</span><span class='line'>                       staffid 
</span><span class='line'>                    ],
</span><span class='line'>                    "isAtAll": False
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        return resp
</span><span class='line'>    
</span><span class='line'>    def chat(self, channel, data):
</span><span class='line'>        reply = channel.handle(data)
</span><span class='line'>        type = data['conversationType']
</span><span class='line'>        if type == "1":
</span><span class='line'>            reply_json = self.build_response(reply, data)
</span><span class='line'>            self.notify_dingtalk(data, reply_json)
</span><span class='line'>        else:
</span><span class='line'>            # group的不清楚怎么@，先用webhook调用
</span><span class='line'>            reply_json = self.build_webhook_response(reply, data)
</span><span class='line'>            self.notify_dingtalk_webhook(reply_json)
</span><span class='line'>        
</span><span class='line'>
</span><span class='line'>    def notify_dingtalk(self, data, reply_json):
</span><span class='line'>        headers = {
</span><span class='line'>            'content-type': 'application/json', 
</span><span class='line'>            'x-acs-dingtalk-access-token': self.get_token()
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>        notify_url = self.get_post_url(data)
</span><span class='line'>        try:
</span><span class='line'>            r = requests.post(notify_url, json=reply_json, headers=headers)
</span><span class='line'>            resp = r.json()
</span><span class='line'>            log.info("[DingTalk] response={}".format(str(resp)))
</span><span class='line'>        except Exception as e:
</span><span class='line'>            log.error(e)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>class DingTalkChannel(Channel):
</span><span class='line'>    def __init__(self):
</span><span class='line'>        log.info("[DingTalk] started.")
</span><span class='line'>
</span><span class='line'>    def startup(self):
</span><span class='line'>        http_app.run(host='0.0.0.0', port=channel_conf(const.DINGTALK).get('port'))
</span><span class='line'>
</span><span class='line'>    def handle(self, data):
</span><span class='line'>        reply = "您好，有什么我可以帮助您解答的问题吗？"
</span><span class='line'>        prompt = data['text']['content']
</span><span class='line'>        prompt = prompt.strip()
</span><span class='line'>        if str(prompt) != 0:
</span><span class='line'>            conversation_id = data['conversationId']
</span><span class='line'>            sender_id = data['senderId']
</span><span class='line'>            context = dict()
</span><span class='line'>            img_match_prefix = functions.check_prefix(
</span><span class='line'>                prompt, channel_conf_val(const.DINGTALK, 'image_create_prefix'))
</span><span class='line'>            if img_match_prefix:
</span><span class='line'>                prompt = prompt.split(img_match_prefix, 1)[1].strip()
</span><span class='line'>                context['type'] = 'IMAGE_CREATE'
</span><span class='line'>            id = sender_id
</span><span class='line'>            context['from_user_id'] = str(id)
</span><span class='line'>            reply = super().build_reply_content(prompt, context)
</span><span class='line'>        return reply
</span><span class='line'>         
</span><span class='line'>
</span><span class='line'>dd = DingTalkChannel()
</span><span class='line'>handlers = dict()
</span><span class='line'>robots = channel_conf(const.DINGTALK).get('dingtalk_robots')
</span><span class='line'>if robots and len(robots) &gt; 0:
</span><span class='line'>    for robot in robots:
</span><span class='line'>        robot_config = channel_conf(const.DINGTALK).get(robot)
</span><span class='line'>        robot_key = robot_config.get('dingtalk_key')
</span><span class='line'>        group_name = robot_config.get('dingtalk_group')
</span><span class='line'>        handlers[group_name or robot_key] = DingTalkHandler(robot_config)
</span><span class='line'>else:
</span><span class='line'>    handlers['DEFAULT'] = DingTalkHandler(channel_conf(const.DINGTALK))
</span><span class='line'>http_app = Flask(__name__,)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>@http_app.route("/", methods=['POST'])
</span><span class='line'>def chat():
</span><span class='line'>    log.info("[DingTalk] chat_headers={}".format(str(request.headers)))
</span><span class='line'>    log.info("[DingTalk] chat={}".format(str(request.data)))
</span><span class='line'>    token = request.headers.get('token')
</span><span class='line'>    data = json.loads(request.data)
</span><span class='line'>    if data:
</span><span class='line'>        content = data['text']['content']
</span><span class='line'>        if not content:
</span><span class='line'>            return
</span><span class='line'>        code = data['robotCode']
</span><span class='line'>        group_name = None
</span><span class='line'>        if 'conversationTitle' in data:
</span><span class='line'>            group_name = data['conversationTitle']
</span><span class='line'>        handler = handlers.get(group_name, handlers.get(code, handlers.get('DEFAULT')))
</span><span class='line'>        if handler.dingtalk_post_token and token != handler.dingtalk_post_token:
</span><span class='line'>            return {'ret': 203}
</span><span class='line'>        handler.chat(dd, data)
</span><span class='line'>        return {'ret': 200}
</span><span class='line'>    
</span><span class='line'>    return {'ret': 201}
</span><span class='line'>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2023/03/26/clash-on-raspberry4/">树莓派4安装Clash</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2023-03-26T00:31:01+08:00" pubdate data-updated="true">Sun 2023-03-26 00:31</time>
		
        
		
      </p>
    
  </header>


  <div class="entry-content"><h2>安装Clash</h2>

<p>参考：<a href="https://mraddict.top/posts/clash-on-rpi/">https://mraddict.top/posts/clash-on-rpi/</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@ubuntu:~# arch
</span><span class='line'>
</span><span class='line'># 下载上传clash
</span><span class='line'>root@ubuntu:~# mv clash-linux-arm64 /usr/local/bin/
</span><span class='line'>
</span><span class='line'>root@ubuntu:~# cd /usr/local/bin/
</span><span class='line'>root@ubuntu:/usr/local/bin# chmod +x clash-linux-arm64 
</span><span class='line'>root@ubuntu:/usr/local/bin# ln -s clash-linux-arm64 clash
</span><span class='line'>root@ubuntu:/usr/local/bin# ls clash*
</span><span class='line'>clash  clash-linux-arm64
</span><span class='line'>root@ubuntu:/usr/local/bin# ls -l clash*
</span><span class='line'>lrwxrwxrwx 1 root root      17 Mar 24 21:43 clash -&gt; clash-linux-arm64
</span><span class='line'>-rwxr-xr-x 1 root root 8978432 Jan 29 18:59 clash-linux-arm64
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># 启动一次，会生成配置和下载Country.mmdb文件：
</span><span class='line'>root@ubuntu:/usr/local/bin# clash
</span><span class='line'>INFO[0000] Can't find config, create a initial config file 
</span><span class='line'>INFO[0000] Can't find MMDB, start download              
</span><span class='line'>INFO[0344] Mixed(http+socks) proxy listening at: 127.0.0.1:7890 
</span><span class='line'>
</span><span class='line'># clash-ui
</span><span class='line'>root@ubuntu:/usr/local/bin# cd ~/.config/clash
</span><span class='line'>root@ubuntu:~/.config/clash# git clone --branch gh-pages https://github.com/Dreamacro/clash-dashboard.git    
</span><span class='line'>Cloning into 'clash-dashboard'...
</span><span class='line'>remote: Enumerating objects: 3951, done.
</span><span class='line'>remote: Counting objects: 100% (232/232), done.
</span><span class='line'>remote: Compressing objects: 100% (172/172), done.
</span><span class='line'>remote: Total 3951 (delta 79), reused 189 (delta 56), pack-reused 3719
</span><span class='line'>Receiving objects: 100% (3951/3951), 4.87 MiB | 21.00 KiB/s, done.
</span><span class='line'>Resolving deltas: 100% (2240/2240), done.
</span></code></pre></td></tr></table></div></figure>


<p>配置：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## 配置文件：https://github.com/Dreamacro/clash/wiki/Configuration#introduction
</span><span class='line'>## 下载服务提供的订阅地址内容，保存到文件。
</span><span class='line'>
</span><span class='line'>root@ubuntu:~/.config/clash# ln -s Clash_1679667989.yaml config.yaml
</span><span class='line'>root@ubuntu:~/.config/clash# vi config.yaml 
</span><span class='line'>  11 mode: rule
</span><span class='line'>  12 log-level: debug
</span><span class='line'>  13 external-ui: clash-dashboard
</span><span class='line'>  14 external-controller: '0.0.0.0:9090'
</span><span class='line'>  
</span><span class='line'>
</span><span class='line'>root@ubuntu:~/.config/clash# clash
</span><span class='line'>INFO[0000] Start initial compatible provider 🎬哔哩哔哩      
</span><span class='line'>INFO[0000] Start initial compatible provider ⚓️其他流量     
</span><span class='line'>INFO[0000] Start initial compatible provider ✈️Telegram 
</span><span class='line'>INFO[0000] Start initial compatible provider 🎬Netflix   
</span><span class='line'>INFO[0000] Start initial compatible provider 🍎苹果服务      
</span><span class='line'>INFO[0000] Start initial compatible provider 🎬Youtube   
</span><span class='line'>INFO[0000] Start initial compatible provider 🎬国外媒体      
</span><span class='line'>INFO[0000] Start initial compatible provider 🚀直接连接      
</span><span class='line'>INFO[0000] Start initial compatible provider 🔰国外流量      
</span><span class='line'>INFO[0000] Start initial compatible provider Ⓜ️ 微软服务    
</span><span class='line'>INFO[0000] HTTP proxy listening at: 127.0.0.1:7890      
</span><span class='line'>INFO[0000] RESTful API listening at: [::]:9090          
</span><span class='line'>INFO[0000] SOCKS proxy listening at: 127.0.0.1:7891     
</span><span class='line'>INFO[0000] Redirect proxy listening at: 127.0.0.1:7892 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># 打开 http://192.168.123.41:9090/ui/#/settings 页面后，添加一下服务器的ip地址，就可以访问了。
</span></code></pre></td></tr></table></div></figure>


<h2>安装conda</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
<span class='line-number'>325</span>
<span class='line-number'>326</span>
<span class='line-number'>327</span>
<span class='line-number'>328</span>
<span class='line-number'>329</span>
<span class='line-number'>330</span>
<span class='line-number'>331</span>
<span class='line-number'>332</span>
<span class='line-number'>333</span>
<span class='line-number'>334</span>
<span class='line-number'>335</span>
<span class='line-number'>336</span>
<span class='line-number'>337</span>
<span class='line-number'>338</span>
<span class='line-number'>339</span>
<span class='line-number'>340</span>
<span class='line-number'>341</span>
<span class='line-number'>342</span>
<span class='line-number'>343</span>
<span class='line-number'>344</span>
<span class='line-number'>345</span>
<span class='line-number'>346</span>
<span class='line-number'>347</span>
<span class='line-number'>348</span>
<span class='line-number'>349</span>
<span class='line-number'>350</span>
<span class='line-number'>351</span>
<span class='line-number'>352</span>
<span class='line-number'>353</span>
<span class='line-number'>354</span>
<span class='line-number'>355</span>
<span class='line-number'>356</span>
<span class='line-number'>357</span>
<span class='line-number'>358</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 用代理下载后面的数据
</span><span class='line'>root@ubuntu:~# export http_proxy="http://127.0.0.1:7890"
</span><span class='line'>root@ubuntu:~# export https_proxy="http://127.0.0.1:7890"
</span><span class='line'>
</span><span class='line'>root@ubuntu:~# wget https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-aarch64.sh     
</span><span class='line'>--2023-03-24 23:16:35--  https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-aarch64.sh
</span><span class='line'>Connecting to 127.0.0.1:7890... connected.
</span><span class='line'>Proxy request sent, awaiting response... 302 Found
</span><span class='line'>Location: https://github.com/conda-forge/miniforge/releases/download/22.11.1-4/Miniforge3-Linux-aarch64.sh [following]
</span><span class='line'>--2023-03-24 23:16:35--  https://github.com/conda-forge/miniforge/releases/download/22.11.1-4/Miniforge3-Linux-aarch64.sh
</span><span class='line'>Reusing existing connection to github.com:443.
</span><span class='line'>Proxy request sent, awaiting response... 302 Found
</span><span class='line'>Location: https://objects.githubusercontent.com/github-production-release-asset-2e65be/221584272/97169057-ca90-4fce-873e-a7d6d2e1db90?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20230324%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20230324T151635Z&X-Amz-Expires=300&X-Amz-Signature=c46561816462b1e2bcd82d8b99f8ce840f4ff9b6214fda083828079783d43f0f&X-Amz-SignedHeaders=host&actor_id=0&key_id=0&repo_id=221584272&response-content-disposition=attachment%3B%20filename%3DMiniforge3-Linux-aarch64.sh&response-content-type=application%2Foctet-stream [following]
</span><span class='line'>--2023-03-24 23:16:36--  https://objects.githubusercontent.com/github-production-release-asset-2e65be/221584272/97169057-ca90-4fce-873e-a7d6d2e1db90?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20230324%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20230324T151635Z&X-Amz-Expires=300&X-Amz-Signature=c46561816462b1e2bcd82d8b99f8ce840f4ff9b6214fda083828079783d43f0f&X-Amz-SignedHeaders=host&actor_id=0&key_id=0&repo_id=221584272&response-content-disposition=attachment%3B%20filename%3DMiniforge3-Linux-aarch64.sh&response-content-type=application%2Foctet-stream
</span><span class='line'>Connecting to 127.0.0.1:7890... connected.
</span><span class='line'>Proxy request sent, awaiting response... 200 OK
</span><span class='line'>Length: 53550114 (51M) [application/octet-stream]
</span><span class='line'>Saving to: ‘Miniforge3-Linux-aarch64.sh.1’
</span><span class='line'>
</span><span class='line'>Miniforge3-Linux-aarch64.sh.1                    1%[&gt;                                                                                                  ] 752.00K  9.01KB/s    in 74s     
</span><span class='line'>
</span><span class='line'>2023-03-24 23:17:51 (10.2 KB/s) - Connection closed at byte 770048. Retrying.
</span><span class='line'>
</span><span class='line'>## 默认用的是direct，没有翻墙。在9090/ui页面先把原来的[连接]停掉，然后把[代理]切换到香港的节点
</span><span class='line'>
</span><span class='line'>--2023-03-24 23:17:52--  (try: 2)  https://objects.githubusercontent.com/github-production-release-asset-2e65be/221584272/97169057-ca90-4fce-873e-a7d6d2e1db90?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20230324%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20230324T151635Z&X-Amz-Expires=300&X-Amz-Signature=c46561816462b1e2bcd82d8b99f8ce840f4ff9b6214fda083828079783d43f0f&X-Amz-SignedHeaders=host&actor_id=0&key_id=0&repo_id=221584272&response-content-disposition=attachment%3B%20filename%3DMiniforge3-Linux-aarch64.sh&response-content-type=application%2Foctet-stream
</span><span class='line'>Connecting to 127.0.0.1:7890... connected.
</span><span class='line'>Proxy request sent, awaiting response... 206 Partial Content
</span><span class='line'>Length: 53550114 (51M), 52780066 (50M) remaining [application/octet-stream]
</span><span class='line'>Saving to: ‘Miniforge3-Linux-aarch64.sh.1’
</span><span class='line'>
</span><span class='line'>Miniforge3-Linux-aarch64.sh.1                  100%[+=================================================================================================&gt;]  51.07M  2.79MB/s    in 21s     
</span><span class='line'>
</span><span class='line'>2023-03-24 23:18:14 (2.39 MB/s) - ‘Miniforge3-Linux-aarch64.sh.1’ saved [53550114/53550114]
</span><span class='line'>
</span><span class='line'>root@ubuntu:~# 
</span><span class='line'>
</span><span class='line'>root@ubuntu:~# rm -rf Miniforge3-Linux-aarch64.sh
</span><span class='line'>root@ubuntu:~# mv Miniforge3-Linux-aarch64.sh.1 Miniforge3-Linux-aarch64.sh
</span><span class='line'>root@ubuntu:~# chmod +x Miniforge3-Linux-aarch64.sh
</span><span class='line'>
</span><span class='line'>root@ubuntu:~# rm -rf /usr/local/miniforge3
</span><span class='line'>root@ubuntu:~# ./Miniforge3-Linux-aarch64.sh 
</span><span class='line'>
</span><span class='line'>Welcome to Miniforge3 22.11.1-4
</span><span class='line'>
</span><span class='line'>In order to continue the installation process, please review the license
</span><span class='line'>agreement.
</span><span class='line'>Please, press ENTER to continue
</span><span class='line'>&gt;&gt;&gt;  
</span><span class='line'>Miniforge installer code uses BSD-3-Clause license as stated below.
</span><span class='line'>
</span><span class='line'>Binary packages that come with it have their own licensing terms
</span><span class='line'>and by installing miniforge you agree to the licensing terms of individual
</span><span class='line'>packages as well. They include different OSI-approved licenses including
</span><span class='line'>the GNU General Public License and can be found in pkgs/&lt;pkg-name&gt;/info/licenses
</span><span class='line'>folders.
</span><span class='line'>
</span><span class='line'>Miniforge installer comes with a boostrapping executable that is used
</span><span class='line'>when installing miniforge and is deleted after miniforge is installed.
</span><span class='line'>The bootstrapping executable uses micromamba, cli11, cpp-filesystem,
</span><span class='line'>curl, c-ares, krb5, libarchive, libev, lz4, nghttp2, openssl, libsolv,
</span><span class='line'>nlohmann-json, reproc and zstd which are licensed under BSD-3-Clause,
</span><span class='line'>MIT and OpenSSL licenses. Licenses and copyright notices of these
</span><span class='line'>projects can be found at the following URL.
</span><span class='line'>https://github.com/conda-forge/micromamba-feedstock/tree/master/recipe.
</span><span class='line'>
</span><span class='line'>=============================================================================
</span><span class='line'>
</span><span class='line'>Copyright (c) 2019-2022, conda-forge
</span><span class='line'>All rights reserved.
</span><span class='line'>
</span><span class='line'>Redistribution and use in source and binary forms, with or without
</span><span class='line'>modification, are permitted provided that the following conditions are met:
</span><span class='line'>
</span><span class='line'>1. Redistributions of source code must retain the above copyright notice, this
</span><span class='line'>list of conditions and the following disclaimer.
</span><span class='line'>
</span><span class='line'>2. Redistributions in binary form must reproduce the above copyright notice,
</span><span class='line'>this list of conditions and the following disclaimer in the documentation
</span><span class='line'>and/or other materials provided with the distribution.
</span><span class='line'>
</span><span class='line'>3. Neither the name of the copyright holder nor the names of its contributors
</span><span class='line'>may be used to endorse or promote products derived from this software without
</span><span class='line'>specific prior written permission.
</span><span class='line'>
</span><span class='line'>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
</span><span class='line'>ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
</span><span class='line'>WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
</span><span class='line'>DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
</span><span class='line'>FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
</span><span class='line'>DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
</span><span class='line'>SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
</span><span class='line'>CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
</span><span class='line'>OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
</span><span class='line'>OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Do you accept the license terms? [yes|no]
</span><span class='line'>[no] &gt;&gt;&gt; yes
</span><span class='line'>
</span><span class='line'>Miniforge3 will now be installed into this location:
</span><span class='line'>/root/miniforge3
</span><span class='line'>
</span><span class='line'>  - Press ENTER to confirm the location
</span><span class='line'>  - Press CTRL-C to abort the installation
</span><span class='line'>  - Or specify a different location below
</span><span class='line'>
</span><span class='line'>[/root/miniforge3] &gt;&gt;&gt; /usr/local/miniforge3   
</span><span class='line'>PREFIX=/usr/local/miniforge3
</span><span class='line'>Unpacking payload ...
</span><span class='line'>Extracting ca-certificates-2022.12.7-h4fd8a4c_0.conda
</span><span class='line'>Extracting ld_impl_linux-aarch64-2.40-h2d8c526_0.conda
</span><span class='line'>Extracting libgomp-12.2.0-h607ecd0_19.tar.bz2
</span><span class='line'>Extracting libstdcxx-ng-12.2.0-hc13a102_19.tar.bz2
</span><span class='line'>Extracting python_abi-3.10-3_cp310.conda
</span><span class='line'>Extracting tzdata-2022g-h191b570_0.conda
</span><span class='line'>Extracting _openmp_mutex-4.5-2_gnu.tar.bz2
</span><span class='line'>Extracting libgcc-ng-12.2.0-h607ecd0_19.tar.bz2
</span><span class='line'>Extracting bzip2-1.0.8-hf897c2e_4.tar.bz2
</span><span class='line'>Extracting libffi-3.4.2-h3557bc0_5.tar.bz2
</span><span class='line'>Extracting libnsl-2.0.0-hf897c2e_0.tar.bz2
</span><span class='line'>Extracting libuuid-2.32.1-hf897c2e_1000.tar.bz2
</span><span class='line'>Extracting libzlib-1.2.13-h4e544f5_4.tar.bz2
</span><span class='line'>Extracting ncurses-6.3-headf329_1.tar.bz2
</span><span class='line'>Extracting openssl-3.0.8-hb4cce97_0.conda
</span><span class='line'>Extracting xz-5.2.6-h9cdd2b7_0.tar.bz2
</span><span class='line'>Extracting libsqlite-3.40.0-hf9034f9_0.tar.bz2
</span><span class='line'>Extracting readline-8.1.2-h38e3740_0.tar.bz2
</span><span class='line'>Extracting tk-8.6.12-hd8af866_0.tar.bz2
</span><span class='line'>Extracting zstd-1.5.2-h44f6412_6.conda
</span><span class='line'>Extracting python-3.10.9-ha43d526_0_cpython.conda
</span><span class='line'>Extracting certifi-2022.12.7-pyhd8ed1ab_0.conda
</span><span class='line'>Extracting charset-normalizer-2.1.1-pyhd8ed1ab_0.tar.bz2
</span><span class='line'>Extracting colorama-0.4.6-pyhd8ed1ab_0.tar.bz2
</span><span class='line'>Extracting idna-3.4-pyhd8ed1ab_0.tar.bz2
</span><span class='line'>Extracting pluggy-1.0.0-pyhd8ed1ab_5.tar.bz2
</span><span class='line'>Extracting pycosat-0.6.4-py310h761cc84_1.tar.bz2
</span><span class='line'>Extracting pycparser-2.21-pyhd8ed1ab_0.tar.bz2
</span><span class='line'>Extracting pysocks-1.7.1-pyha2e5f31_6.tar.bz2
</span><span class='line'>Extracting ruamel.yaml.clib-0.2.7-py310hb89b984_1.conda
</span><span class='line'>Extracting setuptools-65.6.3-pyhd8ed1ab_0.conda
</span><span class='line'>Extracting toolz-0.12.0-pyhd8ed1ab_0.tar.bz2
</span><span class='line'>Extracting wheel-0.38.4-pyhd8ed1ab_0.tar.bz2
</span><span class='line'>Extracting cffi-1.15.1-py310hf0c4615_3.conda
</span><span class='line'>Extracting pip-23.0-pyhd8ed1ab_0.conda
</span><span class='line'>Extracting ruamel.yaml-0.17.21-py310h761cc84_2.tar.bz2
</span><span class='line'>Extracting tqdm-4.64.1-pyhd8ed1ab_0.tar.bz2
</span><span class='line'>Extracting brotlipy-0.7.0-py310h761cc84_1005.tar.bz2
</span><span class='line'>Extracting cryptography-39.0.1-py310he4ba0b1_0.conda
</span><span class='line'>Extracting zstandard-0.19.0-py310hde4b81c_1.conda
</span><span class='line'>Extracting conda-package-streaming-0.7.0-pyhd8ed1ab_1.conda
</span><span class='line'>Extracting pyopenssl-23.0.0-pyhd8ed1ab_0.conda
</span><span class='line'>Extracting conda-package-handling-2.0.2-pyh38be061_0.conda
</span><span class='line'>Extracting urllib3-1.26.14-pyhd8ed1ab_0.conda
</span><span class='line'>Extracting requests-2.28.2-pyhd8ed1ab_0.conda
</span><span class='line'>Extracting conda-22.11.1-py310h4c7bcd0_1.conda
</span><span class='line'>
</span><span class='line'>Installing base environment...
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>                                           __
</span><span class='line'>          __  ______ ___  ____ _____ ___  / /_  ____ _
</span><span class='line'>         / / / / __ `__ \/ __ `/ __ `__ \/ __ \/ __ `/
</span><span class='line'>        / /_/ / / / / / / /_/ / / / / / / /_/ / /_/ /
</span><span class='line'>       / .___/_/ /_/ /_/\__,_/_/ /_/ /_/_.___/\__,_/
</span><span class='line'>      /_/
</span><span class='line'>
</span><span class='line'>Transaction
</span><span class='line'>
</span><span class='line'>  Prefix: /usr/local/miniforge3
</span><span class='line'>
</span><span class='line'>  Updating specs:
</span><span class='line'>
</span><span class='line'>   - conda-forge/linux-aarch64::ca-certificates==2022.12.7=h4fd8a4c_0[md5=2450fbcaf65634e0d071e47e2b8487b4]
</span><span class='line'>   - conda-forge/linux-aarch64::ld_impl_linux-aarch64==2.40=h2d8c526_0[md5=16246d69e945d0b1969a6099e7c5d457]
</span><span class='line'>   - conda-forge/linux-aarch64::libgomp==12.2.0=h607ecd0_19[md5=65b9cb876525dcb2e74a90cf02c6762a]
</span><span class='line'>   - conda-forge/linux-aarch64::libstdcxx-ng==12.2.0=hc13a102_19[md5=981741cd4321edd5c504b48f74fe91f2]
</span><span class='line'>   - conda-forge/linux-aarch64::python_abi==3.10=3_cp310[md5=7f4f00b03d3a7c4d4b8b987e5da461a9]
</span><span class='line'>   - conda-forge/noarch::tzdata==2022g=h191b570_0[md5=51fc4fcfb19f5d95ffc8c339db5068e8]
</span><span class='line'>   - conda-forge/linux-aarch64::_openmp_mutex==4.5=2_gnu[md5=6168d71addc746e8f2b8d57dfd2edcea]
</span><span class='line'>   - conda-forge/linux-aarch64::libgcc-ng==12.2.0=h607ecd0_19[md5=8456a29b6d9fc3123ccb9a966b6b2c49]
</span><span class='line'>   - conda-forge/linux-aarch64::bzip2==1.0.8=hf897c2e_4[md5=2d787570a729e273a4e75775ddf3348a]
</span><span class='line'>   - conda-forge/linux-aarch64::libffi==3.4.2=h3557bc0_5[md5=dddd85f4d52121fab0a8b099c5e06501]
</span><span class='line'>   - conda-forge/linux-aarch64::libnsl==2.0.0=hf897c2e_0[md5=36fdbc05c9d9145ece86f5a63c3f352e]
</span><span class='line'>   - conda-forge/linux-aarch64::libuuid==2.32.1=hf897c2e_1000[md5=e038da5ef9095b0d79aac14a311394e7]
</span><span class='line'>   - conda-forge/linux-aarch64::libzlib==1.2.13=h4e544f5_4[md5=88596b6277fe6d39f046983aae6044db]
</span><span class='line'>   - conda-forge/linux-aarch64::ncurses==6.3=headf329_1[md5=486b68148e121bc8bbadc3cefae4c04f]
</span><span class='line'>   - conda-forge/linux-aarch64::openssl==3.0.8=hb4cce97_0[md5=268fe30a14a3f40fe54da04fc053fd2d]
</span><span class='line'>   - conda-forge/linux-aarch64::xz==5.2.6=h9cdd2b7_0[md5=83baad393a31d59c20b63ba4da6592df]
</span><span class='line'>   - conda-forge/linux-aarch64::libsqlite==3.40.0=hf9034f9_0[md5=9afb0d5dbaa403858a660cd0b4a31d29]
</span><span class='line'>   - conda-forge/linux-aarch64::readline==8.1.2=h38e3740_0[md5=3cdbfb7d7b63ae2c2d35bb167d257ecd]
</span><span class='line'>   - conda-forge/linux-aarch64::tk==8.6.12=hd8af866_0[md5=7894e82ff743bd96c76585ddebe28e2a]
</span><span class='line'>   - conda-forge/linux-aarch64::zstd==1.5.2=h44f6412_6[md5=6d0d1cd6d184129eabb96bb220afb5b2]
</span><span class='line'>   - conda-forge/linux-aarch64::python==3.10.9=ha43d526_0_cpython[md5=24478dd738f2d557efe2a4fc6a248eb3]
</span><span class='line'>   - conda-forge/noarch::certifi==2022.12.7=pyhd8ed1ab_0[md5=fb9addc3db06e56abe03e0e9f21a63e6]
</span><span class='line'>   - conda-forge/noarch::charset-normalizer==2.1.1=pyhd8ed1ab_0[md5=c1d5b294fbf9a795dec349a6f4d8be8e]
</span><span class='line'>   - conda-forge/noarch::colorama==0.4.6=pyhd8ed1ab_0[md5=3faab06a954c2a04039983f2c4a50d99]
</span><span class='line'>   - conda-forge/noarch::idna==3.4=pyhd8ed1ab_0[md5=34272b248891bddccc64479f9a7fffed]
</span><span class='line'>   - conda-forge/noarch::pluggy==1.0.0=pyhd8ed1ab_5[md5=7d301a0d25f424d96175f810935f0da9]
</span><span class='line'>   - conda-forge/linux-aarch64::pycosat==0.6.4=py310h761cc84_1[md5=c701cff6d6e7907c93ab603e58082a7c]
</span><span class='line'>   - conda-forge/noarch::pycparser==2.21=pyhd8ed1ab_0[md5=076becd9e05608f8dc72757d5f3a91ff]
</span><span class='line'>   - conda-forge/noarch::pysocks==1.7.1=pyha2e5f31_6[md5=2a7de29fb590ca14b5243c4c812c8025]
</span><span class='line'>   - conda-forge/linux-aarch64::ruamel.yaml.clib==0.2.7=py310hb89b984_1[md5=89972c78c36ed3261c22bde7c012be03]
</span><span class='line'>   - conda-forge/noarch::setuptools==65.6.3=pyhd8ed1ab_0[md5=9600fc9524d3f821e6a6d58c52f5bf5a]
</span><span class='line'>   - conda-forge/noarch::toolz==0.12.0=pyhd8ed1ab_0[md5=92facfec94bc02d6ccf42e7173831a36]
</span><span class='line'>   - conda-forge/noarch::wheel==0.38.4=pyhd8ed1ab_0[md5=c829cfb8cb826acb9de0ac1a2df0a940]
</span><span class='line'>   - conda-forge/linux-aarch64::cffi==1.15.1=py310hf0c4615_3[md5=a2bedcb1d205485ea32fe5d2bd6fd970]
</span><span class='line'>   - conda-forge/noarch::pip==23.0=pyhd8ed1ab_0[md5=85b35999162ec95f9f999bac15279c02]
</span><span class='line'>   - conda-forge/linux-aarch64::ruamel.yaml==0.17.21=py310h761cc84_2[md5=98c0b13f20fcb4f5080554d137e39b37]
</span><span class='line'>   - conda-forge/noarch::tqdm==4.64.1=pyhd8ed1ab_0[md5=5526ff3f88f9db87bb0924b9ce575345]
</span><span class='line'>   - conda-forge/linux-aarch64::brotlipy==0.7.0=py310h761cc84_1005[md5=66934993368d01f896652925d3ac7e66]
</span><span class='line'>   - conda-forge/linux-aarch64::cryptography==39.0.1=py310he4ba0b1_0[md5=3129345d217e5fd6488df794e49e327b]
</span><span class='line'>   - conda-forge/linux-aarch64::zstandard==0.19.0=py310hde4b81c_1[md5=d4b3cc980179c38949c83fe23057d97c]
</span><span class='line'>   - conda-forge/noarch::conda-package-streaming==0.7.0=pyhd8ed1ab_1[md5=1a2fa9e53cfbc2e4d9ab21990805a436]
</span><span class='line'>   - conda-forge/noarch::pyopenssl==23.0.0=pyhd8ed1ab_0[md5=d41957700e83bbb925928764cb7f8878]
</span><span class='line'>   - conda-forge/noarch::conda-package-handling==2.0.2=pyh38be061_0[md5=44800e9bd13143292097c65e57323038]
</span><span class='line'>   - conda-forge/noarch::urllib3==1.26.14=pyhd8ed1ab_0[md5=01f33ad2e0aaf6b5ba4add50dad5ad29]
</span><span class='line'>   - conda-forge/noarch::requests==2.28.2=pyhd8ed1ab_0[md5=11d178fc55199482ee48d6812ea83983]
</span><span class='line'>   - conda-forge/linux-aarch64::conda==22.11.1=py310h4c7bcd0_1[md5=a71c4cc6bd77f61c0c1601b28291c460]
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  Package                      Version  Build               Channel           Size
</span><span class='line'>────────────────────────────────────────────────────────────────────────────────────
</span><span class='line'>  Install:
</span><span class='line'>────────────────────────────────────────────────────────────────────────────────────
</span><span class='line'>
</span><span class='line'>  + _openmp_mutex                  4.5  2_gnu               conda-forge     Cached
</span><span class='line'>  + brotlipy                     0.7.0  py310h761cc84_1005  conda-forge     Cached
</span><span class='line'>  + bzip2                        1.0.8  hf897c2e_4          conda-forge     Cached
</span><span class='line'>  + ca-certificates          2022.12.7  h4fd8a4c_0          conda-forge     Cached
</span><span class='line'>  + certifi                  2022.12.7  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + cffi                        1.15.1  py310hf0c4615_3     conda-forge     Cached
</span><span class='line'>  + charset-normalizer           2.1.1  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + colorama                     0.4.6  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + conda                      22.11.1  py310h4c7bcd0_1     conda-forge     Cached
</span><span class='line'>  + conda-package-handling       2.0.2  pyh38be061_0        conda-forge     Cached
</span><span class='line'>  + conda-package-streaming      0.7.0  pyhd8ed1ab_1        conda-forge     Cached
</span><span class='line'>  + cryptography                39.0.1  py310he4ba0b1_0     conda-forge     Cached
</span><span class='line'>  + idna                           3.4  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + ld_impl_linux-aarch64         2.40  h2d8c526_0          conda-forge     Cached
</span><span class='line'>  + libffi                       3.4.2  h3557bc0_5          conda-forge     Cached
</span><span class='line'>  + libgcc-ng                   12.2.0  h607ecd0_19         conda-forge     Cached
</span><span class='line'>  + libgomp                     12.2.0  h607ecd0_19         conda-forge     Cached
</span><span class='line'>  + libnsl                       2.0.0  hf897c2e_0          conda-forge     Cached
</span><span class='line'>  + libsqlite                   3.40.0  hf9034f9_0          conda-forge     Cached
</span><span class='line'>  + libstdcxx-ng                12.2.0  hc13a102_19         conda-forge     Cached
</span><span class='line'>  + libuuid                     2.32.1  hf897c2e_1000       conda-forge     Cached
</span><span class='line'>  + libzlib                     1.2.13  h4e544f5_4          conda-forge     Cached
</span><span class='line'>  + ncurses                        6.3  headf329_1          conda-forge     Cached
</span><span class='line'>  + openssl                      3.0.8  hb4cce97_0          conda-forge     Cached
</span><span class='line'>  + pip                           23.0  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + pluggy                       1.0.0  pyhd8ed1ab_5        conda-forge     Cached
</span><span class='line'>  + pycosat                      0.6.4  py310h761cc84_1     conda-forge     Cached
</span><span class='line'>  + pycparser                     2.21  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + pyopenssl                   23.0.0  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + pysocks                      1.7.1  pyha2e5f31_6        conda-forge     Cached
</span><span class='line'>  + python                      3.10.9  ha43d526_0_cpython  conda-forge     Cached
</span><span class='line'>  + python_abi                    3.10  3_cp310             conda-forge     Cached
</span><span class='line'>  + readline                     8.1.2  h38e3740_0          conda-forge     Cached
</span><span class='line'>  + requests                    2.28.2  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + ruamel.yaml                0.17.21  py310h761cc84_2     conda-forge     Cached
</span><span class='line'>  + ruamel.yaml.clib             0.2.7  py310hb89b984_1     conda-forge     Cached
</span><span class='line'>  + setuptools                  65.6.3  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + tk                          8.6.12  hd8af866_0          conda-forge     Cached
</span><span class='line'>  + toolz                       0.12.0  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + tqdm                        4.64.1  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + tzdata                       2022g  h191b570_0          conda-forge     Cached
</span><span class='line'>  + urllib3                    1.26.14  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + wheel                       0.38.4  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + xz                           5.2.6  h9cdd2b7_0          conda-forge     Cached
</span><span class='line'>  + zstandard                   0.19.0  py310hde4b81c_1     conda-forge     Cached
</span><span class='line'>  + zstd                         1.5.2  h44f6412_6          conda-forge     Cached
</span><span class='line'>
</span><span class='line'>  Summary:
</span><span class='line'>
</span><span class='line'>  Install: 46 packages
</span><span class='line'>
</span><span class='line'>  Total download: 0 B
</span><span class='line'>
</span><span class='line'>────────────────────────────────────────────────────────────────────────────────────
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Transaction starting
</span><span class='line'>Linking ca-certificates-2022.12.7-h4fd8a4c_0
</span><span class='line'>Linking ld_impl_linux-aarch64-2.40-h2d8c526_0
</span><span class='line'>Linking libgomp-12.2.0-h607ecd0_19
</span><span class='line'>Linking libstdcxx-ng-12.2.0-hc13a102_19
</span><span class='line'>Linking python_abi-3.10-3_cp310
</span><span class='line'>Linking tzdata-2022g-h191b570_0
</span><span class='line'>Linking _openmp_mutex-4.5-2_gnu
</span><span class='line'>Linking libgcc-ng-12.2.0-h607ecd0_19
</span><span class='line'>Linking bzip2-1.0.8-hf897c2e_4
</span><span class='line'>Linking libffi-3.4.2-h3557bc0_5
</span><span class='line'>Linking libnsl-2.0.0-hf897c2e_0
</span><span class='line'>Linking libuuid-2.32.1-hf897c2e_1000
</span><span class='line'>Linking libzlib-1.2.13-h4e544f5_4
</span><span class='line'>Linking ncurses-6.3-headf329_1
</span><span class='line'>Linking openssl-3.0.8-hb4cce97_0
</span><span class='line'>Linking xz-5.2.6-h9cdd2b7_0
</span><span class='line'>Linking libsqlite-3.40.0-hf9034f9_0
</span><span class='line'>Linking readline-8.1.2-h38e3740_0
</span><span class='line'>Linking tk-8.6.12-hd8af866_0
</span><span class='line'>Linking zstd-1.5.2-h44f6412_6
</span><span class='line'>Linking python-3.10.9-ha43d526_0_cpython
</span><span class='line'>Linking certifi-2022.12.7-pyhd8ed1ab_0
</span><span class='line'>Linking charset-normalizer-2.1.1-pyhd8ed1ab_0
</span><span class='line'>Linking colorama-0.4.6-pyhd8ed1ab_0
</span><span class='line'>Linking idna-3.4-pyhd8ed1ab_0
</span><span class='line'>Linking pluggy-1.0.0-pyhd8ed1ab_5
</span><span class='line'>Linking pycosat-0.6.4-py310h761cc84_1
</span><span class='line'>Linking pycparser-2.21-pyhd8ed1ab_0
</span><span class='line'>Linking pysocks-1.7.1-pyha2e5f31_6
</span><span class='line'>Linking ruamel.yaml.clib-0.2.7-py310hb89b984_1
</span><span class='line'>Linking setuptools-65.6.3-pyhd8ed1ab_0
</span><span class='line'>Linking toolz-0.12.0-pyhd8ed1ab_0
</span><span class='line'>Linking wheel-0.38.4-pyhd8ed1ab_0
</span><span class='line'>Linking cffi-1.15.1-py310hf0c4615_3
</span><span class='line'>Linking pip-23.0-pyhd8ed1ab_0
</span><span class='line'>Linking ruamel.yaml-0.17.21-py310h761cc84_2
</span><span class='line'>Linking tqdm-4.64.1-pyhd8ed1ab_0
</span><span class='line'>Linking brotlipy-0.7.0-py310h761cc84_1005
</span><span class='line'>Linking cryptography-39.0.1-py310he4ba0b1_0
</span><span class='line'>Linking zstandard-0.19.0-py310hde4b81c_1
</span><span class='line'>Linking conda-package-streaming-0.7.0-pyhd8ed1ab_1
</span><span class='line'>Linking pyopenssl-23.0.0-pyhd8ed1ab_0
</span><span class='line'>Linking conda-package-handling-2.0.2-pyh38be061_0
</span><span class='line'>Linking urllib3-1.26.14-pyhd8ed1ab_0
</span><span class='line'>Linking requests-2.28.2-pyhd8ed1ab_0
</span><span class='line'>Linking conda-22.11.1-py310h4c7bcd0_1
</span><span class='line'>Transaction finished
</span><span class='line'>installation finished.
</span><span class='line'>Do you wish the installer to initialize Miniforge3
</span><span class='line'>by running conda init? [yes|no]
</span><span class='line'>[no] &gt;&gt;&gt; yes
</span><span class='line'>no change     /usr/local/miniforge3/condabin/conda
</span><span class='line'>no change     /usr/local/miniforge3/bin/conda
</span><span class='line'>no change     /usr/local/miniforge3/bin/conda-env
</span><span class='line'>no change     /usr/local/miniforge3/bin/activate
</span><span class='line'>no change     /usr/local/miniforge3/bin/deactivate
</span><span class='line'>no change     /usr/local/miniforge3/etc/profile.d/conda.sh
</span><span class='line'>no change     /usr/local/miniforge3/etc/fish/conf.d/conda.fish
</span><span class='line'>no change     /usr/local/miniforge3/shell/condabin/Conda.psm1
</span><span class='line'>no change     /usr/local/miniforge3/shell/condabin/conda-hook.ps1
</span><span class='line'>no change     /usr/local/miniforge3/lib/python3.10/site-packages/xontrib/conda.xsh
</span><span class='line'>no change     /usr/local/miniforge3/etc/profile.d/conda.csh
</span><span class='line'>modified      /root/.bashrc
</span><span class='line'>
</span><span class='line'>==&gt; For changes to take effect, close and re-open your current shell. &lt;==
</span><span class='line'>
</span><span class='line'>If you'd prefer that conda's base environment not be activated on startup, 
</span><span class='line'>   set the auto_activate_base parameter to false: 
</span><span class='line'>
</span><span class='line'>conda config --set auto_activate_base false
</span><span class='line'>
</span><span class='line'>Thank you for installing Miniforge3!
</span><span class='line'>root@ubuntu:~# 
</span></code></pre></td></tr></table></div></figure>


<p>这里修改了 /root/.bashrc 添加了：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># &gt;&gt;&gt; conda initialize &gt;&gt;&gt;
</span><span class='line'># !! Contents within this block are managed by 'conda init' !!
</span><span class='line'>__conda_setup="$('/usr/local/miniforge3/bin/conda' 'shell.bash' 'hook' 2&gt; /dev/null)"
</span><span class='line'>if [ $? -eq 0 ]; then
</span><span class='line'>    eval "$__conda_setup"
</span><span class='line'>else
</span><span class='line'>    if [ -f "/usr/local/miniforge3/etc/profile.d/conda.sh" ]; then
</span><span class='line'>        . "/usr/local/miniforge3/etc/profile.d/conda.sh"
</span><span class='line'>    else
</span><span class='line'>        export PATH="/usr/local/miniforge3/bin:$PATH"
</span><span class='line'>    fi
</span><span class='line'>fi
</span><span class='line'>unset __conda_setup
</span><span class='line'># &lt;&lt;&lt; conda initialize &lt;&lt;&lt;
</span></code></pre></td></tr></table></div></figure>


<p>为了重新加载环境变量，新开一个窗口，查看版本：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(base) root@ubuntu:~# python -V
</span><span class='line'>Python 3.10.9
</span><span class='line'>(base) root@ubuntu:~# 
</span><span class='line'>(base) root@ubuntu:~# conda -V
</span><span class='line'>conda 22.11.1
</span><span class='line'>
</span><span class='line'>(base) root@ubuntu:~# python3
</span><span class='line'>Python 3.10.9 | packaged by conda-forge | (main, Feb  2 2023, 20:11:30) [GCC 11.3.0] on linux
</span><span class='line'>Type "help", "copyright", "credits" or "license" for more information.
</span><span class='line'>&gt;&gt;&gt; import platform
</span><span class='line'>&gt;&gt;&gt; platform.architecture()
</span><span class='line'>('64bit', 'ELF')
</span><span class='line'>&gt;&gt;&gt; </span></code></pre></td></tr></table></div></figure>


<p>使用conda新建一个python3.8的配置 &lt;<a href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html">https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html</a></p>

<blockquote><p>：</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(base) root@ubuntu:~# conda info --envs
</span><span class='line'># conda environments:
</span><span class='line'>#
</span><span class='line'>base                  *  /usr/local/miniforge3
</span><span class='line'>
</span><span class='line'>(base) root@ubuntu:~# export http_proxy="http://127.0.0.1:7890"
</span><span class='line'>(base) root@ubuntu:~# export https_proxy="http://127.0.0.1:7890" 
</span><span class='line'>
</span><span class='line'>(base) root@ubuntu:~# conda create -n openai python=3.8 
</span><span class='line'>Collecting package metadata (current_repodata.json): done
</span><span class='line'>Solving environment: done
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>==&gt; WARNING: A newer version of conda exists. &lt;==
</span><span class='line'>  current version: 22.11.1
</span><span class='line'>  latest version: 23.1.0
</span><span class='line'>
</span><span class='line'>Please update conda by running
</span><span class='line'>
</span><span class='line'>    $ conda update -n base -c conda-forge conda
</span><span class='line'>
</span><span class='line'>Or to minimize the number of packages updated during conda update use
</span><span class='line'>
</span><span class='line'>     conda install conda=23.1.0
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>## Package Plan ##
</span><span class='line'>
</span><span class='line'>  environment location: /usr/local/miniforge3/envs/openai
</span><span class='line'>
</span><span class='line'>  added / updated specs:
</span><span class='line'>    - python=3.8
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>The following packages will be downloaded:
</span><span class='line'>
</span><span class='line'>    package                    |            build
</span><span class='line'>    ---------------------------|-----------------
</span><span class='line'>    pypy3.8-7.3.11             |       hf9a8208_0        31.6 MB  conda-forge
</span><span class='line'>    ------------------------------------------------------------
</span><span class='line'>                                           Total:        31.6 MB
</span><span class='line'>
</span><span class='line'>The following NEW packages will be INSTALLED:
</span><span class='line'>
</span><span class='line'>  _openmp_mutex      conda-forge/linux-aarch64::_openmp_mutex-4.5-2_gnu 
</span><span class='line'>  bzip2              conda-forge/linux-aarch64::bzip2-1.0.8-hf897c2e_4 
</span><span class='line'>  ca-certificates    conda-forge/linux-aarch64::ca-certificates-2022.12.7-h4fd8a4c_0 
</span><span class='line'>  expat              conda-forge/linux-aarch64::expat-2.5.0-ha18d298_0 
</span><span class='line'>  gdbm               conda-forge/linux-aarch64::gdbm-1.18-h0a1914f_2 
</span><span class='line'>  libffi             conda-forge/linux-aarch64::libffi-3.4.2-h3557bc0_5 
</span><span class='line'>  libgcc-ng          conda-forge/linux-aarch64::libgcc-ng-12.2.0-h607ecd0_19 
</span><span class='line'>  libgomp            conda-forge/linux-aarch64::libgomp-12.2.0-h607ecd0_19 
</span><span class='line'>  libsqlite          conda-forge/linux-aarch64::libsqlite-3.40.0-hf9034f9_0 
</span><span class='line'>  libstdcxx-ng       conda-forge/linux-aarch64::libstdcxx-ng-12.2.0-hc13a102_19 
</span><span class='line'>  libzlib            conda-forge/linux-aarch64::libzlib-1.2.13-h4e544f5_4 
</span><span class='line'>  ncurses            conda-forge/linux-aarch64::ncurses-6.3-headf329_1 
</span><span class='line'>  openssl            conda-forge/linux-aarch64::openssl-3.1.0-hb4cce97_0 
</span><span class='line'>  pip                conda-forge/noarch::pip-23.0.1-pyhd8ed1ab_0 
</span><span class='line'>  pypy3.8            conda-forge/linux-aarch64::pypy3.8-7.3.11-hf9a8208_0 
</span><span class='line'>  python             conda-forge/linux-aarch64::python-3.8.16-0_73_pypy 
</span><span class='line'>  python_abi         conda-forge/linux-aarch64::python_abi-3.8-3_pypy38_pp73 
</span><span class='line'>  readline           conda-forge/linux-aarch64::readline-8.2-h8fc344f_1 
</span><span class='line'>  setuptools         conda-forge/noarch::setuptools-67.6.0-pyhd8ed1ab_0 
</span><span class='line'>  sqlite             conda-forge/linux-aarch64::sqlite-3.40.0-h69ca7e5_0 
</span><span class='line'>  tk                 conda-forge/linux-aarch64::tk-8.6.12-hd8af866_0 
</span><span class='line'>  wheel              conda-forge/noarch::wheel-0.40.0-pyhd8ed1ab_0 
</span><span class='line'>  xz                 conda-forge/linux-aarch64::xz-5.2.6-h9cdd2b7_0 
</span><span class='line'>  zlib               conda-forge/linux-aarch64::zlib-1.2.13-h4e544f5_4 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Proceed ([y]/n)? y
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Downloading and Extracting Packages
</span><span class='line'>                                                                                                                                                                                          
</span><span class='line'>Preparing transaction: done
</span><span class='line'>Verifying transaction: done
</span><span class='line'>Executing transaction: done
</span><span class='line'>#
</span><span class='line'># To activate this environment, use
</span><span class='line'>#
</span><span class='line'>#     $ conda activate openai
</span><span class='line'>#
</span><span class='line'># To deactivate an active environment, use
</span><span class='line'>#
</span><span class='line'>#     $ conda deactivate
</span><span class='line'>
</span><span class='line'>(base) root@ubuntu:~# 
</span></code></pre></td></tr></table></div></figure>


<p>激活配置：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(base) root@ubuntu:~# conda activate openai
</span><span class='line'>(openai) root@ubuntu:~# 
</span><span class='line'>(openai) root@ubuntu:~# python --version
</span><span class='line'>Python 3.8.16 | packaged by conda-forge | (a9dbdca6, Jan 29 2023, 10:19:50)
</span><span class='line'>[PyPy 7.3.11 with GCC 11.3.0]
</span><span class='line'>(openai) root@ubuntu:~# pip --version 
</span><span class='line'>pip 23.0.1 from /usr/local/miniforge3/envs/openai/lib/pypy3.8/site-packages/pip (python 3.8)
</span><span class='line'>(openai) root@ubuntu:~# git clone https://github.com/zhayujie/bot-on-anything
</span><span class='line'>Cloning into 'bot-on-anything'...
</span><span class='line'>remote: Enumerating objects: 644, done.
</span><span class='line'>remote: Counting objects: 100% (271/271), done.
</span><span class='line'>remote: Compressing objects: 100% (116/116), done.
</span><span class='line'>remote: Total 644 (delta 190), reused 194 (delta 154), pack-reused 373
</span><span class='line'>Receiving objects: 100% (644/644), 588.10 KiB | 448.00 KiB/s, done.
</span><span class='line'>Resolving deltas: 100% (373/373), done.
</span><span class='line'>(openai) root@ubuntu:~# 
</span><span class='line'>(openai) root@ubuntu:~# pip3 install itchat-uos==1.5.0.dev0
</span><span class='line'>Collecting itchat-uos==1.5.0.dev0
</span><span class='line'>  Downloading itchat_uos-1.5.0.dev0-py3-none-any.whl (52 kB)
</span><span class='line'>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 52.5/52.5 kB 244.0 kB/s eta 0:00:00
</span><span class='line'>Collecting requests
</span><span class='line'>  Downloading requests-2.28.2-py3-none-any.whl (62 kB)
</span><span class='line'>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 62.8/62.8 kB 409.1 kB/s eta 0:00:00
</span><span class='line'>Collecting pyqrcode
</span><span class='line'>  Downloading PyQRCode-1.2.1.zip (41 kB)
</span><span class='line'>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 41.9/41.9 kB 961.5 kB/s eta 0:00:00
</span><span class='line'>  Preparing metadata (setup.py) ... done
</span><span class='line'>Collecting pypng
</span><span class='line'>  Downloading pypng-0.20220715.0-py3-none-any.whl (58 kB)
</span><span class='line'>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 58.1/58.1 kB 540.0 kB/s eta 0:00:00
</span><span class='line'>Collecting charset-normalizer&lt;4,&gt;=2
</span><span class='line'>  Downloading charset_normalizer-3.1.0-py3-none-any.whl (46 kB)
</span><span class='line'>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 46.2/46.2 kB 642.4 kB/s eta 0:00:00
</span><span class='line'>Collecting idna&lt;4,&gt;=2.5
</span><span class='line'>  Downloading idna-3.4-py3-none-any.whl (61 kB)
</span><span class='line'>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 61.5/61.5 kB 567.0 kB/s eta 0:00:00
</span><span class='line'>Collecting urllib3&lt;1.27,&gt;=1.21.1
</span><span class='line'>  Downloading urllib3-1.26.15-py2.py3-none-any.whl (140 kB)
</span><span class='line'>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 140.9/140.9 kB 1.0 MB/s eta 0:00:00
</span><span class='line'>Collecting certifi&gt;=2017.4.17
</span><span class='line'>  Downloading certifi-2022.12.7-py3-none-any.whl (155 kB)
</span><span class='line'>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 155.3/155.3 kB 1.2 MB/s eta 0:00:00
</span><span class='line'>Building wheels for collected packages: pyqrcode
</span><span class='line'>  Building wheel for pyqrcode (setup.py) ... done
</span><span class='line'>  Created wheel for pyqrcode: filename=PyQRCode-1.2.1-py3-none-any.whl size=36228 sha256=ba8cd080e7793f5e55c14fa704e57c1459ae29aa6481c719833bf9e148de5ad0
</span><span class='line'>  Stored in directory: /root/.cache/pip/wheels/5f/46/eb/231c89e0ae989c528db1a30d3aae90c4fee29f14d4e0369312
</span><span class='line'>Successfully built pyqrcode
</span><span class='line'>Installing collected packages: pyqrcode, pypng, urllib3, idna, charset-normalizer, certifi, requests, itchat-uos
</span><span class='line'>Successfully installed certifi-2022.12.7 charset-normalizer-3.1.0 idna-3.4 itchat-uos-1.5.0.dev0 pypng-0.20220715.0 pyqrcode-1.2.1 requests-2.28.2 urllib3-1.26.15
</span><span class='line'>WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
</span><span class='line'>(openai) root@ubuntu:~# 
</span><span class='line'>(openai) root@ubuntu:~# pip3 install --upgrade openai
</span><span class='line'>Collecting openai
</span><span class='line'>  Downloading openai-0.27.2-py3-none-any.whl (70 kB)
</span><span class='line'>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 70.1/70.1 kB 277.1 kB/s eta 0:00:00
</span><span class='line'>Requirement already satisfied: requests&gt;=2.20 in /usr/local/miniforge3/envs/openai/lib/python3.8/site-packages (from openai) (2.28.2)
</span><span class='line'>Collecting tqdm
</span><span class='line'>  Downloading tqdm-4.65.0-py3-none-any.whl (77 kB)
</span><span class='line'>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 77.1/77.1 kB 394.8 kB/s eta 0:00:00
</span><span class='line'>Collecting aiohttp
</span><span class='line'>  Downloading aiohttp-3.8.4.tar.gz (7.3 MB)
</span><span class='line'>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 7.3/7.3 MB 2.1 MB/s eta 0:00:00
</span><span class='line'>  Installing build dependencies ... done
</span><span class='line'>  Getting requirements to build wheel ... done
</span><span class='line'>  Installing backend dependencies ... done
</span><span class='line'>  Preparing metadata (pyproject.toml) ... done
</span><span class='line'>Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /usr/local/miniforge3/envs/openai/lib/python3.8/site-packages (from requests&gt;=2.20-&gt;openai) (3.1.0)
</span><span class='line'>Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/miniforge3/envs/openai/lib/python3.8/site-packages (from requests&gt;=2.20-&gt;openai) (3.4)
</span><span class='line'>Requirement already satisfied: urllib3&lt;1.27,&gt;=1.21.1 in /usr/local/miniforge3/envs/openai/lib/python3.8/site-packages (from requests&gt;=2.20-&gt;openai) (1.26.15)
</span><span class='line'>Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/miniforge3/envs/openai/lib/python3.8/site-packages (from requests&gt;=2.20-&gt;openai) (2022.12.7)
</span><span class='line'>Collecting attrs&gt;=17.3.0
</span><span class='line'>  Downloading attrs-22.2.0-py3-none-any.whl (60 kB)
</span><span class='line'>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 60.0/60.0 kB 834.6 kB/s eta 0:00:00
</span><span class='line'>Collecting multidict&lt;7.0,&gt;=4.5
</span><span class='line'>  Downloading multidict-6.0.4.tar.gz (51 kB)
</span><span class='line'>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 51.3/51.3 kB 1.4 MB/s eta 0:00:00
</span><span class='line'>  Installing build dependencies ... done
</span><span class='line'>  Getting requirements to build wheel ... done
</span><span class='line'>  Installing backend dependencies ... done
</span><span class='line'>  Preparing metadata (pyproject.toml) ... done
</span><span class='line'>Collecting async-timeout&lt;5.0,&gt;=4.0.0a3
</span><span class='line'>  Downloading async_timeout-4.0.2-py3-none-any.whl (5.8 kB)
</span><span class='line'>Collecting yarl&lt;2.0,&gt;=1.0
</span><span class='line'>  Downloading yarl-1.8.2.tar.gz (172 kB)
</span><span class='line'>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 172.3/172.3 kB 1.8 MB/s eta 0:00:00
</span><span class='line'>  Installing build dependencies ... done
</span><span class='line'>  Getting requirements to build wheel ... done
</span><span class='line'>  Preparing metadata (pyproject.toml) ... done
</span><span class='line'>Collecting frozenlist&gt;=1.1.1
</span><span class='line'>  Downloading frozenlist-1.3.3.tar.gz (66 kB)
</span><span class='line'>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 66.6/66.6 kB 392.4 kB/s eta 0:00:00
</span><span class='line'>  Installing build dependencies ... done
</span><span class='line'>  Getting requirements to build wheel ... done
</span><span class='line'>  Preparing metadata (pyproject.toml) ... done
</span><span class='line'>Collecting aiosignal&gt;=1.1.2
</span><span class='line'>  Downloading aiosignal-1.3.1-py3-none-any.whl (7.6 kB)
</span><span class='line'>Building wheels for collected packages: aiohttp, frozenlist, multidict, yarl
</span><span class='line'>  Building wheel for aiohttp (pyproject.toml) ... done
</span><span class='line'>  Created wheel for aiohttp: filename=aiohttp-3.8.4-py3-none-any.whl size=183495 sha256=6bdf6b07bb86d5e5e452691da3570b0465c4177bec6fbe8ab668aef8d27ce39c
</span><span class='line'>  Stored in directory: /root/.cache/pip/wheels/46/48/fb/1fceb5376aa4eb481cec5ca10d6aece4455cf6a95030009502
</span><span class='line'>  Building wheel for frozenlist (pyproject.toml) ... done
</span><span class='line'>  Created wheel for frozenlist: filename=frozenlist-1.3.3-py3-none-any.whl size=9271 sha256=83ae70b8a9145f1fb94dffca4105ef207500e63dd3d8c056dc63a3f6ba664927
</span><span class='line'>  Stored in directory: /root/.cache/pip/wheels/0e/e7/55/8036a4cd9267238ba8aa2d714837827b8fd836324632469067
</span><span class='line'>  Building wheel for multidict (pyproject.toml) ... done
</span><span class='line'>  Created wheel for multidict: filename=multidict-6.0.4-py3-none-any.whl size=9710 sha256=0a72821685197753e4e43473bbfe1232bb33cd79fa4ad9c97daae3a7e4afd097
</span><span class='line'>  Stored in directory: /root/.cache/pip/wheels/23/65/1f/b5b0672ad49d2ff7b2c6ad75f24f45c407aab185c37803ae76
</span><span class='line'>  Building wheel for yarl (pyproject.toml) ... done
</span><span class='line'>  Created wheel for yarl: filename=yarl-1.8.2-py3-none-any.whl size=24118 sha256=4ed71ce5647e860cac0a0b5496e72e837878a33d62177d3bdded7d20d068b299
</span><span class='line'>  Stored in directory: /root/.cache/pip/wheels/4e/40/2e/3261e7db3f6b66ca3d8a1ec694f2d5d87f89110e2204675597
</span><span class='line'>Successfully built aiohttp frozenlist multidict yarl
</span><span class='line'>Installing collected packages: tqdm, multidict, frozenlist, attrs, async-timeout, yarl, aiosignal, aiohttp, openai
</span><span class='line'>Successfully installed aiohttp-3.8.4 aiosignal-1.3.1 async-timeout-4.0.2 attrs-22.2.0 frozenlist-1.3.3 multidict-6.0.4 openai-0.27.2 tqdm-4.65.0 yarl-1.8.2
</span><span class='line'>WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
</span><span class='line'>(openai) root@ubuntu:~# 
</span></code></pre></td></tr></table></div></figure>


<h3>学习conda</h3>

<ul>
<li><a href="https://stackoverflow.com/questions/34534513/calling-conda-source-activate-from-bash-script">https://stackoverflow.com/questions/34534513/calling-conda-source-activate-from-bash-script</a></li>
<li><a href="https://docs.conda.io/projects/conda/en/latest/dev-guide/deep-dives/activation.html">https://docs.conda.io/projects/conda/en/latest/dev-guide/deep-dives/activation.html</a></li>
<li><a href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html">https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1
</span><span class='line'>$ eval "$(conda shell.bash activate)"
</span><span class='line'>$ conda shell.bash activate mamba-poc
</span><span class='line'>
</span><span class='line'>2
</span><span class='line'>eval "$(conda shell.bash hook)"
</span><span class='line'>conda activate &lt;env-name&gt;
</span><span class='line'>
</span><span class='line'>3
</span><span class='line'>#!/bin/bash
</span><span class='line'>source /Users/yourname/anaconda/bin/activate your_env
</span><span class='line'>python --version # example way to see that your virtual env loaded as expected
</span><span class='line'>
</span><span class='line'>4
</span><span class='line'>try using
</span><span class='line'>
</span><span class='line'>source ~/anaconda3/etc/profile.d/conda.sh
</span><span class='line'>
</span><span class='line'>and then do
</span><span class='line'>
</span><span class='line'>conda activate pult
</span><span class='line'>
</span><span class='line'>5
</span><span class='line'>https://unix.stackexchange.com/questions/689163/launch-terminal-and-conda-activate-env-from-bash-script
</span><span class='line'># Just activate my conda
</span><span class='line'>alias my_conda='source /home/$USER/anaconda3/bin/activate && conda activate MyPy38'
</span><span class='line'>
</span><span class='line'># Open Jupyter Notebook in my Env
</span><span class='line'>alias my_jupn='source /home/$USER/anaconda3/bin/activate && conda activate MyPy38 && jupyter-notebook'
</span><span class='line'>
</span><span class='line'># Open Jupyter Lab in my Env
</span><span class='line'>alias my_jupl='source /home/$USER/anaconda3/bin/activate && conda activate MyPy38 && jupyter-lab'
</span><span class='line'>
</span><span class='line'># Open Spyder in my Env
</span><span class='line'>alias my_spyder='source /home/$USER/anaconda3/bin/activate && conda activate MyPy38 && spyder'
</span></code></pre></td></tr></table></div></figure>


<h2>花生壳</h2>

<ul>
<li><a href="https://hsk.oray.com/download">https://hsk.oray.com/download</a></li>
<li><a href="https://service.oray.com/question/11639.html">https://service.oray.com/question/11639.html</a></li>
</ul>


<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2023/03/25/reinstall-raspberry2/">重新折腾raspberry2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2023-03-25T21:24:35+08:00" pubdate data-updated="true">Sat 2023-03-25 21:24</time>
		
        
		
      </p>
    
  </header>


  <div class="entry-content"><p>买了新的raspberry4后，就没怎么去弄旧的树莓派2了，今天再次看到想着运行起来看看，插上电源后，一直亮着绿灯，然后就没其他反应了。</p>

<p>树莓派2有点旧，现在直接拿着新的手机充电器去接的时刻，一直起不来，刚开始是怀疑是用TTL接错线导致板子烧了，也没有显示器查看界面。</p>

<p>后面想着重新安装一下试试，然后拿着去接网线有线网络，这样就拿了一个旧的充电器的头。没想到这个时刻电源指示灯尽然闪起来了。想来这可能是电流过载保护了。</p>

<p>问题解决了，也把最新的重新安装的记录一下。</p>

<h2>安装</h2>

<p>参考：
* <a href="https://www.raspberrypi.com/documentation/computers/getting-started.html#installing-the-operating-system">Setting up your Raspberry Pi</a></p>

<h3>安装系统</h3>

<p>1 打开 <a href="https://www.raspberrypi.com/software/">Raspberry Pi Imager</a> 下载并安装，然后把SD card插入电脑。</p>

<p><img src="/images/blogs/rasp2/rasp2-1.png" alt="" /></p>

<p>2 设置初始化 用户和密码，并默认打开ssh服务（新版本已经去掉默认用户了，所以要设置一下 <a href="https://www.raspberrypi.com/news/raspberry-pi-bullseye-update-april-2022/">An update to Raspberry Pi OS Bullseye</a> ）</p>

<p><img src="/images/blogs/rasp2/rasp2-2.png" alt="" /></p>

<p>3 选择操作系统</p>

<p><img src="/images/blogs/rasp2/rasp2-3-1.png" alt="" /></p>

<p><img src="/images/blogs/rasp2/rasp2-3-2.png" alt="" /></p>

<p>4 连上有线网络，接通电源。然后打开路由管理界面，查看raspberry的ip地址</p>

<p><img src="/images/blogs/rasp2/rasp2-4-0.png" alt="" /></p>

<p>5 用ssh连接服务器</p>

<p><img src="/images/blogs/rasp2/rasp2-4-1.png" alt="" /></p>

<h3>配置Wifi网络</h3>

<p>原来已经买了usb的无线网卡，用 <code>ifconfig</code> 也能查看到 <code>wlan0</code> 的接口。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@raspberrypi:~# apt install vim 
</span><span class='line'>Reading package lists... Done
</span><span class='line'>Building dependency tree... Done
</span><span class='line'>Reading state information... Done
</span><span class='line'>  libgpm2 vim-runtime
</span><span class='line'>Suggested packages:
</span><span class='line'>  gpm ctags vim-doc vim-scripts
</span><span class='line'>The following NEW packages will be installed:
</span><span class='line'>  libgpm2 vim vim-runtime
</span><span class='line'>0 upgraded, 3 newly installed, 0 to remove and 0 not upgraded.
</span><span class='line'>...
</span><span class='line'>update-alternatives: using /usr/bin/vim.basic to provide /usr/bin/vim (vim) in auto mode
</span><span class='line'>update-alternatives: using /usr/bin/vim.basic to provide /usr/bin/vimdiff (vimdiff) in auto mode
</span><span class='line'>update-alternatives: using /usr/bin/vim.basic to provide /usr/bin/rvim (rvim) in auto mode
</span><span class='line'>update-alternatives: using /usr/bin/vim.basic to provide /usr/bin/rview (rview) in auto mode
</span><span class='line'>update-alternatives: using /usr/bin/vim.basic to provide /usr/bin/vi (vi) in auto mode
</span><span class='line'>update-alternatives: using /usr/bin/vim.basic to provide /usr/bin/view (view) in auto mode
</span><span class='line'>update-alternatives: using /usr/bin/vim.basic to provide /usr/bin/ex (ex) in auto mode
</span><span class='line'>Processing triggers for man-db (2.9.4-2) ...
</span><span class='line'>Processing triggers for libc-bin (2.31-13+rpt2+rpi1+deb11u5) ...
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~# echo "set mouse-=a" &gt;&gt;~/.vimrc
</span><span class='line'>root@raspberrypi:~# vim /etc/wpa_supplicant/wpa_supplicant.conf    
</span><span class='line'>root@raspberrypi:~# 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~# iwlist wlan0 scan
</span><span class='line'>
</span><span class='line'># 算一个加密的配置
</span><span class='line'>root@raspberrypi:~# wpa_passphrase winse
</span><span class='line'># reading passphrase from stdin
</span><span class='line'>xxx
</span><span class='line'>network={
</span><span class='line'>        ssid="winse"
</span><span class='line'>        #psk="xxx"
</span><span class='line'>        psk=xxx
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~# cat /etc/wpa_supplicant/wpa_supplicant.conf   
</span><span class='line'>country=CN
</span><span class='line'>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
</span><span class='line'>update_config=1
</span><span class='line'>
</span><span class='line'>network={
</span><span class='line'>        ssid="winse"
</span><span class='line'>        #psk="xxx"
</span><span class='line'>        psk=xxx
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># 配置服务
</span><span class='line'>pi@raspberrypi:~ $ cat /lib/systemd/system/wpa_supplicant.service 
</span><span class='line'>[Unit]
</span><span class='line'>Description=WPA supplicant
</span><span class='line'>Before=network.target
</span><span class='line'>After=dbus.service
</span><span class='line'>Wants=network.target
</span><span class='line'>IgnoreOnIsolate=true
</span><span class='line'>
</span><span class='line'>[Service]
</span><span class='line'>#Type=dbus
</span><span class='line'>#BusName=fi.w1.wpa_supplicant1
</span><span class='line'>Type=forking
</span><span class='line'>ExecStart=/sbin/wpa_supplicant -u -s -O /run/wpa_supplicant -c /etc/wpa_supplicant/wpa_supplicant.conf -i wlan0 -B -D wext
</span><span class='line'>Restart=always
</span><span class='line'>
</span><span class='line'>[Install]
</span><span class='line'>WantedBy=multi-user.target
</span><span class='line'>#Alias=dbus-fi.w1.wpa_supplicant1.service
</span><span class='line'>pi@raspberrypi:~ $ cat /etc/systemd/system/dhclient.service 
</span><span class='line'>[Unit]
</span><span class='line'>Description= DHCP Client
</span><span class='line'>Before=network.target
</span><span class='line'>
</span><span class='line'>[Service]
</span><span class='line'>Type=forking
</span><span class='line'>ExecStart=/sbin/dhclient wlan0 -v
</span><span class='line'>ExecStop=/sbin/dhclient wlan0 -r
</span><span class='line'>Restart=always
</span><span class='line'>
</span><span class='line'>[Install] 
</span><span class='line'>WantedBy=multi-user.target
</span><span class='line'>pi@raspberrypi:~ $ 
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~# systemctl daemon-reload 
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~# systemctl stop NetworkManager
</span><span class='line'>root@raspberrypi:~# systemctl enable wpa_supplicant.service 
</span><span class='line'>root@raspberrypi:~# systemctl enable dhclient.service
</span><span class='line'>Created symlink /etc/systemd/system/multi-user.target.wants/dhclient.service → /etc/systemd/system/dhclient.service.
</span></code></pre></td></tr></table></div></figure>


<p>配置好后，重启服务器，再次查看路由器管理web界面：</p>

<p><img src="/images/blogs/rasp2/rasp2-5.png" alt="" /></p>

<p>然后再把网线拔掉，再重启一次确认一下。</p>

<h3>遇到的问题：</h3>

<p>1 <a href="https://zhuanlan.zhihu.com/p/136463580">https://zhuanlan.zhihu.com/p/136463580</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>如果树莓派系统使用的是Raspbian Stretch，则ifup命令可能不起作用，可能会收到一条错误消息，
</span><span class='line'>内容如下：“ ifdown：unknown interface wlan0 ”。可以使用以下任何命令来解决：
</span><span class='line'>sudo ifconfig wlan0 up
</span></code></pre></td></tr></table></div></figure>


<p>2 <a href="https://shumeipai.nxez.com/2017/09/13/raspberry-pi-network-configuration-before-boot.html">https://shumeipai.nxez.com/2017/09/13/raspberry-pi-network-configuration-before-boot.html</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>说明以及不同安全性的 WiFi 配置示例：
</span><span class='line'>#ssid:网络的ssid
</span><span class='line'>#psk:密码
</span><span class='line'>#priority:连接优先级，数字越大优先级越高（不可以是负数）
</span><span class='line'>#scan_ssid:连接隐藏WiFi时需要指定该值为1
</span><span class='line'>
</span><span class='line'>如果你的 WiFi 没有密码
</span><span class='line'>
</span><span class='line'>network={
</span><span class='line'>  ssid="你的无线网络名称（ssid）"
</span><span class='line'>  key_mgmt=NONE
</span><span class='line'>}
</span><span class='line'>如果你的 WiFi 使用WEP加密
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>network={
</span><span class='line'>  ssid="你的无线网络名称（ssid）"
</span><span class='line'>  key_mgmt=NONE
</span><span class='line'>  wep_key0="你的wifi密码"
</span><span class='line'>}
</span><span class='line'>如果你的 WiFi 使用WPA/WPA2加密
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>network={
</span><span class='line'>  ssid="你的无线网络名称（ssid）"
</span><span class='line'>  key_mgmt=WPA-PSK
</span><span class='line'>  psk="你的wifi密码"
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>如果你不清楚 WiFi 的加密模式，可以在安卓手机上用 root explorer 打开 /data/misc/wifi/wpa/wpa_supplicant.conf，查看 WiFi 的信息。
</span></code></pre></td></tr></table></div></figure>


<p>3 <a href="https://www.labno3.com/2021/03/22/setting-up-raspberry-pi-wifi/">https://www.labno3.com/2021/03/22/setting-up-raspberry-pi-wifi/</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>如果连接有问题，一定要确认Pi是否支持WiFi。也有可能你的SSID是错误的，要扫描和检查，
</span><span class='line'>使用sudo iwlist wlan0 scan并检查essid字段。
</span><span class='line'>这个字段应该和你在ssid字段输入的一样。
</span></code></pre></td></tr></table></div></figure>


<p>4 查看信息 <a href="https://www.baeldung.com/linux/connect-network-cli">https://www.baeldung.com/linux/connect-network-cli</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@raspberrypi:~# ip link show wlan0
</span><span class='line'>3: wlan0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc mq state DOWN mode DEFAULT group default qlen 1000
</span><span class='line'>  link/ether 00:5a:39:e1:4d:bb brd ff:ff:ff:ff:ff:ff
</span><span class='line'>root@raspberrypi:~# ip link set wlan0 up  
</span><span class='line'>root@raspberrypi:~# ip link show wlan0
</span><span class='line'>3: wlan0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc mq state DOWN mode DEFAULT group default qlen 1000
</span><span class='line'>  link/ether 00:5a:39:e1:4d:bb brd ff:ff:ff:ff:ff:ff
</span><span class='line'>root@raspberrypi:~# 
</span><span class='line'>root@raspberrypi:~# iw wlan0 link
</span><span class='line'>Not connected.
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~# ifconfig wlan0 down
</span><span class='line'>root@raspberrypi:~# ifconfig wlan0 up 
</span><span class='line'>root@raspberrypi:~# ifconfig wlan0
</span><span class='line'>wlan0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
</span><span class='line'>      ether 00:5a:39:e1:4d:bb  txqueuelen 1000  (Ethernet)
</span><span class='line'>      RX packets 0  bytes 0 (0.0 B)
</span><span class='line'>      RX errors 0  dropped 0  overruns 0  frame 0
</span><span class='line'>      TX packets 0  bytes 0 (0.0 B)
</span><span class='line'>      TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span></code></pre></td></tr></table></div></figure>


<p>5 <a href="https://shapeshed.com/linux-wifi/">https://shapeshed.com/linux-wifi/</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wpa_cli
</span></code></pre></td></tr></table></div></figure>


<p>6 <a href="https://www.bilibili.com/read/cv8895717">https://www.bilibili.com/read/cv8895717</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vim /etc/wpa_supplicant/wpa_supplicant.conf 编辑该文件，在文件顶部增加以下内容
</span><span class='line'>country=CN
</span><span class='line'>ctrl_interface=/run/wpa_supplicant
</span><span class='line'>update_config=1
</span><span class='line'>
</span><span class='line'>特别说明：country=CN 由于各个国家wifi使用频段不同，尤其5G频段
</span><span class='line'>
</span><span class='line'>vim /etc/rc.local 添加以下内容
</span><span class='line'>
</span><span class='line'>#!/bin/bash
</span><span class='line'>
</span><span class='line'>ip link set wlan0 up &
</span><span class='line'>wpa_supplicant -B -i wlan0 -D nl80211 -c /etc/wpa_supplicant/wpa_supplicant.conf &
</span><span class='line'>dhclient wlan0
</span><span class='line'>
</span><span class='line'>exit 0</span></code></pre></td></tr></table></div></figure>


<p>7 <a href="https://blog.csdn.net/u010049696/article/details/48765999">https://blog.csdn.net/u010049696/article/details/48765999</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>配置service。进入到/usr/lib/systemd/system目录，可以看到下面四个文件：
</span><span class='line'>
</span><span class='line'>wpa_supplicant-nl80211@.service
</span><span class='line'>wpa_supplicant.service
</span><span class='line'>wpa_supplicant@.service
</span><span class='line'>wpa_supplicant-wired@.service
</span><span class='line'>
</span><span class='line'>编辑wpa_supplicant.service文件，如下：
</span><span class='line'>
</span><span class='line'>[Unit]
</span><span class='line'>Description=WPA supplicant
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[Service]
</span><span class='line'>Type=dbus
</span><span class='line'>BusName=fi.epitest.hostap.WPASupplicant
</span><span class='line'>ExecStart=/usr/bin/wpa_supplicant -c/etc/wpa_supplicant/test.conf -i wlp3s0
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[Install]
</span><span class='line'>WantedBy=multi-user.target
</span><span class='line'>Alias=dbus-fi.epitest.hostap.WPASupplicant.service
</span><span class='line'>
</span><span class='line'>其中，只需修改ExecStart=/usr/bin/wpa_supplicant -c/etc/wpa_supplicant/test.conf -i wlp3s0即可。</span></code></pre></td></tr></table></div></figure>


<p>8 <a href="https://www.linuxbabe.com/command-line/ubuntu-server-16-04-wifi-wpa-supplicant">https://www.linuxbabe.com/command-line/ubuntu-server-16-04-wifi-wpa-supplicant</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Auto Connect on Startup
</span><span class='line'>To automatically connect to wireless network at boot time, we need to edit the wpa_supplicant.service file. It’s a good idea to copy the file from /lib/systemd/system/ directory to /etc/systemd/system/ directory, then edit it because we don’t want newer version of wpasupplicant to override our modifications.
</span><span class='line'>
</span><span class='line'>sudo cp /lib/systemd/system/wpa_supplicant.service /etc/systemd/system/wpa_supplicant.service
</span><span class='line'>
</span><span class='line'>sudo nano /etc/systemd/system/wpa_supplicant.service
</span><span class='line'>Find the following line.
</span><span class='line'>
</span><span class='line'>ExecStart=/sbin/wpa_supplicant -u -s -O /run/wpa_supplicant
</span><span class='line'>Change it to the following. Obviously you need to change wlp3s0 if that isn’t your interface name.
</span><span class='line'>
</span><span class='line'>ExecStart=/sbin/wpa_supplicant -u -s -c /etc/wpa_supplicant.conf -i wlp3s0
</span><span class='line'>It’s recommended to always try to restart wpa_supplicant when failure is detected. Add the following right below the ExecStart line.
</span><span class='line'>
</span><span class='line'>Restart=always
</span><span class='line'>If you can find the following line in this file, comment it out (Add the # character at the beginning of the line).
</span><span class='line'>
</span><span class='line'>Alias=dbus-fi.w1.wpa_supplicant1.service
</span><span class='line'>Save and close the file. Then enable wpa_supplicant service to start at boot time.
</span><span class='line'>
</span><span class='line'>sudo systemctl enable wpa_supplicant.service
</span><span class='line'>
</span><span class='line'>~~~
</span><span class='line'>
</span><span class='line'>sudo nano /etc/systemd/system/dhclient.service
</span><span class='line'>Put the following text into the file.
</span><span class='line'>
</span><span class='line'>[Unit]
</span><span class='line'>Description= DHCP Client
</span><span class='line'>Before=network.target
</span><span class='line'>
</span><span class='line'>[Service]
</span><span class='line'>Type=forking
</span><span class='line'>ExecStart=/sbin/dhclient wlp3s0 -v
</span><span class='line'>ExecStop=/sbin/dhclient wlp3s0 -r
</span><span class='line'>Restart=always
</span><span class='line'>
</span><span class='line'>[Install] 
</span><span class='line'>WantedBy=multi-user.target
</span><span class='line'>Save and close the file. Then enable this service.
</span><span class='line'>
</span><span class='line'>sudo systemctl enable dhclient.service
</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2023/03/25/mirror-request/">请求复制/镜像</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2023-03-25T18:28:14+08:00" pubdate data-updated="true">Sat 2023-03-25 18:28</time>
		
        
		
      </p>
    
  </header>


  <div class="entry-content"><p>在测试一个新功能，如果写入原程序的情况下再写一份到新的程序呢？比如Elasticsearch和OpenSearch。还有把生产的流量引一份出来测试，如果来实现呢？</p>

<p>一般的转换功能复制，如logstash、vector，但这些不能返回结果，不符合。只能往反向代理上找：nginx。</p>

<ul>
<li><a href="https://cloud.tencent.com/developer/article/1495449">Nginx 流量镜像使用技巧</a></li>
<li><a href="https://juejin.cn/post/7101267337332375559">Nginx流量镜像</a></li>
</ul>


<h2>nginx_http_mirror_module模块</h2>

<p>当请求到达 Nginx 时，如果 Nginx 开启了流量镜像功能，就会将请求复制一份，并根据 mirror location 中的配置来处理这份复制的请求。</p>

<h2>配置</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  listen 9200;
</span><span class='line'>  server_name elasticsearch;
</span><span class='line'>  client_max_body_size 50m;
</span><span class='line'>
</span><span class='line'># error_log /var/log/nginx/elasticsearch-errors.log;
</span><span class='line'># access_log /var/log/nginx/elasticsearch.log;
</span><span class='line'>
</span><span class='line'>  location / {
</span><span class='line'>  
</span><span class='line'>    # Deny Nodes shutdown API
</span><span class='line'>    if ($request_filename ~ "_shutdown") { 
</span><span class='line'>      return 403;
</span><span class='line'>      break;
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>    # Deny access to cluster API
</span><span class='line'>    if ($request_filename ~ "_cluster") {
</span><span class='line'>      return 403;
</span><span class='line'>      break;
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>    # Pass requests to ETasticsearch
</span><span class='line'>    proxy_pass http://localhost:9201;
</span><span class='line'>    proxy_redirect off;
</span><span class='line'>    
</span><span class='line'>    proxy_set_header X-Real-IP $remote_addr;
</span><span class='line'>    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span><span class='line'>    proxy_set_header Host $http_host;
</span><span class='line'>    
</span><span class='line'>    # For CORS Ajax 
</span><span class='line'>    proxy_pass_header Access-Control-Allow-origin;
</span><span class='line'>    proxy_pass_header Access-Control-Allow-Method proxy_hide_header Access-Control-Allow-Headers;
</span><span class='line'>    add_header Access-control-A1low-Headers 'X-Requested-with, Content-Type';
</span><span class='line'>    # add_header Access-Control-Allow-credentials true;
</span><span class='line'>        
</span><span class='line'>    # Authorize access 
</span><span class='line'>    #auth basic "elasticsearch";
</span><span class='line'>    #auth_basic_user_file /usr/local/etc/elasticsearch/passwords;
</span><span class='line'>    
</span><span class='line'>    mirror /mirror;
</span><span class='line'>    mirror_request_body on;
</span><span class='line'>  }
</span><span class='line'>  
</span><span class='line'>  location /mirror {
</span><span class='line'>    internal; # 指定此location只能被“内部的”请求调用
</span><span class='line'>  
</span><span class='line'>    # Pass requests to OpenSearch
</span><span class='line'>    proxy_pass http://127.0.0.1:19200$request_uri;
</span><span class='line'>    proxy_redirect off:
</span><span class='line'>  
</span><span class='line'>    proxy_set_header X-Real-IP $remote_addr;
</span><span class='line'>    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span><span class='line'>    proxy_set_header Host $http_host;
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>server {
</span><span class='line'>  listen 127.0.0.1:19200;
</span><span class='line'>  location / { # 增加一层，方便在nginx中输出日志定位问题
</span><span class='line'>    proxy_pass https://192.168.1.21:9200;
</span><span class='line'>
</span><span class='line'>    proxy_set_header X-Real-IP $remote_addr;
</span><span class='line'>    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span><span class='line'>    proxy_set_header Host $http_host;
</span><span class='line'>  
</span><span class='line'>    proxy_set_header Authorization "Basic YWRtaW46YWRtaW4=";
</span></code></pre></td></tr></table></div></figure>


<p>shell中计算base64的时刻要注意加上 <code>-ne</code> ，也可以直接网上 <a href="https://tool.chinaz.com/tools/base64.aspx">https://tool.chinaz.com/tools/base64.aspx</a> 算一下。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo -ne 'admin:admin'|base64 -</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>佛爷</h1>
  <p>来之不易, 且等且珍惜. <br>得之我幸; 不得<span style="display:none">-争-复争-且不得</span>, 命也, 乐享天命, 福也. </p>
  <p><a href="https://github.com/winse"><i class="fa fa-github-alt">winse</i></a>&nbsp;&nbsp;<a href="http://weibo.com/winseliu"><i class="fa fa-weibo">winseliu</i></a></p>
</section>
<section>
  <h1><a class='category' href='/blog/categories/recommend/'>Recommend</a></h1>
	<ul role="list">
		
			<li class="post">
				<a href="/blog/2023/11/18/reinstall-redmine-on-respberry2/">Reinstall Redmine on Respberry2</a>
			</li>
		
			<li class="post">
				<a href="/blog/2023/03/25/reinstall-raspberry2/">重新折腾raspberry2</a>
			</li>
		
			<li class="post">
				<a href="/blog/2023/03/25/mirror-request/">请求复制/镜像</a>
			</li>
		
			<li class="post">
				<a href="/blog/2022/07/24/xinchuang-install-postgres/">信创环境迁移浅析-以Postgres为例</a>
			</li>
		
			<li class="post">
				<a href="/blog/2021/12/08/recommand-blogs/">认真的博客</a>
			</li>
		
			<li class="post">
				<a href="/blog/2017/10/30/windows-run-ubuntu/">Windows Run Ubuntu</a>
			</li>
		
			<li class="post">
				<a href="/blog/2017/09/18/redmine-deploy-and-install-plugins/">Redmine部署以及插件安装</a>
			</li>
		
			<li class="post">
				<a href="/blog/2015/09/13/review-linux-101-hacks/">【linux 101 Hacks】读后感</a>
			</li>
		
			<li class="post">
				<a href="/blog/2013/09/19/let-shell-command-efficient/">让敲Shell命令高效起来</a>
			</li>
		
	</ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2023/11/18/reinstall-redmine-on-respberry2/">Reinstall Redmine on Respberry2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/04/09/dingtalk-with-openai/">钉钉群机器人对接ChatGPT</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/03/26/clash-on-raspberry4/">树莓派4安装Clash</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/03/25/reinstall-raspberry2/">重新折腾raspberry2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/03/25/mirror-request/">请求复制/镜像</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/03/18/wechat-on-openai/">微信对接OpenAI</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/02/01/git-reset-hard/">记git Reset &#8211;hard</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/02/01/register-openai/">注册OpenAI</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>

	 
	<ul role="list">
		
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/0/'>0</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/alluxio/'>alluxio</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/android/'>android</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/bigdata/'>bigdata</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/blabla/'>blabla</a> (7) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/books/'>books</a> (6) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/clash/'>clash</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/debug/'>debug</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/deprecated/'>deprecated</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/devops/'>devops</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/docker/'>docker</a> (16) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/elasticsearch/'>elasticsearch</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/es/'>es</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/flume/'>flume</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/ganglia/'>ganglia</a> (5) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/git/'>git</a> (4) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/good-series-1/'>good-series-1</a> (9) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/hadoop/'>hadoop</a> (44) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/hbase/'>hbase</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/hive/'>hive</a> (8) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/hole/'>hole</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/java/'>java</a> (13) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/jekyll/'>jekyll</a> (8) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/jenkins/'>jenkins</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/jeykll/'>jeykll</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/k2/'>k2</a> (2) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/k8s/'>k8s</a> (15) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/kafka/'>kafka</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/kubeadm/'>kubeadm</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/logstash/'>logstash</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/map/'>map</a> (2) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/nfs/'>nfs</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/nginx/'>nginx</a> (5) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/openai/'>openai</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/openeuler/'>openeuler</a> (2) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/openvpn/'>openvpn</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/puppet/'>puppet</a> (11) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/r4a/'>r4a</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/raspberry/'>raspberry</a> (5) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/recommend/'>recommend</a> (18) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/redis/'>redis</a> (7) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/redmine/'>redmine</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/respberry2/'>respberry2</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/scala/'>scala</a> (4) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/shell/'>shell</a> (4) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/spark/'>spark</a> (13) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/staf/'>staf</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/tachyon/'>tachyon</a> (3) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/tez/'>tez</a> (2) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/tools/'>tools</a> (71) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/topics/'>topics</a> (2) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/vagrant/'>vagrant</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/vnc/'>vnc</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/wsl/'>wsl</a> (1) 
		</li>
		 
		<li style="float:left; width:120px"> 
			<a class='category' href='/blog/categories/zookeeper/'>zookeeper</a> (1) 
		</li>
		
		
		<li style="clear:both; width: 1px; margin: 0; padding: 0;"></li>
		<li class="category"><a href="/blog/archives">All categories</a> (236)</li>
	</ul>
	
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/winse">@winse</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'winse',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
<!--
  <h1>Softs, I&#8217;m using</h1>
  <ul>
    <li class="post">
		<a href="http://hadoop.apache.org/releases.html">hadoop-2.6.3</a>
	</li>
	<li class="post">
		<a href="https://issues.apache.org/jira/browse/HBASE/?selectedTab=com.atlassian.jira.jira-projects-plugin:changelog-panel">hbase-0.96.0</a>
	</li>
	<li class="post">
		<a href="https://hive.apache.org/downloads.html">hive-1.2.1</a>
	</li>
	<li class="post">
		<a href="https://issues.apache.org/jira/browse/TEZ/?selectedTab=com.atlassian.jira.jira-projects-plugin:summary-panel">tez-0.7.0</a>
    </li>
  </ul>
&#8211;>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2023 - Winse Liu -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1253103971'%3E%3C/span%3E%3Cscript src='https://s19.cnzz.com/z_stat.php%3Fid%3D1253103971%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</p>

</footer>
  


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

<script>

var time=location.pathname.substring(6).substring(0,11);
var eName=location.pathname.substring(17);
var gitalk = new Gitalk({
  clientID: 'c14f68eac6330d15d984',
  clientSecret: '73b7c1fffa98e299ff0cdd332821201933858e6e',
  repo: 'winse.github.com',
  owner: 'winse',
  admin: ['winse'],
  id: eName,
  labels: ['Gitalk', time],
  body: "http://winse.github.io" + location.pathname,
  createIssueManually: true,
  
  // facebook-like distraction free mode
  distractionFreeMode: false
})

gitalk.render('gitalk-container')

</script>



<script>
/*
$.ajax({
  type: "POST",
  url: "http://log.winseliu.com:20000",
  data: JSON.stringify({
    title: document.title,
    location: JSON.stringify(location),
    referrer: document.referrer,
    userAgent: navigator.userAgent
  }),
  contentType: "application/json; charset=utf-8",
  dataType: "json"
});
*/
</script>











</body>
</html>
