<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Winse Blog]]></title>
  <link href="http://winse.github.io/atom.xml" rel="self"/>
  <link href="http://winse.github.io/"/>
  <updated>2023-04-09T19:31:58+08:00</updated>
  <id>http://winse.github.io/</id>
  <author>
    <name><![CDATA[Winse Liu]]></name>
    <email><![CDATA[winseliu@foxmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[é’‰é’‰ç¾¤æœºå™¨äººå¯¹æ¥ChatGPT]]></title>
    <link href="http://winse.github.io/blog/2023/04/09/dingtalk-with-openai/"/>
    <updated>2023-04-09T19:25:42+08:00</updated>
    <id>http://winse.github.io/blog/2023/04/09/dingtalk-with-openai</id>
    <content type="html"><![CDATA[<p>å‰é¢ä¸€æ®µæ—¶åˆ»ï¼Œé€šè¿‡ <a href="https://github.com/zhayujie/bot-on-anything">https://github.com/zhayujie/bot-on-anything</a> å¯¹æ¥è¿‡ä¸ªäººå¾®ä¿¡çš„ç¾¤ï¼Œä½†æ˜¯æ²¡è¿‡å¤šä¹…å¾®ä¿¡å°±è¢«è­¦å‘Šä¸èƒ½æ‰«ç äº†ï¼Œå‰å‡ å¤©æ›´æ–°äº†é’‰é’‰æœºå™¨äººçš„å¯¹æ¥æ–¹æ³•ï¼Œå°è¯•äº†ä¸€ä¸‹æ„Ÿè§‰è¿˜è¡Œé©¬é©¬è™è™ã€‚</p>

<p>å½“ç„¶è¿‡ç¨‹æ˜¯æªå¿ƒçš„ï¼šé’‰é’‰æ–‡æ¡£åœ¨æ›´æ–°å‡çº§ï¼Œbotè¿™è¾¹çš„æ–‡æ¡£å¤ªç®€å•ï¼Œéœ€è¦å¯¹ç€ä»£ç ï¼Œç„¶åå¯¹ç€dingtalkå®˜æ–¹çš„æ–‡æ¡£å¯¹ç…§ç€å»æ’æŸ¥ã€‚</p>

<h2>ç¬¬ä¸€æ­¥ é¦–å…ˆæ˜¯åˆ›å»ºä¼ä¸šå†…éƒ¨æœºå™¨äººï¼Œè·å–Secret</h2>

<p>å¹³æ—¶å¯¹æ¥çš„å‘Šè­¦æœºå™¨äººæ˜¯åªèƒ½å‘æ¶ˆæ¯çš„ï¼Œä¸èƒ½æ¥æ”¶æ¶ˆæ¯ã€‚</p>

<p>åœ¨é’‰é’‰APPä¸­åˆ›å»ºä¸€ä¸ªç»„ç»‡ï¼Œç„¶ååœ¨ä»¥è¿™ä¸ªç»„ç»‡ç™»å½• <a href="https://open-dev.dingtalk.com/v1/fe/old#/corprobot">https://open-dev.dingtalk.com/v1/fe/old#/corprobot</a> ç„¶åå†ç‚¹å‡» åˆ›å»ºæœºå™¨äººï¼š</p>

<p>å…¶ä¸­åŸºç¡€ä¿¡æ¯ä¸­çš„AppSecretåé¢ä¼šç”¨åˆ°ï¼Œå¯¹åº”dingtalk_secretï¼š</p>

<p><img src="http://winse.github.io/images/blogs/openai/dingtalk1.png" alt="æœºå™¨äººåŸºç¡€ä¿¡æ¯" /></p>

<p>ç„¶åé…ç½®æ¥å—æ¶ˆæ¯çš„åœ°å€ï¼šå°±æ˜¯é’‰é’‰æœåŠ¡å™¨æ”¶åˆ°æ¶ˆæ¯åï¼ŒæŠŠæ¶ˆæ¯è½¬å‘åˆ°ä½ çš„æœåŠ¡å™¨ï¼ˆå…¬ç½‘å¯è®¿é—®çš„ï¼‰åœ°å€ã€‚æœåŠ¡å™¨å‡ºå£IPï¼šå°±æ˜¯ä½ éƒ¨ç½²æœåŠ¡å™¨çš„å…¬ç½‘IPï¼Œä¸ºäº†éªŒè¯ä¿¡æ¯çš„åˆæ³•æ€§çš„ä¸€ä¸ªå‚æ•°ã€‚</p>

<p><img src="http://winse.github.io/images/blogs/openai/dingtalk2.png" alt="æœåŠ¡é…ç½®" /></p>

<p>åˆ›å»ºå¥½æœºå™¨äººåï¼Œåœ¨ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒé¡µç­¾ä¸­ï¼Œä¸Šçº¿æœºå™¨äººã€‚è¿™æ ·æˆ‘ä»¬åœ¨ç»„ç»‡çš„ç¾¤é‡Œé¢å°±èƒ½é€‰æ‹©è¿™ä¸ªæœºå™¨äººäº†ã€‚</p>

<h2>ç¬¬äºŒæ­¥ æŠŠæœºå™¨äººåŠ å…¥ç»„ç»‡ç¾¤ï¼Œè·å–Token</h2>

<p>é€‰æ‹© ç¾¤è®¾ç½® - æœºå™¨äºº - æ·»åŠ æœºå™¨äººï¼ŒæŠŠåˆšåˆšåˆ›å»ºçš„æœºå™¨äººåŠ å…¥åˆ°æˆ‘ä»¬ç»„ç»‡/å…¬å¸ç¾¤ï¼Œç„¶åæŸ¥çœ‹æœºå™¨äººçš„è®¾ç½®ï¼Œä¼šæä¾›ä¸€ä¸ªwebhookçš„åœ°å€ï¼Œè¿™ä¸€ä¸²åœ°å€ä¸­å°±åŒ…æ‹¬äº†ä¸€ä¸ªaccess_tokençš„å­—ç¬¦ä¸²å‚æ•°ï¼Œå°±æ˜¯åé¢éœ€è¦ç”¨çš„dingtalk_tokenã€‚</p>

<p><img src="http://winse.github.io/images/blogs/openai/dingtalk3.png" alt="æœºå™¨äººç®¡ç†" /></p>

<p><img src="http://winse.github.io/images/blogs/openai/dingtalk4.png" alt="æœºå™¨äººè®¾ç½®/é…ç½®é¡µé¢" /></p>

<h2>ç¬¬ä¸‰æ­¥ é…ç½®botï¼Œå¯åŠ¨æœåŠ¡</h2>

<p>é…ç½®bot-on-anythingçš„config.jsonï¼Œä¿®æ”¹ channel - type çš„ç±»å‹ä¸º dingtalkï¼Œdingtalkçš„å‚æ•°ä¸ºï¼šæœºå™¨äººåº”ç”¨å‡­è¯çš„AppSecretå¯¹åº”dingtalk_secretï¼›å‘å¸ƒæœºå™¨äººï¼ŒæŠŠæœºå™¨äººåŠ å…¥åˆ°ç¾¤åï¼Œæœºå™¨äººè®¾ç½®é¡µé¢çš„webhookåœ°å€ä¸Šçš„access_tokenå¯¹åº”çš„æ˜¯dingtalk_tokenã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>"channel": {
</span><span class='line'>    "type": "dingtalk",
</span><span class='line'>    "single_chat_prefix": ["bot", "@bot"],
</span><span class='line'>    "single_chat_reply_prefix": "[bot] ",
</span><span class='line'>    "group_chat_prefix": ["@bot"],
</span><span class='line'>    "group_name_white_list": ["ChatGPTæµ‹è¯•ç¾¤"],
</span><span class='line'>    "image_create_prefix": ["ç”»", "çœ‹", "æ‰¾ä¸€å¼ "],
</span><span class='line'>
</span><span class='line'>    "wechat": {
</span><span class='line'>    },
</span><span class='line'>
</span><span class='line'>    "wechat_mp": {
</span><span class='line'>      "token": "2023...",
</span><span class='line'>      "port": "3000"
</span><span class='line'>    },
</span><span class='line'>
</span><span class='line'>    "dingtalk": {
</span><span class='line'>      "image_create_prefix": ["ç”»", "draw", "Draw"],
</span><span class='line'>      "port": "3000",
</span><span class='line'>      "dingtalk_token": "d55566a9e90...",
</span><span class='line'>      "dingtalk_post_token": "",
</span><span class='line'>      "dingtalk_secret": "PUMsK......"
</span><span class='line'>    },
</span><span class='line'>  </span></code></pre></td></tr></table></div></figure>


<p>å¯åŠ¨æœåŠ¡ï¼Œæ„‰å¿«çš„è€èµ·æ¥ã€‚</p>

<h2>ç¬¬å››æ­¥ å°å°æ”¹è¿›</h2>

<p>åœ¨æµ‹è¯•å›¾ç‰‡æ¶ˆæ¯çš„æ—¶åˆ»ï¼Œå‘ç°è¿˜ä¸å¤ªæ”¯æŒï¼Œè¿˜æœ‰å›å¤æ¶ˆæ¯atæé—®çš„äººä¹Ÿå°å°æ”¹è¿›äº†ä¸€ä¸‹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat dingtalk_channel.py 
</span><span class='line'># encoding:utf-8
</span><span class='line'>import json
</span><span class='line'>import hmac
</span><span class='line'>import hashlib
</span><span class='line'>import base64
</span><span class='line'>import time
</span><span class='line'>import requests
</span><span class='line'>from urllib.parse import quote_plus
</span><span class='line'>from common import log
</span><span class='line'>from flask import Flask, request, render_template, make_response
</span><span class='line'>from common import const
</span><span class='line'>from common import functions
</span><span class='line'>from config import channel_conf
</span><span class='line'>from config import channel_conf_val
</span><span class='line'>from channel.channel import Channel
</span><span class='line'>
</span><span class='line'>class DingTalkChannel(Channel):
</span><span class='line'>    def __init__(self):
</span><span class='line'>        self.dingtalk_token = channel_conf(const.DINGTALK).get('dingtalk_token')
</span><span class='line'>        self.dingtalk_post_token = channel_conf(const.DINGTALK).get('dingtalk_post_token')
</span><span class='line'>        self.dingtalk_secret = channel_conf(const.DINGTALK).get('dingtalk_secret')
</span><span class='line'>        log.info("[DingTalk] dingtalk_secret={}, dingtalk_token={} dingtalk_post_token={}".format(self.dingtalk_secret, self.dingtalk_token, self.dingtalk_post_token))
</span><span class='line'>
</span><span class='line'>    def startup(self):
</span><span class='line'>        http_app.run(host='0.0.0.0', port=channel_conf(const.DINGTALK).get('port'))
</span><span class='line'>        
</span><span class='line'>    def notify_dingtalk(self, data):
</span><span class='line'>        timestamp = round(time.time() * 1000)
</span><span class='line'>        secret_enc = bytes(self.dingtalk_secret, encoding='utf-8')
</span><span class='line'>        string_to_sign = '{}\n{}'.format(timestamp, self.dingtalk_secret)
</span><span class='line'>        string_to_sign_enc = bytes(string_to_sign, encoding='utf-8')
</span><span class='line'>        hmac_code = hmac.new(secret_enc, string_to_sign_enc,
</span><span class='line'>                             digestmod=hashlib.sha256).digest()
</span><span class='line'>        sign = quote_plus(base64.b64encode(hmac_code))
</span><span class='line'>
</span><span class='line'>        notify_url = f"https://oapi.dingtalk.com/robot/send?access_token={self.dingtalk_token}&timestamp={timestamp}&sign={sign}"
</span><span class='line'>        try:
</span><span class='line'>            r = requests.post(notify_url, json=data)
</span><span class='line'>            reply = r.json()
</span><span class='line'>            # log.info("[DingTalk] reply={}".format(str(reply)))
</span><span class='line'>        except Exception as e:
</span><span class='line'>            log.error(e)
</span><span class='line'>
</span><span class='line'>    def handle(self, resp):
</span><span class='line'>        reply = "æ‚¨å¥½ï¼Œæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©æ‚¨è§£ç­”çš„é—®é¢˜å—ï¼Ÿ"
</span><span class='line'>        prompt = resp['text']['content']
</span><span class='line'>        prompt = prompt.strip()
</span><span class='line'>        if str(prompt) != 0:
</span><span class='line'>            conversation_id = resp['conversationId']
</span><span class='line'>            sender_id = resp['senderId']
</span><span class='line'>            context = dict()
</span><span class='line'>            img_match_prefix = functions.check_prefix(
</span><span class='line'>                prompt, channel_conf_val(const.DINGTALK, 'image_create_prefix'))
</span><span class='line'>            if img_match_prefix:
</span><span class='line'>                prompt = prompt.split(img_match_prefix, 1)[1].strip()
</span><span class='line'>                context['type'] = 'IMAGE_CREATE'
</span><span class='line'>            id = sender_id
</span><span class='line'>            nick = resp['senderNick']
</span><span class='line'>            staffid = resp['senderStaffId']
</span><span class='line'>            context['from_user_id'] = str(id)
</span><span class='line'>            reply = super().build_reply_content(prompt, context)
</span><span class='line'>        if img_match_prefix and isinstance(reply, list):
</span><span class='line'>            images = ""
</span><span class='line'>            for url in reply:
</span><span class='line'>                images += f"!['IMAGE_CREATE']({url})\n"
</span><span class='line'>            reply = images
</span><span class='line'>            resp = {
</span><span class='line'>                "msgtype": "markdown",
</span><span class='line'>                "markdown": {
</span><span class='line'>                    "title": "IMAGE @" + nick + " ", 
</span><span class='line'>                    "text": images + " \n " + "@" + nick
</span><span class='line'>                },
</span><span class='line'>                "at": {
</span><span class='line'>                    "atUserIds": [
</span><span class='line'>                        staffid
</span><span class='line'>                    ],
</span><span class='line'>                    "isAtAll": False
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        else:
</span><span class='line'>            resp = {
</span><span class='line'>                "msgtype": "text",
</span><span class='line'>                "text": {
</span><span class='line'>                    "content": reply
</span><span class='line'>                },
</span><span class='line'>                "at": {
</span><span class='line'>                    "atUserIds": [
</span><span class='line'>                       staffid 
</span><span class='line'>                    ],
</span><span class='line'>                    "isAtAll": False
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        return resp 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>dd = DingTalkChannel()
</span><span class='line'>http_app = Flask(__name__,)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>@http_app.route("/", methods=['POST'])
</span><span class='line'>def chat():
</span><span class='line'>    log.info("[DingTalk] chat_headers={}".format(str(request.headers)))
</span><span class='line'>    log.info("[DingTalk] chat={}".format(str(request.data)))
</span><span class='line'>    token = request.headers.get('token')
</span><span class='line'>    if dd.dingtalk_post_token and token != dd.dingtalk_post_token:
</span><span class='line'>        return {'ret': 203}
</span><span class='line'>    data = json.loads(request.data)
</span><span class='line'>    if data:
</span><span class='line'>        content = data['text']['content']
</span><span class='line'>        if not content:
</span><span class='line'>            return
</span><span class='line'>        reply = dd.handle(resp=data);
</span><span class='line'>        dd.notify_dingtalk(reply)
</span><span class='line'>        return {'ret': 200}
</span><span class='line'>    return {'ret': 201}
</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æ ‘è“æ´¾4å®‰è£…Clash]]></title>
    <link href="http://winse.github.io/blog/2023/03/26/clash-on-raspberry4/"/>
    <updated>2023-03-26T00:31:01+08:00</updated>
    <id>http://winse.github.io/blog/2023/03/26/clash-on-raspberry4</id>
    <content type="html"><![CDATA[<h2>å®‰è£…Clash</h2>

<p>å‚è€ƒï¼š<a href="https://mraddict.top/posts/clash-on-rpi/">https://mraddict.top/posts/clash-on-rpi/</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@ubuntu:~# arch
</span><span class='line'>
</span><span class='line'># ä¸‹è½½ä¸Šä¼ clash
</span><span class='line'>root@ubuntu:~# mv clash-linux-arm64 /usr/local/bin/
</span><span class='line'>
</span><span class='line'>root@ubuntu:~# cd /usr/local/bin/
</span><span class='line'>root@ubuntu:/usr/local/bin# chmod +x clash-linux-arm64 
</span><span class='line'>root@ubuntu:/usr/local/bin# ln -s clash-linux-arm64 clash
</span><span class='line'>root@ubuntu:/usr/local/bin# ls clash*
</span><span class='line'>clash  clash-linux-arm64
</span><span class='line'>root@ubuntu:/usr/local/bin# ls -l clash*
</span><span class='line'>lrwxrwxrwx 1 root root      17 Mar 24 21:43 clash -&gt; clash-linux-arm64
</span><span class='line'>-rwxr-xr-x 1 root root 8978432 Jan 29 18:59 clash-linux-arm64
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># å¯åŠ¨ä¸€æ¬¡ï¼Œä¼šç”Ÿæˆé…ç½®å’Œä¸‹è½½Country.mmdbæ–‡ä»¶ï¼š
</span><span class='line'>root@ubuntu:/usr/local/bin# clash
</span><span class='line'>INFO[0000] Can't find config, create a initial config file 
</span><span class='line'>INFO[0000] Can't find MMDB, start download              
</span><span class='line'>INFO[0344] Mixed(http+socks) proxy listening at: 127.0.0.1:7890 
</span><span class='line'>
</span><span class='line'># clash-ui
</span><span class='line'>root@ubuntu:/usr/local/bin# cd ~/.config/clash
</span><span class='line'>root@ubuntu:~/.config/clash# git clone --branch gh-pages https://github.com/Dreamacro/clash-dashboard.git    
</span><span class='line'>Cloning into 'clash-dashboard'...
</span><span class='line'>remote: Enumerating objects: 3951, done.
</span><span class='line'>remote: Counting objects: 100% (232/232), done.
</span><span class='line'>remote: Compressing objects: 100% (172/172), done.
</span><span class='line'>remote: Total 3951 (delta 79), reused 189 (delta 56), pack-reused 3719
</span><span class='line'>Receiving objects: 100% (3951/3951), 4.87 MiB | 21.00 KiB/s, done.
</span><span class='line'>Resolving deltas: 100% (2240/2240), done.
</span></code></pre></td></tr></table></div></figure>


<p>é…ç½®ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## é…ç½®æ–‡ä»¶ï¼šhttps://github.com/Dreamacro/clash/wiki/Configuration#introduction
</span><span class='line'>## ä¸‹è½½æœåŠ¡æä¾›çš„è®¢é˜…åœ°å€å†…å®¹ï¼Œä¿å­˜åˆ°æ–‡ä»¶ã€‚
</span><span class='line'>
</span><span class='line'>root@ubuntu:~/.config/clash# ln -s Clash_1679667989.yaml config.yaml
</span><span class='line'>root@ubuntu:~/.config/clash# vi config.yaml 
</span><span class='line'>  11 mode: rule
</span><span class='line'>  12 log-level: debug
</span><span class='line'>  13 external-ui: clash-dashboard
</span><span class='line'>  14 external-controller: '0.0.0.0:9090'
</span><span class='line'>  
</span><span class='line'>
</span><span class='line'>root@ubuntu:~/.config/clash# clash
</span><span class='line'>INFO[0000] Start initial compatible provider ğŸ¬å“”å“©å“”å“©      
</span><span class='line'>INFO[0000] Start initial compatible provider âš“ï¸å…¶ä»–æµé‡     
</span><span class='line'>INFO[0000] Start initial compatible provider âœˆï¸Telegram 
</span><span class='line'>INFO[0000] Start initial compatible provider ğŸ¬Netflix   
</span><span class='line'>INFO[0000] Start initial compatible provider ğŸè‹¹æœæœåŠ¡      
</span><span class='line'>INFO[0000] Start initial compatible provider ğŸ¬Youtube   
</span><span class='line'>INFO[0000] Start initial compatible provider ğŸ¬å›½å¤–åª’ä½“      
</span><span class='line'>INFO[0000] Start initial compatible provider ğŸš€ç›´æ¥è¿æ¥      
</span><span class='line'>INFO[0000] Start initial compatible provider ğŸ”°å›½å¤–æµé‡      
</span><span class='line'>INFO[0000] Start initial compatible provider â“‚ï¸ å¾®è½¯æœåŠ¡    
</span><span class='line'>INFO[0000] HTTP proxy listening at: 127.0.0.1:7890      
</span><span class='line'>INFO[0000] RESTful API listening at: [::]:9090          
</span><span class='line'>INFO[0000] SOCKS proxy listening at: 127.0.0.1:7891     
</span><span class='line'>INFO[0000] Redirect proxy listening at: 127.0.0.1:7892 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># æ‰“å¼€ http://192.168.123.41:9090/ui/#/settings é¡µé¢åï¼Œæ·»åŠ ä¸€ä¸‹æœåŠ¡å™¨çš„ipåœ°å€ï¼Œå°±å¯ä»¥è®¿é—®äº†ã€‚
</span></code></pre></td></tr></table></div></figure>


<h2>å®‰è£…conda</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
<span class='line-number'>325</span>
<span class='line-number'>326</span>
<span class='line-number'>327</span>
<span class='line-number'>328</span>
<span class='line-number'>329</span>
<span class='line-number'>330</span>
<span class='line-number'>331</span>
<span class='line-number'>332</span>
<span class='line-number'>333</span>
<span class='line-number'>334</span>
<span class='line-number'>335</span>
<span class='line-number'>336</span>
<span class='line-number'>337</span>
<span class='line-number'>338</span>
<span class='line-number'>339</span>
<span class='line-number'>340</span>
<span class='line-number'>341</span>
<span class='line-number'>342</span>
<span class='line-number'>343</span>
<span class='line-number'>344</span>
<span class='line-number'>345</span>
<span class='line-number'>346</span>
<span class='line-number'>347</span>
<span class='line-number'>348</span>
<span class='line-number'>349</span>
<span class='line-number'>350</span>
<span class='line-number'>351</span>
<span class='line-number'>352</span>
<span class='line-number'>353</span>
<span class='line-number'>354</span>
<span class='line-number'>355</span>
<span class='line-number'>356</span>
<span class='line-number'>357</span>
<span class='line-number'>358</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ç”¨ä»£ç†ä¸‹è½½åé¢çš„æ•°æ®
</span><span class='line'>root@ubuntu:~# export http_proxy="http://127.0.0.1:7890"
</span><span class='line'>root@ubuntu:~# export https_proxy="http://127.0.0.1:7890"
</span><span class='line'>
</span><span class='line'>root@ubuntu:~# wget https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-aarch64.sh     
</span><span class='line'>--2023-03-24 23:16:35--  https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-aarch64.sh
</span><span class='line'>Connecting to 127.0.0.1:7890... connected.
</span><span class='line'>Proxy request sent, awaiting response... 302 Found
</span><span class='line'>Location: https://github.com/conda-forge/miniforge/releases/download/22.11.1-4/Miniforge3-Linux-aarch64.sh [following]
</span><span class='line'>--2023-03-24 23:16:35--  https://github.com/conda-forge/miniforge/releases/download/22.11.1-4/Miniforge3-Linux-aarch64.sh
</span><span class='line'>Reusing existing connection to github.com:443.
</span><span class='line'>Proxy request sent, awaiting response... 302 Found
</span><span class='line'>Location: https://objects.githubusercontent.com/github-production-release-asset-2e65be/221584272/97169057-ca90-4fce-873e-a7d6d2e1db90?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20230324%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20230324T151635Z&X-Amz-Expires=300&X-Amz-Signature=c46561816462b1e2bcd82d8b99f8ce840f4ff9b6214fda083828079783d43f0f&X-Amz-SignedHeaders=host&actor_id=0&key_id=0&repo_id=221584272&response-content-disposition=attachment%3B%20filename%3DMiniforge3-Linux-aarch64.sh&response-content-type=application%2Foctet-stream [following]
</span><span class='line'>--2023-03-24 23:16:36--  https://objects.githubusercontent.com/github-production-release-asset-2e65be/221584272/97169057-ca90-4fce-873e-a7d6d2e1db90?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20230324%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20230324T151635Z&X-Amz-Expires=300&X-Amz-Signature=c46561816462b1e2bcd82d8b99f8ce840f4ff9b6214fda083828079783d43f0f&X-Amz-SignedHeaders=host&actor_id=0&key_id=0&repo_id=221584272&response-content-disposition=attachment%3B%20filename%3DMiniforge3-Linux-aarch64.sh&response-content-type=application%2Foctet-stream
</span><span class='line'>Connecting to 127.0.0.1:7890... connected.
</span><span class='line'>Proxy request sent, awaiting response... 200 OK
</span><span class='line'>Length: 53550114 (51M) [application/octet-stream]
</span><span class='line'>Saving to: â€˜Miniforge3-Linux-aarch64.sh.1â€™
</span><span class='line'>
</span><span class='line'>Miniforge3-Linux-aarch64.sh.1                    1%[&gt;                                                                                                  ] 752.00K  9.01KB/s    in 74s     
</span><span class='line'>
</span><span class='line'>2023-03-24 23:17:51 (10.2 KB/s) - Connection closed at byte 770048. Retrying.
</span><span class='line'>
</span><span class='line'>## é»˜è®¤ç”¨çš„æ˜¯directï¼Œæ²¡æœ‰ç¿»å¢™ã€‚åœ¨9090/uié¡µé¢å…ˆæŠŠåŸæ¥çš„[è¿æ¥]åœæ‰ï¼Œç„¶åæŠŠ[ä»£ç†]åˆ‡æ¢åˆ°é¦™æ¸¯çš„èŠ‚ç‚¹
</span><span class='line'>
</span><span class='line'>--2023-03-24 23:17:52--  (try: 2)  https://objects.githubusercontent.com/github-production-release-asset-2e65be/221584272/97169057-ca90-4fce-873e-a7d6d2e1db90?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20230324%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20230324T151635Z&X-Amz-Expires=300&X-Amz-Signature=c46561816462b1e2bcd82d8b99f8ce840f4ff9b6214fda083828079783d43f0f&X-Amz-SignedHeaders=host&actor_id=0&key_id=0&repo_id=221584272&response-content-disposition=attachment%3B%20filename%3DMiniforge3-Linux-aarch64.sh&response-content-type=application%2Foctet-stream
</span><span class='line'>Connecting to 127.0.0.1:7890... connected.
</span><span class='line'>Proxy request sent, awaiting response... 206 Partial Content
</span><span class='line'>Length: 53550114 (51M), 52780066 (50M) remaining [application/octet-stream]
</span><span class='line'>Saving to: â€˜Miniforge3-Linux-aarch64.sh.1â€™
</span><span class='line'>
</span><span class='line'>Miniforge3-Linux-aarch64.sh.1                  100%[+=================================================================================================&gt;]  51.07M  2.79MB/s    in 21s     
</span><span class='line'>
</span><span class='line'>2023-03-24 23:18:14 (2.39 MB/s) - â€˜Miniforge3-Linux-aarch64.sh.1â€™ saved [53550114/53550114]
</span><span class='line'>
</span><span class='line'>root@ubuntu:~# 
</span><span class='line'>
</span><span class='line'>root@ubuntu:~# rm -rf Miniforge3-Linux-aarch64.sh
</span><span class='line'>root@ubuntu:~# mv Miniforge3-Linux-aarch64.sh.1 Miniforge3-Linux-aarch64.sh
</span><span class='line'>root@ubuntu:~# chmod +x Miniforge3-Linux-aarch64.sh
</span><span class='line'>
</span><span class='line'>root@ubuntu:~# rm -rf /usr/local/miniforge3
</span><span class='line'>root@ubuntu:~# ./Miniforge3-Linux-aarch64.sh 
</span><span class='line'>
</span><span class='line'>Welcome to Miniforge3 22.11.1-4
</span><span class='line'>
</span><span class='line'>In order to continue the installation process, please review the license
</span><span class='line'>agreement.
</span><span class='line'>Please, press ENTER to continue
</span><span class='line'>&gt;&gt;&gt;  
</span><span class='line'>Miniforge installer code uses BSD-3-Clause license as stated below.
</span><span class='line'>
</span><span class='line'>Binary packages that come with it have their own licensing terms
</span><span class='line'>and by installing miniforge you agree to the licensing terms of individual
</span><span class='line'>packages as well. They include different OSI-approved licenses including
</span><span class='line'>the GNU General Public License and can be found in pkgs/&lt;pkg-name&gt;/info/licenses
</span><span class='line'>folders.
</span><span class='line'>
</span><span class='line'>Miniforge installer comes with a boostrapping executable that is used
</span><span class='line'>when installing miniforge and is deleted after miniforge is installed.
</span><span class='line'>The bootstrapping executable uses micromamba, cli11, cpp-filesystem,
</span><span class='line'>curl, c-ares, krb5, libarchive, libev, lz4, nghttp2, openssl, libsolv,
</span><span class='line'>nlohmann-json, reproc and zstd which are licensed under BSD-3-Clause,
</span><span class='line'>MIT and OpenSSL licenses. Licenses and copyright notices of these
</span><span class='line'>projects can be found at the following URL.
</span><span class='line'>https://github.com/conda-forge/micromamba-feedstock/tree/master/recipe.
</span><span class='line'>
</span><span class='line'>=============================================================================
</span><span class='line'>
</span><span class='line'>Copyright (c) 2019-2022, conda-forge
</span><span class='line'>All rights reserved.
</span><span class='line'>
</span><span class='line'>Redistribution and use in source and binary forms, with or without
</span><span class='line'>modification, are permitted provided that the following conditions are met:
</span><span class='line'>
</span><span class='line'>1. Redistributions of source code must retain the above copyright notice, this
</span><span class='line'>list of conditions and the following disclaimer.
</span><span class='line'>
</span><span class='line'>2. Redistributions in binary form must reproduce the above copyright notice,
</span><span class='line'>this list of conditions and the following disclaimer in the documentation
</span><span class='line'>and/or other materials provided with the distribution.
</span><span class='line'>
</span><span class='line'>3. Neither the name of the copyright holder nor the names of its contributors
</span><span class='line'>may be used to endorse or promote products derived from this software without
</span><span class='line'>specific prior written permission.
</span><span class='line'>
</span><span class='line'>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
</span><span class='line'>ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
</span><span class='line'>WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
</span><span class='line'>DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
</span><span class='line'>FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
</span><span class='line'>DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
</span><span class='line'>SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
</span><span class='line'>CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
</span><span class='line'>OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
</span><span class='line'>OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Do you accept the license terms? [yes|no]
</span><span class='line'>[no] &gt;&gt;&gt; yes
</span><span class='line'>
</span><span class='line'>Miniforge3 will now be installed into this location:
</span><span class='line'>/root/miniforge3
</span><span class='line'>
</span><span class='line'>  - Press ENTER to confirm the location
</span><span class='line'>  - Press CTRL-C to abort the installation
</span><span class='line'>  - Or specify a different location below
</span><span class='line'>
</span><span class='line'>[/root/miniforge3] &gt;&gt;&gt; /usr/local/miniforge3   
</span><span class='line'>PREFIX=/usr/local/miniforge3
</span><span class='line'>Unpacking payload ...
</span><span class='line'>Extracting ca-certificates-2022.12.7-h4fd8a4c_0.conda
</span><span class='line'>Extracting ld_impl_linux-aarch64-2.40-h2d8c526_0.conda
</span><span class='line'>Extracting libgomp-12.2.0-h607ecd0_19.tar.bz2
</span><span class='line'>Extracting libstdcxx-ng-12.2.0-hc13a102_19.tar.bz2
</span><span class='line'>Extracting python_abi-3.10-3_cp310.conda
</span><span class='line'>Extracting tzdata-2022g-h191b570_0.conda
</span><span class='line'>Extracting _openmp_mutex-4.5-2_gnu.tar.bz2
</span><span class='line'>Extracting libgcc-ng-12.2.0-h607ecd0_19.tar.bz2
</span><span class='line'>Extracting bzip2-1.0.8-hf897c2e_4.tar.bz2
</span><span class='line'>Extracting libffi-3.4.2-h3557bc0_5.tar.bz2
</span><span class='line'>Extracting libnsl-2.0.0-hf897c2e_0.tar.bz2
</span><span class='line'>Extracting libuuid-2.32.1-hf897c2e_1000.tar.bz2
</span><span class='line'>Extracting libzlib-1.2.13-h4e544f5_4.tar.bz2
</span><span class='line'>Extracting ncurses-6.3-headf329_1.tar.bz2
</span><span class='line'>Extracting openssl-3.0.8-hb4cce97_0.conda
</span><span class='line'>Extracting xz-5.2.6-h9cdd2b7_0.tar.bz2
</span><span class='line'>Extracting libsqlite-3.40.0-hf9034f9_0.tar.bz2
</span><span class='line'>Extracting readline-8.1.2-h38e3740_0.tar.bz2
</span><span class='line'>Extracting tk-8.6.12-hd8af866_0.tar.bz2
</span><span class='line'>Extracting zstd-1.5.2-h44f6412_6.conda
</span><span class='line'>Extracting python-3.10.9-ha43d526_0_cpython.conda
</span><span class='line'>Extracting certifi-2022.12.7-pyhd8ed1ab_0.conda
</span><span class='line'>Extracting charset-normalizer-2.1.1-pyhd8ed1ab_0.tar.bz2
</span><span class='line'>Extracting colorama-0.4.6-pyhd8ed1ab_0.tar.bz2
</span><span class='line'>Extracting idna-3.4-pyhd8ed1ab_0.tar.bz2
</span><span class='line'>Extracting pluggy-1.0.0-pyhd8ed1ab_5.tar.bz2
</span><span class='line'>Extracting pycosat-0.6.4-py310h761cc84_1.tar.bz2
</span><span class='line'>Extracting pycparser-2.21-pyhd8ed1ab_0.tar.bz2
</span><span class='line'>Extracting pysocks-1.7.1-pyha2e5f31_6.tar.bz2
</span><span class='line'>Extracting ruamel.yaml.clib-0.2.7-py310hb89b984_1.conda
</span><span class='line'>Extracting setuptools-65.6.3-pyhd8ed1ab_0.conda
</span><span class='line'>Extracting toolz-0.12.0-pyhd8ed1ab_0.tar.bz2
</span><span class='line'>Extracting wheel-0.38.4-pyhd8ed1ab_0.tar.bz2
</span><span class='line'>Extracting cffi-1.15.1-py310hf0c4615_3.conda
</span><span class='line'>Extracting pip-23.0-pyhd8ed1ab_0.conda
</span><span class='line'>Extracting ruamel.yaml-0.17.21-py310h761cc84_2.tar.bz2
</span><span class='line'>Extracting tqdm-4.64.1-pyhd8ed1ab_0.tar.bz2
</span><span class='line'>Extracting brotlipy-0.7.0-py310h761cc84_1005.tar.bz2
</span><span class='line'>Extracting cryptography-39.0.1-py310he4ba0b1_0.conda
</span><span class='line'>Extracting zstandard-0.19.0-py310hde4b81c_1.conda
</span><span class='line'>Extracting conda-package-streaming-0.7.0-pyhd8ed1ab_1.conda
</span><span class='line'>Extracting pyopenssl-23.0.0-pyhd8ed1ab_0.conda
</span><span class='line'>Extracting conda-package-handling-2.0.2-pyh38be061_0.conda
</span><span class='line'>Extracting urllib3-1.26.14-pyhd8ed1ab_0.conda
</span><span class='line'>Extracting requests-2.28.2-pyhd8ed1ab_0.conda
</span><span class='line'>Extracting conda-22.11.1-py310h4c7bcd0_1.conda
</span><span class='line'>
</span><span class='line'>Installing base environment...
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>                                           __
</span><span class='line'>          __  ______ ___  ____ _____ ___  / /_  ____ _
</span><span class='line'>         / / / / __ `__ \/ __ `/ __ `__ \/ __ \/ __ `/
</span><span class='line'>        / /_/ / / / / / / /_/ / / / / / / /_/ / /_/ /
</span><span class='line'>       / .___/_/ /_/ /_/\__,_/_/ /_/ /_/_.___/\__,_/
</span><span class='line'>      /_/
</span><span class='line'>
</span><span class='line'>Transaction
</span><span class='line'>
</span><span class='line'>  Prefix: /usr/local/miniforge3
</span><span class='line'>
</span><span class='line'>  Updating specs:
</span><span class='line'>
</span><span class='line'>   - conda-forge/linux-aarch64::ca-certificates==2022.12.7=h4fd8a4c_0[md5=2450fbcaf65634e0d071e47e2b8487b4]
</span><span class='line'>   - conda-forge/linux-aarch64::ld_impl_linux-aarch64==2.40=h2d8c526_0[md5=16246d69e945d0b1969a6099e7c5d457]
</span><span class='line'>   - conda-forge/linux-aarch64::libgomp==12.2.0=h607ecd0_19[md5=65b9cb876525dcb2e74a90cf02c6762a]
</span><span class='line'>   - conda-forge/linux-aarch64::libstdcxx-ng==12.2.0=hc13a102_19[md5=981741cd4321edd5c504b48f74fe91f2]
</span><span class='line'>   - conda-forge/linux-aarch64::python_abi==3.10=3_cp310[md5=7f4f00b03d3a7c4d4b8b987e5da461a9]
</span><span class='line'>   - conda-forge/noarch::tzdata==2022g=h191b570_0[md5=51fc4fcfb19f5d95ffc8c339db5068e8]
</span><span class='line'>   - conda-forge/linux-aarch64::_openmp_mutex==4.5=2_gnu[md5=6168d71addc746e8f2b8d57dfd2edcea]
</span><span class='line'>   - conda-forge/linux-aarch64::libgcc-ng==12.2.0=h607ecd0_19[md5=8456a29b6d9fc3123ccb9a966b6b2c49]
</span><span class='line'>   - conda-forge/linux-aarch64::bzip2==1.0.8=hf897c2e_4[md5=2d787570a729e273a4e75775ddf3348a]
</span><span class='line'>   - conda-forge/linux-aarch64::libffi==3.4.2=h3557bc0_5[md5=dddd85f4d52121fab0a8b099c5e06501]
</span><span class='line'>   - conda-forge/linux-aarch64::libnsl==2.0.0=hf897c2e_0[md5=36fdbc05c9d9145ece86f5a63c3f352e]
</span><span class='line'>   - conda-forge/linux-aarch64::libuuid==2.32.1=hf897c2e_1000[md5=e038da5ef9095b0d79aac14a311394e7]
</span><span class='line'>   - conda-forge/linux-aarch64::libzlib==1.2.13=h4e544f5_4[md5=88596b6277fe6d39f046983aae6044db]
</span><span class='line'>   - conda-forge/linux-aarch64::ncurses==6.3=headf329_1[md5=486b68148e121bc8bbadc3cefae4c04f]
</span><span class='line'>   - conda-forge/linux-aarch64::openssl==3.0.8=hb4cce97_0[md5=268fe30a14a3f40fe54da04fc053fd2d]
</span><span class='line'>   - conda-forge/linux-aarch64::xz==5.2.6=h9cdd2b7_0[md5=83baad393a31d59c20b63ba4da6592df]
</span><span class='line'>   - conda-forge/linux-aarch64::libsqlite==3.40.0=hf9034f9_0[md5=9afb0d5dbaa403858a660cd0b4a31d29]
</span><span class='line'>   - conda-forge/linux-aarch64::readline==8.1.2=h38e3740_0[md5=3cdbfb7d7b63ae2c2d35bb167d257ecd]
</span><span class='line'>   - conda-forge/linux-aarch64::tk==8.6.12=hd8af866_0[md5=7894e82ff743bd96c76585ddebe28e2a]
</span><span class='line'>   - conda-forge/linux-aarch64::zstd==1.5.2=h44f6412_6[md5=6d0d1cd6d184129eabb96bb220afb5b2]
</span><span class='line'>   - conda-forge/linux-aarch64::python==3.10.9=ha43d526_0_cpython[md5=24478dd738f2d557efe2a4fc6a248eb3]
</span><span class='line'>   - conda-forge/noarch::certifi==2022.12.7=pyhd8ed1ab_0[md5=fb9addc3db06e56abe03e0e9f21a63e6]
</span><span class='line'>   - conda-forge/noarch::charset-normalizer==2.1.1=pyhd8ed1ab_0[md5=c1d5b294fbf9a795dec349a6f4d8be8e]
</span><span class='line'>   - conda-forge/noarch::colorama==0.4.6=pyhd8ed1ab_0[md5=3faab06a954c2a04039983f2c4a50d99]
</span><span class='line'>   - conda-forge/noarch::idna==3.4=pyhd8ed1ab_0[md5=34272b248891bddccc64479f9a7fffed]
</span><span class='line'>   - conda-forge/noarch::pluggy==1.0.0=pyhd8ed1ab_5[md5=7d301a0d25f424d96175f810935f0da9]
</span><span class='line'>   - conda-forge/linux-aarch64::pycosat==0.6.4=py310h761cc84_1[md5=c701cff6d6e7907c93ab603e58082a7c]
</span><span class='line'>   - conda-forge/noarch::pycparser==2.21=pyhd8ed1ab_0[md5=076becd9e05608f8dc72757d5f3a91ff]
</span><span class='line'>   - conda-forge/noarch::pysocks==1.7.1=pyha2e5f31_6[md5=2a7de29fb590ca14b5243c4c812c8025]
</span><span class='line'>   - conda-forge/linux-aarch64::ruamel.yaml.clib==0.2.7=py310hb89b984_1[md5=89972c78c36ed3261c22bde7c012be03]
</span><span class='line'>   - conda-forge/noarch::setuptools==65.6.3=pyhd8ed1ab_0[md5=9600fc9524d3f821e6a6d58c52f5bf5a]
</span><span class='line'>   - conda-forge/noarch::toolz==0.12.0=pyhd8ed1ab_0[md5=92facfec94bc02d6ccf42e7173831a36]
</span><span class='line'>   - conda-forge/noarch::wheel==0.38.4=pyhd8ed1ab_0[md5=c829cfb8cb826acb9de0ac1a2df0a940]
</span><span class='line'>   - conda-forge/linux-aarch64::cffi==1.15.1=py310hf0c4615_3[md5=a2bedcb1d205485ea32fe5d2bd6fd970]
</span><span class='line'>   - conda-forge/noarch::pip==23.0=pyhd8ed1ab_0[md5=85b35999162ec95f9f999bac15279c02]
</span><span class='line'>   - conda-forge/linux-aarch64::ruamel.yaml==0.17.21=py310h761cc84_2[md5=98c0b13f20fcb4f5080554d137e39b37]
</span><span class='line'>   - conda-forge/noarch::tqdm==4.64.1=pyhd8ed1ab_0[md5=5526ff3f88f9db87bb0924b9ce575345]
</span><span class='line'>   - conda-forge/linux-aarch64::brotlipy==0.7.0=py310h761cc84_1005[md5=66934993368d01f896652925d3ac7e66]
</span><span class='line'>   - conda-forge/linux-aarch64::cryptography==39.0.1=py310he4ba0b1_0[md5=3129345d217e5fd6488df794e49e327b]
</span><span class='line'>   - conda-forge/linux-aarch64::zstandard==0.19.0=py310hde4b81c_1[md5=d4b3cc980179c38949c83fe23057d97c]
</span><span class='line'>   - conda-forge/noarch::conda-package-streaming==0.7.0=pyhd8ed1ab_1[md5=1a2fa9e53cfbc2e4d9ab21990805a436]
</span><span class='line'>   - conda-forge/noarch::pyopenssl==23.0.0=pyhd8ed1ab_0[md5=d41957700e83bbb925928764cb7f8878]
</span><span class='line'>   - conda-forge/noarch::conda-package-handling==2.0.2=pyh38be061_0[md5=44800e9bd13143292097c65e57323038]
</span><span class='line'>   - conda-forge/noarch::urllib3==1.26.14=pyhd8ed1ab_0[md5=01f33ad2e0aaf6b5ba4add50dad5ad29]
</span><span class='line'>   - conda-forge/noarch::requests==2.28.2=pyhd8ed1ab_0[md5=11d178fc55199482ee48d6812ea83983]
</span><span class='line'>   - conda-forge/linux-aarch64::conda==22.11.1=py310h4c7bcd0_1[md5=a71c4cc6bd77f61c0c1601b28291c460]
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  Package                      Version  Build               Channel           Size
</span><span class='line'>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</span><span class='line'>  Install:
</span><span class='line'>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</span><span class='line'>
</span><span class='line'>  + _openmp_mutex                  4.5  2_gnu               conda-forge     Cached
</span><span class='line'>  + brotlipy                     0.7.0  py310h761cc84_1005  conda-forge     Cached
</span><span class='line'>  + bzip2                        1.0.8  hf897c2e_4          conda-forge     Cached
</span><span class='line'>  + ca-certificates          2022.12.7  h4fd8a4c_0          conda-forge     Cached
</span><span class='line'>  + certifi                  2022.12.7  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + cffi                        1.15.1  py310hf0c4615_3     conda-forge     Cached
</span><span class='line'>  + charset-normalizer           2.1.1  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + colorama                     0.4.6  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + conda                      22.11.1  py310h4c7bcd0_1     conda-forge     Cached
</span><span class='line'>  + conda-package-handling       2.0.2  pyh38be061_0        conda-forge     Cached
</span><span class='line'>  + conda-package-streaming      0.7.0  pyhd8ed1ab_1        conda-forge     Cached
</span><span class='line'>  + cryptography                39.0.1  py310he4ba0b1_0     conda-forge     Cached
</span><span class='line'>  + idna                           3.4  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + ld_impl_linux-aarch64         2.40  h2d8c526_0          conda-forge     Cached
</span><span class='line'>  + libffi                       3.4.2  h3557bc0_5          conda-forge     Cached
</span><span class='line'>  + libgcc-ng                   12.2.0  h607ecd0_19         conda-forge     Cached
</span><span class='line'>  + libgomp                     12.2.0  h607ecd0_19         conda-forge     Cached
</span><span class='line'>  + libnsl                       2.0.0  hf897c2e_0          conda-forge     Cached
</span><span class='line'>  + libsqlite                   3.40.0  hf9034f9_0          conda-forge     Cached
</span><span class='line'>  + libstdcxx-ng                12.2.0  hc13a102_19         conda-forge     Cached
</span><span class='line'>  + libuuid                     2.32.1  hf897c2e_1000       conda-forge     Cached
</span><span class='line'>  + libzlib                     1.2.13  h4e544f5_4          conda-forge     Cached
</span><span class='line'>  + ncurses                        6.3  headf329_1          conda-forge     Cached
</span><span class='line'>  + openssl                      3.0.8  hb4cce97_0          conda-forge     Cached
</span><span class='line'>  + pip                           23.0  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + pluggy                       1.0.0  pyhd8ed1ab_5        conda-forge     Cached
</span><span class='line'>  + pycosat                      0.6.4  py310h761cc84_1     conda-forge     Cached
</span><span class='line'>  + pycparser                     2.21  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + pyopenssl                   23.0.0  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + pysocks                      1.7.1  pyha2e5f31_6        conda-forge     Cached
</span><span class='line'>  + python                      3.10.9  ha43d526_0_cpython  conda-forge     Cached
</span><span class='line'>  + python_abi                    3.10  3_cp310             conda-forge     Cached
</span><span class='line'>  + readline                     8.1.2  h38e3740_0          conda-forge     Cached
</span><span class='line'>  + requests                    2.28.2  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + ruamel.yaml                0.17.21  py310h761cc84_2     conda-forge     Cached
</span><span class='line'>  + ruamel.yaml.clib             0.2.7  py310hb89b984_1     conda-forge     Cached
</span><span class='line'>  + setuptools                  65.6.3  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + tk                          8.6.12  hd8af866_0          conda-forge     Cached
</span><span class='line'>  + toolz                       0.12.0  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + tqdm                        4.64.1  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + tzdata                       2022g  h191b570_0          conda-forge     Cached
</span><span class='line'>  + urllib3                    1.26.14  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + wheel                       0.38.4  pyhd8ed1ab_0        conda-forge     Cached
</span><span class='line'>  + xz                           5.2.6  h9cdd2b7_0          conda-forge     Cached
</span><span class='line'>  + zstandard                   0.19.0  py310hde4b81c_1     conda-forge     Cached
</span><span class='line'>  + zstd                         1.5.2  h44f6412_6          conda-forge     Cached
</span><span class='line'>
</span><span class='line'>  Summary:
</span><span class='line'>
</span><span class='line'>  Install: 46 packages
</span><span class='line'>
</span><span class='line'>  Total download: 0 B
</span><span class='line'>
</span><span class='line'>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Transaction starting
</span><span class='line'>Linking ca-certificates-2022.12.7-h4fd8a4c_0
</span><span class='line'>Linking ld_impl_linux-aarch64-2.40-h2d8c526_0
</span><span class='line'>Linking libgomp-12.2.0-h607ecd0_19
</span><span class='line'>Linking libstdcxx-ng-12.2.0-hc13a102_19
</span><span class='line'>Linking python_abi-3.10-3_cp310
</span><span class='line'>Linking tzdata-2022g-h191b570_0
</span><span class='line'>Linking _openmp_mutex-4.5-2_gnu
</span><span class='line'>Linking libgcc-ng-12.2.0-h607ecd0_19
</span><span class='line'>Linking bzip2-1.0.8-hf897c2e_4
</span><span class='line'>Linking libffi-3.4.2-h3557bc0_5
</span><span class='line'>Linking libnsl-2.0.0-hf897c2e_0
</span><span class='line'>Linking libuuid-2.32.1-hf897c2e_1000
</span><span class='line'>Linking libzlib-1.2.13-h4e544f5_4
</span><span class='line'>Linking ncurses-6.3-headf329_1
</span><span class='line'>Linking openssl-3.0.8-hb4cce97_0
</span><span class='line'>Linking xz-5.2.6-h9cdd2b7_0
</span><span class='line'>Linking libsqlite-3.40.0-hf9034f9_0
</span><span class='line'>Linking readline-8.1.2-h38e3740_0
</span><span class='line'>Linking tk-8.6.12-hd8af866_0
</span><span class='line'>Linking zstd-1.5.2-h44f6412_6
</span><span class='line'>Linking python-3.10.9-ha43d526_0_cpython
</span><span class='line'>Linking certifi-2022.12.7-pyhd8ed1ab_0
</span><span class='line'>Linking charset-normalizer-2.1.1-pyhd8ed1ab_0
</span><span class='line'>Linking colorama-0.4.6-pyhd8ed1ab_0
</span><span class='line'>Linking idna-3.4-pyhd8ed1ab_0
</span><span class='line'>Linking pluggy-1.0.0-pyhd8ed1ab_5
</span><span class='line'>Linking pycosat-0.6.4-py310h761cc84_1
</span><span class='line'>Linking pycparser-2.21-pyhd8ed1ab_0
</span><span class='line'>Linking pysocks-1.7.1-pyha2e5f31_6
</span><span class='line'>Linking ruamel.yaml.clib-0.2.7-py310hb89b984_1
</span><span class='line'>Linking setuptools-65.6.3-pyhd8ed1ab_0
</span><span class='line'>Linking toolz-0.12.0-pyhd8ed1ab_0
</span><span class='line'>Linking wheel-0.38.4-pyhd8ed1ab_0
</span><span class='line'>Linking cffi-1.15.1-py310hf0c4615_3
</span><span class='line'>Linking pip-23.0-pyhd8ed1ab_0
</span><span class='line'>Linking ruamel.yaml-0.17.21-py310h761cc84_2
</span><span class='line'>Linking tqdm-4.64.1-pyhd8ed1ab_0
</span><span class='line'>Linking brotlipy-0.7.0-py310h761cc84_1005
</span><span class='line'>Linking cryptography-39.0.1-py310he4ba0b1_0
</span><span class='line'>Linking zstandard-0.19.0-py310hde4b81c_1
</span><span class='line'>Linking conda-package-streaming-0.7.0-pyhd8ed1ab_1
</span><span class='line'>Linking pyopenssl-23.0.0-pyhd8ed1ab_0
</span><span class='line'>Linking conda-package-handling-2.0.2-pyh38be061_0
</span><span class='line'>Linking urllib3-1.26.14-pyhd8ed1ab_0
</span><span class='line'>Linking requests-2.28.2-pyhd8ed1ab_0
</span><span class='line'>Linking conda-22.11.1-py310h4c7bcd0_1
</span><span class='line'>Transaction finished
</span><span class='line'>installation finished.
</span><span class='line'>Do you wish the installer to initialize Miniforge3
</span><span class='line'>by running conda init? [yes|no]
</span><span class='line'>[no] &gt;&gt;&gt; yes
</span><span class='line'>no change     /usr/local/miniforge3/condabin/conda
</span><span class='line'>no change     /usr/local/miniforge3/bin/conda
</span><span class='line'>no change     /usr/local/miniforge3/bin/conda-env
</span><span class='line'>no change     /usr/local/miniforge3/bin/activate
</span><span class='line'>no change     /usr/local/miniforge3/bin/deactivate
</span><span class='line'>no change     /usr/local/miniforge3/etc/profile.d/conda.sh
</span><span class='line'>no change     /usr/local/miniforge3/etc/fish/conf.d/conda.fish
</span><span class='line'>no change     /usr/local/miniforge3/shell/condabin/Conda.psm1
</span><span class='line'>no change     /usr/local/miniforge3/shell/condabin/conda-hook.ps1
</span><span class='line'>no change     /usr/local/miniforge3/lib/python3.10/site-packages/xontrib/conda.xsh
</span><span class='line'>no change     /usr/local/miniforge3/etc/profile.d/conda.csh
</span><span class='line'>modified      /root/.bashrc
</span><span class='line'>
</span><span class='line'>==&gt; For changes to take effect, close and re-open your current shell. &lt;==
</span><span class='line'>
</span><span class='line'>If you'd prefer that conda's base environment not be activated on startup, 
</span><span class='line'>   set the auto_activate_base parameter to false: 
</span><span class='line'>
</span><span class='line'>conda config --set auto_activate_base false
</span><span class='line'>
</span><span class='line'>Thank you for installing Miniforge3!
</span><span class='line'>root@ubuntu:~# 
</span></code></pre></td></tr></table></div></figure>


<p>è¿™é‡Œä¿®æ”¹äº† /root/.bashrc æ·»åŠ äº†ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># &gt;&gt;&gt; conda initialize &gt;&gt;&gt;
</span><span class='line'># !! Contents within this block are managed by 'conda init' !!
</span><span class='line'>__conda_setup="$('/usr/local/miniforge3/bin/conda' 'shell.bash' 'hook' 2&gt; /dev/null)"
</span><span class='line'>if [ $? -eq 0 ]; then
</span><span class='line'>    eval "$__conda_setup"
</span><span class='line'>else
</span><span class='line'>    if [ -f "/usr/local/miniforge3/etc/profile.d/conda.sh" ]; then
</span><span class='line'>        . "/usr/local/miniforge3/etc/profile.d/conda.sh"
</span><span class='line'>    else
</span><span class='line'>        export PATH="/usr/local/miniforge3/bin:$PATH"
</span><span class='line'>    fi
</span><span class='line'>fi
</span><span class='line'>unset __conda_setup
</span><span class='line'># &lt;&lt;&lt; conda initialize &lt;&lt;&lt;
</span></code></pre></td></tr></table></div></figure>


<p>ä¸ºäº†é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡ï¼Œæ–°å¼€ä¸€ä¸ªçª—å£ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(base) root@ubuntu:~# python -V
</span><span class='line'>Python 3.10.9
</span><span class='line'>(base) root@ubuntu:~# 
</span><span class='line'>(base) root@ubuntu:~# conda -V
</span><span class='line'>conda 22.11.1
</span><span class='line'>
</span><span class='line'>(base) root@ubuntu:~# python3
</span><span class='line'>Python 3.10.9 | packaged by conda-forge | (main, Feb  2 2023, 20:11:30) [GCC 11.3.0] on linux
</span><span class='line'>Type "help", "copyright", "credits" or "license" for more information.
</span><span class='line'>&gt;&gt;&gt; import platform
</span><span class='line'>&gt;&gt;&gt; platform.architecture()
</span><span class='line'>('64bit', 'ELF')
</span><span class='line'>&gt;&gt;&gt; </span></code></pre></td></tr></table></div></figure>


<p>ä½¿ç”¨condaæ–°å»ºä¸€ä¸ªpython3.8çš„é…ç½® &lt;<a href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html">https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html</a></p>

<blockquote><p>ï¼š</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(base) root@ubuntu:~# conda info --envs
</span><span class='line'># conda environments:
</span><span class='line'>#
</span><span class='line'>base                  *  /usr/local/miniforge3
</span><span class='line'>
</span><span class='line'>(base) root@ubuntu:~# export http_proxy="http://127.0.0.1:7890"
</span><span class='line'>(base) root@ubuntu:~# export https_proxy="http://127.0.0.1:7890" 
</span><span class='line'>
</span><span class='line'>(base) root@ubuntu:~# conda create -n openai python=3.8 
</span><span class='line'>Collecting package metadata (current_repodata.json): done
</span><span class='line'>Solving environment: done
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>==&gt; WARNING: A newer version of conda exists. &lt;==
</span><span class='line'>  current version: 22.11.1
</span><span class='line'>  latest version: 23.1.0
</span><span class='line'>
</span><span class='line'>Please update conda by running
</span><span class='line'>
</span><span class='line'>    $ conda update -n base -c conda-forge conda
</span><span class='line'>
</span><span class='line'>Or to minimize the number of packages updated during conda update use
</span><span class='line'>
</span><span class='line'>     conda install conda=23.1.0
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>## Package Plan ##
</span><span class='line'>
</span><span class='line'>  environment location: /usr/local/miniforge3/envs/openai
</span><span class='line'>
</span><span class='line'>  added / updated specs:
</span><span class='line'>    - python=3.8
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>The following packages will be downloaded:
</span><span class='line'>
</span><span class='line'>    package                    |            build
</span><span class='line'>    ---------------------------|-----------------
</span><span class='line'>    pypy3.8-7.3.11             |       hf9a8208_0        31.6 MB  conda-forge
</span><span class='line'>    ------------------------------------------------------------
</span><span class='line'>                                           Total:        31.6 MB
</span><span class='line'>
</span><span class='line'>The following NEW packages will be INSTALLED:
</span><span class='line'>
</span><span class='line'>  _openmp_mutex      conda-forge/linux-aarch64::_openmp_mutex-4.5-2_gnu 
</span><span class='line'>  bzip2              conda-forge/linux-aarch64::bzip2-1.0.8-hf897c2e_4 
</span><span class='line'>  ca-certificates    conda-forge/linux-aarch64::ca-certificates-2022.12.7-h4fd8a4c_0 
</span><span class='line'>  expat              conda-forge/linux-aarch64::expat-2.5.0-ha18d298_0 
</span><span class='line'>  gdbm               conda-forge/linux-aarch64::gdbm-1.18-h0a1914f_2 
</span><span class='line'>  libffi             conda-forge/linux-aarch64::libffi-3.4.2-h3557bc0_5 
</span><span class='line'>  libgcc-ng          conda-forge/linux-aarch64::libgcc-ng-12.2.0-h607ecd0_19 
</span><span class='line'>  libgomp            conda-forge/linux-aarch64::libgomp-12.2.0-h607ecd0_19 
</span><span class='line'>  libsqlite          conda-forge/linux-aarch64::libsqlite-3.40.0-hf9034f9_0 
</span><span class='line'>  libstdcxx-ng       conda-forge/linux-aarch64::libstdcxx-ng-12.2.0-hc13a102_19 
</span><span class='line'>  libzlib            conda-forge/linux-aarch64::libzlib-1.2.13-h4e544f5_4 
</span><span class='line'>  ncurses            conda-forge/linux-aarch64::ncurses-6.3-headf329_1 
</span><span class='line'>  openssl            conda-forge/linux-aarch64::openssl-3.1.0-hb4cce97_0 
</span><span class='line'>  pip                conda-forge/noarch::pip-23.0.1-pyhd8ed1ab_0 
</span><span class='line'>  pypy3.8            conda-forge/linux-aarch64::pypy3.8-7.3.11-hf9a8208_0 
</span><span class='line'>  python             conda-forge/linux-aarch64::python-3.8.16-0_73_pypy 
</span><span class='line'>  python_abi         conda-forge/linux-aarch64::python_abi-3.8-3_pypy38_pp73 
</span><span class='line'>  readline           conda-forge/linux-aarch64::readline-8.2-h8fc344f_1 
</span><span class='line'>  setuptools         conda-forge/noarch::setuptools-67.6.0-pyhd8ed1ab_0 
</span><span class='line'>  sqlite             conda-forge/linux-aarch64::sqlite-3.40.0-h69ca7e5_0 
</span><span class='line'>  tk                 conda-forge/linux-aarch64::tk-8.6.12-hd8af866_0 
</span><span class='line'>  wheel              conda-forge/noarch::wheel-0.40.0-pyhd8ed1ab_0 
</span><span class='line'>  xz                 conda-forge/linux-aarch64::xz-5.2.6-h9cdd2b7_0 
</span><span class='line'>  zlib               conda-forge/linux-aarch64::zlib-1.2.13-h4e544f5_4 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Proceed ([y]/n)? y
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Downloading and Extracting Packages
</span><span class='line'>                                                                                                                                                                                          
</span><span class='line'>Preparing transaction: done
</span><span class='line'>Verifying transaction: done
</span><span class='line'>Executing transaction: done
</span><span class='line'>#
</span><span class='line'># To activate this environment, use
</span><span class='line'>#
</span><span class='line'>#     $ conda activate openai
</span><span class='line'>#
</span><span class='line'># To deactivate an active environment, use
</span><span class='line'>#
</span><span class='line'>#     $ conda deactivate
</span><span class='line'>
</span><span class='line'>(base) root@ubuntu:~# 
</span></code></pre></td></tr></table></div></figure>


<p>æ¿€æ´»é…ç½®ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(base) root@ubuntu:~# conda activate openai
</span><span class='line'>(openai) root@ubuntu:~# 
</span><span class='line'>(openai) root@ubuntu:~# python --version
</span><span class='line'>Python 3.8.16 | packaged by conda-forge | (a9dbdca6, Jan 29 2023, 10:19:50)
</span><span class='line'>[PyPy 7.3.11 with GCC 11.3.0]
</span><span class='line'>(openai) root@ubuntu:~# pip --version 
</span><span class='line'>pip 23.0.1 from /usr/local/miniforge3/envs/openai/lib/pypy3.8/site-packages/pip (python 3.8)
</span><span class='line'>(openai) root@ubuntu:~# git clone https://github.com/zhayujie/bot-on-anything
</span><span class='line'>Cloning into 'bot-on-anything'...
</span><span class='line'>remote: Enumerating objects: 644, done.
</span><span class='line'>remote: Counting objects: 100% (271/271), done.
</span><span class='line'>remote: Compressing objects: 100% (116/116), done.
</span><span class='line'>remote: Total 644 (delta 190), reused 194 (delta 154), pack-reused 373
</span><span class='line'>Receiving objects: 100% (644/644), 588.10 KiB | 448.00 KiB/s, done.
</span><span class='line'>Resolving deltas: 100% (373/373), done.
</span><span class='line'>(openai) root@ubuntu:~# 
</span><span class='line'>(openai) root@ubuntu:~# pip3 install itchat-uos==1.5.0.dev0
</span><span class='line'>Collecting itchat-uos==1.5.0.dev0
</span><span class='line'>  Downloading itchat_uos-1.5.0.dev0-py3-none-any.whl (52 kB)
</span><span class='line'>     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 52.5/52.5 kB 244.0 kB/s eta 0:00:00
</span><span class='line'>Collecting requests
</span><span class='line'>  Downloading requests-2.28.2-py3-none-any.whl (62 kB)
</span><span class='line'>     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 62.8/62.8 kB 409.1 kB/s eta 0:00:00
</span><span class='line'>Collecting pyqrcode
</span><span class='line'>  Downloading PyQRCode-1.2.1.zip (41 kB)
</span><span class='line'>     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 41.9/41.9 kB 961.5 kB/s eta 0:00:00
</span><span class='line'>  Preparing metadata (setup.py) ... done
</span><span class='line'>Collecting pypng
</span><span class='line'>  Downloading pypng-0.20220715.0-py3-none-any.whl (58 kB)
</span><span class='line'>     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 58.1/58.1 kB 540.0 kB/s eta 0:00:00
</span><span class='line'>Collecting charset-normalizer&lt;4,&gt;=2
</span><span class='line'>  Downloading charset_normalizer-3.1.0-py3-none-any.whl (46 kB)
</span><span class='line'>     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 46.2/46.2 kB 642.4 kB/s eta 0:00:00
</span><span class='line'>Collecting idna&lt;4,&gt;=2.5
</span><span class='line'>  Downloading idna-3.4-py3-none-any.whl (61 kB)
</span><span class='line'>     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 61.5/61.5 kB 567.0 kB/s eta 0:00:00
</span><span class='line'>Collecting urllib3&lt;1.27,&gt;=1.21.1
</span><span class='line'>  Downloading urllib3-1.26.15-py2.py3-none-any.whl (140 kB)
</span><span class='line'>     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 140.9/140.9 kB 1.0 MB/s eta 0:00:00
</span><span class='line'>Collecting certifi&gt;=2017.4.17
</span><span class='line'>  Downloading certifi-2022.12.7-py3-none-any.whl (155 kB)
</span><span class='line'>     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 155.3/155.3 kB 1.2 MB/s eta 0:00:00
</span><span class='line'>Building wheels for collected packages: pyqrcode
</span><span class='line'>  Building wheel for pyqrcode (setup.py) ... done
</span><span class='line'>  Created wheel for pyqrcode: filename=PyQRCode-1.2.1-py3-none-any.whl size=36228 sha256=ba8cd080e7793f5e55c14fa704e57c1459ae29aa6481c719833bf9e148de5ad0
</span><span class='line'>  Stored in directory: /root/.cache/pip/wheels/5f/46/eb/231c89e0ae989c528db1a30d3aae90c4fee29f14d4e0369312
</span><span class='line'>Successfully built pyqrcode
</span><span class='line'>Installing collected packages: pyqrcode, pypng, urllib3, idna, charset-normalizer, certifi, requests, itchat-uos
</span><span class='line'>Successfully installed certifi-2022.12.7 charset-normalizer-3.1.0 idna-3.4 itchat-uos-1.5.0.dev0 pypng-0.20220715.0 pyqrcode-1.2.1 requests-2.28.2 urllib3-1.26.15
</span><span class='line'>WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
</span><span class='line'>(openai) root@ubuntu:~# 
</span><span class='line'>(openai) root@ubuntu:~# pip3 install --upgrade openai
</span><span class='line'>Collecting openai
</span><span class='line'>  Downloading openai-0.27.2-py3-none-any.whl (70 kB)
</span><span class='line'>     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 70.1/70.1 kB 277.1 kB/s eta 0:00:00
</span><span class='line'>Requirement already satisfied: requests&gt;=2.20 in /usr/local/miniforge3/envs/openai/lib/python3.8/site-packages (from openai) (2.28.2)
</span><span class='line'>Collecting tqdm
</span><span class='line'>  Downloading tqdm-4.65.0-py3-none-any.whl (77 kB)
</span><span class='line'>     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 77.1/77.1 kB 394.8 kB/s eta 0:00:00
</span><span class='line'>Collecting aiohttp
</span><span class='line'>  Downloading aiohttp-3.8.4.tar.gz (7.3 MB)
</span><span class='line'>     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 7.3/7.3 MB 2.1 MB/s eta 0:00:00
</span><span class='line'>  Installing build dependencies ... done
</span><span class='line'>  Getting requirements to build wheel ... done
</span><span class='line'>  Installing backend dependencies ... done
</span><span class='line'>  Preparing metadata (pyproject.toml) ... done
</span><span class='line'>Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /usr/local/miniforge3/envs/openai/lib/python3.8/site-packages (from requests&gt;=2.20-&gt;openai) (3.1.0)
</span><span class='line'>Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/miniforge3/envs/openai/lib/python3.8/site-packages (from requests&gt;=2.20-&gt;openai) (3.4)
</span><span class='line'>Requirement already satisfied: urllib3&lt;1.27,&gt;=1.21.1 in /usr/local/miniforge3/envs/openai/lib/python3.8/site-packages (from requests&gt;=2.20-&gt;openai) (1.26.15)
</span><span class='line'>Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/miniforge3/envs/openai/lib/python3.8/site-packages (from requests&gt;=2.20-&gt;openai) (2022.12.7)
</span><span class='line'>Collecting attrs&gt;=17.3.0
</span><span class='line'>  Downloading attrs-22.2.0-py3-none-any.whl (60 kB)
</span><span class='line'>     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 60.0/60.0 kB 834.6 kB/s eta 0:00:00
</span><span class='line'>Collecting multidict&lt;7.0,&gt;=4.5
</span><span class='line'>  Downloading multidict-6.0.4.tar.gz (51 kB)
</span><span class='line'>     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 51.3/51.3 kB 1.4 MB/s eta 0:00:00
</span><span class='line'>  Installing build dependencies ... done
</span><span class='line'>  Getting requirements to build wheel ... done
</span><span class='line'>  Installing backend dependencies ... done
</span><span class='line'>  Preparing metadata (pyproject.toml) ... done
</span><span class='line'>Collecting async-timeout&lt;5.0,&gt;=4.0.0a3
</span><span class='line'>  Downloading async_timeout-4.0.2-py3-none-any.whl (5.8 kB)
</span><span class='line'>Collecting yarl&lt;2.0,&gt;=1.0
</span><span class='line'>  Downloading yarl-1.8.2.tar.gz (172 kB)
</span><span class='line'>     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 172.3/172.3 kB 1.8 MB/s eta 0:00:00
</span><span class='line'>  Installing build dependencies ... done
</span><span class='line'>  Getting requirements to build wheel ... done
</span><span class='line'>  Preparing metadata (pyproject.toml) ... done
</span><span class='line'>Collecting frozenlist&gt;=1.1.1
</span><span class='line'>  Downloading frozenlist-1.3.3.tar.gz (66 kB)
</span><span class='line'>     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 66.6/66.6 kB 392.4 kB/s eta 0:00:00
</span><span class='line'>  Installing build dependencies ... done
</span><span class='line'>  Getting requirements to build wheel ... done
</span><span class='line'>  Preparing metadata (pyproject.toml) ... done
</span><span class='line'>Collecting aiosignal&gt;=1.1.2
</span><span class='line'>  Downloading aiosignal-1.3.1-py3-none-any.whl (7.6 kB)
</span><span class='line'>Building wheels for collected packages: aiohttp, frozenlist, multidict, yarl
</span><span class='line'>  Building wheel for aiohttp (pyproject.toml) ... done
</span><span class='line'>  Created wheel for aiohttp: filename=aiohttp-3.8.4-py3-none-any.whl size=183495 sha256=6bdf6b07bb86d5e5e452691da3570b0465c4177bec6fbe8ab668aef8d27ce39c
</span><span class='line'>  Stored in directory: /root/.cache/pip/wheels/46/48/fb/1fceb5376aa4eb481cec5ca10d6aece4455cf6a95030009502
</span><span class='line'>  Building wheel for frozenlist (pyproject.toml) ... done
</span><span class='line'>  Created wheel for frozenlist: filename=frozenlist-1.3.3-py3-none-any.whl size=9271 sha256=83ae70b8a9145f1fb94dffca4105ef207500e63dd3d8c056dc63a3f6ba664927
</span><span class='line'>  Stored in directory: /root/.cache/pip/wheels/0e/e7/55/8036a4cd9267238ba8aa2d714837827b8fd836324632469067
</span><span class='line'>  Building wheel for multidict (pyproject.toml) ... done
</span><span class='line'>  Created wheel for multidict: filename=multidict-6.0.4-py3-none-any.whl size=9710 sha256=0a72821685197753e4e43473bbfe1232bb33cd79fa4ad9c97daae3a7e4afd097
</span><span class='line'>  Stored in directory: /root/.cache/pip/wheels/23/65/1f/b5b0672ad49d2ff7b2c6ad75f24f45c407aab185c37803ae76
</span><span class='line'>  Building wheel for yarl (pyproject.toml) ... done
</span><span class='line'>  Created wheel for yarl: filename=yarl-1.8.2-py3-none-any.whl size=24118 sha256=4ed71ce5647e860cac0a0b5496e72e837878a33d62177d3bdded7d20d068b299
</span><span class='line'>  Stored in directory: /root/.cache/pip/wheels/4e/40/2e/3261e7db3f6b66ca3d8a1ec694f2d5d87f89110e2204675597
</span><span class='line'>Successfully built aiohttp frozenlist multidict yarl
</span><span class='line'>Installing collected packages: tqdm, multidict, frozenlist, attrs, async-timeout, yarl, aiosignal, aiohttp, openai
</span><span class='line'>Successfully installed aiohttp-3.8.4 aiosignal-1.3.1 async-timeout-4.0.2 attrs-22.2.0 frozenlist-1.3.3 multidict-6.0.4 openai-0.27.2 tqdm-4.65.0 yarl-1.8.2
</span><span class='line'>WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
</span><span class='line'>(openai) root@ubuntu:~# 
</span></code></pre></td></tr></table></div></figure>


<h3>å­¦ä¹ conda</h3>

<ul>
<li><a href="https://stackoverflow.com/questions/34534513/calling-conda-source-activate-from-bash-script">https://stackoverflow.com/questions/34534513/calling-conda-source-activate-from-bash-script</a></li>
<li><a href="https://docs.conda.io/projects/conda/en/latest/dev-guide/deep-dives/activation.html">https://docs.conda.io/projects/conda/en/latest/dev-guide/deep-dives/activation.html</a></li>
<li><a href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html">https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1
</span><span class='line'>$ eval "$(conda shell.bash activate)"
</span><span class='line'>$ conda shell.bash activate mamba-poc
</span><span class='line'>
</span><span class='line'>2
</span><span class='line'>eval "$(conda shell.bash hook)"
</span><span class='line'>conda activate &lt;env-name&gt;
</span><span class='line'>
</span><span class='line'>3
</span><span class='line'>#!/bin/bash
</span><span class='line'>source /Users/yourname/anaconda/bin/activate your_env
</span><span class='line'>python --version # example way to see that your virtual env loaded as expected
</span><span class='line'>
</span><span class='line'>4
</span><span class='line'>try using
</span><span class='line'>
</span><span class='line'>source ~/anaconda3/etc/profile.d/conda.sh
</span><span class='line'>
</span><span class='line'>and then do
</span><span class='line'>
</span><span class='line'>conda activate pult
</span><span class='line'>
</span><span class='line'>5
</span><span class='line'>https://unix.stackexchange.com/questions/689163/launch-terminal-and-conda-activate-env-from-bash-script
</span><span class='line'># Just activate my conda
</span><span class='line'>alias my_conda='source /home/$USER/anaconda3/bin/activate && conda activate MyPy38'
</span><span class='line'>
</span><span class='line'># Open Jupyter Notebook in my Env
</span><span class='line'>alias my_jupn='source /home/$USER/anaconda3/bin/activate && conda activate MyPy38 && jupyter-notebook'
</span><span class='line'>
</span><span class='line'># Open Jupyter Lab in my Env
</span><span class='line'>alias my_jupl='source /home/$USER/anaconda3/bin/activate && conda activate MyPy38 && jupyter-lab'
</span><span class='line'>
</span><span class='line'># Open Spyder in my Env
</span><span class='line'>alias my_spyder='source /home/$USER/anaconda3/bin/activate && conda activate MyPy38 && spyder'
</span></code></pre></td></tr></table></div></figure>


<h2>èŠ±ç”Ÿå£³</h2>

<ul>
<li><a href="https://hsk.oray.com/download">https://hsk.oray.com/download</a></li>
<li><a href="https://service.oray.com/question/11639.html">https://service.oray.com/question/11639.html</a></li>
</ul>


<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[é‡æ–°æŠ˜è…¾raspberry2]]></title>
    <link href="http://winse.github.io/blog/2023/03/25/reinstall-raspberry2/"/>
    <updated>2023-03-25T21:24:35+08:00</updated>
    <id>http://winse.github.io/blog/2023/03/25/reinstall-raspberry2</id>
    <content type="html"><![CDATA[<p>ä¹°äº†æ–°çš„raspberry4åï¼Œå°±æ²¡æ€ä¹ˆå»å¼„æ—§çš„æ ‘è“æ´¾2äº†ï¼Œä»Šå¤©å†æ¬¡çœ‹åˆ°æƒ³ç€è¿è¡Œèµ·æ¥çœ‹çœ‹ï¼Œæ’ä¸Šç”µæºåï¼Œä¸€ç›´äº®ç€ç»¿ç¯ï¼Œç„¶åå°±æ²¡å…¶ä»–ååº”äº†ã€‚</p>

<p>æ ‘è“æ´¾2æœ‰ç‚¹æ—§ï¼Œç°åœ¨ç›´æ¥æ‹¿ç€æ–°çš„æ‰‹æœºå……ç”µå™¨å»æ¥çš„æ—¶åˆ»ï¼Œä¸€ç›´èµ·ä¸æ¥ï¼Œåˆšå¼€å§‹æ˜¯æ€€ç–‘æ˜¯ç”¨TTLæ¥é”™çº¿å¯¼è‡´æ¿å­çƒ§äº†ï¼Œä¹Ÿæ²¡æœ‰æ˜¾ç¤ºå™¨æŸ¥çœ‹ç•Œé¢ã€‚</p>

<p>åé¢æƒ³ç€é‡æ–°å®‰è£…ä¸€ä¸‹è¯•è¯•ï¼Œç„¶åæ‹¿ç€å»æ¥ç½‘çº¿æœ‰çº¿ç½‘ç»œï¼Œè¿™æ ·å°±æ‹¿äº†ä¸€ä¸ªæ—§çš„å……ç”µå™¨çš„å¤´ã€‚æ²¡æƒ³åˆ°è¿™ä¸ªæ—¶åˆ»ç”µæºæŒ‡ç¤ºç¯å°½ç„¶é—ªèµ·æ¥äº†ã€‚æƒ³æ¥è¿™å¯èƒ½æ˜¯ç”µæµè¿‡è½½ä¿æŠ¤äº†ã€‚</p>

<p>é—®é¢˜è§£å†³äº†ï¼Œä¹ŸæŠŠæœ€æ–°çš„é‡æ–°å®‰è£…çš„è®°å½•ä¸€ä¸‹ã€‚</p>

<h2>å®‰è£…</h2>

<p>å‚è€ƒï¼š
* <a href="https://www.raspberrypi.com/documentation/computers/getting-started.html#installing-the-operating-system">Setting up your Raspberry Pi</a></p>

<h3>å®‰è£…ç³»ç»Ÿ</h3>

<p>1 æ‰“å¼€ <a href="https://www.raspberrypi.com/software/">Raspberry Pi Imager</a> ä¸‹è½½å¹¶å®‰è£…ï¼Œç„¶åæŠŠSD cardæ’å…¥ç”µè„‘ã€‚</p>

<p><img src="http://winse.github.io/images/blogs/rasp2/rasp2-1.png" alt="" /></p>

<p>2 è®¾ç½®åˆå§‹åŒ– ç”¨æˆ·å’Œå¯†ç ï¼Œå¹¶é»˜è®¤æ‰“å¼€sshæœåŠ¡ï¼ˆæ–°ç‰ˆæœ¬å·²ç»å»æ‰é»˜è®¤ç”¨æˆ·äº†ï¼Œæ‰€ä»¥è¦è®¾ç½®ä¸€ä¸‹ <a href="https://www.raspberrypi.com/news/raspberry-pi-bullseye-update-april-2022/">An update to Raspberry Pi OS Bullseye</a> ï¼‰</p>

<p><img src="http://winse.github.io/images/blogs/rasp2/rasp2-2.png" alt="" /></p>

<p>3 é€‰æ‹©æ“ä½œç³»ç»Ÿ</p>

<p><img src="http://winse.github.io/images/blogs/rasp2/rasp2-3-1.png" alt="" /></p>

<p><img src="http://winse.github.io/images/blogs/rasp2/rasp2-3-2.png" alt="" /></p>

<p>4 è¿ä¸Šæœ‰çº¿ç½‘ç»œï¼Œæ¥é€šç”µæºã€‚ç„¶åæ‰“å¼€è·¯ç”±ç®¡ç†ç•Œé¢ï¼ŒæŸ¥çœ‹raspberryçš„ipåœ°å€</p>

<p><img src="http://winse.github.io/images/blogs/rasp2/rasp2-4-0.png" alt="" /></p>

<p>5 ç”¨sshè¿æ¥æœåŠ¡å™¨</p>

<p><img src="http://winse.github.io/images/blogs/rasp2/rasp2-4-1.png" alt="" /></p>

<h3>é…ç½®Wifiç½‘ç»œ</h3>

<p>åŸæ¥å·²ç»ä¹°äº†usbçš„æ— çº¿ç½‘å¡ï¼Œç”¨ <code>ifconfig</code> ä¹Ÿèƒ½æŸ¥çœ‹åˆ° <code>wlan0</code> çš„æ¥å£ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@raspberrypi:~# apt install vim 
</span><span class='line'>Reading package lists... Done
</span><span class='line'>Building dependency tree... Done
</span><span class='line'>Reading state information... Done
</span><span class='line'>  libgpm2 vim-runtime
</span><span class='line'>Suggested packages:
</span><span class='line'>  gpm ctags vim-doc vim-scripts
</span><span class='line'>The following NEW packages will be installed:
</span><span class='line'>  libgpm2 vim vim-runtime
</span><span class='line'>0 upgraded, 3 newly installed, 0 to remove and 0 not upgraded.
</span><span class='line'>...
</span><span class='line'>update-alternatives: using /usr/bin/vim.basic to provide /usr/bin/vim (vim) in auto mode
</span><span class='line'>update-alternatives: using /usr/bin/vim.basic to provide /usr/bin/vimdiff (vimdiff) in auto mode
</span><span class='line'>update-alternatives: using /usr/bin/vim.basic to provide /usr/bin/rvim (rvim) in auto mode
</span><span class='line'>update-alternatives: using /usr/bin/vim.basic to provide /usr/bin/rview (rview) in auto mode
</span><span class='line'>update-alternatives: using /usr/bin/vim.basic to provide /usr/bin/vi (vi) in auto mode
</span><span class='line'>update-alternatives: using /usr/bin/vim.basic to provide /usr/bin/view (view) in auto mode
</span><span class='line'>update-alternatives: using /usr/bin/vim.basic to provide /usr/bin/ex (ex) in auto mode
</span><span class='line'>Processing triggers for man-db (2.9.4-2) ...
</span><span class='line'>Processing triggers for libc-bin (2.31-13+rpt2+rpi1+deb11u5) ...
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~# echo "set mouse-=a" &gt;&gt;~/.vimrc
</span><span class='line'>root@raspberrypi:~# vim /etc/wpa_supplicant/wpa_supplicant.conf    
</span><span class='line'>root@raspberrypi:~# 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~# iwlist wlan0 scan
</span><span class='line'>
</span><span class='line'># ç®—ä¸€ä¸ªåŠ å¯†çš„é…ç½®
</span><span class='line'>root@raspberrypi:~# wpa_passphrase winse
</span><span class='line'># reading passphrase from stdin
</span><span class='line'>xxx
</span><span class='line'>network={
</span><span class='line'>        ssid="winse"
</span><span class='line'>        #psk="xxx"
</span><span class='line'>        psk=xxx
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~# cat /etc/wpa_supplicant/wpa_supplicant.conf   
</span><span class='line'>country=CN
</span><span class='line'>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
</span><span class='line'>update_config=1
</span><span class='line'>
</span><span class='line'>network={
</span><span class='line'>        ssid="winse"
</span><span class='line'>        #psk="xxx"
</span><span class='line'>        psk=xxx
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># é…ç½®æœåŠ¡
</span><span class='line'>pi@raspberrypi:~ $ cat /lib/systemd/system/wpa_supplicant.service 
</span><span class='line'>[Unit]
</span><span class='line'>Description=WPA supplicant
</span><span class='line'>Before=network.target
</span><span class='line'>After=dbus.service
</span><span class='line'>Wants=network.target
</span><span class='line'>IgnoreOnIsolate=true
</span><span class='line'>
</span><span class='line'>[Service]
</span><span class='line'>#Type=dbus
</span><span class='line'>#BusName=fi.w1.wpa_supplicant1
</span><span class='line'>Type=forking
</span><span class='line'>ExecStart=/sbin/wpa_supplicant -u -s -O /run/wpa_supplicant -c /etc/wpa_supplicant/wpa_supplicant.conf -i wlan0 -B -D wext
</span><span class='line'>Restart=always
</span><span class='line'>
</span><span class='line'>[Install]
</span><span class='line'>WantedBy=multi-user.target
</span><span class='line'>#Alias=dbus-fi.w1.wpa_supplicant1.service
</span><span class='line'>pi@raspberrypi:~ $ cat /etc/systemd/system/dhclient.service 
</span><span class='line'>[Unit]
</span><span class='line'>Description= DHCP Client
</span><span class='line'>Before=network.target
</span><span class='line'>
</span><span class='line'>[Service]
</span><span class='line'>Type=forking
</span><span class='line'>ExecStart=/sbin/dhclient wlan0 -v
</span><span class='line'>ExecStop=/sbin/dhclient wlan0 -r
</span><span class='line'>Restart=always
</span><span class='line'>
</span><span class='line'>[Install] 
</span><span class='line'>WantedBy=multi-user.target
</span><span class='line'>pi@raspberrypi:~ $ 
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~# systemctl daemon-reload 
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~# systemctl stop NetworkManager
</span><span class='line'>root@raspberrypi:~# systemctl enable wpa_supplicant.service 
</span><span class='line'>root@raspberrypi:~# systemctl enable dhclient.service
</span><span class='line'>Created symlink /etc/systemd/system/multi-user.target.wants/dhclient.service â†’ /etc/systemd/system/dhclient.service.
</span></code></pre></td></tr></table></div></figure>


<p>é…ç½®å¥½åï¼Œé‡å¯æœåŠ¡å™¨ï¼Œå†æ¬¡æŸ¥çœ‹è·¯ç”±å™¨ç®¡ç†webç•Œé¢ï¼š</p>

<p><img src="http://winse.github.io/images/blogs/rasp2/rasp2-5.png" alt="" /></p>

<p>ç„¶åå†æŠŠç½‘çº¿æ‹”æ‰ï¼Œå†é‡å¯ä¸€æ¬¡ç¡®è®¤ä¸€ä¸‹ã€‚</p>

<h3>é‡åˆ°çš„é—®é¢˜ï¼š</h3>

<p>1 <a href="https://zhuanlan.zhihu.com/p/136463580">https://zhuanlan.zhihu.com/p/136463580</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>å¦‚æœæ ‘è“æ´¾ç³»ç»Ÿä½¿ç”¨çš„æ˜¯Raspbian Stretchï¼Œåˆ™ifupå‘½ä»¤å¯èƒ½ä¸èµ·ä½œç”¨ï¼Œå¯èƒ½ä¼šæ”¶åˆ°ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼Œ
</span><span class='line'>å†…å®¹å¦‚ä¸‹ï¼šâ€œ ifdownï¼šunknown interface wlan0 â€ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»»ä½•å‘½ä»¤æ¥è§£å†³ï¼š
</span><span class='line'>sudo ifconfig wlan0 up
</span></code></pre></td></tr></table></div></figure>


<p>2 <a href="https://shumeipai.nxez.com/2017/09/13/raspberry-pi-network-configuration-before-boot.html">https://shumeipai.nxez.com/2017/09/13/raspberry-pi-network-configuration-before-boot.html</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>è¯´æ˜ä»¥åŠä¸åŒå®‰å…¨æ€§çš„ WiFi é…ç½®ç¤ºä¾‹ï¼š
</span><span class='line'>#ssid:ç½‘ç»œçš„ssid
</span><span class='line'>#psk:å¯†ç 
</span><span class='line'>#priority:è¿æ¥ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼ˆä¸å¯ä»¥æ˜¯è´Ÿæ•°ï¼‰
</span><span class='line'>#scan_ssid:è¿æ¥éšè—WiFiæ—¶éœ€è¦æŒ‡å®šè¯¥å€¼ä¸º1
</span><span class='line'>
</span><span class='line'>å¦‚æœä½ çš„ WiFi æ²¡æœ‰å¯†ç 
</span><span class='line'>
</span><span class='line'>network={
</span><span class='line'>  ssid="ä½ çš„æ— çº¿ç½‘ç»œåç§°ï¼ˆssidï¼‰"
</span><span class='line'>  key_mgmt=NONE
</span><span class='line'>}
</span><span class='line'>å¦‚æœä½ çš„ WiFi ä½¿ç”¨WEPåŠ å¯†
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>network={
</span><span class='line'>  ssid="ä½ çš„æ— çº¿ç½‘ç»œåç§°ï¼ˆssidï¼‰"
</span><span class='line'>  key_mgmt=NONE
</span><span class='line'>  wep_key0="ä½ çš„wifiå¯†ç "
</span><span class='line'>}
</span><span class='line'>å¦‚æœä½ çš„ WiFi ä½¿ç”¨WPA/WPA2åŠ å¯†
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>network={
</span><span class='line'>  ssid="ä½ çš„æ— çº¿ç½‘ç»œåç§°ï¼ˆssidï¼‰"
</span><span class='line'>  key_mgmt=WPA-PSK
</span><span class='line'>  psk="ä½ çš„wifiå¯†ç "
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>å¦‚æœä½ ä¸æ¸…æ¥š WiFi çš„åŠ å¯†æ¨¡å¼ï¼Œå¯ä»¥åœ¨å®‰å“æ‰‹æœºä¸Šç”¨ root explorer æ‰“å¼€ /data/misc/wifi/wpa/wpa_supplicant.confï¼ŒæŸ¥çœ‹ WiFi çš„ä¿¡æ¯ã€‚
</span></code></pre></td></tr></table></div></figure>


<p>3 <a href="https://www.labno3.com/2021/03/22/setting-up-raspberry-pi-wifi/">https://www.labno3.com/2021/03/22/setting-up-raspberry-pi-wifi/</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>å¦‚æœè¿æ¥æœ‰é—®é¢˜ï¼Œä¸€å®šè¦ç¡®è®¤Piæ˜¯å¦æ”¯æŒWiFiã€‚ä¹Ÿæœ‰å¯èƒ½ä½ çš„SSIDæ˜¯é”™è¯¯çš„ï¼Œè¦æ‰«æå’Œæ£€æŸ¥ï¼Œ
</span><span class='line'>ä½¿ç”¨sudo iwlist wlan0 scanå¹¶æ£€æŸ¥essidå­—æ®µã€‚
</span><span class='line'>è¿™ä¸ªå­—æ®µåº”è¯¥å’Œä½ åœ¨ssidå­—æ®µè¾“å…¥çš„ä¸€æ ·ã€‚
</span></code></pre></td></tr></table></div></figure>


<p>4 æŸ¥çœ‹ä¿¡æ¯ <a href="https://www.baeldung.com/linux/connect-network-cli">https://www.baeldung.com/linux/connect-network-cli</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@raspberrypi:~# ip link show wlan0
</span><span class='line'>3: wlan0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc mq state DOWN mode DEFAULT group default qlen 1000
</span><span class='line'>  link/ether 00:5a:39:e1:4d:bb brd ff:ff:ff:ff:ff:ff
</span><span class='line'>root@raspberrypi:~# ip link set wlan0 up  
</span><span class='line'>root@raspberrypi:~# ip link show wlan0
</span><span class='line'>3: wlan0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc mq state DOWN mode DEFAULT group default qlen 1000
</span><span class='line'>  link/ether 00:5a:39:e1:4d:bb brd ff:ff:ff:ff:ff:ff
</span><span class='line'>root@raspberrypi:~# 
</span><span class='line'>root@raspberrypi:~# iw wlan0 link
</span><span class='line'>Not connected.
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~# ifconfig wlan0 down
</span><span class='line'>root@raspberrypi:~# ifconfig wlan0 up 
</span><span class='line'>root@raspberrypi:~# ifconfig wlan0
</span><span class='line'>wlan0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
</span><span class='line'>      ether 00:5a:39:e1:4d:bb  txqueuelen 1000  (Ethernet)
</span><span class='line'>      RX packets 0  bytes 0 (0.0 B)
</span><span class='line'>      RX errors 0  dropped 0  overruns 0  frame 0
</span><span class='line'>      TX packets 0  bytes 0 (0.0 B)
</span><span class='line'>      TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span></code></pre></td></tr></table></div></figure>


<p>5 <a href="https://shapeshed.com/linux-wifi/">https://shapeshed.com/linux-wifi/</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wpa_cli
</span></code></pre></td></tr></table></div></figure>


<p>6 <a href="https://www.bilibili.com/read/cv8895717">https://www.bilibili.com/read/cv8895717</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vim /etc/wpa_supplicant/wpa_supplicant.conf ç¼–è¾‘è¯¥æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶é¡¶éƒ¨å¢åŠ ä»¥ä¸‹å†…å®¹
</span><span class='line'>country=CN
</span><span class='line'>ctrl_interface=/run/wpa_supplicant
</span><span class='line'>update_config=1
</span><span class='line'>
</span><span class='line'>ç‰¹åˆ«è¯´æ˜ï¼šcountry=CN ç”±äºå„ä¸ªå›½å®¶wifiä½¿ç”¨é¢‘æ®µä¸åŒï¼Œå°¤å…¶5Gé¢‘æ®µ
</span><span class='line'>
</span><span class='line'>vim /etc/rc.local æ·»åŠ ä»¥ä¸‹å†…å®¹
</span><span class='line'>
</span><span class='line'>#!/bin/bash
</span><span class='line'>
</span><span class='line'>ip link set wlan0 up &
</span><span class='line'>wpa_supplicant -B -i wlan0 -D nl80211 -c /etc/wpa_supplicant/wpa_supplicant.conf &
</span><span class='line'>dhclient wlan0
</span><span class='line'>
</span><span class='line'>exit 0</span></code></pre></td></tr></table></div></figure>


<p>7 <a href="https://blog.csdn.net/u010049696/article/details/48765999">https://blog.csdn.net/u010049696/article/details/48765999</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>é…ç½®serviceã€‚è¿›å…¥åˆ°/usr/lib/systemd/systemç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢å››ä¸ªæ–‡ä»¶ï¼š
</span><span class='line'>
</span><span class='line'>wpa_supplicant-nl80211@.service
</span><span class='line'>wpa_supplicant.service
</span><span class='line'>wpa_supplicant@.service
</span><span class='line'>wpa_supplicant-wired@.service
</span><span class='line'>
</span><span class='line'>ç¼–è¾‘wpa_supplicant.serviceæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š
</span><span class='line'>
</span><span class='line'>[Unit]
</span><span class='line'>Description=WPA supplicant
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[Service]
</span><span class='line'>Type=dbus
</span><span class='line'>BusName=fi.epitest.hostap.WPASupplicant
</span><span class='line'>ExecStart=/usr/bin/wpa_supplicant -c/etc/wpa_supplicant/test.conf -i wlp3s0
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[Install]
</span><span class='line'>WantedBy=multi-user.target
</span><span class='line'>Alias=dbus-fi.epitest.hostap.WPASupplicant.service
</span><span class='line'>
</span><span class='line'>å…¶ä¸­ï¼Œåªéœ€ä¿®æ”¹ExecStart=/usr/bin/wpa_supplicant -c/etc/wpa_supplicant/test.conf -i wlp3s0å³å¯ã€‚</span></code></pre></td></tr></table></div></figure>


<p>8 <a href="https://www.linuxbabe.com/command-line/ubuntu-server-16-04-wifi-wpa-supplicant">https://www.linuxbabe.com/command-line/ubuntu-server-16-04-wifi-wpa-supplicant</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Auto Connect on Startup
</span><span class='line'>To automatically connect to wireless network at boot time, we need to edit the wpa_supplicant.service file. Itâ€™s a good idea to copy the file from /lib/systemd/system/ directory to /etc/systemd/system/ directory, then edit it because we donâ€™t want newer version of wpasupplicant to override our modifications.
</span><span class='line'>
</span><span class='line'>sudo cp /lib/systemd/system/wpa_supplicant.service /etc/systemd/system/wpa_supplicant.service
</span><span class='line'>
</span><span class='line'>sudo nano /etc/systemd/system/wpa_supplicant.service
</span><span class='line'>Find the following line.
</span><span class='line'>
</span><span class='line'>ExecStart=/sbin/wpa_supplicant -u -s -O /run/wpa_supplicant
</span><span class='line'>Change it to the following. Obviously you need to change wlp3s0 if that isnâ€™t your interface name.
</span><span class='line'>
</span><span class='line'>ExecStart=/sbin/wpa_supplicant -u -s -c /etc/wpa_supplicant.conf -i wlp3s0
</span><span class='line'>Itâ€™s recommended to always try to restart wpa_supplicant when failure is detected. Add the following right below the ExecStart line.
</span><span class='line'>
</span><span class='line'>Restart=always
</span><span class='line'>If you can find the following line in this file, comment it out (Add the # character at the beginning of the line).
</span><span class='line'>
</span><span class='line'>Alias=dbus-fi.w1.wpa_supplicant1.service
</span><span class='line'>Save and close the file. Then enable wpa_supplicant service to start at boot time.
</span><span class='line'>
</span><span class='line'>sudo systemctl enable wpa_supplicant.service
</span><span class='line'>
</span><span class='line'>~~~
</span><span class='line'>
</span><span class='line'>sudo nano /etc/systemd/system/dhclient.service
</span><span class='line'>Put the following text into the file.
</span><span class='line'>
</span><span class='line'>[Unit]
</span><span class='line'>Description= DHCP Client
</span><span class='line'>Before=network.target
</span><span class='line'>
</span><span class='line'>[Service]
</span><span class='line'>Type=forking
</span><span class='line'>ExecStart=/sbin/dhclient wlp3s0 -v
</span><span class='line'>ExecStop=/sbin/dhclient wlp3s0 -r
</span><span class='line'>Restart=always
</span><span class='line'>
</span><span class='line'>[Install] 
</span><span class='line'>WantedBy=multi-user.target
</span><span class='line'>Save and close the file. Then enable this service.
</span><span class='line'>
</span><span class='line'>sudo systemctl enable dhclient.service
</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è¯·æ±‚å¤åˆ¶/é•œåƒ]]></title>
    <link href="http://winse.github.io/blog/2023/03/25/mirror-request/"/>
    <updated>2023-03-25T18:28:14+08:00</updated>
    <id>http://winse.github.io/blog/2023/03/25/mirror-request</id>
    <content type="html"><![CDATA[<p>åœ¨æµ‹è¯•ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œå¦‚æœå†™å…¥åŸç¨‹åºçš„æƒ…å†µä¸‹å†å†™ä¸€ä»½åˆ°æ–°çš„ç¨‹åºå‘¢ï¼Ÿæ¯”å¦‚Elasticsearchå’ŒOpenSearchã€‚è¿˜æœ‰æŠŠç”Ÿäº§çš„æµé‡å¼•ä¸€ä»½å‡ºæ¥æµ‹è¯•ï¼Œå¦‚æœæ¥å®ç°å‘¢ï¼Ÿ</p>

<p>ä¸€èˆ¬çš„è½¬æ¢åŠŸèƒ½å¤åˆ¶ï¼Œå¦‚logstashã€vectorï¼Œä½†è¿™äº›ä¸èƒ½è¿”å›ç»“æœï¼Œä¸ç¬¦åˆã€‚åªèƒ½å¾€åå‘ä»£ç†ä¸Šæ‰¾ï¼šnginxã€‚</p>

<ul>
<li><a href="https://cloud.tencent.com/developer/article/1495449">Nginx æµé‡é•œåƒä½¿ç”¨æŠ€å·§</a></li>
<li><a href="https://juejin.cn/post/7101267337332375559">Nginxæµé‡é•œåƒ</a></li>
</ul>


<h2>nginx_http_mirror_moduleæ¨¡å—</h2>

<p>å½“è¯·æ±‚åˆ°è¾¾ Nginx æ—¶ï¼Œå¦‚æœ Nginx å¼€å¯äº†æµé‡é•œåƒåŠŸèƒ½ï¼Œå°±ä¼šå°†è¯·æ±‚å¤åˆ¶ä¸€ä»½ï¼Œå¹¶æ ¹æ® mirror location ä¸­çš„é…ç½®æ¥å¤„ç†è¿™ä»½å¤åˆ¶çš„è¯·æ±‚ã€‚</p>

<h2>é…ç½®</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  listen 9200;
</span><span class='line'>  server_name elasticsearch;
</span><span class='line'>  client_max_body_size 50m;
</span><span class='line'>
</span><span class='line'># error_log /var/log/nginx/elasticsearch-errors.log;
</span><span class='line'># access_log /var/log/nginx/elasticsearch.log;
</span><span class='line'>
</span><span class='line'>  location / {
</span><span class='line'>  
</span><span class='line'>    # Deny Nodes shutdown API
</span><span class='line'>    if ($request_filename ~ "_shutdown") { 
</span><span class='line'>      return 403;
</span><span class='line'>      break;
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>    # Deny access to cluster API
</span><span class='line'>    if ($request_filename ~ "_cluster") {
</span><span class='line'>      return 403;
</span><span class='line'>      break;
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>    # Pass requests to ETasticsearch
</span><span class='line'>    proxy_pass http://localhost:9201;
</span><span class='line'>    proxy_redirect off;
</span><span class='line'>    
</span><span class='line'>    proxy_set_header X-Real-IP $remote_addr;
</span><span class='line'>    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span><span class='line'>    proxy_set_header Host $http_host;
</span><span class='line'>    
</span><span class='line'>    # For CORS Ajax 
</span><span class='line'>    proxy_pass_header Access-Control-Allow-origin;
</span><span class='line'>    proxy_pass_header Access-Control-Allow-Method proxy_hide_header Access-Control-Allow-Headers;
</span><span class='line'>    add_header Access-control-A1low-Headers 'X-Requested-with, Content-Type';
</span><span class='line'>    # add_header Access-Control-Allow-credentials true;
</span><span class='line'>        
</span><span class='line'>    # Authorize access 
</span><span class='line'>    #auth basic "elasticsearch";
</span><span class='line'>    #auth_basic_user_file /usr/local/etc/elasticsearch/passwords;
</span><span class='line'>    
</span><span class='line'>    mirror /mirror;
</span><span class='line'>    mirror_request_body on;
</span><span class='line'>  }
</span><span class='line'>  
</span><span class='line'>  location /mirror {
</span><span class='line'>    internal; # æŒ‡å®šæ­¤locationåªèƒ½è¢«â€œå†…éƒ¨çš„â€è¯·æ±‚è°ƒç”¨
</span><span class='line'>  
</span><span class='line'>    # Pass requests to OpenSearch
</span><span class='line'>    proxy_pass http://127.0.0.1:19200$request_uri;
</span><span class='line'>    proxy_redirect off:
</span><span class='line'>  
</span><span class='line'>    proxy_set_header X-Real-IP $remote_addr;
</span><span class='line'>    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span><span class='line'>    proxy_set_header Host $http_host;
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>server {
</span><span class='line'>  listen 127.0.0.1:19200;
</span><span class='line'>  location / { # å¢åŠ ä¸€å±‚ï¼Œæ–¹ä¾¿åœ¨nginxä¸­è¾“å‡ºæ—¥å¿—å®šä½é—®é¢˜
</span><span class='line'>    proxy_pass https://192.168.1.21:9200;
</span><span class='line'>
</span><span class='line'>    proxy_set_header X-Real-IP $remote_addr;
</span><span class='line'>    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span><span class='line'>    proxy_set_header Host $http_host;
</span><span class='line'>  
</span><span class='line'>    proxy_set_header Authorization "Basic YWRtaW46YWRtaW4=";
</span></code></pre></td></tr></table></div></figure>


<p>shellä¸­è®¡ç®—base64çš„æ—¶åˆ»è¦æ³¨æ„åŠ ä¸Š <code>-ne</code> ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç½‘ä¸Š <a href="https://tool.chinaz.com/tools/base64.aspx">https://tool.chinaz.com/tools/base64.aspx</a> ç®—ä¸€ä¸‹ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo -ne 'admin:admin'|base64 -</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å¾®ä¿¡å¯¹æ¥OpenAI]]></title>
    <link href="http://winse.github.io/blog/2023/03/18/wechat-on-openai/"/>
    <updated>2023-03-18T14:13:00+08:00</updated>
    <id>http://winse.github.io/blog/2023/03/18/wechat-on-openai</id>
    <content type="html"><![CDATA[<p>å‰ç¯‡é€šè¿‡smsç”³è¯·å›½å¤–æ‰‹æœºå·æ³¨å†Œäº†OpenAIï¼Œåœ¨ç½‘é¡µä¸Šä½“éªŒäº†ä¸€æŠŠChatGPTã€‚ç”±äºéœ€è¦ç¿»å¢™ï¼Œåœ¨æ‰‹æœºä¸Šä½¿ç”¨èµ·æ¥å¹¶ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œä¹Ÿä¸èƒ½æŠŠè´¦å·ç»™æ‰€æœ‰æƒ³ç”¨çš„æœ‹å‹ç”¨ï¼ŒèŒƒå›´å—é™ã€‚</p>

<p>æœ€è¿‘OpenAIçš„æ¥å£åŠŸå¯¹æ¥ï¼Œä»¥åŠå¾ˆå¤šæ–‡ç« è®²å¾®ä¿¡å¯¹æ¥çš„æ–‡ç« ï¼Œæˆ‘ä¹Ÿè¹­ç€è¿™è‚¡é£æŠŠåŸæ¥çš„å…¬ä¼—å·æ¡èµ·æ¥ç†Ÿæ‚‰ç†Ÿæ‚‰ã€‚</p>

<h1>ä½¿ç”¨å¼€æºçš„æ–¹æ¡ˆ</h1>

<p>å‚è€ƒæ–‡ç« ï¼š</p>

<ul>
<li><a href="https://mp.weixin.qq.com/s/y1Uv3HlVAzo2tSo1XbmyOA">https://mp.weixin.qq.com/s/y1Uv3HlVAzo2tSo1XbmyOA</a></li>
<li><a href="https://github.com/zhayujie/bot-on-anything">https://github.com/zhayujie/bot-on-anything</a></li>
<li><a href="https://github.com/zhayujie/chatgpt-on-wechat">https://github.com/zhayujie/chatgpt-on-wechat</a></li>
</ul>


<h2>æä¸€å°å›½å¤–çš„æœåŠ¡å™¨ï¼ˆåŒäº‹é€šè¿‡è‡ªå·±çš„æœºå™¨+ç¿»å¢™ä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰</h2>

<h2>å®‰è£…Python3.8ï¼ˆOpenAIæ¥å£æœ‰è¦æ±‚ï¼‰</h2>

<p>æˆ‘ç”¨çš„æœåŠ¡å™¨æ˜¯CentOS7çš„ï¼Œå·²ç»å®‰è£…äº†Python3.6ï¼Œå®˜æ–¹yumä¸­æœ€æ–°çš„ä¹Ÿå°±3.6ã€‚ä½¿ç”¨sclï¼ˆSoftware Collectionsï¼Œç±»ä¼¼NVMå¤šç‰ˆæœ¬å…±å­˜ï¼‰çš„æ–¹å¼å®‰è£…ï¼š</p>

<p><strong>å†å›é¡¾ï¼šå¦‚æœè¿˜è¦æ›´å¤šä¸ªpythonç‰ˆæœ¬ï¼Œå®‰è£…condaä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# sudo yum install centos-release-scl
</span><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# yum install rh-python38
</span><span class='line'>Loaded plugins: fastestmirror, langpacks
</span><span class='line'>Loading mirror speeds from cached hostfile
</span><span class='line'> * centos-sclo-rh: mirror.vodien.com
</span><span class='line'> * centos-sclo-sclo: mirror.vodien.com
</span><span class='line'>Resolving Dependencies
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package rh-python38.x86_64 0:2.0-4.el7 will be installed
</span><span class='line'>--&gt; Processing Dependency: rh-python38-runtime for package: rh-python38-2.0-4.el7.x86_64
</span><span class='line'>--&gt; Processing Dependency: rh-python38-python for package: rh-python38-2.0-4.el7.x86_64
</span><span class='line'>--&gt; Processing Dependency: rh-python38-python-pip for package: rh-python38-2.0-4.el7.x86_64
</span><span class='line'>--&gt; Processing Dependency: rh-python38-python-setuptools for package: rh-python38-2.0-4.el7.x86_64
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package rh-python38-python.x86_64 0:3.8.13-1.el7 will be installed
</span><span class='line'>--&gt; Processing Dependency: rh-python38-python-libs(x86-64) = 3.8.13-1.el7 for package: rh-python38-python-3.8.13-1.el7.x86_64
</span><span class='line'>--&gt; Processing Dependency: libpython3.8.so.rh-python38-1.0()(64bit) for package: rh-python38-python-3.8.13-1.el7.x86_64
</span><span class='line'>---&gt; Package rh-python38-python-pip.noarch 0:19.3.1-3.el7 will be installed
</span><span class='line'>---&gt; Package rh-python38-python-setuptools.noarch 0:41.6.0-7.el7 will be installed
</span><span class='line'>---&gt; Package rh-python38-runtime.x86_64 0:2.0-4.el7 will be installed
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package rh-python38-python-libs.x86_64 0:3.8.13-1.el7 will be installed
</span><span class='line'>--&gt; Processing Dependency: rh-python38-python-pip-wheel for package: rh-python38-python-libs-3.8.13-1.el7.x86_64
</span><span class='line'>--&gt; Processing Dependency: rh-python38-python-setuptools-wheel for package: rh-python38-python-libs-3.8.13-1.el7.x86_64
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package rh-python38-python-pip-wheel.noarch 0:19.3.1-3.el7 will be installed
</span><span class='line'>---&gt; Package rh-python38-python-setuptools-wheel.noarch 0:41.6.0-7.el7 will be installed
</span><span class='line'>--&gt; Finished Dependency Resolution
</span><span class='line'>
</span><span class='line'>Dependencies Resolved
</span><span class='line'>
</span><span class='line'>====================================================================================================================================================
</span><span class='line'> Package                                              Arch                    Version                         Repository                       Size
</span><span class='line'>====================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> rh-python38                                          x86_64                  2.0-4.el7                       centos-sclo-rh                  2.8 k
</span><span class='line'>Installing for dependencies:
</span><span class='line'> rh-python38-python                                   x86_64                  3.8.13-1.el7                    centos-sclo-rh                   71 k
</span><span class='line'> rh-python38-python-libs                              x86_64                  3.8.13-1.el7                    centos-sclo-rh                  7.7 M
</span><span class='line'> rh-python38-python-pip                               noarch                  19.3.1-3.el7                    centos-sclo-rh                  1.6 M
</span><span class='line'> rh-python38-python-pip-wheel                         noarch                  19.3.1-3.el7                    centos-sclo-rh                  1.0 M
</span><span class='line'> rh-python38-python-setuptools                        noarch                  41.6.0-7.el7                    centos-sclo-rh                  636 k
</span><span class='line'> rh-python38-python-setuptools-wheel                  noarch                  41.6.0-7.el7                    centos-sclo-rh                  299 k
</span><span class='line'> rh-python38-runtime                                  x86_64                  2.0-4.el7                       centos-sclo-rh                  1.1 M
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>====================================================================================================================================================
</span><span class='line'>Install  1 Package (+7 Dependent packages)
</span><span class='line'>
</span><span class='line'>Total download size: 12 M
</span><span class='line'>Installed size: 48 M
</span><span class='line'>Is this ok [y/d/N]: y
</span><span class='line'>Downloading packages:
</span><span class='line'>warning: /var/cache/yum/x86_64/7/centos-sclo-rh/packages/rh-python38-2.0-4.el7.x86_64.rpm: Header V4 RSA/SHA1 Signature, key ID f2ee9d55: NOKEY
</span><span class='line'>Public key for rh-python38-2.0-4.el7.x86_64.rpm is not installed
</span><span class='line'>(1/8): rh-python38-2.0-4.el7.x86_64.rpm                                                                                      | 2.8 kB  00:00:00     
</span><span class='line'>(2/8): rh-python38-python-3.8.13-1.el7.x86_64.rpm                                                                            |  71 kB  00:00:00     
</span><span class='line'>(3/8): rh-python38-python-pip-19.3.1-3.el7.noarch.rpm                                                                        | 1.6 MB  00:00:00     
</span><span class='line'>(4/8): rh-python38-python-pip-wheel-19.3.1-3.el7.noarch.rpm                                                                  | 1.0 MB  00:00:00     
</span><span class='line'>(5/8): rh-python38-python-setuptools-41.6.0-7.el7.noarch.rpm                                                                 | 636 kB  00:00:00     
</span><span class='line'>(6/8): rh-python38-python-libs-3.8.13-1.el7.x86_64.rpm                                                                       | 7.7 MB  00:00:00     
</span><span class='line'>(7/8): rh-python38-python-setuptools-wheel-41.6.0-7.el7.noarch.rpm                                                           | 299 kB  00:00:00     
</span><span class='line'>(8/8): rh-python38-runtime-2.0-4.el7.x86_64.rpm                                                                              | 1.1 MB  00:00:00     
</span><span class='line'>----------------------------------------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Total                                                                                                                21 MB/s |  12 MB  00:00:00     
</span><span class='line'>Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo
</span><span class='line'>Importing GPG key 0xF2EE9D55:
</span><span class='line'> Userid     : "CentOS SoftwareCollections SIG (https://wiki.centos.org/SpecialInterestGroup/SCLo) &lt;security@centos.org&gt;"
</span><span class='line'> Fingerprint: c4db d535 b1fb ba14 f8ba 64a8 4eb8 4e71 f2ee 9d55
</span><span class='line'> Package    : centos-release-scl-rh-2-3.el7.centos.noarch (@extras)
</span><span class='line'> From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo
</span><span class='line'>Is this ok [y/N]: y
</span><span class='line'>Running transaction check
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded
</span><span class='line'>Running transaction
</span><span class='line'>  Installing : rh-python38-runtime-2.0-4.el7.x86_64                                                                                             1/8 
</span><span class='line'>  Installing : rh-python38-python-pip-wheel-19.3.1-3.el7.noarch                                                                                 2/8 
</span><span class='line'>  Installing : rh-python38-python-setuptools-wheel-41.6.0-7.el7.noarch                                                                          3/8 
</span><span class='line'>  Installing : rh-python38-python-setuptools-41.6.0-7.el7.noarch                                                                                4/8 
</span><span class='line'>  Installing : rh-python38-python-3.8.13-1.el7.x86_64                                                                                           5/8 
</span><span class='line'>  Installing : rh-python38-python-libs-3.8.13-1.el7.x86_64                                                                                      6/8 
</span><span class='line'>  Installing : rh-python38-python-pip-19.3.1-3.el7.noarch                                                                                       7/8 
</span><span class='line'>  Installing : rh-python38-2.0-4.el7.x86_64                                                                                                     8/8 
</span><span class='line'>  Verifying  : rh-python38-2.0-4.el7.x86_64                                                                                                     1/8 
</span><span class='line'>  Verifying  : rh-python38-python-pip-wheel-19.3.1-3.el7.noarch                                                                                 2/8 
</span><span class='line'>  Verifying  : rh-python38-python-setuptools-wheel-41.6.0-7.el7.noarch                                                                          3/8 
</span><span class='line'>  Verifying  : rh-python38-python-3.8.13-1.el7.x86_64                                                                                           4/8 
</span><span class='line'>  Verifying  : rh-python38-python-pip-19.3.1-3.el7.noarch                                                                                       5/8 
</span><span class='line'>  Verifying  : rh-python38-python-libs-3.8.13-1.el7.x86_64                                                                                      6/8 
</span><span class='line'>  Verifying  : rh-python38-python-setuptools-41.6.0-7.el7.noarch                                                                                7/8 
</span><span class='line'>  Verifying  : rh-python38-runtime-2.0-4.el7.x86_64                                                                                             8/8 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  rh-python38.x86_64 0:2.0-4.el7                                                                                                                    
</span><span class='line'>
</span><span class='line'>Dependency Installed:
</span><span class='line'>  rh-python38-python.x86_64 0:3.8.13-1.el7                              rh-python38-python-libs.x86_64 0:3.8.13-1.el7                              
</span><span class='line'>  rh-python38-python-pip.noarch 0:19.3.1-3.el7                          rh-python38-python-pip-wheel.noarch 0:19.3.1-3.el7                         
</span><span class='line'>  rh-python38-python-setuptools.noarch 0:41.6.0-7.el7                   rh-python38-python-setuptools-wheel.noarch 0:41.6.0-7.el7                  
</span><span class='line'>  rh-python38-runtime.x86_64 0:2.0-4.el7                               
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# 
</span></code></pre></td></tr></table></div></figure>


<p>æ£€æµ‹ä¸€ä¸‹ï¼ŒæŸ¥çœ‹Pythonç‰ˆæœ¬ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# scl enable rh-python38 bash
</span><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# python --version
</span><span class='line'>Python 3.8.13
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# pip --version 
</span><span class='line'>pip 19.3.1 from /opt/rh/rh-python38/root/usr/lib/python3.8/site-packages/pip (python 3.8)
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# </span></code></pre></td></tr></table></div></figure>


<p>ä¸‹è½½ä»£ç ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# git clone https://github.com/zhayujie/bot-on-anything
</span></code></pre></td></tr></table></div></figure>


<h2>å¯¹æ¥ä¸ªäººå¾®ä¿¡</h2>

<p>1 å®‰è£…ä¾èµ–</p>

<p>å‚è€ƒ <a href="https://github.com/zhayujie/chatgpt-on-wechat">https://github.com/zhayujie/chatgpt-on-wechat</a> çš„è¯´æ˜ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## [root@izt4nhcmmx33bjwcsdmf8oz Python-3.8.1]# yum install libffi-devel
</span><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# pip3 install itchat-uos==1.5.0.dev0
</span><span class='line'>WARNING: Running pip install with root privileges is generally not a good idea. Try `pip3 install --user` instead.
</span><span class='line'>Looking in indexes: http://mirrors.aliyun.com/pypi/simple/
</span><span class='line'>Collecting itchat-uos==1.5.0.dev0
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/31/2b/0be7e46195dc3c461518b046a6fb9c34c97cd2fd44847b840a0011686575/itchat_uos-1.5.0.dev0-py3-none-any.whl (52kB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 61kB 1.9MB/s 
</span><span class='line'>Collecting requests
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/d2/f4/274d1dbe96b41cf4e0efb70cbced278ffd61b5c7bb70338b62af94ccb25b/requests-2.28.2-py3-none-any.whl (62kB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 71kB 2.0MB/s 
</span><span class='line'>Collecting pyqrcode
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/37/61/f07226075c347897937d4086ef8e55f0a62ae535e28069884ac68d979316/PyQRCode-1.2.1.tar.gz
</span><span class='line'>Collecting pypng
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/3e/b9/3766cc361d93edb2ce81e2e1f87dd98f314d7d513877a342d31b30741680/pypng-0.20220715.0-py3-none-any.whl (58kB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 61kB 1.8MB/s 
</span><span class='line'>Collecting certifi&gt;=2017.4.17
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/71/4c/3db2b8021bd6f2f0ceb0e088d6b2d49147671f25832fb17970e9b583d742/certifi-2022.12.7-py3-none-any.whl (155kB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 163kB 1.7MB/s 
</span><span class='line'>Collecting idna&lt;4,&gt;=2.5
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/fc/34/3030de6f1370931b9dbb4dad48f6ab1015ab1d32447850b9fc94e60097be/idna-3.4-py3-none-any.whl (61kB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 71kB 1.9MB/s 
</span><span class='line'>Collecting urllib3&lt;1.27,&gt;=1.21.1
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/fe/ca/466766e20b767ddb9b951202542310cba37ea5f2d792dae7589f1741af58/urllib3-1.26.14-py2.py3-none-any.whl (140kB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 143kB 1.3MB/s 
</span><span class='line'>Collecting charset-normalizer&lt;4,&gt;=2
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/20/a2/16b2cbf5f73bdd10624b94647b85c008ba25059792a5c7b4fdb8358bceeb/charset_normalizer-3.0.1-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (195kB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 204kB 1.5MB/s 
</span><span class='line'>Installing collected packages: certifi, idna, urllib3, charset-normalizer, requests, pyqrcode, pypng, itchat-uos
</span><span class='line'>    Running setup.py install for pyqrcode ... done
</span><span class='line'>Successfully installed certifi-2022.12.7 charset-normalizer-3.0.1 idna-3.4 itchat-uos-1.5.0.dev0 pypng-0.20220715.0 pyqrcode-1.2.1 requests-2.28.2 urllib3-1.26.14
</span><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# pip3 install --upgrade openai
</span><span class='line'>WARNING: Running pip install with root privileges is generally not a good idea. Try `pip3 install --user` instead.
</span><span class='line'>Looking in indexes: http://mirrors.aliyun.com/pypi/simple/
</span><span class='line'>Collecting openai
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/2f/15/b29ed5ad2eed1f49b8b3e2067fbbbb63cfbfc496ca2a27b772bcf0907ad8/openai-0.27.0-py3-none-any.whl (70kB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 71kB 1.7MB/s 
</span><span class='line'>Collecting tqdm
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/e6/02/a2cff6306177ae6bc73bc0665065de51dfb3b9db7373e122e2735faf0d97/tqdm-4.65.0-py3-none-any.whl (77kB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 81kB 1.9MB/s 
</span><span class='line'>Collecting aiohttp
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/d2/e5/cef5eeb11d7e8bac830b3bee1c8311b19bf8e8a1c45fe14b876c70adcd06/aiohttp-3.8.4-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (1.0MB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1.0MB 1.5MB/s 
</span><span class='line'>Requirement already satisfied, skipping upgrade: requests&gt;=2.20 in /opt/rh/rh-python38/root/usr/local/lib/python3.8/site-packages (from openai) (2.28.2)
</span><span class='line'>Collecting yarl&lt;2.0,&gt;=1.0
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/b3/0d/0ba1f2022b9a36ae670c1f3c579ed08d0958398cb6beaf4687e606ad33d4/yarl-1.8.2-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (262kB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 266kB 1.7MB/s 
</span><span class='line'>Collecting aiosignal&gt;=1.1.2
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/76/ac/a7305707cb852b7e16ff80eaf5692309bde30e2b1100a1fcacdc8f731d97/aiosignal-1.3.1-py3-none-any.whl
</span><span class='line'>Collecting attrs&gt;=17.3.0
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/fb/6e/6f83bf616d2becdf333a1640f1d463fef3150e2e926b7010cb0f81c95e88/attrs-22.2.0-py3-none-any.whl (60kB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 61kB 1.7MB/s 
</span><span class='line'>Requirement already satisfied, skipping upgrade: charset-normalizer&lt;4.0,&gt;=2.0 in /opt/rh/rh-python38/root/usr/local/lib64/python3.8/site-packages (from aiohttp-&gt;openai) (3.0.1)
</span><span class='line'>Collecting frozenlist&gt;=1.1.1
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/ec/ab/a440db757401a1e8863c9abb374a77cb2884eda74ffbf555dedcf1fbe7f6/frozenlist-1.3.3-cp38-cp38-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (161kB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 163kB 1.8MB/s 
</span><span class='line'>Collecting multidict&lt;7.0,&gt;=4.5
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/fe/0c/8469202f8f4b0e65816f91c3febc4bda7316c995b59ecdf3b15c574f7a24/multidict-6.0.4-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (121kB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 122kB 1.9MB/s 
</span><span class='line'>Collecting async-timeout&lt;5.0,&gt;=4.0.0a3
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/d6/c1/8991e7c5385b897b8c020cdaad718c5b087a6626d1d11a23e1ea87e325a7/async_timeout-4.0.2-py3-none-any.whl
</span><span class='line'>Requirement already satisfied, skipping upgrade: idna&lt;4,&gt;=2.5 in /opt/rh/rh-python38/root/usr/local/lib/python3.8/site-packages (from requests&gt;=2.20-&gt;openai) (3.4)
</span><span class='line'>Requirement already satisfied, skipping upgrade: certifi&gt;=2017.4.17 in /opt/rh/rh-python38/root/usr/local/lib/python3.8/site-packages (from requests&gt;=2.20-&gt;openai) (2022.12.7)
</span><span class='line'>Requirement already satisfied, skipping upgrade: urllib3&lt;1.27,&gt;=1.21.1 in /opt/rh/rh-python38/root/usr/local/lib/python3.8/site-packages (from requests&gt;=2.20-&gt;openai) (1.26.14)
</span><span class='line'>Installing collected packages: tqdm, multidict, yarl, frozenlist, aiosignal, attrs, async-timeout, aiohttp, openai
</span><span class='line'>Successfully installed aiohttp-3.8.4 aiosignal-1.3.1 async-timeout-4.0.2 attrs-22.2.0 frozenlist-1.3.3 multidict-6.0.4 openai-0.27.0 tqdm-4.65.0 yarl-1.8.2
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# 
</span></code></pre></td></tr></table></div></figure>


<p>2 ä¿®æ”¹é…ç½®ç”¨ä¸ªäººå¾®ä¿¡æ–¹å¼ä½¿ç”¨</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz bot-on-anything]# cp config-template.json config.json
</span><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz bot-on-anything]# cat config.json 
</span><span class='line'>{
</span><span class='line'>  "model": {
</span><span class='line'>    "type" : "chatgpt",
</span><span class='line'>    "openai": {
</span><span class='line'>      "api_key": "sk-xxx",
</span><span class='line'>      "proxy": "",
</span><span class='line'>      "conversation_max_tokens": 1000,
</span><span class='line'>      "character_desc": "ä½ æ˜¯ChatGPT, ä¸€ä¸ªç”±OpenAIè®­ç»ƒçš„å¤§å‹è¯­è¨€æ¨¡å‹, ä½ æ—¨åœ¨å›ç­”å¹¶è§£å†³äººä»¬çš„ä»»ä½•é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨å¤šç§è¯­è¨€ä¸äººäº¤æµã€‚"
</span><span class='line'>    }
</span><span class='line'>  },
</span><span class='line'>
</span><span class='line'>  "channel": {
</span><span class='line'>    "type": "wechat",
</span><span class='line'>    "single_chat_prefix": ["bot", "@bot"],
</span><span class='line'>    "single_chat_reply_prefix": "[bot] ",
</span><span class='line'>    "group_chat_prefix": ["@bot"],
</span><span class='line'>    "group_name_white_list": ["ChatGPTæµ‹è¯•ç¾¤"],
</span><span class='line'>    "image_create_prefix": ["ç”»", "çœ‹", "æ‰¾ä¸€å¼ "],
</span><span class='line'>
</span><span class='line'>    "terminal": {
</span><span class='line'>    },
</span><span class='line'>
</span><span class='line'>    "wechat": {
</span><span class='line'>    },
</span></code></pre></td></tr></table></div></figure>


<p>é…ç½®è§£é‡Šè¯´æ˜ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  "single_chat_prefix": ["bot", "@bot"], # ç§èŠæ—¶æ–‡æœ¬éœ€è¦åŒ…å«è¯¥å‰ç¼€æ‰èƒ½è§¦å‘æœºå™¨äººå›å¤
</span><span class='line'>  "single_chat_reply_prefix": "[bot] ", # ç§èŠæ—¶è‡ªåŠ¨å›å¤çš„å‰ç¼€ï¼Œç”¨äºåŒºåˆ†çœŸäºº
</span><span class='line'>  "group_chat_prefix": ["@bot"], # ç¾¤èŠæ—¶åŒ…å«è¯¥å‰ç¼€åˆ™ä¼šè§¦å‘æœºå™¨äººå›å¤
</span><span class='line'>  "group_name_white_list": ["ChatGPTæµ‹è¯•ç¾¤", "ChatGPTæµ‹è¯•ç¾¤2"], # å¼€å¯è‡ªåŠ¨å›å¤çš„ç¾¤åç§°åˆ—è¡¨
</span><span class='line'>  "image_create_prefix": ["ç”»", "çœ‹", "æ‰¾"], # å¼€å¯å›¾ç‰‡å›å¤çš„å‰ç¼€</span></code></pre></td></tr></table></div></figure>


<p>å¯ä»¥æŠŠ group_chat_prefix æ”¹æˆä½ è¦ä½¿ç”¨çš„å¾®ä¿¡å·çš„åç§°ï¼Œè¿™æ ·äººå®¶@ä½ ï¼Œå°±èƒ½è§¦å‘æœºå™¨äººäº†ã€‚</p>

<p>3 å¯åŠ¨</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz bot-on-anything]# cat startup.sh 
</span><span class='line'>#!/bin/bash
</span><span class='line'>
</span><span class='line'>scl enable rh-python38 - &lt;&lt; \EOF
</span><span class='line'>
</span><span class='line'>mv nohup.out{,$(date +'%Y%m%d%H%M')}
</span><span class='line'>touch nohup.out
</span><span class='line'>nohup python3 app.py & tail -f nohup.out
</span><span class='line'>
</span><span class='line'>EOF
</span><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz bot-on-anything]# 
</span><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz bot-on-anything]# sh startup.sh 
</span></code></pre></td></tr></table></div></figure>


<p>å¯åŠ¨åï¼Œä¼šè¾“å‡ºä¸€ä¸ªäºŒç»´ç ï¼Œä½¿ç”¨å¾®ä¿¡æ‰«æç™»å½•ã€‚ç„¶åå»ºç¾¤ <code>ChatGPTæµ‹è¯•ç¾¤</code> å°±å¯ä»¥å’ŒChatGPTèŠå¤©äº†ã€‚</p>

<h2>å¯¹æ¥å¾®ä¿¡å…¬ä¼—å·</h2>

<p>1 åšåŸŸåå¤–ç½‘æ˜ å°„</p>

<p>å¾®ä¿¡å…¬ä¼—å·è¦æ±‚443æˆ–è€…80ç«¯å£ï¼Œé¦–å…ˆç”¨ èŠ±ç”Ÿå£³ åšä¸€ä¸ªæ˜ å°„ï¼ˆè¿˜ä¸è¦æ±‚å¤–ç½‘ipçš„443ç«¯å£ï¼‰ã€‚</p>

<ul>
<li><a href="https://hsk.oray.com/download">https://hsk.oray.com/download</a></li>
<li><a href="https://service.oray.com/question/11630.html">https://service.oray.com/question/11630.html</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# wget "https://down.oray.com/hsk/linux/phddns_5.2.0_amd64.rpm" -O phddns_5.2.0_amd64.rpm
</span><span class='line'>--2023-03-16 12:59:06--  https://down.oray.com/hsk/linux/phddns_5.2.0_amd64.rpm
</span><span class='line'>
</span><span class='line'>Resolving down.oray.com (down.oray.com)... 163.181.42.225, 163.181.42.228, 163.181.42.223, ...
</span><span class='line'>Connecting to down.oray.com (down.oray.com)|163.181.42.225|:443... connected.
</span><span class='line'>HTTP request sent, awaiting response... 200 OK
</span><span class='line'>Length: 295240 (288K) [application/x-redhat-package-manager]
</span><span class='line'>Saving to: â€˜phddns_5.2.0_amd64.rpmâ€™
</span><span class='line'>
</span><span class='line'>100%[==========================================================================================================&gt;] 295,240     1.25MB/s   in 0.2s   
</span><span class='line'>
</span><span class='line'>2023-03-16 12:59:07 (1.25 MB/s) - â€˜phddns_5.2.0_amd64.rpmâ€™ saved [295240/295240]
</span><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# 
</span><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# rpm -ivh phddns_5.2.0_amd64.rpm       
</span><span class='line'>Preparing...                          ################################# [100%]
</span><span class='line'>
</span><span class='line'>+----------------Phtunnel start install--------------+
</span><span class='line'>
</span><span class='line'>Updating / installing...
</span><span class='line'>   1:phddns-5.2.0-1                   ################################# [100%]
</span><span class='line'>Binary file /proc/1/cmdline matches
</span><span class='line'>Created symlink from /etc/systemd/system/multi-user.target.wants/phtunnel.service to /usr/lib/systemd/system/phtunnel.service.
</span><span class='line'>Created symlink from /etc/systemd/system/multi-user.target.wants/phddns_mini_httpd.service to /usr/lib/systemd/system/phddns_mini_httpd.service.
</span><span class='line'>
</span><span class='line'>+-----------Phtunnel Service Install Success---------+
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>+--------------------------------------------------------+
</span><span class='line'>|                Oray Phtunnel Linux 5.2.0               |
</span><span class='line'>+--------------------------------------------------------+
</span><span class='line'>|     SN: orayc1xxxxx   Default password: admin     |
</span><span class='line'>+--------------------------------------------------------+
</span><span class='line'>| Usage: phddns(start|status|stop|restart|reset|version) |
</span><span class='line'>+--------------------------------------------------------+
</span><span class='line'>|       Remote Management Address http://b.oray.com      |
</span><span class='line'>+--------------------------------------------------------+
</span><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# 
</span><span class='line'>
</span><span class='line'># å¸è½½ï¼šyum remove phddns
</span><span class='line'># phddns startï¼ˆå¯åŠ¨ï¼‰| statusï¼ˆçŠ¶æ€ï¼‰| stopï¼ˆåœæ­¢ï¼‰|restartï¼ˆé‡å¯ï¼‰| resetï¼ˆé‡ç½®ï¼‰|enableï¼ˆå¼€æœºè‡ªå¯åŠ¨ï¼‰|disableï¼ˆå…³é—­å¼€æœºè‡ªå¯åŠ¨ï¼‰|versionï¼ˆç‰ˆæœ¬ï¼‰
</span></code></pre></td></tr></table></div></figure>


<p>ç”¨ä¸Šé¢çš„SNå·å’Œå¯†ç ç™»å½•ï¼Œåœ¨linuxä¸Šä¼šä»¥ä¸€ä¸ªè®¾å¤‡çš„æ–¹å¼ï¼Œç„¶åç»‘å®šåˆ°æˆ‘ä»¬çš„è´¦å·ï¼Œ</p>

<p>ç„¶åå†åˆ°è‡ªå·±çš„è´¦å·è®¾ç½® <code>https://console.hsk.oray.com/forward</code> å†…ç½‘ç©¿é€ï¼Œé…ç½®ä¸€ä¸ªhttpsæ˜ å°„çš„ã€‚</p>

<p><img src="http://winse.github.io/images/blogs/openai/hsk1.jpg" alt="" /></p>

<p><img src="http://winse.github.io/images/blogs/openai/hsk2.jpg" alt="" /></p>

<p>2 ä¿®æ”¹é…ç½®è¿æ¥å…¬ä¼—å·</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz bot-on-anything]# cat config.json 
</span><span class='line'>{
</span><span class='line'>  "model": {
</span><span class='line'>    "type" : "chatgpt",
</span><span class='line'>    "openai": {
</span><span class='line'>      "api_key": "sk-xxxxxx",
</span><span class='line'>      "proxy": "",
</span><span class='line'>      "conversation_max_tokens": 1000,
</span><span class='line'>      "character_desc": "ä½ æ˜¯ChatGPT, ä¸€ä¸ªç”±OpenAIè®­ç»ƒçš„å¤§å‹è¯­è¨€æ¨¡å‹, ä½ æ—¨åœ¨å›ç­”å¹¶è§£å†³äººä»¬çš„ä»»ä½•é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨å¤šç§è¯­è¨€ä¸äººäº¤æµã€‚"
</span><span class='line'>    }
</span><span class='line'>  },
</span><span class='line'>
</span><span class='line'>  "channel": {
</span><span class='line'>    "type": "wechat_mp",
</span><span class='line'>    "single_chat_prefix": ["bot", "@bot"],
</span><span class='line'>    "single_chat_reply_prefix": "[ChatGPT] ",
</span><span class='line'>    "group_chat_prefix": ["@bot"],
</span><span class='line'>    "group_name_white_list": ["ChatGPTæµ‹è¯•ç¾¤", "ChatGPTå“‡å“‡å“‡", "åˆ˜å…°å®¶", "ChatGPT"],
</span><span class='line'>    "image_create_prefix": ["ç”»", "çœ‹", "æ‰¾ä¸€å¼ "],
</span><span class='line'>
</span><span class='line'>    "terminal": {
</span><span class='line'>    },
</span><span class='line'>
</span><span class='line'>    "wechat": {
</span><span class='line'>    },
</span><span class='line'>
</span><span class='line'>    "wechat_mp": {
</span><span class='line'>      "token": "xxxxxx",
</span><span class='line'>      "port": "3000"
</span><span class='line'>    },
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>3 å®‰è£…ä¾èµ–</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz bot-on-anything]# scl enable rh-python38 bash 
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz bot-on-anything]# pip3 install werobot
</span><span class='line'>WARNING: Running pip install with root privileges is generally not a good idea. Try `pip3 install --user` instead.
</span><span class='line'>Looking in indexes: http://mirrors.aliyun.com/pypi/simple/
</span><span class='line'>Collecting werobot
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/84/98/6a16bc6c9b3c216efd28babe06f1891ff1fe3f7f96dfb88516545a8c9b30/WeRoBot-1.13.1-py2.py3-none-any.whl (44kB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 51kB 2.0MB/s 
</span><span class='line'>Collecting bottle
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/bb/1f/5977ea88c6a3df6199db97d320e5da816d415d1eb75a987a1f6823d5cc9d/bottle-0.12.25-py3-none-any.whl (90kB)
</span><span class='line'>     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 92kB 1.8MB/s 
</span><span class='line'>Requirement already satisfied: requests in /opt/rh/rh-python38/root/usr/local/lib/python3.8/site-packages (from werobot) (2.28.2)
</span><span class='line'>Collecting xmltodict
</span><span class='line'>  Downloading http://mirrors.aliyun.com/pypi/packages/94/db/fd0326e331726f07ff7f40675cd86aa804bfd2e5016c727fa761c934990e/xmltodict-0.13.0-py2.py3-none-any.whl
</span><span class='line'>Requirement already satisfied: certifi&gt;=2017.4.17 in /opt/rh/rh-python38/root/usr/local/lib/python3.8/site-packages (from requests-&gt;werobot) (2022.12.7)
</span><span class='line'>Requirement already satisfied: urllib3&lt;1.27,&gt;=1.21.1 in /opt/rh/rh-python38/root/usr/local/lib/python3.8/site-packages (from requests-&gt;werobot) (1.26.14)
</span><span class='line'>Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /opt/rh/rh-python38/root/usr/local/lib64/python3.8/site-packages (from requests-&gt;werobot) (3.0.1)
</span><span class='line'>Requirement already satisfied: idna&lt;4,&gt;=2.5 in /opt/rh/rh-python38/root/usr/local/lib/python3.8/site-packages (from requests-&gt;werobot) (3.4)
</span><span class='line'>Installing collected packages: bottle, xmltodict, werobot
</span><span class='line'>Successfully installed bottle-0.12.25 werobot-1.13.1 xmltodict-0.13.0
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz bot-on-anything]# 
</span></code></pre></td></tr></table></div></figure>


<p>å†ä¸‹è½½ä¸€ä¸ªæ•æ„Ÿå­—è¿‡æ»¤æ–‡ä»¶ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz bot-on-anything]# wget https://raw.githubusercontent.com/qloog/sensitive_words/master/keywords
</span><span class='line'>--2023-03-16 13:52:30--  https://raw.githubusercontent.com/qloog/sensitive_words/master/keywords
</span><span class='line'>Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.108.133, 185.199.110.133, 185.199.109.133, ...
</span><span class='line'>Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.108.133|:443... connected.
</span><span class='line'>HTTP request sent, awaiting response... 200 OK
</span><span class='line'>Length: 289615 (283K) [text/plain]
</span><span class='line'>Saving to: â€˜keywordsâ€™
</span><span class='line'>
</span><span class='line'>100%[==========================================================================================================&gt;] 289,615     --.-K/s   in 0.009s  
</span><span class='line'>
</span><span class='line'>2023-03-16 13:52:31 (32.0 MB/s) - â€˜keywordsâ€™ saved [289615/289615]
</span><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz bot-on-anything]# mv keywords  sensitive_words.txt
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz bot-on-anything]# 
</span></code></pre></td></tr></table></div></figure>


<p>é…ç½®å¥½åï¼Œå…ˆå¯åŠ¨æœåŠ¡ï¼Œå†ä¿®æ”¹å¾®ä¿¡å…¬ä¼—å·æ¥å£åœ°å€ã€‚</p>

<p>å¯åŠ¨è¿˜æ˜¯ç”¨ä¸Šé¢çš„è„šæœ¬å³å¯ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Bottle v0.12.25 server starting up (using AutoServer())...
</span><span class='line'>Listening on http://0.0.0.0:3000/</span></code></pre></td></tr></table></div></figure>


<p>4 ä¿®æ”¹å¾®ä¿¡å…¬ä¼—å·çš„æ¥å£åœ°å€</p>

<p>åœ¨ <code>è®¾ç½®ä¸å¼€å‘</code> - <code>åŸºæœ¬é…ç½®</code> çš„ <code>æœåŠ¡å™¨é…ç½®</code> çš„ <code>æœåŠ¡å™¨åœ°å€</code> ã€‚<code>ä»¤ç‰ŒTOKEN</code> ä¸ config.json é‡Œé¢çš„ä¸€è‡´ã€‚</p>

<p>ç„¶åå°±å¯ä»¥ç”¨å¾®ä¿¡å…¬ä¼—å·ä¸ChatGPTèŠå¤©äº†ã€‚</p>

<h1>è‡ªå·±ç </h1>

<p>1 å¯¹æ¥</p>

<p>å‚è€ƒï¼š</p>

<ul>
<li><a href="https://cnodejs.org/topic/59294bff9e32cc84569a746a">https://cnodejs.org/topic/59294bff9e32cc84569a746a</a></li>
<li><a href="https://github.com/SilenceHVK/wechatByNode">https://github.com/SilenceHVK/wechatByNode</a></li>
</ul>


<p>åœ¨å¾®ä¿¡å…¬ä¼—å·å¼€å¯æ¥å£è‡ªåŠ¨å›å¤åŠŸèƒ½ï¼Œåœ¨åŸºæœ¬é…ç½®-æœåŠ¡å™¨é…ç½®æŒ‡å®šåœ°å€å’Œä»¤ç‰Œã€‚</p>

<p>æœåŠ¡å™¨åœ°å€(URL) <a href="https://xxx.goho.co/">https://xxx.goho.co/</a></p>

<p>åœ°å€çš„ç«¯å£è¦æ˜¯80çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ èŠ±ç”Ÿå£³å†…ç½‘æ˜ å°„å¤–ç½‘çš„è½¯ä»¶ æ¥é…ç½®ä¸€ä¸ªhttpsï¼ŒæŒ‡å®šåˆ°æœ¬åœ°æœºå™¨å¯åŠ¨çš„æœåŠ¡ã€‚</p>

<p>2 socks proxy:</p>

<ul>
<li><a href="https://blog.csdn.net/z_xuewen/article/details/125935182">https://blog.csdn.net/z_xuewen/article/details/125935182</a></li>
<li><a href="https://medium.com/@paynoattn/using-a-socks-proxy-to-make-requests-in-node-js-ba5125c7999f">https://medium.com/@paynoattn/using-a-socks-proxy-to-make-requests-in-node-js-ba5125c7999f</a></li>
<li><a href="https://levelup.gitconnected.com/how-to-use-a-socks-proxy-in-axios-6c0355a2e013">https://levelup.gitconnected.com/how-to-use-a-socks-proxy-in-axios-6c0355a2e013</a></li>
</ul>


<p>3 pkg æ‰“åŒ…nodejsç¨‹åº</p>

<ul>
<li><a href="https://segmentfault.com/a/1190000041958374">https://segmentfault.com/a/1190000041958374</a></li>
</ul>


<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è®°git Reset --hard]]></title>
    <link href="http://winse.github.io/blog/2023/02/01/git-reset-hard/"/>
    <updated>2023-02-01T08:39:26+08:00</updated>
    <id>http://winse.github.io/blog/2023/02/01/git-reset-hard</id>
    <content type="html"><![CDATA[<p>å¹³æ—¶ä¸æ˜¯æ‰€æœ‰çš„æ”¹åŠ¨éƒ½æäº¤ï¼Œä¹Ÿä¿ç•™ä¸€äº›ä¸´æ—¶ä»£ç ã€‚ä»Šå¤©åœ¨ä¸»å¹²ä¸Šæäº¤äº†åï¼Œéœ€è¦resetåé€€åˆ°å‰å‡ å¤©çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯ç›´æ¥checkoutæ˜¯æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œå¦‚æœreset sortè¿˜éœ€è¦å¤„ç†indexï¼Œéº»çƒ¦ï¼Œå°±åœ¨eclipseä¸­ç‚¹å‡»äº†reset hardï¼Œæˆ‘å‹’ä¸ªå»ï¼Œ<strong>ç›´æ¥æŠŠ åŸæ¥æäº¤è¿‡çš„ä»£ç  æ”¹åŠ¨æ²¡æäº¤çš„ ç»™è¿˜åŸäº†</strong>ï¼ï¼ï¼</p>

<p><a href="https://stackoverflow.com/questions/9529078/how-do-i-use-git-reset-hard-head-to-revert-to-a-previous-commit">https://stackoverflow.com/questions/9529078/how-do-i-use-git-reset-hard-head-to-revert-to-a-previous-commit</a></p>

<blockquote><p>First, it&rsquo;s always worth noting that git reset &ndash;hard is a potentially dangerous command, since it throws away all your uncommitted changes. For safety, you should always check that the output of git status is clean (that is, empty) before using it.</p></blockquote>

<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æ³¨å†ŒOpenAI]]></title>
    <link href="http://winse.github.io/blog/2023/02/01/register-openai/"/>
    <updated>2023-02-01T07:09:45+08:00</updated>
    <id>http://winse.github.io/blog/2023/02/01/register-openai</id>
    <content type="html"><![CDATA[<p>ChatGPTå†ä¸€æ¬¡ç«ï¼Œè‡ªå·±ä¹Ÿæƒ³å°è¯•ä¸€ä¸‹å­ã€‚æ‰¾åˆ°å®˜ç½‘<a href="https://chat.openai.com">https://chat.openai.com</a>ä½†æ³¨å†Œçš„æ—¶åˆ»éœ€è¦æ‰‹æœºéªŒè¯ç ï¼Œå’±å›½å†…çš„æ‰‹æœºå·ç æ˜¯ä¸è¡Œçš„ã€‚</p>

<p>æœç´¢ä¹‹åæ‰¾åˆ°å¯ä»¥é€šè¿‡è™šæ‹Ÿæ‰‹æœºå·æ¥æ¥æ”¶çŸ­ä¿¡å®Œæˆæ³¨å†Œçš„æ–¹æ³•ï¼š<a href="https://cloud.tencent.com/developer/article/2190154">ä¸€æ–‡æ•™ä½ å¿«é€Ÿæ³¨å†ŒOpenAiï¼ˆChatGPTï¼‰ï¼Œå›½å†…ä¹Ÿå¯ä»¥ï¼</a></p>

<p>å®æ“æ­¥éª¤å¦‚ä¸‹ï¼š</p>

<h2>æ³¨å†Œç™»å½•smså¹¶å……å€¼</h2>

<p>1ã€ æ³¨å†Œç™»å½• <a href="https://sms-activate.org/#">https://sms-activate.org/#</a> ï¼Œå¯ç›´æ¥ä½¿ç”¨å›½å†…é‚®ç®±ã€‚</p>

<p>2ã€ å……å€¼çš„æ—¶åˆ»ï¼Œå…ˆæœä¸€ä¸‹openaiæœåŠ¡éœ€è¦çš„é‡‘é¢ã€‚</p>

<p><img src="http://winse.github.io/images/blogs/openai/openai-sms.png" alt="" /></p>

<p>ç„¶åé€‰æ‹©åˆä¸Šè§’çš„ä½™é¢ä¸‹æ‹‰èœå•çš„å……å€¼æŒ‰é’®ï¼Œç„¶åé€‰æ‹©æ”¯ä»˜å®ï¼Œå……å¯¹åº”é‡‘é¢çš„é’±ï¼ˆæˆ‘è¿™é‡Œæ˜¯10å¢å¸ƒï¼‰ã€‚</p>

<p><img src="http://winse.github.io/images/blogs/openai/openai-pay.png" alt="" /></p>

<p>æ”¯ä»˜æˆåŠŸåï¼Œè¦ç­‰ä¸€å°ä¼šï¼ˆåæ­£æˆ‘åˆ·äº†å‡ åˆ†é’Ÿï¼Œå……å€¼é¡µé¢æœ€ä¸‹é¢å¯ä»¥çœ‹å……å€¼å†å²ï¼‰ï¼Œæœ¬æ¥æ˜¯å……10å¢å¸ƒçš„ï¼Œåˆ°è´¦10.55å¢å¸ƒã€‚</p>

<p>3ã€ æœopenaiï¼Œåœ¨æä¾›çš„åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªå›½å®¶è´­ä¹°ï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªå¯¹åº”å›½å®¶çš„å·ç </p>

<p>ä¸€å¼€å§‹æˆ‘æ˜¯é€‰é©¬æ¥è¥¿äºšçš„ï¼Œä½†æ˜¯openaiæ³¨å†Œçš„æ—¶åˆ»è¯´è¿™ä¸ªå·ç è¢«æ³¨å†Œæ¬¡æ•°å¤ªå¤šï¼Œåé¢æ¢äº†å°åº¦çš„10.5ï¼ˆæ±‡ç‡å¤šå‡ºçš„0.5è¿˜æ˜¯è›®å¥½çš„ï¼‰ï¼Œå°±å¯ä»¥äº†ã€‚</p>

<p><img src="http://winse.github.io/images/blogs/openai/openai-phone.png" alt="" /></p>

<h2>é‚®ç®±æ³¨å†Œopenai</h2>

<p>ç›´æ¥<a href="https://chat.openai.com/chat">https://chat.openai.com/chat</a>ä½¿ç”¨å›½å†…çš„é‚®ç®±æ³¨å†Œï¼Œç„¶ååœ¨å¡«æ‰‹æœºå·ç çš„é¡µé¢é€‰æ‹©smsä¸­çš„å›½å®¶å’Œæä¾›çš„å·ç ï¼Œç­‰å‡ åç§’å°±èƒ½åœ¨smsçš„é¡µé¢çœ‹åˆ°6ä½æ•°å­—çš„çŸ­ä¿¡éªŒè¯ç </p>

<p>æ³¨æ„: éœ€è¦ç¿»å¢™æ‰èƒ½è®¿é—®ï¼ï¼ï¼</p>

<p><img src="http://winse.github.io/images/blogs/openai/openai.png" alt="" /></p>

<h2>ç©ç©</h2>

<p><img src="http://winse.github.io/images/blogs/openai/openai-e1.jpg" alt="" /></p>

<p><img src="http://winse.github.io/images/blogs/openai/openai-e2.png" alt="hello world" /></p>

<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¿¡åˆ›ç¯å¢ƒè¿ç§»æµ…æ-ä»¥Postgresä¸ºä¾‹]]></title>
    <link href="http://winse.github.io/blog/2022/07/24/xinchuang-install-postgres/"/>
    <updated>2022-07-24T09:16:24+08:00</updated>
    <id>http://winse.github.io/blog/2022/07/24/xinchuang-install-postgres</id>
    <content type="html"><![CDATA[<p>å›½å†…æœåŠ¡å™¨æ“ä½œç³»ç»Ÿä¸»è¦è¿˜æ˜¯åœ¨Linuxå„ä¸ªå‘è¡Œç‰ˆä¸Šå«æ¥è¿‡æ¥çš„ï¼Œåˆåšäº†å„ç§å°æ”¹åŠ¨ï¼Œæœ¬æ¥åœ¨ä¸»æµçš„æ“ä½œç³»ç»Ÿä¸Šå¯ä»¥æ¯”è¾ƒå®¹æ˜“å®‰è£…çš„åº”ç”¨è¿ç§»å¸¦æ¥äº†å„ç§å›°éš¾ï¼Œè·¯å¾„å¼‚å¸¸çš„è‰°è¾›ã€‚</p>

<p>é¦–å…ˆï¼Œçº¯æºç ç¼–è¯‘æ–¹å¼è¿™ç§ä¸åœ¨æˆ‘çš„é€‰æ‹©ä¹‹ä¸­ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šå‚è€ƒã€‚ä¸é‡å¤äº†ï¼ŒåŒæ—¶è¿™ç§æ–¹å¼ä¸å…·æœ‰æ“ä½œç®€å•å’Œå¯è„šæœ¬è¯çš„æ½œè´¨ï¼
å¦‚: <a href="https://blog.csdn.net/luo805914196/article/details/121083885">é“¶æ²³éº’éºŸv10 å®‰è£… postgis</a>
ä¸»è¦è¿˜æ˜¯å¯»æ±‚åŒ…ç®¡ç†yum/rpmçš„æ–¹å¼è¿›è¡Œå®‰è£…ã€‚
å…¶æ¬¡ï¼Œå¯»æ‰¾ä¾èµ–ç‰ˆæœ¬æ—¶ï¼Œä»¥ç³»ç»Ÿè‡ªå¸¦èƒ½é€‚é…æœ€ä½³ï¼›å†å°±æ˜¯ä¸æ”¹å˜ç³»ç»Ÿæ ¸å¿ƒå‰æä¸‹ï¼ˆgccï¼Œglibcï¼‰ï¼Œä½¿ç”¨rpmbuildé‡æ–°ç¼–è¯‘ä¾èµ–çš„src.rpmã€‚</p>

<p>ä¸‹é¢ä»¥kylin v10å®‰è£…postgres9.6+postgis2.4ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚</p>

<h2>ç¬¬ä¸€æ­¥ï¼Œäº†è§£ç³»ç»Ÿ</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# cat /etc/os-release 
</span><span class='line'>NAME="Kylin Linux Advanced Server"
</span><span class='line'>VERSION="V10 (Tercel)"
</span><span class='line'>ID="kylin"
</span><span class='line'>VERSION_ID="V10"
</span><span class='line'>PRETTY_NAME="Kylin Linux Advanced Server V10 (Tercel)"
</span><span class='line'>ANSI_COLOR="0;31"
</span><span class='line'>
</span><span class='line'>[root@col ~]# cat /etc/kylin-release 
</span><span class='line'>Kylin Linux Advanced Server release V10 (Tercel)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[root@col ~]# uname -a 
</span><span class='line'>Linux col 4.19.90-17.ky10.aarch64 #1 SMP Sun Jun 28 14:27:40 CST 2020 aarch64 aarch64 aarch64 GNU/Linux
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[root@col ~]# tail -n10 /proc/cpuinfo  
</span><span class='line'>processor       : 15
</span><span class='line'>model name      : HUAWEI,Kunpeng 920
</span><span class='line'>BogoMIPS        : 200.00
</span><span class='line'>Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma dcpop asimddp asimdfhm
</span><span class='line'>CPU implementer : 0x48
</span><span class='line'>CPU architecture: 8
</span><span class='line'>CPU variant     : 0x1
</span><span class='line'>CPU part        : 0xd01
</span><span class='line'>CPU revision    : 0
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum list glibc
</span><span class='line'>Last metadata expiration check: 1:03:03 ago on Sat 23 Jul 2022 07:54:01 PM CST.
</span><span class='line'>Installed Packages
</span><span class='line'>glibc.aarch64                                                                     2.28-36.1.ky10                                                                     @anaconda
</span><span class='line'>[root@col ~]# yum list gcc
</span><span class='line'>Last metadata expiration check: 1:04:34 ago on Sat 23 Jul 2022 07:54:01 PM CST.
</span><span class='line'>Installed Packages
</span><span class='line'>gcc.aarch64                                                                 7.3.0-20190804.h30.ky10                                                                  @anaconda
</span><span class='line'>[root@col ~]# yum list cpp
</span><span class='line'>Last metadata expiration check: 1:04:42 ago on Sat 23 Jul 2022 07:54:01 PM CST.
</span><span class='line'>Installed Packages
</span><span class='line'>cpp.aarch64                                                                 7.3.0-20190804.h30.ky10                                                                  @anaconda</span></code></pre></td></tr></table></div></figure>


<h2>ç¬¬äºŒæ­¥ å®‰è£…ä¸€ä¸‹åº”ç”¨</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# vi /etc/yum.repos.d/pgdg-redhat-all.repo 
</span><span class='line'>[pgdg-common]
</span><span class='line'>name=PostgreSQL common RPMs for RHEL / Rocky 8 - $basearch
</span><span class='line'>baseurl=https://download.postgresql.org/pub/repos/yum/common/redhat/rhel-8-$basearch
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=0
</span><span class='line'>
</span><span class='line'>[pgdg96]
</span><span class='line'>name=PostgreSQL 9.6 for RHEL / Rocky 8 - $basearch
</span><span class='line'>baseurl=https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel-8-$basearch
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=0
</span><span class='line'>
</span><span class='line'>[epel]
</span><span class='line'>name=epel
</span><span class='line'>baseurl=https://dl.fedoraproject.org/pub/epel/8/Everything/aarch64/
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=0
</span><span class='line'>
</span><span class='line'>[pgdg96-source]
</span><span class='line'>name=PostgreSQL 9.6 for RHEL / Rocky 8 - $basearch - Source
</span><span class='line'>baseurl=https://download.postgresql.org/pub/repos/yum/srpms/9.6/redhat/rhel-8-$basearch
</span><span class='line'>enabled=0
</span><span class='line'>gpgcheck=0
</span><span class='line'>
</span><span class='line'>[pgdg96-debuginfo]
</span><span class='line'>name=PostgreSQL 9.6 for RHEL / Rocky 8 - $basearch - Debuginfo
</span><span class='line'>baseurl=https://download.postgresql.org/pub/repos/yum/debug/9.6/redhat/rhel-8-$basearch
</span><span class='line'>enabled=0
</span><span class='line'>gpgcheck=0
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install postgresql96 postgresql96-server postgis24_96
</span><span class='line'>PostgreSQL common RPMs for RHEL / Rocky 8 - aarch64                                                                                           122 kB/s | 406 kB     00:03    
</span><span class='line'>PostgreSQL 9.6 for RHEL / Rocky 8 - aarch64                                                                                                    19 kB/s | 276 kB     00:14    
</span><span class='line'>epel                                                                                                                                           13 kB/s |  12 MB     16:11    
</span><span class='line'>Error: 
</span><span class='line'> Problem: package postgis24_96-2.4.9-3.rhel8.aarch64 requires libgdal.so.28()(64bit), but none of the providers can be installed
</span><span class='line'>  - package postgis24_96-2.4.9-3.rhel8.aarch64 requires gdal32-libs &gt;= 3.2.0, but none of the providers can be installed
</span><span class='line'>  - package gdal32-libs-3.2.2-12.rhel8.aarch64 requires libhdf5.so.103()(64bit), but none of the providers can be installed
</span><span class='line'>  - package gdal32-libs-3.2.2-13.rhel8.aarch64 requires libhdf5.so.103()(64bit), but none of the providers can be installed
</span><span class='line'>  - cannot install the best candidate for the job
</span><span class='line'>  - nothing provides libgfortran.so.5()(64bit) needed by hdf5-1.10.5-4.el8.aarch64
</span><span class='line'>  - nothing provides libgfortran.so.5(GFORTRAN_8)(64bit) needed by hdf5-1.10.5-4.el8.aarch64
</span><span class='line'>(try to add '--skip-broken' to skip uninstallable packages or '--nobest' to use not only best candidate packages)</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœæŒ‰centos8çš„åŒ…ç®¡ç†<a href="https://centos.pkgs.org/8/epel-aarch64/hdf5-1.10.5-4.el8.aarch64.rpm.html">hdf5-1.10.5-4.el8.aarch64</a>ï¼Œå¯ä»¥çœ‹å‡º <code>libgfortran.so.5(GFORTRAN_8)(64bit)</code> ä¾èµ–æœ€ç»ˆå°±ä¾èµ–åˆ° <code>gcc-8.5.0</code> ã€‚gccå‡çº§ä¼šæ¯”è¾ƒå¤æ‚ã€‚</p>

<p>å‚ç…§ <a href="http://c.biancheng.net/view/2921.html">Linux SRPMæºç åŒ…å®‰è£…</a> <a href="https://blog.csdn.net/jiajane/article/details/104409541">rpmrebuild æå–specé‡æ–°æ‰“åŒ…</a>çš„æ–¹å¼ï¼Œä½¿ç”¨rpmbuildåœ¨å½“å‰ç³»ç»Ÿä¸Šé‡æ–°ç¼–è¯‘æ‰“åŒ…ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# yum install rpmrebuild -y 
</span></code></pre></td></tr></table></div></figure>


<h2>hdf5</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# rpmbuild --rebuild hdf5-1.10.5-4.el8.src.rpm 
</span><span class='line'>Installing hdf5-1.10.5-4.el8.src.rpm
</span><span class='line'>warning: hdf5-1.10.5-4.el8.src.rpm: Header V3 RSA/SHA256 Signature, key ID 2f86d6a1: NOKEY
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>error: Failed build dependencies:
</span><span class='line'>        hamcrest is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        java-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        javapackages-tools is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        junit is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        krb5-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        libaec-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        mpich-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        openmpi-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        openssl-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>        slf4j is needed by hdf5-1.10.5-4.ky10.ky10.aarch64</span></code></pre></td></tr></table></div></figure>


<p>æŸ¥æ‰¾ <code>https://pkgs.org/search/?q=hamcrest</code> å¹¶ä¸‹è½½javaç›¸å…³çš„æ¨¡å—centos8ä¾èµ–ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# ll *.rpm
</span><span class='line'>-rw------- 1 root root  305031 Jul 23 22:12 cglib-3.2.4-7.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  147131 Jul 23 22:11 easymock-3.5-4.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  131075 Jul 23 22:08 hamcrest-1.3-23.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root   60043 Jul 23 22:08 hamcrest-core-1.3-23.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw-r--r-- 1 root root 8739906 Jul 22 14:57 hdf5-1.10.5-4.el8.src.rpm
</span><span class='line'>-rw------- 1 root root  307067 Jul 23 22:08 junit-4.12-9.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  457315 Jul 23 22:12 objectweb-asm-6.2-5.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  108627 Jul 23 22:12 objenesis-2.6-2.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  305655 Jul 23 22:12 qdox-2.0-3.M9.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root   78511 Jul 23 22:08 slf4j-1.7.25-4.module_el8.0.0+39+6a9b6e22.noarch.rpm
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install ./hamcrest-* ./junit-* ./slf4j-* ./easymock-* ./qdox-* ./cglib-* ./objectweb-asm-* ./objenesis-*
</span><span class='line'>Last metadata expiration check: 0:48:28 ago on Sat 23 Jul 2022 09:25:01 PM CST.
</span><span class='line'>Dependencies resolved.
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'> Package                                         Architecture                Version                                                   Repository                        Size
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> hamcrest                                        noarch                      1.3-23.module_el8.0.0+30+832da3a1                         @commandline                     128 k
</span><span class='line'> hamcrest-core                                   noarch                      1.3-23.module_el8.0.0+30+832da3a1                         @commandline                      59 k
</span><span class='line'> junit                                           noarch                      1:4.12-9.module_el8.0.0+30+832da3a1                       @commandline                     300 k
</span><span class='line'> slf4j                                           noarch                      1.7.25-4.module_el8.0.0+39+6a9b6e22                       @commandline                      77 k
</span><span class='line'> easymock                                        noarch                      3.5-4.module_el8.0.0+30+832da3a1                          @commandline                     144 k
</span><span class='line'> qdox                                            noarch                      2.0-3.M9.module_el8.0.0+30+832da3a1                       @commandline                     298 k
</span><span class='line'> cglib                                           noarch                      3.2.4-7.module_el8.0.0+30+832da3a1                        @commandline                     298 k
</span><span class='line'> objectweb-asm                                   noarch                      6.2-5.module_el8.0.0+30+832da3a1                          @commandline                     447 k
</span><span class='line'> objenesis                                       noarch                      2.6-2.module_el8.0.0+30+832da3a1                          @commandline                     106 k
</span><span class='line'>Installing dependencies:
</span><span class='line'> copy-jdk-configs                                noarch                      3.7-3.ky10                                                ks10-adv-os                       23 k
</span><span class='line'> java-1.8.0-openjdk-headless                     aarch64                     1:1.8.0.242.b08-1.h5.ky10                                 ks10-adv-os                       32 M
</span><span class='line'> javapackages-filesystem                         noarch                      5.3.0-2.ky10                                              ks10-adv-os                      9.8 k
</span><span class='line'> javapackages-tools                              noarch                      5.3.0-2.ky10                                              ks10-adv-os                       30 k
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'>Install  13 Packages
</span><span class='line'>
</span><span class='line'>Total size: 34 M
</span><span class='line'>Total download size: 32 M
</span><span class='line'>Installed size: 111 M
</span><span class='line'>Is this ok [y/N]: y
</span><span class='line'>Downloading Packages:
</span><span class='line'>(1/4): javapackages-filesystem-5.3.0-2.ky10.noarch.rpm                                                                                         36 kB/s | 9.8 kB     00:00    
</span><span class='line'>(2/4): copy-jdk-configs-3.7-3.ky10.noarch.rpm                                                                                                  72 kB/s |  23 kB     00:00    
</span><span class='line'>(3/4): javapackages-tools-5.3.0-2.ky10.noarch.rpm                                                                                             641 kB/s |  30 kB     00:00    
</span><span class='line'>(4/4): java-1.8.0-openjdk-headless-1.8.0.242.b08-1.h5.ky10.aarch64.rpm                                                                        259 kB/s |  32 MB     02:07    
</span><span class='line'>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Total                                                                                                                                         260 kB/s |  32 MB     02:07     
</span><span class='line'>Running transaction check
</span><span class='line'>Transaction check succeeded.
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded.
</span><span class='line'>Running transaction
</span><span class='line'>  Running scriptlet: copy-jdk-configs-3.7-3.ky10.noarch                                                                                                                   1/1 
</span><span class='line'>  Running scriptlet: java-1.8.0-openjdk-headless-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                        1/1 
</span><span class='line'>  Preparing        :                                                                                                                                                      1/1 
</span><span class='line'>  Installing       : javapackages-filesystem-5.3.0-2.ky10.noarch                                                                                                         1/13 
</span><span class='line'>  Installing       : copy-jdk-configs-3.7-3.ky10.noarch                                                                                                                  2/13 
</span><span class='line'>  Installing       : java-1.8.0-openjdk-headless-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                       3/13 
</span><span class='line'>  Running scriptlet: java-1.8.0-openjdk-headless-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                       3/13 
</span><span class='line'>  Installing       : hamcrest-core-1.3-23.module_el8.0.0+30+832da3a1.noarch                                                                                              4/13 
</span><span class='line'>  Installing       : javapackages-tools-5.3.0-2.ky10.noarch                                                                                                              5/13 
</span><span class='line'>  Installing       : objectweb-asm-6.2-5.module_el8.0.0+30+832da3a1.noarch                                                                                               6/13 
</span><span class='line'>  Installing       : cglib-3.2.4-7.module_el8.0.0+30+832da3a1.noarch                                                                                                     7/13 
</span><span class='line'>  Installing       : qdox-2.0-3.M9.module_el8.0.0+30+832da3a1.noarch                                                                                                     8/13 
</span><span class='line'>  Installing       : objenesis-2.6-2.module_el8.0.0+30+832da3a1.noarch                                                                                                   9/13 
</span><span class='line'>  Installing       : easymock-3.5-4.module_el8.0.0+30+832da3a1.noarch                                                                                                   10/13 
</span><span class='line'>  Installing       : hamcrest-1.3-23.module_el8.0.0+30+832da3a1.noarch                                                                                                  11/13 
</span><span class='line'>  Installing       : junit-1:4.12-9.module_el8.0.0+30+832da3a1.noarch                                                                                                   12/13 
</span><span class='line'>  Installing       : slf4j-1.7.25-4.module_el8.0.0+39+6a9b6e22.noarch                                                                                                   13/13 
</span><span class='line'>  Running scriptlet: copy-jdk-configs-3.7-3.ky10.noarch                                                                                                                 13/13 
</span><span class='line'>  Running scriptlet: slf4j-1.7.25-4.module_el8.0.0+39+6a9b6e22.noarch                                                                                                   13/13 
</span><span class='line'>  Verifying        : copy-jdk-configs-3.7-3.ky10.noarch                                                                                                                  1/13 
</span><span class='line'>  Verifying        : java-1.8.0-openjdk-headless-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                       2/13 
</span><span class='line'>  Verifying        : javapackages-filesystem-5.3.0-2.ky10.noarch                                                                                                         3/13 
</span><span class='line'>  Verifying        : javapackages-tools-5.3.0-2.ky10.noarch                                                                                                              4/13 
</span><span class='line'>  Verifying        : hamcrest-1.3-23.module_el8.0.0+30+832da3a1.noarch                                                                                                   5/13 
</span><span class='line'>  Verifying        : hamcrest-core-1.3-23.module_el8.0.0+30+832da3a1.noarch                                                                                              6/13 
</span><span class='line'>  Verifying        : junit-1:4.12-9.module_el8.0.0+30+832da3a1.noarch                                                                                                    7/13 
</span><span class='line'>  Verifying        : slf4j-1.7.25-4.module_el8.0.0+39+6a9b6e22.noarch                                                                                                    8/13 
</span><span class='line'>  Verifying        : easymock-3.5-4.module_el8.0.0+30+832da3a1.noarch                                                                                                    9/13 
</span><span class='line'>  Verifying        : qdox-2.0-3.M9.module_el8.0.0+30+832da3a1.noarch                                                                                                    10/13 
</span><span class='line'>  Verifying        : cglib-3.2.4-7.module_el8.0.0+30+832da3a1.noarch                                                                                                    11/13 
</span><span class='line'>  Verifying        : objectweb-asm-6.2-5.module_el8.0.0+30+832da3a1.noarch                                                                                              12/13 
</span><span class='line'>  Verifying        : objenesis-2.6-2.module_el8.0.0+30+832da3a1.noarch                                                                                                  13/13 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  hamcrest-1.3-23.module_el8.0.0+30+832da3a1.noarch    hamcrest-core-1.3-23.module_el8.0.0+30+832da3a1.noarch           junit-1:4.12-9.module_el8.0.0+30+832da3a1.noarch    
</span><span class='line'>  slf4j-1.7.25-4.module_el8.0.0+39+6a9b6e22.noarch     easymock-3.5-4.module_el8.0.0+30+832da3a1.noarch                 qdox-2.0-3.M9.module_el8.0.0+30+832da3a1.noarch     
</span><span class='line'>  cglib-3.2.4-7.module_el8.0.0+30+832da3a1.noarch      objectweb-asm-6.2-5.module_el8.0.0+30+832da3a1.noarch            objenesis-2.6-2.module_el8.0.0+30+832da3a1.noarch   
</span><span class='line'>  copy-jdk-configs-3.7-3.ky10.noarch                   java-1.8.0-openjdk-headless-1:1.8.0.242.b08-1.h5.ky10.aarch64    javapackages-filesystem-5.3.0-2.ky10.noarch         
</span><span class='line'>  javapackages-tools-5.3.0-2.ky10.noarch              
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>[root@col ~]# 
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install java-devel javapackages-tools krb5-devel libaec-devel mpich-devel openssl-devel
</span><span class='line'>Last metadata expiration check: 0:54:34 ago on Sat 23 Jul 2022 09:25:01 PM CST.
</span><span class='line'>Package javapackages-tools-5.3.0-2.ky10.noarch is already installed.
</span><span class='line'>Dependencies resolved.
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'> Package                                          Architecture                    Version                                           Repository                           Size
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> java-1.8.0-openjdk-devel                         aarch64                         1:1.8.0.242.b08-1.h5.ky10                         ks10-adv-os                         7.8 M
</span><span class='line'> krb5-devel                                       aarch64                         1.17-9.ky10                                       ks10-adv-os                         160 k
</span><span class='line'> libaec-devel                                     aarch64                         1.0.4-1.ky10                                      ks10-adv-os                         9.9 k
</span><span class='line'> mpich-devel                                      aarch64                         3.2.1-10.ky10                                     ks10-adv-os                         121 k
</span><span class='line'> openssl-devel                                    aarch64                         1:1.1.1d-9.ky10                                   ks10-adv-os                         1.7 M
</span><span class='line'>Installing dependencies:
</span><span class='line'> e2fsprogs-devel                                  aarch64                         1.45.3-4.p01.ky10                                 ks10-adv-os                         287 k
</span><span class='line'> hwloc                                            aarch64                         1.11.9-3.ky10                                     ks10-adv-os                         1.7 M
</span><span class='line'> java-1.8.0-openjdk                               aarch64                         1:1.8.0.242.b08-1.h5.ky10                         ks10-adv-os                         382 k
</span><span class='line'> keyutils-libs-devel                              aarch64                         1.5.10-11.ky10                                    ks10-adv-os                         9.8 k
</span><span class='line'> libaec                                           aarch64                         1.0.4-1.ky10                                      ks10-adv-os                          34 k
</span><span class='line'> libverto-devel                                   aarch64                         0.3.1-2.ky10                                      ks10-adv-os                          16 k
</span><span class='line'> lua-filesystem                                   aarch64                         1.6.3-10.ky10                                     ks10-adv-os                          17 k
</span><span class='line'> mpich                                            aarch64                         3.2.1-10.ky10                                     ks10-adv-os                         1.0 M
</span><span class='line'> Lmod                                             aarch64                         8.7.7-1.el8                                       epel                                261 k
</span><span class='line'> lua-term                                         aarch64                         0.07-9.el8                                        epel                                 16 k
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'>Install  15 Packages
</span><span class='line'>
</span><span class='line'>Total download size: 13 M
</span><span class='line'>Installed size: 60 M
</span><span class='line'>Is this ok [y/N]: y
</span><span class='line'>Downloading Packages:
</span><span class='line'>(1/15): e2fsprogs-devel-1.45.3-4.p01.ky10.aarch64.rpm                                                                                          46 kB/s | 287 kB     00:06    
</span><span class='line'>(2/15): java-1.8.0-openjdk-1.8.0.242.b08-1.h5.ky10.aarch64.rpm                                                                                 60 kB/s | 382 kB     00:06    
</span><span class='line'>(3/15): keyutils-libs-devel-1.5.10-11.ky10.aarch64.rpm                                                                                        454 kB/s | 9.8 kB     00:00    
</span><span class='line'>(4/15): krb5-devel-1.17-9.ky10.aarch64.rpm                                                                                                    7.4 MB/s | 160 kB     00:00    
</span><span class='line'>(5/15): libaec-1.0.4-1.ky10.aarch64.rpm                                                                                                       1.9 MB/s |  34 kB     00:00    
</span><span class='line'>(6/15): libaec-devel-1.0.4-1.ky10.aarch64.rpm                                                                                                 619 kB/s | 9.9 kB     00:00    
</span><span class='line'>(7/15): libverto-devel-0.3.1-2.ky10.aarch64.rpm                                                                                               1.1 MB/s |  16 kB     00:00    
</span><span class='line'>(8/15): lua-filesystem-1.6.3-10.ky10.aarch64.rpm                                                                                              1.1 MB/s |  17 kB     00:00    
</span><span class='line'>(9/15): mpich-3.2.1-10.ky10.aarch64.rpm                                                                                                       491 kB/s | 1.0 MB     00:02    
</span><span class='line'>(10/15): mpich-devel-3.2.1-10.ky10.aarch64.rpm                                                                                                3.4 MB/s | 121 kB     00:00    
</span><span class='line'>(11/15): hwloc-1.11.9-3.ky10.aarch64.rpm                                                                                                      161 kB/s | 1.7 MB     00:10    
</span><span class='line'>(12/15): openssl-devel-1.1.1d-9.ky10.aarch64.rpm                                                                                              376 kB/s | 1.7 MB     00:04    
</span><span class='line'>(13/15): lua-term-0.07-9.el8.aarch64.rpm                                                                                                       15 kB/s |  16 kB     00:01    
</span><span class='line'>(14/15): java-1.8.0-openjdk-devel-1.8.0.242.b08-1.h5.ky10.aarch64.rpm                                                                         274 kB/s | 7.8 MB     00:28    
</span><span class='line'>(15/15): Lmod-8.7.7-1.el8.aarch64.rpm                                                                                                         9.0 kB/s | 261 kB     00:29    
</span><span class='line'>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Total                                                                                                                                         346 kB/s |  13 MB     00:39     
</span><span class='line'>Running transaction check
</span><span class='line'>Transaction check succeeded.
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded.
</span><span class='line'>Running transaction
</span><span class='line'>  Preparing        :                                                                                                                                                      1/1 
</span><span class='line'>  Installing       : lua-term-0.07-9.el8.aarch64                                                                                                                         1/15 
</span><span class='line'>  Installing       : lua-filesystem-1.6.3-10.ky10.aarch64                                                                                                                2/15 
</span><span class='line'>  Installing       : Lmod-8.7.7-1.el8.aarch64                                                                                                                            3/15 
</span><span class='line'>  Running scriptlet: Lmod-8.7.7-1.el8.aarch64                                                                                                                            3/15 
</span><span class='line'>  Installing       : libverto-devel-0.3.1-2.ky10.aarch64                                                                                                                 4/15 
</span><span class='line'>  Installing       : libaec-1.0.4-1.ky10.aarch64                                                                                                                         5/15 
</span><span class='line'>  Installing       : keyutils-libs-devel-1.5.10-11.ky10.aarch64                                                                                                          6/15 
</span><span class='line'>  Installing       : java-1.8.0-openjdk-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                                7/15 
</span><span class='line'>  Running scriptlet: java-1.8.0-openjdk-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                                7/15 
</span><span class='line'>  Installing       : hwloc-1.11.9-3.ky10.aarch64                                                                                                                         8/15 
</span><span class='line'>  Installing       : mpich-3.2.1-10.ky10.aarch64                                                                                                                         9/15 
</span><span class='line'>  Running scriptlet: mpich-3.2.1-10.ky10.aarch64                                                                                                                         9/15 
</span><span class='line'>  Installing       : e2fsprogs-devel-1.45.3-4.p01.ky10.aarch64                                                                                                          10/15 
</span><span class='line'>  Running scriptlet: e2fsprogs-devel-1.45.3-4.p01.ky10.aarch64                                                                                                          10/15 
</span><span class='line'>  Installing       : krb5-devel-1.17-9.ky10.aarch64                                                                                                                     11/15 
</span><span class='line'>  Installing       : openssl-devel-1:1.1.1d-9.ky10.aarch64                                                                                                              12/15 
</span><span class='line'>  Installing       : mpich-devel-3.2.1-10.ky10.aarch64                                                                                                                  13/15 
</span><span class='line'>  Installing       : java-1.8.0-openjdk-devel-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                         14/15 
</span><span class='line'>  Running scriptlet: java-1.8.0-openjdk-devel-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                         14/15 
</span><span class='line'>  Installing       : libaec-devel-1.0.4-1.ky10.aarch64                                                                                                                  15/15 
</span><span class='line'>  Running scriptlet: java-1.8.0-openjdk-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                               15/15 
</span><span class='line'>  Running scriptlet: java-1.8.0-openjdk-devel-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                         15/15 
</span><span class='line'>  Running scriptlet: libaec-devel-1.0.4-1.ky10.aarch64                                                                                                                  15/15 
</span><span class='line'>  Verifying        : e2fsprogs-devel-1.45.3-4.p01.ky10.aarch64                                                                                                           1/15 
</span><span class='line'>  Verifying        : hwloc-1.11.9-3.ky10.aarch64                                                                                                                         2/15 
</span><span class='line'>  Verifying        : java-1.8.0-openjdk-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                                3/15 
</span><span class='line'>  Verifying        : java-1.8.0-openjdk-devel-1:1.8.0.242.b08-1.h5.ky10.aarch64                                                                                          4/15 
</span><span class='line'>  Verifying        : keyutils-libs-devel-1.5.10-11.ky10.aarch64                                                                                                          5/15 
</span><span class='line'>  Verifying        : krb5-devel-1.17-9.ky10.aarch64                                                                                                                      6/15 
</span><span class='line'>  Verifying        : libaec-1.0.4-1.ky10.aarch64                                                                                                                         7/15 
</span><span class='line'>  Verifying        : libaec-devel-1.0.4-1.ky10.aarch64                                                                                                                   8/15 
</span><span class='line'>  Verifying        : libverto-devel-0.3.1-2.ky10.aarch64                                                                                                                 9/15 
</span><span class='line'>  Verifying        : lua-filesystem-1.6.3-10.ky10.aarch64                                                                                                               10/15 
</span><span class='line'>  Verifying        : mpich-3.2.1-10.ky10.aarch64                                                                                                                        11/15 
</span><span class='line'>  Verifying        : mpich-devel-3.2.1-10.ky10.aarch64                                                                                                                  12/15 
</span><span class='line'>  Verifying        : openssl-devel-1:1.1.1d-9.ky10.aarch64                                                                                                              13/15 
</span><span class='line'>  Verifying        : Lmod-8.7.7-1.el8.aarch64                                                                                                                           14/15 
</span><span class='line'>  Verifying        : lua-term-0.07-9.el8.aarch64                                                                                                                        15/15 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  java-1.8.0-openjdk-devel-1:1.8.0.242.b08-1.h5.ky10.aarch64       krb5-devel-1.17-9.ky10.aarch64                             libaec-devel-1.0.4-1.ky10.aarch64               
</span><span class='line'>  mpich-devel-3.2.1-10.ky10.aarch64                                openssl-devel-1:1.1.1d-9.ky10.aarch64                      e2fsprogs-devel-1.45.3-4.p01.ky10.aarch64       
</span><span class='line'>  hwloc-1.11.9-3.ky10.aarch64                                      java-1.8.0-openjdk-1:1.8.0.242.b08-1.h5.ky10.aarch64       keyutils-libs-devel-1.5.10-11.ky10.aarch64      
</span><span class='line'>  libaec-1.0.4-1.ky10.aarch64                                      libverto-devel-0.3.1-2.ky10.aarch64                        lua-filesystem-1.6.3-10.ky10.aarch64            
</span><span class='line'>  mpich-3.2.1-10.ky10.aarch64                                      Lmod-8.7.7-1.el8.aarch64                                   lua-term-0.07-9.el8.aarch64                     
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>[root@col ~]# 
</span><span class='line'>
</span><span class='line'>[root@col ~]# rpmbuild --rebuild hdf5-1.10.5-4.el8.src.rpm 
</span><span class='line'>Installing hdf5-1.10.5-4.el8.src.rpm
</span><span class='line'>warning: hdf5-1.10.5-4.el8.src.rpm: Header V3 RSA/SHA256 Signature, key ID 2f86d6a1: NOKEY
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>error: Failed build dependencies:
</span><span class='line'>        openmpi-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64</span></code></pre></td></tr></table></div></figure>


<h3>å†ç¼–è¯‘openmpi</h3>

<p>æºç <a href="https://centos.pkgs.org/8/centos-appstream-aarch64/openmpi-devel-4.1.1-2.el8.aarch64.rpm.html">æŸ¥æ‰¾åé€‰æ‹©centos8çš„ç‰ˆæœ¬</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# rpmbuild --rebuild openmpi-4.1.1-2.el8.src.rpm 
</span><span class='line'>Installing openmpi-4.1.1-2.el8.src.rpm
</span><span class='line'>warning: openmpi-4.1.1-2.el8.src.rpm: Header V3 RSA/SHA256 Signature, key ID 8483c65d: NOKEY
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mockbuild does not exist - using root
</span><span class='line'>error: Failed build dependencies:
</span><span class='line'>        hwloc-devel &gt;= 2.2.0 is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        libevent-devel is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        libfabric-devel is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        opensm-devel &gt; 3.3.0 is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        papi-devel is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        pmix-devel is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        rdma-core-devel is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        rpm-mpi-hooks is needed by openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>        ucx-devel is needed by openmpi-4.1.1-2.ky10.ky10.aarch64</span></code></pre></td></tr></table></div></figure>


<p>ä¸‹è½½ä¾èµ–</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# ll *.rpm
</span><span class='line'>-rw------- 1 root root  305031 Jul 23 22:12 cglib-3.2.4-7.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  147131 Jul 23 22:11 easymock-3.5-4.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  131075 Jul 23 22:08 hamcrest-1.3-23.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root   60043 Jul 23 22:08 hamcrest-core-1.3-23.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw-r--r-- 1 root root 8739906 Jul 22 14:57 hdf5-1.10.5-4.el8.src.rpm
</span><span class='line'>-rw------- 1 root root  254060 Jul 23 22:32 hwloc-devel-2.2.0-3.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root   67048 Jul 23 22:32 hwloc-gui-2.2.0-3.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root 2085332 Jul 23 22:32 hwloc-libs-2.2.0-3.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root  307067 Jul 23 22:08 junit-4.12-9.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  457315 Jul 23 22:12 objectweb-asm-6.2-5.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  108627 Jul 23 22:12 objenesis-2.6-2.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root 9846455 Jul 23 22:26 openmpi-4.1.1-2.el8.src.rpm
</span><span class='line'>-rw------- 1 root root  685564 Jul 24 06:23 pmix-2.2.4rc1-1.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root   60776 Jul 24 06:23 pmix-devel-2.2.4rc1-1.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root  305655 Jul 23 22:12 qdox-2.0-3.M9.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root   13320 Jul 23 22:27 rpm-mpi-hooks-8-2.el8.noarch.rpm
</span><span class='line'>-rw------- 1 root root   78511 Jul 23 22:08 slf4j-1.7.25-4.module_el8.0.0+39+6a9b6e22.noarch.rpm
</span><span class='line'>-rw------- 1 root root  541892 Jul 23 22:27 ucx-1.10.1-2.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root  162896 Jul 23 22:27 ucx-devel-1.10.1-2.el8.aarch64.rpm
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install ./rpm-mpi-hooks-8-2.el8.noarch.rpm ./ucx-* 
</span><span class='line'>Last metadata expiration check: 1:03:14 ago on Sat 23 Jul 2022 09:25:01 PM CST.
</span><span class='line'>Dependencies resolved.
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'> Package                                    Architecture                         Version                                      Repository                                 Size
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> rpm-mpi-hooks                              noarch                               8-2.el8                                      @commandline                               13 k
</span><span class='line'> ucx                                        aarch64                              1.10.1-2.el8                                 @commandline                              529 k
</span><span class='line'> ucx-devel                                  aarch64                              1.10.1-2.el8                                 @commandline                              159 k
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>==============================================================================================================================================================================
</span><span class='line'>Install  3 Packages
</span><span class='line'>
</span><span class='line'>Total size: 701 k
</span><span class='line'>Installed size: 2.5 M
</span><span class='line'>Is this ok [y/N]: y
</span><span class='line'>Downloading Packages:
</span><span class='line'>Running transaction check
</span><span class='line'>Transaction check succeeded.
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded.
</span><span class='line'>Running transaction
</span><span class='line'>  Preparing        :                                                                                                                                                      1/1 
</span><span class='line'>  Installing       : ucx-1.10.1-2.el8.aarch64                                                                                                                             1/3 
</span><span class='line'>  Running scriptlet: ucx-1.10.1-2.el8.aarch64                                                                                                                             1/3 
</span><span class='line'>  Installing       : ucx-devel-1.10.1-2.el8.aarch64                                                                                                                       2/3 
</span><span class='line'>  Installing       : rpm-mpi-hooks-8-2.el8.noarch                                                                                                                         3/3 
</span><span class='line'>  Running scriptlet: rpm-mpi-hooks-8-2.el8.noarch                                                                                                                         3/3 
</span><span class='line'>  Verifying        : rpm-mpi-hooks-8-2.el8.noarch                                                                                                                         1/3 
</span><span class='line'>  Verifying        : ucx-1.10.1-2.el8.aarch64                                                                                                                             2/3 
</span><span class='line'>  Verifying        : ucx-devel-1.10.1-2.el8.aarch64                                                                                                                       3/3 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  rpm-mpi-hooks-8-2.el8.noarch                              ucx-1.10.1-2.el8.aarch64                              ucx-devel-1.10.1-2.el8.aarch64                             
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum remove hwloc
</span><span class='line'>Dependencies resolved.
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'> Package                                  Architecture                         Version                                       Repository                                 Size
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Removing:
</span><span class='line'> hwloc                                    aarch64                              1.11.9-3.ky10                                 @ks10-adv-os                              3.2 M
</span><span class='line'>Removing dependent packages:
</span><span class='line'> hwloc-devel                              aarch64                              1.11.9-3.ky10                                 @ks10-adv-os                              405 k
</span><span class='line'> pmix-devel                               aarch64                              3.1.4-2.oe1                                   @ks10-adv-os                              295 k
</span><span class='line'>Removing unused dependencies:
</span><span class='line'> munge                                    aarch64                              0.5.13-3.oe1                                  @ks10-adv-os                              442 k
</span><span class='line'> pmix                                     aarch64                              3.1.4-2.oe1                                   @ks10-adv-os                              2.7 M
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Remove  5 Packages
</span><span class='line'>
</span><span class='line'>Freed space: 7.0 M
</span><span class='line'>Is this ok [y/N]: y
</span><span class='line'>Running transaction check
</span><span class='line'>Transaction check succeeded.
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded.
</span><span class='line'>Running transaction
</span><span class='line'>  Preparing        :                                                                                                                                                     1/1 
</span><span class='line'>  Erasing          : pmix-devel-3.1.4-2.oe1.aarch64                                                                                                                      1/5 
</span><span class='line'>  Running scriptlet: pmix-devel-3.1.4-2.oe1.aarch64                                                                                                                      1/5 
</span><span class='line'>  Erasing          : hwloc-devel-1.11.9-3.ky10.aarch64                                                                                                                   2/5 
</span><span class='line'>  Erasing          : pmix-3.1.4-2.oe1.aarch64                                                                                                                            3/5 
</span><span class='line'>  Running scriptlet: pmix-3.1.4-2.oe1.aarch64                                                                                                                            3/5 
</span><span class='line'>  Erasing          : hwloc-1.11.9-3.ky10.aarch64                                                                                                                         4/5 
</span><span class='line'>  Running scriptlet: munge-0.5.13-3.oe1.aarch64                                                                                                                          5/5 
</span><span class='line'>  Erasing          : munge-0.5.13-3.oe1.aarch64                                                                                                                          5/5 
</span><span class='line'>  Running scriptlet: munge-0.5.13-3.oe1.aarch64                                                                                                                          5/5 
</span><span class='line'>  Verifying        : hwloc-1.11.9-3.ky10.aarch64                                                                                                                         1/5 
</span><span class='line'>  Verifying        : hwloc-devel-1.11.9-3.ky10.aarch64                                                                                                                   2/5 
</span><span class='line'>  Verifying        : munge-0.5.13-3.oe1.aarch64                                                                                                                          3/5 
</span><span class='line'>  Verifying        : pmix-3.1.4-2.oe1.aarch64                                                                                                                            4/5 
</span><span class='line'>  Verifying        : pmix-devel-3.1.4-2.oe1.aarch64                                                                                                                      5/5 
</span><span class='line'>
</span><span class='line'>Removed:
</span><span class='line'>  hwloc-1.11.9-3.ky10.aarch64      hwloc-devel-1.11.9-3.ky10.aarch64      pmix-devel-3.1.4-2.oe1.aarch64      munge-0.5.13-3.oe1.aarch64      pmix-3.1.4-2.oe1.aarch64     
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>[root@col ~]# 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install libevent-devel libfabric-devel papi-devel rdma-core-devel opensm-devel ./hwloc-libs-2.2.0-3.el8.aarch64.rpm ./hwloc-devel-2.2.0-3.el8.aarch64.rpm ./hwloc-gui-2.2.0-3.el8.aarch64.rpm ./pmix-2.2.4rc1-1.el8.aarch64.rpm ./pmix-devel-2.2.4rc1-1.el8.aarch64.rpm            
</span><span class='line'>
</span><span class='line'>[root@col ~]# rpmbuild --rebuild openmpi-4.1.1-2.el8.src.rpm 
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install ~/rpmbuild/RPMS/aarch64/openmpi-4.1.1-2.ky10.ky10.aarch64.rpm ~/rpmbuild/RPMS/aarch64/openmpi-devel-4.1.1-2.ky10.ky10.aarch64.rpm 
</span></code></pre></td></tr></table></div></figure>


<h3>mpich</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# rpmbuild --rebuild hdf5-1.10.5-4.el8.src.rpm   
</span><span class='line'>Installing hdf5-1.10.5-4.el8.src.rpm
</span><span class='line'>warning: hdf5-1.10.5-4.el8.src.rpm: Header V3 RSA/SHA256 Signature, key ID 2f86d6a1: NOKEY
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>warning: user mockbuild does not exist - using root
</span><span class='line'>warning: group mock does not exist - using root
</span><span class='line'>error: Failed build dependencies:
</span><span class='line'>        mpich-devel is needed by hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>      
</span><span class='line'>[root@col ~]# yum install mpich-devel mpich 
</span><span class='line'>Last metadata expiration check: 1:55:24 ago on Sun 24 Jul 2022 04:56:06 AM CST.
</span><span class='line'>Error: 
</span><span class='line'> Problem 1: package hwloc-1.11.9-3.ky10.aarch64 obsoletes hwloc-libs provided by hwloc-libs-2.2.0-3.el8.aarch64
</span><span class='line'>  - package mpich-3.2.1-10.ky10.aarch64 requires libhwloc.so.5()(64bit), but none of the providers can be installed
</span><span class='line'>  - package openmpi-4.1.1-2.ky10.ky10.aarch64 requires libhwloc.so.15()(64bit), but none of the providers can be installed
</span><span class='line'>  - conflicting requests
</span><span class='line'>  - problem with installed package openmpi-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'> Problem 2: package mpich-3.2.1-10.ky10.aarch64 requires libhwloc.so.5()(64bit), but none of the providers can be installed
</span><span class='line'>  - package hwloc-1.11.9-3.ky10.aarch64 obsoletes hwloc-libs provided by hwloc-libs-2.2.0-3.el8.aarch64
</span><span class='line'>  - package mpich-devel-3.2.1-10.ky10.aarch64 requires mpich = 3.2.1-10.ky10, but none of the providers can be installed
</span><span class='line'>  - package openmpi-devel-4.1.1-2.ky10.ky10.aarch64 requires libhwloc.so.15()(64bit), but none of the providers can be installed
</span><span class='line'>  - conflicting requests
</span><span class='line'>  - problem with installed package openmpi-devel-4.1.1-2.ky10.ky10.aarch64
</span><span class='line'>(try to add '--skip-broken' to skip uninstallable packages or '--nobest' to use not only best candidate packages)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[root@col ~]# ll *.rpm
</span><span class='line'>-rw------- 1 root root   305031 Jul 23 22:12 cglib-3.2.4-7.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root   147131 Jul 23 22:11 easymock-3.5-4.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root   131075 Jul 23 22:08 hamcrest-1.3-23.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root    60043 Jul 23 22:08 hamcrest-core-1.3-23.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw-r--r-- 1 root root  8739906 Jul 22 14:57 hdf5-1.10.5-4.el8.src.rpm
</span><span class='line'>-rw------- 1 root root   254060 Jul 23 22:32 hwloc-devel-2.2.0-3.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root    67048 Jul 23 22:32 hwloc-gui-2.2.0-3.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root  2085332 Jul 23 22:32 hwloc-libs-2.2.0-3.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root   307067 Jul 23 22:08 junit-4.12-9.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root 30515938 Jul 24 06:55 mpich-3.4.1-1.el8.src.rpm
</span><span class='line'>-rw------- 1 root root   457315 Jul 23 22:12 objectweb-asm-6.2-5.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root   108627 Jul 23 22:12 objenesis-2.6-2.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root  9846455 Jul 23 22:26 openmpi-4.1.1-2.el8.src.rpm
</span><span class='line'>-rw------- 1 root root   685564 Jul 24 06:23 pmix-2.2.4rc1-1.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root    60776 Jul 24 06:23 pmix-devel-2.2.4rc1-1.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root   305655 Jul 23 22:12 qdox-2.0-3.M9.module_el8.0.0+30+832da3a1.noarch.rpm
</span><span class='line'>-rw------- 1 root root    13320 Jul 23 22:27 rpm-mpi-hooks-8-2.el8.noarch.rpm
</span><span class='line'>-rw------- 1 root root    78511 Jul 23 22:08 slf4j-1.7.25-4.module_el8.0.0+39+6a9b6e22.noarch.rpm
</span><span class='line'>-rw------- 1 root root   541892 Jul 23 22:27 ucx-1.10.1-2.el8.aarch64.rpm
</span><span class='line'>-rw------- 1 root root   162896 Jul 23 22:27 ucx-devel-1.10.1-2.el8.aarch64.rpm
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[root@col ~]# rpmbuild --rebuild --nocheck mpich-3.4.1-1.el8.src.rpm                                                                                    
</span><span class='line'>
</span><span class='line'>[root@col ~]# rpm -ivh --force ~/rpmbuild/RPMS/aarch64/mpich-3.4.1-1.ky10.ky10.aarch64.rpm ~/rpmbuild/RPMS/aarch64/mpich-devel-3.4.1-1.ky10.ky10.aarch64.rpm           
</span><span class='line'>error: Failed dependencies:
</span><span class='line'>        redhat-rpm-config is needed by mpich-devel-3.4.1-1.ky10.ky10.aarch64
</span><span class='line'>[root@col ~]# rpm -ivh --force --nodeps ~/rpmbuild/RPMS/aarch64/mpich-3.4.1-1.ky10.ky10.aarch64.rpm ~/rpmbuild/RPMS/aarch64/mpich-devel-3.4.1-1.ky10.ky10.aarch64.rpm
</span><span class='line'>Verifying...                          ################################# [100%]
</span><span class='line'>Preparing...                          ################################# [100%]
</span><span class='line'>Updating / installing...
</span><span class='line'>   1:mpich-3.4.1-1.ky10.ky10          ################################# [ 50%]
</span><span class='line'>   2:mpich-devel-3.4.1-1.ky10.ky10    ################################# [100%]
</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ¬¡ç»ˆäºå¯ä»¥ç¼–è¯‘hdf5äº†ï¼Œæ—¶é—´ä¼šç›¸å¯¹é•¿ä¸€ç‚¹ï¼Œæ…¢æ…¢ç­‰ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# rpmbuild --rebuild hdf5-1.10.5-4.el8.src.rpm
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install ~/rpmbuild/RPMS/aarch64/hdf5-1.10.5-4.ky10.ky10.aarch64.rpm ~/rpmbuild/RPMS/aarch64/hdf5-devel-1.10.5-4.ky10.ky10.aarch64.rpm 
</span></code></pre></td></tr></table></div></figure>


<h2>armadillo</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# yum install postgresql96 postgresql96-server postgis24_96                                  
</span><span class='line'>Last metadata expiration check: 0:46:44 ago on Sun 24 Jul 2022 07:56:56 AM CST.
</span><span class='line'>Error: 
</span><span class='line'> Problem: package postgis24_96-2.4.9-3.rhel8.aarch64 requires libgdal.so.28()(64bit), but none of the providers can be installed
</span><span class='line'>  - package postgis24_96-2.4.9-3.rhel8.aarch64 requires gdal32-libs &gt;= 3.2.0, but none of the providers can be installed
</span><span class='line'>  - package gdal32-libs-3.2.2-12.rhel8.aarch64 requires libhdf5.so.103()(64bit), but none of the providers can be installed
</span><span class='line'>  - package gdal32-libs-3.2.2-13.rhel8.aarch64 requires libhdf5.so.103()(64bit), but none of the providers can be installed
</span><span class='line'>  - cannot install both hdf5-1.8.20-7.ky10.aarch64 and hdf5-1.10.5-4.ky10.ky10.aarch64
</span><span class='line'>  - package armadillo-9.600.6-3.oe1.aarch64 requires libhdf5.so.10()(64bit), but none of the providers can be installed
</span><span class='line'>  - package gdal32-libs-3.2.2-12.rhel8.aarch64 requires libarmadillo.so.9()(64bit), but none of the providers can be installed
</span><span class='line'>  - package gdal32-libs-3.2.2-13.rhel8.aarch64 requires libarmadillo.so.9()(64bit), but none of the providers can be installed
</span><span class='line'>  - cannot install the best candidate for the job
</span><span class='line'>  - nothing provides libgfortran.so.5()(64bit) needed by hdf5-1.10.5-4.el8.aarch64
</span><span class='line'>  - nothing provides libgfortran.so.5(GFORTRAN_8)(64bit) needed by hdf5-1.10.5-4.el8.aarch64
</span><span class='line'>(try to add '--allowerasing' to command line to replace conflicting packages or '--skip-broken' to skip uninstallable packages or '--nobest' to use not only best candidate packages)
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum list armadillo --showduplicates
</span><span class='line'>Last metadata expiration check: 0:47:59 ago on Sun 24 Jul 2022 07:56:56 AM CST.
</span><span class='line'>Available Packages
</span><span class='line'>armadillo.aarch64                                                                  9.600.6-3.oe1                                                                  ks10-adv-os
</span><span class='line'>armadillo.aarch64                                                                  10.8.2-1.el8                                                                   epel       
</span></code></pre></td></tr></table></div></figure>


<p>gdal32-libs ä¾èµ–çš„æ˜¯ libarmadillo.so.9 ï¼Œç›´æ¥æ‰¾openEulerçš„ç‰ˆæœ¬<a href="https://cmcc.mirrors.ustc.edu.cn/openeuler/openEuler-20.03-LTS-SP1/update/source/Packages/">armadillo-9.600.6-4.oe1.src.rpm</a> ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# rpmbuild --rebuild armadillo-9.600.6-4.oe1.src.rpm 
</span><span class='line'>Installing armadillo-9.600.6-4.oe1.src.rpm
</span><span class='line'>warning: armadillo-9.600.6-4.oe1.src.rpm: Header V3 RSA/SHA1 Signature, key ID b25e7f66: NOKEY
</span><span class='line'>error: bad date in %changelog: Fri 26 Mar 2021 sunguoshuai &lt;sunguoshuai@huawei.com&gt; - 9.600.6-4
</span><span class='line'>error: Failed build dependencies:
</span><span class='line'>        SuperLU-devel is needed by armadillo-9.600.6-4.ky10.aarch64
</span><span class='line'>        arpack-devel is needed by armadillo-9.600.6-4.ky10.aarch64
</span><span class='line'>        lapack-devel is needed by armadillo-9.600.6-4.ky10.aarch64
</span><span class='line'>        openblas-devel is needed by armadillo-9.600.6-4.ky10.aarch64
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install SuperLU-devel arpack-devel-3.5.0
</span><span class='line'>Last metadata expiration check: 0:55:00 ago on Sun 24 Jul 2022 07:56:56 AM CST.
</span><span class='line'>Dependencies resolved.
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'> Package                                     Architecture                         Version                                     Repository                                Size
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> SuperLU-devel                               aarch64                              5.2.1-6.oe1                                 ks10-adv-os                               22 k
</span><span class='line'> arpack-devel                                aarch64                              3.5.0-7.oe1                                 ks10-adv-os                              8.2 k
</span><span class='line'>Installing dependencies:
</span><span class='line'> SuperLU                                     aarch64                              5.2.1-6.oe1                                 ks10-adv-os                              139 k
</span><span class='line'> arpack                                      aarch64                              3.5.0-7.oe1                                 ks10-adv-os                              141 k
</span><span class='line'> openblas                                    aarch64                              0.3.3-3.ky10                                ks10-adv-os                               46 M
</span><span class='line'> openblas-devel                              aarch64                              0.3.3-3.ky10                                ks10-adv-os                               83 k
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Install  6 Packages
</span><span class='line'>
</span><span class='line'>Total download size: 47 M
</span><span class='line'>Installed size: 286 M
</span><span class='line'>Is this ok [y/N]: y
</span><span class='line'>Downloading Packages:
</span><span class='line'>(1/6): SuperLU-devel-5.2.1-6.oe1.aarch64.rpm                                                                                                 3.5 kB/s |  22 kB     00:06    
</span><span class='line'>(2/6): arpack-3.5.0-7.oe1.aarch64.rpm                                                                                                         11 kB/s | 141 kB     00:12    
</span><span class='line'>(3/6): SuperLU-5.2.1-6.oe1.aarch64.rpm                                                                                                        11 kB/s | 139 kB     00:12    
</span><span class='line'>(4/6): arpack-devel-3.5.0-7.oe1.aarch64.rpm                                                                                                  1.4 kB/s | 8.2 kB     00:06    
</span><span class='line'>(5/6): openblas-devel-0.3.3-3.ky10.aarch64.rpm                                                                                               2.6 MB/s |  83 kB     00:00    
</span><span class='line'>(6/6): openblas-0.3.3-3.ky10.aarch64.rpm                                                                                                     258 kB/s |  46 MB     03:03    
</span><span class='line'>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Total                                                                                                                                        244 kB/s |  47 MB     03:15     
</span><span class='line'>Running transaction check
</span><span class='line'>Transaction check succeeded.
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded.
</span><span class='line'>Running transaction
</span><span class='line'>  Preparing        :                                                                                                                                                     1/1 
</span><span class='line'>  Installing       : openblas-devel-0.3.3-3.ky10.aarch64                                                                                                                 1/6 
</span><span class='line'>  Installing       : openblas-0.3.3-3.ky10.aarch64                                                                                                                       2/6 
</span><span class='line'>  Running scriptlet: openblas-0.3.3-3.ky10.aarch64                                                                                                                       2/6 
</span><span class='line'>  Installing       : SuperLU-5.2.1-6.oe1.aarch64                                                                                                                         3/6 
</span><span class='line'>  Running scriptlet: SuperLU-5.2.1-6.oe1.aarch64                                                                                                                         3/6 
</span><span class='line'>  Installing       : arpack-3.5.0-7.oe1.aarch64                                                                                                                          4/6 
</span><span class='line'>  Running scriptlet: arpack-3.5.0-7.oe1.aarch64                                                                                                                          4/6 
</span><span class='line'>  Installing       : arpack-devel-3.5.0-7.oe1.aarch64                                                                                                                    5/6 
</span><span class='line'>  Installing       : SuperLU-devel-5.2.1-6.oe1.aarch64                                                                                                                   6/6 
</span><span class='line'>  Running scriptlet: SuperLU-devel-5.2.1-6.oe1.aarch64                                                                                                                   6/6 
</span><span class='line'>  Verifying        : SuperLU-5.2.1-6.oe1.aarch64                                                                                                                         1/6 
</span><span class='line'>  Verifying        : SuperLU-devel-5.2.1-6.oe1.aarch64                                                                                                                   2/6 
</span><span class='line'>  Verifying        : arpack-3.5.0-7.oe1.aarch64                                                                                                                          3/6 
</span><span class='line'>  Verifying        : arpack-devel-3.5.0-7.oe1.aarch64                                                                                                                    4/6 
</span><span class='line'>  Verifying        : openblas-0.3.3-3.ky10.aarch64                                                                                                                       5/6 
</span><span class='line'>  Verifying        : openblas-devel-0.3.3-3.ky10.aarch64                                                                                                                 6/6 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  SuperLU-devel-5.2.1-6.oe1.aarch64      arpack-devel-3.5.0-7.oe1.aarch64    SuperLU-5.2.1-6.oe1.aarch64    arpack-3.5.0-7.oe1.aarch64    openblas-0.3.3-3.ky10.aarch64   
</span><span class='line'>  openblas-devel-0.3.3-3.ky10.aarch64   
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>[root@col ~]# 
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install lapack-devel 
</span><span class='line'>Last metadata expiration check: 0:59:07 ago on Sun 24 Jul 2022 07:56:56 AM CST.
</span><span class='line'>Dependencies resolved.
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'> Package                                   Architecture                         Version                                       Repository                                Size
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> lapack-devel                              aarch64                              3.8.0-16.ky10                                 ks10-adv-os                              4.7 M
</span><span class='line'>Installing dependencies:
</span><span class='line'> lapack                                    aarch64                              3.8.0-16.ky10                                 ks10-adv-os                              4.5 M
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Install  2 Packages
</span><span class='line'>
</span><span class='line'>Total download size: 9.2 M
</span><span class='line'>Installed size: 47 M
</span><span class='line'>Is this ok [y/N]: y
</span><span class='line'>Downloading Packages:
</span><span class='line'>(1/2): lapack-3.8.0-16.ky10.aarch64.rpm                                                                                                      176 kB/s | 4.5 MB     00:26    
</span><span class='line'>(2/2): lapack-devel-3.8.0-16.ky10.aarch64.rpm                                                                                                184 kB/s | 4.7 MB     00:26    
</span><span class='line'>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Total                                                                                                                                        360 kB/s | 9.2 MB     00:26     
</span><span class='line'>Running transaction check
</span><span class='line'>Transaction check succeeded.
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded.
</span><span class='line'>Running transaction
</span><span class='line'>  Preparing        :                                                                                                                                                     1/1 
</span><span class='line'>  Installing       : lapack-3.8.0-16.ky10.aarch64                                                                                                                        1/2 
</span><span class='line'>  Running scriptlet: lapack-3.8.0-16.ky10.aarch64                                                                                                                        1/2 
</span><span class='line'>  Installing       : lapack-devel-3.8.0-16.ky10.aarch64                                                                                                                  2/2 
</span><span class='line'>  Running scriptlet: lapack-devel-3.8.0-16.ky10.aarch64                                                                                                                  2/2 
</span><span class='line'>  Verifying        : lapack-3.8.0-16.ky10.aarch64                                                                                                                        1/2 
</span><span class='line'>  Verifying        : lapack-devel-3.8.0-16.ky10.aarch64                                                                                                                  2/2 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  lapack-devel-3.8.0-16.ky10.aarch64                                                       lapack-3.8.0-16.ky10.aarch64                                                      
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>[root@col ~]# 
</span><span class='line'>
</span><span class='line'>[root@col ~]# rpmbuild --rebuild armadillo-9.600.6-4.oe1.src.rpm 
</span><span class='line'>
</span><span class='line'>[root@col ~]# yum install ~/rpmbuild/RPMS/aarch64/armadillo-9.600.6-4.ky10.aarch64.rpm 
</span></code></pre></td></tr></table></div></figure>


<h2>å®‰è£…</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# yum install postgresql96 postgresql96-server postgis24_96                                                                                                      
</span><span class='line'>Last metadata expiration check: 1:00:42 ago on Sun 24 Jul 2022 07:56:56 AM CST.
</span><span class='line'>Dependencies resolved.
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'> Package                                         Architecture                      Version                                       Repository                             Size
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> postgis24_96                                    aarch64                           2.4.9-3.rhel8                                 pgdg96                                3.2 M
</span><span class='line'> postgresql96                                    aarch64                           9.6.24-1PGDG.rhel8                            pgdg96                                1.5 M
</span><span class='line'> postgresql96-server                             aarch64                           9.6.24-1PGDG.rhel8                            pgdg96                                4.5 M
</span><span class='line'>Upgrading:
</span><span class='line'> minizip                                         aarch64                           2.8.9-2.el8                                   epel                                  119 k
</span><span class='line'>Installing dependencies:
</span><span class='line'> boost-atomic                                    aarch64                           1.66.0-18.ky10                                ks10-adv-os                            11 k
</span><span class='line'> boost-chrono                                    aarch64                           1.66.0-18.ky10                                ks10-adv-os                            20 k
</span><span class='line'> boost-date-time                                 aarch64                           1.66.0-18.ky10                                ks10-adv-os                            26 k
</span><span class='line'> boost-serialization                             aarch64                           1.66.0-18.ky10                                ks10-adv-os                           105 k
</span><span class='line'> boost-system                                    aarch64                           1.66.0-18.ky10                                ks10-adv-os                            15 k
</span><span class='line'> boost-thread                                    aarch64                           1.66.0-18.ky10                                ks10-adv-os                            53 k
</span><span class='line'> cfitsio                                         aarch64                           3.450-5.oe1                                   ks10-adv-os                           508 k
</span><span class='line'> jasper-libs                                     aarch64                           2.0.14-7.ky10                                 ks10-adv-os                           146 k
</span><span class='line'> libdap                                          aarch64                           3.19.1-3.oe1                                  ks10-adv-os                           562 k
</span><span class='line'> libusb                                          aarch64                           1:0.1.5-15.ky10                               ks10-adv-os                            32 k
</span><span class='line'> protobuf                                        aarch64                           3.9.0-7.ky10                                  ks10-adv-os                           1.5 M
</span><span class='line'> protobuf-c                                      aarch64                           1.3.2-2.ky10                                  ks10-adv-os                           103 k
</span><span class='line'> CGAL                                            aarch64                           4.14-1.rhel8                                  pgdg-common                           473 k
</span><span class='line'> SFCGAL                                          aarch64                           1.3.8-1.rhel8                                 pgdg-common                            20 k
</span><span class='line'> SFCGAL-libs                                     aarch64                           1.3.8-1.rhel8                                 pgdg-common                           1.6 M
</span><span class='line'> gdal32-libs                                     aarch64                           3.2.2-13.rhel8                                pgdg-common                           7.4 M
</span><span class='line'> geos39                                          aarch64                           3.9.2-1.rhel8                                 pgdg-common                           619 k
</span><span class='line'> libgeotiff16                                    aarch64                           1.6.0-6.rhel8                                 pgdg-common                            98 k
</span><span class='line'> libgeotiff16-devel                              aarch64                           1.6.0-6.rhel8                                 pgdg-common                            33 k
</span><span class='line'> librttopo                                       aarch64                           1.1.0-1.rhel8                                 pgdg-common                           161 k
</span><span class='line'> libspatialite50                                 aarch64                           5.0.1-2.rhel8                                 pgdg-common                           2.7 M
</span><span class='line'> libspatialite50-devel                           aarch64                           5.0.1-2.rhel8                                 pgdg-common                            99 k
</span><span class='line'> ogdi41                                          aarch64                           4.1.0-3.rhel8                                 pgdg-common                           220 k
</span><span class='line'> proj72                                          aarch64                           7.2.1-1.rhel8                                 pgdg-common                           2.4 M
</span><span class='line'> proj80                                          aarch64                           8.0.1-1.rhel8                                 pgdg-common                           2.4 M
</span><span class='line'> postgresql96-contrib                            aarch64                           9.6.24-1PGDG.rhel8                            pgdg96                                576 k
</span><span class='line'> postgresql96-libs                               aarch64                           9.6.24-1PGDG.rhel8                            pgdg96                                339 k
</span><span class='line'> freexl                                          aarch64                           1.0.6-4.el8                                   epel                                   33 k
</span><span class='line'> gpsbabel                                        aarch64                           1.6.0-3.el8                                   epel                                  892 k
</span><span class='line'> hdf                                             aarch64                           4.2.14-5.el8                                  epel                                  615 k
</span><span class='line'> libbsd                                          aarch64                           0.9.1-4.el8                                   epel                                  104 k
</span><span class='line'> libgta                                          aarch64                           1.2.1-1.el8                                   epel                                   33 k
</span><span class='line'> minizip1.2                                      aarch64                           1.2.11-24.el8                                 epel                                   32 k
</span><span class='line'> netcdf                                          aarch64                           4.7.0-2.el8                                   epel                                  617 k
</span><span class='line'> shapelib                                        aarch64                           1.5.0-1.el8                                   epel                                   78 k
</span><span class='line'> xerces-c                                        aarch64                           3.2.2-3.el8                                   epel                                  861 k
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Install  39 Packages
</span><span class='line'>Upgrade   1 Package
</span><span class='line'>
</span><span class='line'>Total download size: 35 M
</span><span class='line'>Is this ok [y/N]: y
</span><span class='line'>Downloading Packages:
</span><span class='line'>(1/40): boost-atomic-1.66.0-18.ky10.aarch64.rpm                                                                                               51 kB/s |  11 kB     00:00    
</span><span class='line'>(2/40): boost-chrono-1.66.0-18.ky10.aarch64.rpm                                                                                               85 kB/s |  20 kB     00:00    
</span><span class='line'>(3/40): boost-date-time-1.66.0-18.ky10.aarch64.rpm                                                                                           108 kB/s |  26 kB     00:00    
</span><span class='line'>(4/40): boost-system-1.66.0-18.ky10.aarch64.rpm                                                                                              996 kB/s |  15 kB     00:00    
</span><span class='line'>(5/40): boost-thread-1.66.0-18.ky10.aarch64.rpm                                                                                              2.4 MB/s |  53 kB     00:00    
</span><span class='line'>(6/40): boost-serialization-1.66.0-18.ky10.aarch64.rpm                                                                                       2.4 MB/s | 105 kB     00:00    
</span><span class='line'>(7/40): jasper-libs-2.0.14-7.ky10.aarch64.rpm                                                                                                3.3 MB/s | 146 kB     00:00    
</span><span class='line'>(8/40): libusb-0.1.5-15.ky10.aarch64.rpm                                                                                                     1.8 MB/s |  32 kB     00:00    
</span><span class='line'>(9/40): cfitsio-3.450-5.oe1.aarch64.rpm                                                                                                      4.5 MB/s | 508 kB     00:00    
</span><span class='line'>(10/40): protobuf-c-1.3.2-2.ky10.aarch64.rpm                                                                                                 3.1 MB/s | 103 kB     00:00    
</span><span class='line'>(11/40): libdap-3.19.1-3.oe1.aarch64.rpm                                                                                                     3.9 MB/s | 562 kB     00:00    
</span><span class='line'>(12/40): SFCGAL-1.3.8-1.rhel8.aarch64.rpm                                                                                                     16 kB/s |  20 kB     00:01    
</span><span class='line'>(13/40): CGAL-4.14-1.rhel8.aarch64.rpm                                                                                                       220 kB/s | 473 kB     00:02    
</span><span class='line'>(14/40): SFCGAL-libs-1.3.8-1.rhel8.aarch64.rpm                                                                                               1.2 MB/s | 1.6 MB     00:01    
</span><span class='line'>(15/40): gdal32-libs-3.2.2-13.rhel8.aarch64.rpm                                                                                              4.4 MB/s | 7.4 MB     00:01    
</span><span class='line'>(16/40): protobuf-3.9.0-7.ky10.aarch64.rpm                                                                                                   385 kB/s | 1.5 MB     00:04    
</span><span class='line'>(17/40): geos39-3.9.2-1.rhel8.aarch64.rpm                                                                                                    452 kB/s | 619 kB     00:01    
</span><span class='line'>(18/40): libgeotiff16-1.6.0-6.rhel8.aarch64.rpm                                                                                              438 kB/s |  98 kB     00:00    
</span><span class='line'>(19/40): libgeotiff16-devel-1.6.0-6.rhel8.aarch64.rpm                                                                                        152 kB/s |  33 kB     00:00    
</span><span class='line'>(20/40): librttopo-1.1.0-1.rhel8.aarch64.rpm                                                                                                 602 kB/s | 161 kB     00:00    
</span><span class='line'>(21/40): libspatialite50-5.0.1-2.rhel8.aarch64.rpm                                                                                           4.2 MB/s | 2.7 MB     00:00    
</span><span class='line'>(22/40): libspatialite50-devel-5.0.1-2.rhel8.aarch64.rpm                                                                                     202 kB/s |  99 kB     00:00    
</span><span class='line'>(23/40): ogdi41-4.1.0-3.rhel8.aarch64.rpm                                                                                                    499 kB/s | 220 kB     00:00    
</span><span class='line'>(24/40): proj72-7.2.1-1.rhel8.aarch64.rpm                                                                                                    5.1 MB/s | 2.4 MB     00:00    
</span><span class='line'>(25/40): proj80-8.0.1-1.rhel8.aarch64.rpm                                                                                                    2.8 MB/s | 2.4 MB     00:00    
</span><span class='line'>(26/40): postgis24_96-2.4.9-3.rhel8.aarch64.rpm                                                                                              2.2 MB/s | 3.2 MB     00:01    
</span><span class='line'>(27/40): postgresql96-contrib-9.6.24-1PGDG.rhel8.aarch64.rpm                                                                                 961 kB/s | 576 kB     00:00    
</span><span class='line'>(28/40): postgresql96-9.6.24-1PGDG.rhel8.aarch64.rpm                                                                                         1.2 MB/s | 1.5 MB     00:01    
</span><span class='line'>(29/40): postgresql96-libs-9.6.24-1PGDG.rhel8.aarch64.rpm                                                                                    1.5 MB/s | 339 kB     00:00    
</span><span class='line'>(30/40): postgresql96-server-9.6.24-1PGDG.rhel8.aarch64.rpm                                                                                  5.3 MB/s | 4.5 MB     00:00    
</span><span class='line'>(31/40): freexl-1.0.6-4.el8.aarch64.rpm                                                                                                       17 kB/s |  33 kB     00:01    
</span><span class='line'>(32/40): libbsd-0.9.1-4.el8.aarch64.rpm                                                                                                       43 kB/s | 104 kB     00:02    
</span><span class='line'>(33/40): libgta-1.2.1-1.el8.aarch64.rpm                                                                                                       17 kB/s |  33 kB     00:01    
</span><span class='line'>(34/40): minizip1.2-1.2.11-24.el8.aarch64.rpm                                                                                                 16 kB/s |  32 kB     00:02    
</span><span class='line'>(35/40): hdf-4.2.14-5.el8.aarch64.rpm                                                                                                         18 kB/s | 615 kB     00:33    
</span><span class='line'>(36/40): shapelib-1.5.0-1.el8.aarch64.rpm                                                                                                     21 kB/s |  78 kB     00:03    
</span><span class='line'>(37/40): gpsbabel-1.6.0-3.el8.aarch64.rpm                                                                                                     21 kB/s | 892 kB     00:42    
</span><span class='line'>(38/40): minizip-2.8.9-2.el8.aarch64.rpm                                                                                                      26 kB/s | 119 kB     00:04    
</span><span class='line'>(39/40): netcdf-4.7.0-2.el8.aarch64.rpm                                                                                                       11 kB/s | 617 kB     00:55    
</span><span class='line'>(40/40): xerces-c-3.2.2-3.el8.aarch64.rpm                                                                                                     12 kB/s | 861 kB     01:09    
</span><span class='line'>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Total                                                                                                                                        310 kB/s |  35 MB     01:53     
</span><span class='line'>Running transaction check
</span><span class='line'>Transaction check succeeded.
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded.
</span><span class='line'>Running transaction
</span><span class='line'>  Preparing        :                                                                                                                                                     1/1 
</span><span class='line'>  Installing       : postgresql96-libs-9.6.24-1PGDG.rhel8.aarch64                                                                                                       1/41 
</span><span class='line'>  Running scriptlet: postgresql96-libs-9.6.24-1PGDG.rhel8.aarch64                                                                                                       1/41 
</span><span class='line'>  Installing       : geos39-3.9.2-1.rhel8.aarch64                                                                                                                       2/41 
</span><span class='line'>  Running scriptlet: geos39-3.9.2-1.rhel8.aarch64                                                                                                                       2/41 
</span><span class='line'>  Installing       : boost-system-1.66.0-18.ky10.aarch64                                                                                                                3/41 
</span><span class='line'>  Installing       : postgresql96-9.6.24-1PGDG.rhel8.aarch64                                                                                                            4/41 
</span><span class='line'>  Running scriptlet: postgresql96-9.6.24-1PGDG.rhel8.aarch64                                                                                                            4/41 
</span><span class='line'>  Installing       : proj80-8.0.1-1.rhel8.aarch64                                                                                                                       5/41 
</span><span class='line'>  Running scriptlet: proj80-8.0.1-1.rhel8.aarch64                                                                                                                       5/41 
</span><span class='line'>  Installing       : libgeotiff16-1.6.0-6.rhel8.aarch64                                                                                                                 6/41 
</span><span class='line'>  Running scriptlet: libgeotiff16-1.6.0-6.rhel8.aarch64                                                                                                                 6/41 
</span><span class='line'>  Installing       : boost-chrono-1.66.0-18.ky10.aarch64                                                                                                                7/41 
</span><span class='line'>  Installing       : boost-thread-1.66.0-18.ky10.aarch64                                                                                                                8/41 
</span><span class='line'>  Installing       : xerces-c-3.2.2-3.el8.aarch64                                                                                                                       9/41 
</span><span class='line'>  Installing       : hdf-4.2.14-5.el8.aarch64                                                                                                                          10/41 
</span><span class='line'>  Installing       : freexl-1.0.6-4.el8.aarch64                                                                                                                        11/41 
</span><span class='line'>  Installing       : boost-date-time-1.66.0-18.ky10.aarch64                                                                                                            12/41 
</span><span class='line'>  Installing       : boost-atomic-1.66.0-18.ky10.aarch64                                                                                                               13/41 
</span><span class='line'>  Installing       : CGAL-4.14-1.rhel8.aarch64                                                                                                                         14/41 
</span><span class='line'>  Running scriptlet: CGAL-4.14-1.rhel8.aarch64                                                                                                                         14/41 
</span><span class='line'>  Installing       : netcdf-4.7.0-2.el8.aarch64                                                                                                                        15/41 
</span><span class='line'>  Installing       : libgeotiff16-devel-1.6.0-6.rhel8.aarch64                                                                                                          16/41 
</span><span class='line'>  Running scriptlet: postgresql96-server-9.6.24-1PGDG.rhel8.aarch64                                                                                                    17/41 
</span><span class='line'>  Installing       : postgresql96-server-9.6.24-1PGDG.rhel8.aarch64                                                                                                    17/41 
</span><span class='line'>  Running scriptlet: postgresql96-server-9.6.24-1PGDG.rhel8.aarch64                                                                                                    17/41 
</span><span class='line'>  Installing       : postgresql96-contrib-9.6.24-1PGDG.rhel8.aarch64                                                                                                   18/41 
</span><span class='line'>  Installing       : librttopo-1.1.0-1.rhel8.aarch64                                                                                                                   19/41 
</span><span class='line'>  Installing       : shapelib-1.5.0-1.el8.aarch64                                                                                                                      20/41 
</span><span class='line'>  Installing       : libgta-1.2.1-1.el8.aarch64                                                                                                                        21/41 
</span><span class='line'>  Installing       : libbsd-0.9.1-4.el8.aarch64                                                                                                                        22/41 
</span><span class='line'>  Upgrading        : minizip-2.8.9-2.el8.aarch64                                                                                                                       23/41 
</span><span class='line'>  Running scriptlet: minizip-2.8.9-2.el8.aarch64                                                                                                                       23/41 
</span><span class='line'>  Installing       : libspatialite50-5.0.1-2.rhel8.aarch64                                                                                                             24/41 
</span><span class='line'>  Running scriptlet: libspatialite50-5.0.1-2.rhel8.aarch64                                                                                                             24/41 
</span><span class='line'>  Installing       : libspatialite50-devel-5.0.1-2.rhel8.aarch64                                                                                                       25/41 
</span><span class='line'>  Running scriptlet: libspatialite50-devel-5.0.1-2.rhel8.aarch64                                                                                                       25/41 
</span><span class='line'>  Installing       : proj72-7.2.1-1.rhel8.aarch64                                                                                                                      26/41 
</span><span class='line'>  Running scriptlet: proj72-7.2.1-1.rhel8.aarch64                                                                                                                      26/41 
</span><span class='line'>  Installing       : ogdi41-4.1.0-3.rhel8.aarch64                                                                                                                      27/41 
</span><span class='line'>  Installing       : protobuf-3.9.0-7.ky10.aarch64                                                                                                                     28/41 
</span><span class='line'>  Installing       : protobuf-c-1.3.2-2.ky10.aarch64                                                                                                                   29/41 
</span><span class='line'>  Running scriptlet: protobuf-c-1.3.2-2.ky10.aarch64                                                                                                                   29/41 
</span><span class='line'>  Installing       : libusb-1:0.1.5-15.ky10.aarch64                                                                                                                    30/41 
</span><span class='line'>  Running scriptlet: libusb-1:0.1.5-15.ky10.aarch64                                                                                                                    30/41 
</span><span class='line'>  Installing       : gpsbabel-1.6.0-3.el8.aarch64                                                                                                                      31/41 
</span><span class='line'>  Installing       : libdap-3.19.1-3.oe1.aarch64                                                                                                                       32/41 
</span><span class='line'>  Running scriptlet: libdap-3.19.1-3.oe1.aarch64                                                                                                                       32/41 
</span><span class='line'>  Installing       : jasper-libs-2.0.14-7.ky10.aarch64                                                                                                                 33/41 
</span><span class='line'>  Installing       : cfitsio-3.450-5.oe1.aarch64                                                                                                                       34/41 
</span><span class='line'>  Running scriptlet: cfitsio-3.450-5.oe1.aarch64                                                                                                                       34/41 
</span><span class='line'>  Installing       : boost-serialization-1.66.0-18.ky10.aarch64                                                                                                        35/41 
</span><span class='line'>  Installing       : SFCGAL-libs-1.3.8-1.rhel8.aarch64                                                                                                                 36/41 
</span><span class='line'>  Running scriptlet: SFCGAL-libs-1.3.8-1.rhel8.aarch64                                                                                                                 36/41 
</span><span class='line'>  Installing       : SFCGAL-1.3.8-1.rhel8.aarch64                                                                                                                      37/41 
</span><span class='line'>  Running scriptlet: SFCGAL-1.3.8-1.rhel8.aarch64                                                                                                                      37/41 
</span><span class='line'>  Installing       : gdal32-libs-3.2.2-13.rhel8.aarch64                                                                                                                38/41 
</span><span class='line'>  Running scriptlet: gdal32-libs-3.2.2-13.rhel8.aarch64                                                                                                                38/41 
</span><span class='line'>  Installing       : postgis24_96-2.4.9-3.rhel8.aarch64                                                                                                                39/41 
</span><span class='line'>  Running scriptlet: postgis24_96-2.4.9-3.rhel8.aarch64                                                                                                                39/41 
</span><span class='line'>  Installing       : minizip1.2-1.2.11-24.el8.aarch64                                                                                                                  40/41 
</span><span class='line'>  Cleanup          : minizip-1.2.11-17.1.ky10.aarch64                                                                                                                  41/41 
</span><span class='line'>  Running scriptlet: minizip-1.2.11-17.1.ky10.aarch64                                                                                                                  41/41 
</span><span class='line'>  Verifying        : boost-atomic-1.66.0-18.ky10.aarch64                                                                                                                1/41 
</span><span class='line'>  Verifying        : boost-chrono-1.66.0-18.ky10.aarch64                                                                                                                2/41 
</span><span class='line'>  Verifying        : boost-date-time-1.66.0-18.ky10.aarch64                                                                                                             3/41 
</span><span class='line'>  Verifying        : boost-serialization-1.66.0-18.ky10.aarch64                                                                                                         4/41 
</span><span class='line'>  Verifying        : boost-system-1.66.0-18.ky10.aarch64                                                                                                                5/41 
</span><span class='line'>  Verifying        : boost-thread-1.66.0-18.ky10.aarch64                                                                                                                6/41 
</span><span class='line'>  Verifying        : cfitsio-3.450-5.oe1.aarch64                                                                                                                        7/41 
</span><span class='line'>  Verifying        : jasper-libs-2.0.14-7.ky10.aarch64                                                                                                                  8/41 
</span><span class='line'>  Verifying        : libdap-3.19.1-3.oe1.aarch64                                                                                                                        9/41 
</span><span class='line'>  Verifying        : libusb-1:0.1.5-15.ky10.aarch64                                                                                                                    10/41 
</span><span class='line'>  Verifying        : protobuf-3.9.0-7.ky10.aarch64                                                                                                                     11/41 
</span><span class='line'>  Verifying        : protobuf-c-1.3.2-2.ky10.aarch64                                                                                                                   12/41 
</span><span class='line'>  Verifying        : CGAL-4.14-1.rhel8.aarch64                                                                                                                         13/41 
</span><span class='line'>  Verifying        : SFCGAL-1.3.8-1.rhel8.aarch64                                                                                                                      14/41 
</span><span class='line'>  Verifying        : SFCGAL-libs-1.3.8-1.rhel8.aarch64                                                                                                                 15/41 
</span><span class='line'>  Verifying        : gdal32-libs-3.2.2-13.rhel8.aarch64                                                                                                                16/41 
</span><span class='line'>  Verifying        : geos39-3.9.2-1.rhel8.aarch64                                                                                                                      17/41 
</span><span class='line'>  Verifying        : libgeotiff16-1.6.0-6.rhel8.aarch64                                                                                                                18/41 
</span><span class='line'>  Verifying        : libgeotiff16-devel-1.6.0-6.rhel8.aarch64                                                                                                          19/41 
</span><span class='line'>  Verifying        : librttopo-1.1.0-1.rhel8.aarch64                                                                                                                   20/41 
</span><span class='line'>  Verifying        : libspatialite50-5.0.1-2.rhel8.aarch64                                                                                                             21/41 
</span><span class='line'>  Verifying        : libspatialite50-devel-5.0.1-2.rhel8.aarch64                                                                                                       22/41 
</span><span class='line'>  Verifying        : ogdi41-4.1.0-3.rhel8.aarch64                                                                                                                      23/41 
</span><span class='line'>  Verifying        : proj72-7.2.1-1.rhel8.aarch64                                                                                                                      24/41 
</span><span class='line'>  Verifying        : proj80-8.0.1-1.rhel8.aarch64                                                                                                                      25/41 
</span><span class='line'>  Verifying        : postgis24_96-2.4.9-3.rhel8.aarch64                                                                                                                26/41 
</span><span class='line'>  Verifying        : postgresql96-9.6.24-1PGDG.rhel8.aarch64                                                                                                           27/41 
</span><span class='line'>  Verifying        : postgresql96-contrib-9.6.24-1PGDG.rhel8.aarch64                                                                                                   28/41 
</span><span class='line'>  Verifying        : postgresql96-libs-9.6.24-1PGDG.rhel8.aarch64                                                                                                      29/41 
</span><span class='line'>  Verifying        : postgresql96-server-9.6.24-1PGDG.rhel8.aarch64                                                                                                    30/41 
</span><span class='line'>  Verifying        : freexl-1.0.6-4.el8.aarch64                                                                                                                        31/41 
</span><span class='line'>  Verifying        : gpsbabel-1.6.0-3.el8.aarch64                                                                                                                      32/41 
</span><span class='line'>  Verifying        : hdf-4.2.14-5.el8.aarch64                                                                                                                          33/41 
</span><span class='line'>  Verifying        : libbsd-0.9.1-4.el8.aarch64                                                                                                                        34/41 
</span><span class='line'>  Verifying        : libgta-1.2.1-1.el8.aarch64                                                                                                                        35/41 
</span><span class='line'>  Verifying        : minizip1.2-1.2.11-24.el8.aarch64                                                                                                                  36/41 
</span><span class='line'>  Verifying        : netcdf-4.7.0-2.el8.aarch64                                                                                                                        37/41 
</span><span class='line'>  Verifying        : shapelib-1.5.0-1.el8.aarch64                                                                                                                      38/41 
</span><span class='line'>  Verifying        : xerces-c-3.2.2-3.el8.aarch64                                                                                                                      39/41 
</span><span class='line'>  Verifying        : minizip-2.8.9-2.el8.aarch64                                                                                                                       40/41 
</span><span class='line'>  Verifying        : minizip-1.2.11-17.1.ky10.aarch64                                                                                                                  41/41 
</span><span class='line'>
</span><span class='line'>Upgraded:
</span><span class='line'>  minizip-2.8.9-2.el8.aarch64                                                                                                                                                
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  postgis24_96-2.4.9-3.rhel8.aarch64                     postgresql96-9.6.24-1PGDG.rhel8.aarch64                    postgresql96-server-9.6.24-1PGDG.rhel8.aarch64           
</span><span class='line'>  boost-atomic-1.66.0-18.ky10.aarch64                    boost-chrono-1.66.0-18.ky10.aarch64                        boost-date-time-1.66.0-18.ky10.aarch64                   
</span><span class='line'>  boost-serialization-1.66.0-18.ky10.aarch64             boost-system-1.66.0-18.ky10.aarch64                        boost-thread-1.66.0-18.ky10.aarch64                      
</span><span class='line'>  cfitsio-3.450-5.oe1.aarch64                            jasper-libs-2.0.14-7.ky10.aarch64                          libdap-3.19.1-3.oe1.aarch64                              
</span><span class='line'>  libusb-1:0.1.5-15.ky10.aarch64                         protobuf-3.9.0-7.ky10.aarch64                              protobuf-c-1.3.2-2.ky10.aarch64                          
</span><span class='line'>  CGAL-4.14-1.rhel8.aarch64                              SFCGAL-1.3.8-1.rhel8.aarch64                               SFCGAL-libs-1.3.8-1.rhel8.aarch64                        
</span><span class='line'>  gdal32-libs-3.2.2-13.rhel8.aarch64                     geos39-3.9.2-1.rhel8.aarch64                               libgeotiff16-1.6.0-6.rhel8.aarch64                       
</span><span class='line'>  libgeotiff16-devel-1.6.0-6.rhel8.aarch64               librttopo-1.1.0-1.rhel8.aarch64                            libspatialite50-5.0.1-2.rhel8.aarch64                    
</span><span class='line'>  libspatialite50-devel-5.0.1-2.rhel8.aarch64            ogdi41-4.1.0-3.rhel8.aarch64                               proj72-7.2.1-1.rhel8.aarch64                             
</span><span class='line'>  proj80-8.0.1-1.rhel8.aarch64                           postgresql96-contrib-9.6.24-1PGDG.rhel8.aarch64            postgresql96-libs-9.6.24-1PGDG.rhel8.aarch64             
</span><span class='line'>  freexl-1.0.6-4.el8.aarch64                             gpsbabel-1.6.0-3.el8.aarch64                               hdf-4.2.14-5.el8.aarch64                                 
</span><span class='line'>  libbsd-0.9.1-4.el8.aarch64                             libgta-1.2.1-1.el8.aarch64                                 minizip1.2-1.2.11-24.el8.aarch64                         
</span><span class='line'>  netcdf-4.7.0-2.el8.aarch64                             shapelib-1.5.0-1.el8.aarch64                               xerces-c-3.2.2-3.el8.aarch64                             
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>[root@col ~]# 
</span></code></pre></td></tr></table></div></figure>


<p>æ‰“åŒ…å¤‡ä»½ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@col ~]# tar zcf kylin-postgres96.tgz *.rpm rpmbuild /etc/yum.repos.d/
</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[K8Så®˜æ–¹ä¾‹å­NFS]]></title>
    <link href="http://winse.github.io/blog/2022/04/19/k8s-nfs-run-example/"/>
    <updated>2022-04-19T18:34:01+08:00</updated>
    <id>http://winse.github.io/blog/2022/04/19/k8s-nfs-run-example</id>
    <content type="html"><![CDATA[<h2>å‚è€ƒ</h2>

<p>æºç </p>

<ul>
<li><a href="https://github.com/kubernetes/examples/tree/master/staging/volumes/nfs">https://github.com/kubernetes/examples/tree/master/staging/volumes/nfs</a></li>
<li><a href="https://github.com/kubernetes/examples/blob/master/staging/volumes/nfs/nfs-server-deployment.yaml">https://github.com/kubernetes/examples/blob/master/staging/volumes/nfs/nfs-server-deployment.yaml</a></li>
</ul>


<p>æœ¬åœ°volumn</p>

<ul>
<li><a href="https://kubernetes.io/zh/docs/concepts/storage/volumes/#local">https://kubernetes.io/zh/docs/concepts/storage/volumes/#local</a></li>
</ul>


<h2>è¿è¡Œ</h2>

<h3>ç›®å½•ç»“æ„</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ git clone https://github.com/kubernetes/examples
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ cd examples/staging/volumes/nfs/
</span><span class='line'>[ec2-user@k8s nfs]$ ls -l
</span><span class='line'>total 48
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user  823 Apr 19 20:34 nfs-busybox-deployment.yaml
</span><span class='line'>drwxrwxr-x 2 ec2-user ec2-user   77 Apr 19 20:34 nfs-data
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user  193 Apr 19 20:34 nfs-pvc.yaml
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user 9379 Apr 19 20:34 nfs-pv.png
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user  234 Apr 19 20:34 nfs-pv.yaml
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user  729 Apr 19 20:34 nfs-server-deployment.yaml
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user  212 Apr 19 20:34 nfs-server-service.yaml
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user  673 Apr 19 20:34 nfs-web-deployment.yaml
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user  120 Apr 19 20:34 nfs-web-service.yaml
</span><span class='line'>drwxrwxr-x 2 ec2-user ec2-user   98 Apr 19 20:34 provisioner
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user 6540 Apr 19 20:34 README.md
</span><span class='line'>[ec2-user@k8s nfs]$ ls -l provisioner/
</span><span class='line'>total 12
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user 291 Apr 19 20:34 nfs-server-azure-pv.yaml
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user 324 Apr 19 20:34 nfs-server-cdk-pv.yaml
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user 215 Apr 19 20:34 nfs-server-gce-pv.yaml
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>nfs-data æ˜¯nfs-serveré•œåƒæ„å»ºDockerfileç›¸å…³æ–‡ä»¶ã€‚</li>
<li>nfs-serverï¼š

<ul>
<li>nfs-server-deployment.yaml</li>
<li>nfs-server-service.yaml</li>
<li>provisioner</li>
</ul>
</li>
<li>web

<ul>
<li>nfs-pv.yaml</li>
<li>nfs-pvc.yaml</li>
<li>nfs-web-deployment.yaml</li>
<li>nfs-web-service.yaml</li>
<li>nfs-busybox-deployment.yaml</li>
</ul>
</li>
</ul>


<p>æŒ‰ç…§ç»“æ„ï¼Œä¸€æ­¥æ­¥çš„æ¥è¿›è¡Œé…ç½®å’Œè¿è¡Œã€‚</p>

<h3>æ­å»ºNFS Serverçš„æœ¬åœ°å­˜å‚¨å·</h3>

<ul>
<li><a href="https://kubernetes.io/zh/docs/concepts/storage/volumes/#local">https://kubernetes.io/zh/docs/concepts/storage/volumes/#local</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ sudo mkdir /nfs
</span><span class='line'>[ec2-user@k8s ~]$ sudo chmod 777 /nfs
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ cat server-pv.yml 
</span><span class='line'>apiVersion: v1
</span><span class='line'>kind: PersistentVolume
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs-pv
</span><span class='line'>spec:
</span><span class='line'>  capacity:
</span><span class='line'>    storage: 10Gi
</span><span class='line'>  volumeMode: Filesystem
</span><span class='line'>  accessModes:
</span><span class='line'>  - ReadWriteOnce
</span><span class='line'># https://kubernetes.io/docs/concepts/storage/persistent-volumes/#reclaiming
</span><span class='line'>  persistentVolumeReclaimPolicy: Delete
</span><span class='line'>  storageClassName: local-storage
</span><span class='line'>  local:
</span><span class='line'>    path: /nfs
</span><span class='line'>  nodeAffinity:
</span><span class='line'>    required:
</span><span class='line'>      nodeSelectorTerms:
</span><span class='line'>      - matchExpressions:
</span><span class='line'>        - key: kubernetes.io/hostname
</span><span class='line'>          operator: In
</span><span class='line'>          values:
</span><span class='line'>          - k8s
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl apply -f server-pv.yml
</span><span class='line'>persistentvolume/nfs-pv created
</span></code></pre></td></tr></table></div></figure>


<p>åˆ›å»ºserver pvcï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs]$ kubectl create namespace nfs
</span><span class='line'>namespace/nfs-server created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ cat provisioner/nfs-server-gce-pv.yaml   
</span><span class='line'>apiVersion: v1
</span><span class='line'>kind: PersistentVolumeClaim
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs-pv-provisioning-demo
</span><span class='line'>  labels:
</span><span class='line'>    demo: nfs-pv-provisioning
</span><span class='line'>spec:
</span><span class='line'>  accessModes: [ "ReadWriteOnce" ]
</span><span class='line'>  resources:
</span><span class='line'>    requests:
</span><span class='line'>      storage: 10Gi
</span><span class='line'>  storageClassName: local-storage
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl apply -f provisioner/nfs-server-gce-pv.yaml -n nfs
</span><span class='line'>persistentvolumeclaim/nfs-pv-provisioning-demo created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl get pv 
</span><span class='line'>NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                          STORAGECLASS    REASON   AGE
</span><span class='line'>nfs-pv   10Gi       RWO            Delete           Bound    nfs/nfs-pv-provisioning-demo   local-storage            21s
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl get pvc -n nfs 
</span><span class='line'>NAME                       STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS    AGE
</span><span class='line'>nfs-pv-provisioning-demo   Bound    nfs-pv   10Gi       RWO            local-storage   18s
</span></code></pre></td></tr></table></div></figure>


<h3>å¯åŠ¨nfs-server</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ä¸‹è½½é•œåƒè¦ä»£ç†çš„ï¼Œå¯ä»¥æ›¿æ¢imageæˆ–è€…ä¸‹è½½åæ”¹tag
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ cat nfs-server-deployment.yaml
</span><span class='line'>apiVersion: apps/v1
</span><span class='line'>kind: Deployment
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs-server
</span><span class='line'>spec:
</span><span class='line'>  replicas: 1
</span><span class='line'>  selector:
</span><span class='line'>    matchLabels:
</span><span class='line'>      role: nfs-server
</span><span class='line'>  template:
</span><span class='line'>    metadata:
</span><span class='line'>      labels:
</span><span class='line'>        role: nfs-server
</span><span class='line'>    spec:
</span><span class='line'>      containers:
</span><span class='line'>      - name: nfs-server
</span><span class='line'>        image: k8s.gcr.io/volume-nfs:0.8
</span><span class='line'>        ports:
</span><span class='line'>          - name: nfs
</span><span class='line'>            containerPort: 2049
</span><span class='line'>          - name: mountd
</span><span class='line'>            containerPort: 20048
</span><span class='line'>          - name: rpcbind
</span><span class='line'>            containerPort: 111
</span><span class='line'>        securityContext:
</span><span class='line'>          privileged: true
</span><span class='line'>        volumeMounts:
</span><span class='line'>          - mountPath: /exports
</span><span class='line'>            name: mypvc
</span><span class='line'>      volumes:
</span><span class='line'>        - name: mypvc
</span><span class='line'>          persistentVolumeClaim:
</span><span class='line'>            claimName: nfs-pv-provisioning-demo
</span><span class='line'>[ec2-user@k8s nfs]$ cat nfs-server-service.yaml
</span><span class='line'>kind: Service
</span><span class='line'>apiVersion: v1
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs-server
</span><span class='line'>spec:
</span><span class='line'>  ports:
</span><span class='line'>    - name: nfs
</span><span class='line'>      port: 2049
</span><span class='line'>    - name: mountd
</span><span class='line'>      port: 20048
</span><span class='line'>    - name: rpcbind
</span><span class='line'>      port: 111
</span><span class='line'>  selector:
</span><span class='line'>    role: nfs-server
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl apply -f nfs-server-deployment.yaml -f nfs-server-service.yaml -n nfs
</span><span class='line'>deployment.apps/nfs-server created
</span><span class='line'>service/nfs-server created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl get all -n nfs -o wide
</span><span class='line'>NAME                              READY   STATUS    RESTARTS   AGE   IP             NODE   NOMINATED NODE   READINESS GATES
</span><span class='line'>pod/nfs-server-64886b598f-57mnx   1/1     Running   0          18s   10.244.0.146   k8s    &lt;none&gt;           &lt;none&gt;
</span><span class='line'>
</span><span class='line'>NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                      AGE   SELECTOR
</span><span class='line'>service/nfs-server   ClusterIP   10.111.29.73   &lt;none&gt;        2049/TCP,20048/TCP,111/TCP   18s   role=nfs-server
</span><span class='line'>
</span><span class='line'>NAME                         READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                      SELECTOR
</span><span class='line'>deployment.apps/nfs-server   1/1     1            1           18s   nfs-server   k8s.gcr.io/volume-nfs:0.8   role=nfs-server
</span><span class='line'>
</span><span class='line'>NAME                                    DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES                      SELECTOR
</span><span class='line'>replicaset.apps/nfs-server-64886b598f   1         1         1       18s   nfs-server   k8s.gcr.io/volume-nfs:0.8   pod-template-hash=64886b598f,role=nfs-server
</span></code></pre></td></tr></table></div></figure>


<p>æ ¹æ®nodeAffinityå®¹å™¨éƒ¨ç½²åœ¨äº†k8sçš„æœºå™¨ã€‚</p>

<h3>å¯åŠ¨webåº”ç”¨</h3>

<p>åˆ›å»ºå®¹å™¨ä½¿ç”¨çš„å·ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ä¸çŸ¥ä¸ºä½•ï¼Œåé¢å®¹å™¨æŒ‚è½½å·çš„æ—¶åˆ»è¯†åˆ«ä¸äº†åŸŸå... 
</span><span class='line'># mountçš„æ—¶åˆ»å¯èƒ½æ˜¯åœ¨nodeèŠ‚ç‚¹ä¸Šæ‰§è¡Œçš„ï¼Œæ‰€ä»¥è§£æä¸äº†åŸŸåã€‚
</span><span class='line'># æŠŠä¸»æœºçš„ nameserverè®¾ç½®ä¸ºï¼ˆ/etc/resolv.confï¼‰ nameserver 10.96.0.10 å°±å¯ä»¥äº†ã€‚
</span><span class='line'>[ec2-user@k8s nfs]$ cat nfs-pv.yaml 
</span><span class='line'>apiVersion: v1
</span><span class='line'>kind: PersistentVolume
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs
</span><span class='line'>spec:
</span><span class='line'>  capacity:
</span><span class='line'>    storage: 1Mi
</span><span class='line'>  accessModes:
</span><span class='line'>    - ReadWriteMany
</span><span class='line'>  nfs:
</span><span class='line'>    server: nfs-server.nfs.svc.cluster.local
</span><span class='line'>    path: "/"
</span><span class='line'>  mountOptions:
</span><span class='line'>    - nfsvers=4.2
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl apply -f nfs-pv.yaml 
</span><span class='line'>persistentvolume/nfs created
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl get pv nfs
</span><span class='line'>NAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE
</span><span class='line'>nfs    1Mi        RWX            Retain           Available                                   12s
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ cat nfs-pvc.yaml 
</span><span class='line'>apiVersion: v1
</span><span class='line'>kind: PersistentVolumeClaim
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs
</span><span class='line'>spec:
</span><span class='line'>  accessModes:
</span><span class='line'>    - ReadWriteMany
</span><span class='line'>  storageClassName: ""
</span><span class='line'>  resources:
</span><span class='line'>    requests:
</span><span class='line'>      storage: 1Mi
</span><span class='line'>  volumeName: nfs
</span><span class='line'>  
</span><span class='line'># kubectl get pv | tail -n+2 | awk '$5 == "Released" {print $1}' | xargs -I{} kubectl patch pv {} --type='merge' -p '{"spec":{"claimRef": null}}
</span><span class='line'># 
</span><span class='line'># [ec2-user@k8s nfs]$ kubectl patch pv nfs -p '{"spec":{"claimRef": null}}'                
</span><span class='line'># persistentvolume/nfs patched
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl apply -f nfs-pvc.yaml
</span><span class='line'>persistentvolumeclaim/nfs created
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl get pv 
</span><span class='line'>NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                          STORAGECLASS    REASON   AGE
</span><span class='line'>nfs      1Mi        RWX            Retain           Bound    default/nfs                                                 56s
</span><span class='line'>nfs-pv   10Gi       RWO            Delete           Bound    nfs/nfs-pv-provisioning-demo   local-storage            3m8s
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl get pvc -A 
</span><span class='line'>NAMESPACE   NAME                       STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS    AGE
</span><span class='line'>nfs         nfs                        Bound    nfs      1Mi        RWX                            22s
</span><span class='line'>nfs         nfs-pv-provisioning-demo   Bound    nfs-pv   10Gi       RWO            local-storage   3m
</span></code></pre></td></tr></table></div></figure>


<p>éƒ¨ç½²webåº”ç”¨çš„å®¹å™¨ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs]$ cat nfs-web-deployment.yaml 
</span><span class='line'># This pod mounts the nfs volume claim into /usr/share/nginx/html and
</span><span class='line'># serves a simple web page.
</span><span class='line'>
</span><span class='line'>apiVersion: apps/v1
</span><span class='line'>kind: Deployment
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs-web
</span><span class='line'>spec:
</span><span class='line'>  replicas: 2
</span><span class='line'>  selector:
</span><span class='line'>    matchLabels:
</span><span class='line'>      role: web-frontend
</span><span class='line'>  template:
</span><span class='line'>    metadata:
</span><span class='line'>      labels:
</span><span class='line'>        role: web-frontend
</span><span class='line'>    spec:
</span><span class='line'>      containers:
</span><span class='line'>      - name: web
</span><span class='line'>        image: nginx
</span><span class='line'>        ports:
</span><span class='line'>          - name: web
</span><span class='line'>            containerPort: 80
</span><span class='line'>        volumeMounts:
</span><span class='line'>            # name must match the volume name below
</span><span class='line'>            - name: nfs
</span><span class='line'>              mountPath: "/usr/share/nginx/html"
</span><span class='line'>      volumes:
</span><span class='line'>      - name: nfs
</span><span class='line'>        persistentVolumeClaim:
</span><span class='line'>          claimName: nfs
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ cat nfs-web-service.yaml
</span><span class='line'>kind: Service
</span><span class='line'>apiVersion: v1
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs-web
</span><span class='line'>spec:
</span><span class='line'>  ports:
</span><span class='line'>    - port: 80
</span><span class='line'>  selector:
</span><span class='line'>    role: web-frontend
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl apply -f nfs-web-deployment.yaml -f nfs-web-service.yaml
</span><span class='line'>deployment.apps/nfs-web created
</span><span class='line'>service/nfs-web created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl get all
</span><span class='line'>NAME                           READY   STATUS    RESTARTS   AGE
</span><span class='line'>pod/nfs-web-5554f77845-6rq5p   1/1     Running   0          4m56s
</span><span class='line'>pod/nfs-web-5554f77845-8r885   1/1     Running   0          4m56s
</span><span class='line'>
</span><span class='line'>NAME                 TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
</span><span class='line'>service/kubernetes   ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP   33d
</span><span class='line'>service/nfs-web      ClusterIP   10.108.129.153   &lt;none&gt;        80/TCP    4m56s
</span><span class='line'>
</span><span class='line'>NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
</span><span class='line'>deployment.apps/nfs-web   2/2     2            2           4m56s
</span><span class='line'>
</span><span class='line'>NAME                                 DESIRED   CURRENT   READY   AGE
</span><span class='line'>replicaset.apps/nfs-web-5554f77845   2         2         2       4m56s
</span></code></pre></td></tr></table></div></figure>


<p>æµ‹è¯•ï¼šdeploymentåˆ›å»ºä¸¤ä¸ªbusyboxï¼Œä¼šåœ¨nfså…±äº«ç›®å½•ä¸‹åˆ›å»ºä¿®æ”¹index.htmlï¼Œå†…å®¹ä¸ºï¼šæ—¶é—´å’Œä¸»æœºåã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs]$ kubectl apply -f nfs-busybox-deployment.yaml 
</span><span class='line'>deployment.apps/nfs-busybox created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs]$ curl nfs-web.default.svc.cluster.local 
</span><span class='line'>Wed Apr 20 00:15:20 UTC 2022
</span><span class='line'>nfs-busybox-55c668489c-dxqcx
</span><span class='line'>[ec2-user@k8s nfs]$ curl nfs-web.default.svc.cluster.local
</span><span class='line'>Wed Apr 20 00:16:51 UTC 2022
</span><span class='line'>nfs-busybox-55c668489c-sl7jz
</span></code></pre></td></tr></table></div></figure>


<h3>æ¸…ç†</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs]$ kubectl delete -f nfs-busybox-deployment.yaml -f nfs-web-deployment.yaml -f nfs-web-service.yaml -f nfs-pvc.yaml -f nfs-pv.yaml 
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl delete ns nfs 
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl delete -f server-pv.yml 
</span></code></pre></td></tr></table></div></figure>


<h2>é—®é¢˜</h2>

<h3>NFSæœåŠ¡å™¨çš„åŸŸåè§£æä¸äº†</h3>

<p>ä¸€å¼€å§‹æ²¡æœ‰æ”¹èŠ‚ç‚¹çš„dnsï¼Œä¼šå‡ºç°åŸŸåè§£æä¸äº†çš„æƒ…å†µï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs]$ kubectl describe pod nfs-web-7bc965b94f-k6mrj -n nfs 
</span><span class='line'>...
</span><span class='line'>Events:
</span><span class='line'>  Type     Reason       Age               From               Message
</span><span class='line'>  ----     ------       ----              ----               -------
</span><span class='line'>  Normal   Scheduled    43s               default-scheduler  Successfully assigned nfs/nfs-web-7bc965b94f-k6mrj to worker1
</span><span class='line'>  Warning  FailedMount  1s (x7 over 35s)  kubelet            MountVolume.SetUp failed for volume "nfs" : mount failed: exit status 32
</span><span class='line'>Mounting command: mount
</span><span class='line'>Mounting arguments: -t nfs -o nfsvers=4.2 nfs-server.nfs.svc.cluster.local:/ /var/lib/kubelet/pods/03049217-ded3-4d31-86e8-6a13c0f5b12f/volumes/kubernetes.io~nfs/nfs
</span><span class='line'>Output: mount.nfs: Failed to resolve server nfs-server.nfs.svc.cluster.local: Name or service not known
</span><span class='line'>mount.nfs: Operation already in progress
</span></code></pre></td></tr></table></div></figure>


<p>å®¹å™¨å†…æ˜¯å¯ä»¥é€šè¿‡åŸŸåè®¿é—®çš„ï¼Œmountçš„æ—¶åˆ»å¯èƒ½æ˜¯åœ¨nodeèŠ‚ç‚¹ä¸Šæ‰§è¡Œçš„ï¼Œæ‰€ä»¥è§£æä¸äº†åŸŸåã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl run -ti test --rm --image busybox -n nfs -- sh  
</span><span class='line'>/ # ping nfs-server.nfs.svc.cluster.local
</span><span class='line'>[ec2-user@k8s nfs]$ kubectl run -ti test --rm --image busybox -- sh
</span><span class='line'>
</span><span class='line'>/ # cat /etc/resolv.conf 
</span><span class='line'>nameserver 10.96.0.10
</span><span class='line'>search default.svc.cluster.local svc.cluster.local cluster.local localdomain
</span><span class='line'>options ndots:5
</span></code></pre></td></tr></table></div></figure>


<p>æŠŠæ‰€æœ‰èŠ‚ç‚¹çš„dnsè®¾ç½®ä¸º kube-dns çš„ 10.96.0.10 å°±å¯ä»¥äº†ã€‚</p>

<h3>é›†ç¾¤å‡ºé—®é¢˜</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs]$ kubectl get pods -A 
</span><span class='line'>,,,
</span><span class='line'>ingress-nginx          ingress-nginx-controller-755447bb4d-55hjz    0/1     CrashLoopBackOff       32 (2m19s ago)   17d
</span><span class='line'>kube-system            coredns-64897985d-4d5rx                      0/1     CrashLoopBackOff       40 (4m30s ago)   33d
</span><span class='line'>kube-system            coredns-64897985d-m9p9q                      0/1     CrashLoopBackOff       40 (4m15s ago)   33d
</span><span class='line'>,,,
</span><span class='line'>kubernetes-dashboard   dashboard-metrics-scraper-799d786dbf-rj8rl   0/1     CrashLoopBackOff       33 (116s ago)    17d
</span><span class='line'>kubernetes-dashboard   kubernetes-dashboard-fb8648fd9-22krh         0/1     CrashLoopBackOff       32 (3m35s ago)   17d
</span></code></pre></td></tr></table></div></figure>


<p>æŠŠæ‰€æœ‰çš„å®¹å™¨éƒ½æ¸…ç†äº†ï¼Œç„¶åé‡å¯æœåŠ¡å™¨ï¼ˆæˆ–è€…kubeletï¼‰</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs]$ docker ps -a |  awk '{print $1}' | while read i ; do docker rm -f $i ; done 
</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[k8så…±äº«å­˜å‚¨ä½¿ç”¨NFS]]></title>
    <link href="http://winse.github.io/blog/2022/04/14/k8s-nfs/"/>
    <updated>2022-04-14T01:23:14+08:00</updated>
    <id>http://winse.github.io/blog/2022/04/14/k8s-nfs</id>
    <content type="html"><![CDATA[<p>å®¹å™¨ä¸­çš„åº”ç”¨æ•°æ®å¾—ä¿å­˜ä¸‹æ¥ï¼Œä½¿ç”¨local/hostPathå¯ä»¥ä¸´æ—¶ç”¨ç”¨ï¼Œè¿˜æ˜¯å¾—æœ‰ä¸€ä¸ªå…±äº«çš„å­˜å‚¨ã€‚</p>

<ul>
<li><a href="https://kubernetes.io/zh/docs/concepts/storage/volumes/#volume-types">https://kubernetes.io/zh/docs/concepts/storage/volumes/#volume-types</a></li>
<li><a href="https://kubernetes.io/zh/docs/concepts/storage/_print/#types-of-persistent-volumes">https://kubernetes.io/zh/docs/concepts/storage/_print/#types-of-persistent-volumes</a></li>
<li><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#provisioner">https://kubernetes.io/docs/concepts/storage/storage-classes/#provisioner</a></li>
<li><a href="https://kubernetes.io/docs/concepts/storage/volumes/#hostpath">https://kubernetes.io/docs/concepts/storage/volumes/#hostpath</a></li>
<li><a href="https://kubernetes.io/zh/docs/concepts/storage/volumes/#local">https://kubernetes.io/zh/docs/concepts/storage/volumes/#local</a></li>
<li><a href="https://kubernetes.io/zh/docs/concepts/storage/volumes/#cephfs">https://kubernetes.io/zh/docs/concepts/storage/volumes/#cephfs</a></li>
</ul>


<p>å…ˆä½¿ç”¨æœ€ç®€å•çš„NFSåˆ†åŒº/å·ã€‚</p>

<ul>
<li><a href="http://www.lishuai.fun/2021/08/12/k8s-nfs-pv">http://www.lishuai.fun/2021/08/12/k8s-nfs-pv</a></li>
</ul>


<h2>å®‰è£…NFS server on aws ec2</h2>

<ul>
<li><a href="https://segmentfault.com/a/1190000024512057">https://segmentfault.com/a/1190000024512057</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#æ‰€æœ‰nodeèŠ‚ç‚¹å®‰è£…nfså®¢æˆ·ç«¯
</span><span class='line'>#yum -y install nfs-utils
</span><span class='line'>#systemctl start nfs && systemctl enable nfs
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ sudo yum install nfs-utils 
</span><span class='line'>Loaded plugins: langpacks, priorities, update-motd
</span><span class='line'>amzn2-core                                                                                                                     | 3.7 kB  00:00:00     
</span><span class='line'>Package 1:nfs-utils-1.3.0-0.54.amzn2.0.2.x86_64 already installed and latest version
</span><span class='line'>Nothing to do
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ sudo mkdir /backup
</span><span class='line'>[ec2-user@k8s ~]$ sudo chmod -R 755 /backup
</span><span class='line'>[ec2-user@k8s ~]$ sudo chown nfsnobody:nfsnobody /backup
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ sudo vi /etc/exports
</span><span class='line'>[ec2-user@k8s ~]$ cat /etc/exports    
</span><span class='line'>/backup 192.168.191.0/24(rw,sync,no_root_squash,no_all_squash)
</span><span class='line'>
</span><span class='line'># /k8s-fs *(rw,sync,no_root_squash,no_all_squash)
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ sudo service nfs-server restart 
</span><span class='line'>Redirecting to /bin/systemctl restart nfs-server.service
</span><span class='line'>[ec2-user@k8s ~]$ 
</span><span class='line'>[ec2-user@k8s ~]$ sudo exportfs
</span><span class='line'>/backup         192.168.191.0/24
</span><span class='line'>[ec2-user@k8s ~]$ sudo exportfs -arv 
</span><span class='line'>exporting 192.168.191.0/24:/backup
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ rpcinfo -p localhost
</span><span class='line'>   program vers proto   port  service
</span><span class='line'>    100000    4   tcp    111  portmapper
</span><span class='line'>    100000    3   tcp    111  portmapper
</span><span class='line'>    100000    2   tcp    111  portmapper
</span><span class='line'>    100000    4   udp    111  portmapper
</span><span class='line'>    100000    3   udp    111  portmapper
</span><span class='line'>    100000    2   udp    111  portmapper
</span><span class='line'>    100024    1   udp  56847  status
</span><span class='line'>    100024    1   tcp  60971  status
</span><span class='line'>    100005    1   udp  20048  mountd
</span><span class='line'>    100005    1   tcp  20048  mountd
</span><span class='line'>    100005    2   udp  20048  mountd
</span><span class='line'>    100005    2   tcp  20048  mountd
</span><span class='line'>    100005    3   udp  20048  mountd
</span><span class='line'>    100005    3   tcp  20048  mountd
</span><span class='line'>    100003    3   tcp   2049  nfs
</span><span class='line'>    100003    4   tcp   2049  nfs
</span><span class='line'>    100227    3   tcp   2049  nfs_acl
</span><span class='line'>    100003    3   udp   2049  nfs
</span><span class='line'>    100227    3   udp   2049  nfs_acl
</span><span class='line'>    100021    1   udp  47545  nlockmgr
</span><span class='line'>    100021    3   udp  47545  nlockmgr
</span><span class='line'>    100021    4   udp  47545  nlockmgr
</span><span class='line'>    100021    1   tcp  40703  nlockmgr
</span><span class='line'>    100021    3   tcp  40703  nlockmgr
</span><span class='line'>    100021    4   tcp  40703  nlockmgr
</span><span class='line'>[ec2-user@k8s ~]$ showmount -e 192.168.191.131
</span><span class='line'>Export list for 192.168.191.131:
</span><span class='line'>/backup 192.168.191.0/24
</span></code></pre></td></tr></table></div></figure>


<p>ä¹Ÿå¯ä»¥é€šè¿‡dockeræ¥å¯åŠ¨nfs serverï¼š</p>

<ul>
<li><a href="https://blog.ruanbekker.com/blog/2020/09/20/setup-a-nfs-server-with-docker/">https://blog.ruanbekker.com/blog/2020/09/20/setup-a-nfs-server-with-docker/</a></li>
<li><a href="https://westzq1.github.io/k8s/2019/06/28/nfs-server-on-K8S.html">https://westzq1.github.io/k8s/2019/06/28/nfs-server-on-K8S.html</a></li>
<li><a href="https://github.com/kubernetes/examples/blob/master/staging/volumes/nfs/nfs-server-deployment.yaml">https://github.com/kubernetes/examples/blob/master/staging/volumes/nfs/nfs-server-deployment.yaml</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ sudo mkdir -p /data/kubernetes-volumes
</span><span class='line'>[ec2-user@k8s ~]$ docker run --privileged -itd --name nfs -p 2049:2049 -e SHARED_DIRECTORY=/data -v /data/kubernetes-volumes:/data itsthenetwork/nfs-server-alpine:12 
</span><span class='line'>f84b70dcca6bd5abb275fbee50fd161d8befdd709ce6523b3a514f04b7af8677
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ docker logs f84b70dcca6bd5abb2 
</span><span class='line'>Writing SHARED_DIRECTORY to /etc/exports file
</span><span class='line'>The PERMITTED environment variable is unset or null, defaulting to '*'.
</span><span class='line'>This means any client can mount.
</span><span class='line'>The READ_ONLY environment variable is unset or null, defaulting to 'rw'.
</span><span class='line'>Clients have read/write access.
</span><span class='line'>The SYNC environment variable is unset or null, defaulting to 'async' mode.
</span><span class='line'>Writes will not be immediately written to disk.
</span><span class='line'>Displaying /etc/exports contents:
</span><span class='line'>/data *(rw,fsid=0,async,no_subtree_check,no_auth_nlm,insecure,no_root_squash)
</span><span class='line'>
</span><span class='line'>Starting rpcbind...
</span><span class='line'>Displaying rpcbind status...
</span><span class='line'>   program version netid     address                service    owner
</span><span class='line'>    100000    4    tcp6      ::.0.111               -          superuser
</span><span class='line'>    100000    3    tcp6      ::.0.111               -          superuser
</span><span class='line'>    100000    4    udp6      ::.0.111               -          superuser
</span><span class='line'>    100000    3    udp6      ::.0.111               -          superuser
</span><span class='line'>    100000    4    tcp       0.0.0.0.0.111          -          superuser
</span><span class='line'>    100000    3    tcp       0.0.0.0.0.111          -          superuser
</span><span class='line'>    100000    2    tcp       0.0.0.0.0.111          -          superuser
</span><span class='line'>    100000    4    udp       0.0.0.0.0.111          -          superuser
</span><span class='line'>    100000    3    udp       0.0.0.0.0.111          -          superuser
</span><span class='line'>    100000    2    udp       0.0.0.0.0.111          -          superuser
</span><span class='line'>    100000    4    local     /var/run/rpcbind.sock  -          superuser
</span><span class='line'>    100000    3    local     /var/run/rpcbind.sock  -          superuser
</span><span class='line'>Starting NFS in the background...
</span><span class='line'>rpc.nfsd: knfsd is currently down
</span><span class='line'>rpc.nfsd: Writing version string to kernel: -2 -3 +4 +4.1 +4.2
</span><span class='line'>rpc.nfsd: Created AF_INET TCP socket.
</span><span class='line'>rpc.nfsd: Created AF_INET6 TCP socket.
</span><span class='line'>Exporting File System...
</span><span class='line'>exporting *:/data
</span><span class='line'>/data           &lt;world&gt;
</span><span class='line'>Starting Mountd in the background...These
</span><span class='line'>Startup successful.
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ sudo mount -v -o vers=4,loud 127.0.0.1:/ nfsmnt
</span><span class='line'>mount.nfs: timeout set for Thu Apr 14 08:26:48 2022
</span><span class='line'>mount.nfs: trying text-based options 'vers=4.1,addr=127.0.0.1,clientaddr=127.0.0.1'
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ df -h | grep nfsmnt
</span><span class='line'>127.0.0.1:/      25G  9.8G   16G  39% /home/ec2-user/nfsmnt
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ touch nfsmnt/$(hostname).txt
</span><span class='line'>[ec2-user@k8s ~]$ ls -l nfsmnt/
</span><span class='line'>total 0
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user 0 Apr 14 08:25 k8s.txt
</span><span class='line'>[ec2-user@k8s ~]$ ls -l /data/kubernetes-volumes/
</span><span class='line'>total 0
</span><span class='line'>-rw-rw-r-- 1 ec2-user ec2-user 0 Apr 14 08:25 k8s.txt
</span><span class='line'>[ec2-user@k8s ~]$ 
</span><span class='line'>
</span><span class='line'># vi /etc/fstab
</span><span class='line'># 192.168.0.4:/   /mnt   nfs4    _netdev,auto  0  0
</span><span class='line'>
</span><span class='line'>### pod
</span><span class='line'># kubectl create -f nfs-server.yml
</span><span class='line'>apiVersion: extensions/v1beta1
</span><span class='line'>kind: Deployment
</span><span class='line'>metadata:
</span><span class='line'>  name: nfs-server
</span><span class='line'>spec:
</span><span class='line'>  replicas: 1           # &lt;- no more replicas
</span><span class='line'>  template:
</span><span class='line'>    metadata:
</span><span class='line'>      labels:
</span><span class='line'>        app: nfs-server
</span><span class='line'>    spec:
</span><span class='line'>      nodeSelector:     # &lt;- use selector to fix nfs-server on k8s2.zhangqiaoc.com
</span><span class='line'>        kubernetes.io/hostname: k8s2.zhangqiaoc.com
</span><span class='line'>      containers:
</span><span class='line'>      - name: nfs-server
</span><span class='line'>        image: itsthenetwork/nfs-server-alpine:latest
</span><span class='line'>        volumeMounts:
</span><span class='line'>        - name: nfs-storage
</span><span class='line'>          mountPath: /nfsshare
</span><span class='line'>        env:
</span><span class='line'>        - name: SHARED_DIRECTORY
</span><span class='line'>          value: "/nfsshare"
</span><span class='line'>        ports:
</span><span class='line'>        - name: nfs  
</span><span class='line'>          containerPort: 2049   # &lt;- export port
</span><span class='line'>        securityContext:
</span><span class='line'>          privileged: true      # &lt;- privileged mode is mandentory.
</span><span class='line'>      volumes:
</span><span class='line'>      - name: nfs-storage  
</span><span class='line'>        hostPath:               # &lt;- the folder on the host machine.
</span><span class='line'>          path: /root/fileshare
</span><span class='line'># kubectl expose deployment nfs-server --type=ClusterIP
</span><span class='line'># kubectl get svc
</span><span class='line'>
</span><span class='line'># yum install -y nfs-utils
</span><span class='line'># mkdir /root/nfsmnt
</span><span class='line'># mount -v 10.101.117.226:/ /root/nfsmnt
</span></code></pre></td></tr></table></div></figure>


<p>client</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># æ‰€æœ‰workèŠ‚ç‚¹å®‰è£… nfs-utils rpcbind
</span><span class='line'>[ec2-user@worker1 ~]$ sudo yum install nfs-utils 
</span><span class='line'>Loaded plugins: langpacks, priorities, update-motd
</span><span class='line'>amzn2-core                                                                                                                                        | 3.7 kB  00:00:00     
</span><span class='line'>Package 1:nfs-utils-1.3.0-0.54.amzn2.0.2.x86_64 already installed and latest version
</span><span class='line'>Nothing to do
</span><span class='line'>
</span><span class='line'>[ec2-user@worker1 ~]$ sudo systemctl status nfs
</span><span class='line'>â— nfs-server.service - NFS server and services
</span><span class='line'>   Loaded: loaded (/usr/lib/systemd/system/nfs-server.service; disabled; vendor preset: disabled)
</span><span class='line'>   Active: inactive (dead)
</span><span class='line'>[ec2-user@worker1 ~]$ sudo systemctl status rpcbind
</span><span class='line'>â— rpcbind.service - RPC bind service
</span><span class='line'>   Loaded: loaded (/usr/lib/systemd/system/rpcbind.service; enabled; vendor preset: enabled)
</span><span class='line'>   Active: active (running) since Wed 2022-04-13 20:44:34 CST; 1h 51min ago
</span><span class='line'>  Process: 6979 ExecStart=/sbin/rpcbind -w $RPCBIND_ARGS (code=exited, status=0/SUCCESS)
</span><span class='line'> Main PID: 7025 (rpcbind)
</span><span class='line'>    Tasks: 1
</span><span class='line'>   Memory: 2.1M
</span><span class='line'>   CGroup: /system.slice/rpcbind.service
</span><span class='line'>           â””â”€7025 /sbin/rpcbind -w
</span><span class='line'>
</span><span class='line'>Apr 13 20:44:34 worker1 systemd[1]: Starting RPC bind service...
</span><span class='line'>Apr 13 20:44:34 worker1 systemd[1]: Started RPC bind service.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@worker1 ~]$ sudo mkdir -p /data
</span><span class='line'>[ec2-user@worker1 ~]$ sudo chmod 777 /data 
</span><span class='line'>[ec2-user@worker1 ~]$ sudo mount -t nfs 192.168.191.131:/backup /data
</span><span class='line'>[ec2-user@worker1 ~]$ df -h | grep 192.168.191.131
</span><span class='line'>192.168.191.131:/backup   25G  9.6G   16G  39% /data
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># vi /etc/fstab
</span><span class='line'># 172.17.30.22:/backup /data nfs defaults 0 0
</span></code></pre></td></tr></table></div></figure>


<h2>k8sä¸­ä½¿ç”¨NFS</h2>

<ul>
<li><a href="http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/">http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/</a></li>
</ul>


<h3>å®¹å™¨ç›´æ¥æŒ‚è½½NFS</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ cat nginx-1.yml 
</span><span class='line'>apiVersion: apps/v1
</span><span class='line'>kind: Deployment
</span><span class='line'>metadata:
</span><span class='line'>  name: nginx-deployment
</span><span class='line'>  labels:
</span><span class='line'>    app: nginx
</span><span class='line'>spec:
</span><span class='line'>  replicas: 3
</span><span class='line'>  selector:
</span><span class='line'>    matchLabels:
</span><span class='line'>      app: nginx
</span><span class='line'>  template:
</span><span class='line'>    metadata:
</span><span class='line'>      labels:
</span><span class='line'>        app: nginx
</span><span class='line'>    spec:
</span><span class='line'>      containers:
</span><span class='line'>      - name: nginx
</span><span class='line'>        image: nginx:1.14.2
</span><span class='line'>        ports:
</span><span class='line'>        - containerPort: 80
</span><span class='line'>        volumeMounts:
</span><span class='line'>        - name: data
</span><span class='line'>          mountPath: /usr/share/nginx/html
</span><span class='line'>      volumes:
</span><span class='line'>      - name: data
</span><span class='line'>        nfs:
</span><span class='line'>          path: /backup
</span><span class='line'>          server: 192.168.191.131
</span><span class='line'>        
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f nginx-1.yml
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get all 
</span><span class='line'>NAME                                   READY   STATUS    RESTARTS   AGE
</span><span class='line'>pod/nginx-deployment-67dcb957c-g2h8x   1/1     Running   0          2m50s
</span><span class='line'>pod/nginx-deployment-67dcb957c-gfv28   1/1     Running   0          2m50s
</span><span class='line'>pod/nginx-deployment-67dcb957c-rqwjs   1/1     Running   0          2m50s
</span><span class='line'>
</span><span class='line'>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
</span><span class='line'>service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   27d
</span><span class='line'>
</span><span class='line'>NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
</span><span class='line'>deployment.apps/nginx-deployment   3/3     3            3           2m50s
</span><span class='line'>
</span><span class='line'>NAME                                         DESIRED   CURRENT   READY   AGE
</span><span class='line'>replicaset.apps/nginx-deployment-67dcb957c   3         3         3       2m50s
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl exec -ti pod/nginx-deployment-67dcb957c-g2h8x -- bash 
</span><span class='line'>root@nginx-deployment-67dcb957c-g2h8x:/# echo $(hostname) &gt;/usr/share/nginx/html/1.txt
</span><span class='line'>
</span><span class='line'>root@nginx-deployment-67dcb957c-g2h8x:/# mount | grep 192
</span><span class='line'>192.168.191.131:/backup on /usr/share/nginx/html type nfs4 (rw,relatime,vers=4.1,rsize=524288,wsize=524288,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.191.132,local_lock=none,addr=192.168.191.131)
</span><span class='line'>root@nginx-deployment-67dcb957c-g2h8x:/# 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># æœåŠ¡ç«¯æŸ¥çœ‹æ–‡ä»¶å†…å®¹
</span><span class='line'>[ec2-user@k8s ~]$ cat /backup/1.txt 
</span><span class='line'>nginx-deployment-67dcb957c-g2h8x
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl delete -f nginx-1.yml 
</span><span class='line'>deployment.apps "nginx-deployment" deleted
</span></code></pre></td></tr></table></div></figure>


<h3>pvc</h3>

<ul>
<li><a href="https://segmentfault.com/a/1190000040785500">https://segmentfault.com/a/1190000040785500</a></li>
<li><a href="http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/#%E5%88%9B%E5%BB%BA%E7%B1%BB%E5%9E%8B%E4%B8%BAnfs%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E5%8D%B7">http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/#%E5%88%9B%E5%BB%BA%E7%B1%BB%E5%9E%8B%E4%B8%BAnfs%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E5%8D%B7</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ vi pv-nfs.yaml 
</span><span class='line'>[ec2-user@k8s ~]$ cat pv-nfs.yaml 
</span><span class='line'>apiVersion: v1
</span><span class='line'>kind: PersistentVolume
</span><span class='line'>metadata:
</span><span class='line'>  name: pv-nfs
</span><span class='line'>spec:
</span><span class='line'>  capacity:
</span><span class='line'>    storage: 10Gi
</span><span class='line'>  accessModes:
</span><span class='line'>    - ReadWriteMany 
</span><span class='line'>  nfs:
</span><span class='line'>    path: /backup
</span><span class='line'>    server: 192.168.191.131
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f pv-nfs.yaml 
</span><span class='line'>persistentvolume/pv-nfs created
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pv 
</span><span class='line'>NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE
</span><span class='line'>pv-nfs   10Gi       RWX            Retain           Available                                   5s
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ vi pvc-nfs.yaml 
</span><span class='line'>[ec2-user@k8s ~]$ cat pvc-nfs.yaml 
</span><span class='line'>kind: PersistentVolumeClaim
</span><span class='line'>apiVersion: v1
</span><span class='line'>metadata:
</span><span class='line'>  name: pvc-nfs
</span><span class='line'>spec:
</span><span class='line'>  accessModes:
</span><span class='line'>    - ReadWriteMany
</span><span class='line'>  resources:
</span><span class='line'>    requests:
</span><span class='line'>      storage: 10Gi
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f pvc-nfs.yaml 
</span><span class='line'>persistentvolumeclaim/pvc-nfs created
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pvc
</span><span class='line'>NAME      STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
</span><span class='line'>pvc-nfs   Bound    pv-nfs   10Gi       RWX                           7s
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pv 
</span><span class='line'>NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM             STORAGECLASS   REASON   AGE
</span><span class='line'>pv-nfs   10Gi       RWX            Retain           Bound    default/pvc-nfs                           79s
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ vi dp-pvc.yaml
</span><span class='line'>[ec2-user@k8s ~]$ cat dp-pvc.yaml 
</span><span class='line'>apiVersion: apps/v1
</span><span class='line'>kind: Deployment
</span><span class='line'>metadata:
</span><span class='line'>  name: busybox
</span><span class='line'>  labels:
</span><span class='line'>    app: busybox
</span><span class='line'>spec:
</span><span class='line'>  replicas: 1
</span><span class='line'>  selector:
</span><span class='line'>    matchLabels:
</span><span class='line'>      app: busybox
</span><span class='line'>  template:
</span><span class='line'>    metadata:
</span><span class='line'>      labels:
</span><span class='line'>        app: busybox
</span><span class='line'>    spec:
</span><span class='line'>      containers:
</span><span class='line'>      - name: busybox
</span><span class='line'>        image: busybox
</span><span class='line'>        command: ['sh', '-c', 'echo "Hello, Kubernetes!" && sleep 3600']
</span><span class='line'>        volumeMounts:
</span><span class='line'>        - name: data
</span><span class='line'>          mountPath: /data
</span><span class='line'>      volumes:
</span><span class='line'>      - name: data
</span><span class='line'>        persistentVolumeClaim:
</span><span class='line'>          claimName: pvc-nfs
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f dp-pvc.yaml 
</span><span class='line'>deployment.apps/busybox created
</span><span class='line'>[ec2-user@k8s ~]$ 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get all 
</span><span class='line'>NAME                           READY   STATUS    RESTARTS   AGE
</span><span class='line'>pod/busybox-6b99c495c9-qnvlp   1/1     Running   0          47s
</span><span class='line'>
</span><span class='line'>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
</span><span class='line'>service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   27d
</span><span class='line'>
</span><span class='line'>NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
</span><span class='line'>deployment.apps/busybox   1/1     1            1           47s
</span><span class='line'>
</span><span class='line'>NAME                                 DESIRED   CURRENT   READY   AGE
</span><span class='line'>replicaset.apps/busybox-6b99c495c9   1         1         1       47s
</span><span class='line'>
</span><span class='line'># æŸ¥çœ‹NFSä¸­åŸæ¥çš„æ•°æ®
</span><span class='line'>[ec2-user@k8s ~]$ kubectl exec -ti busybox-6b99c495c9-qnvlp -- cat /data/1.txt 
</span><span class='line'>nginx-deployment-67dcb957c-g2h8x
</span></code></pre></td></tr></table></div></figure>


<p>æµ‹ä¸€ä¸‹subPathExprï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl delete -f dp-pvc.yaml 
</span><span class='line'>deployment.apps "busybox" deleted
</span><span class='line'>[ec2-user@k8s ~]$ 
</span><span class='line'>[ec2-user@k8s ~]$ vi dp-pvc.yaml 
</span><span class='line'>[ec2-user@k8s ~]$ cat dp-pvc.yaml 
</span><span class='line'>apiVersion: apps/v1
</span><span class='line'>kind: Deployment
</span><span class='line'>metadata:
</span><span class='line'>  name: busybox
</span><span class='line'>  labels:
</span><span class='line'>    app: busybox
</span><span class='line'>spec:
</span><span class='line'>  replicas: 1
</span><span class='line'>  selector:
</span><span class='line'>    matchLabels:
</span><span class='line'>      app: busybox
</span><span class='line'>  template:
</span><span class='line'>    metadata:
</span><span class='line'>      labels:
</span><span class='line'>        app: busybox
</span><span class='line'>    spec:
</span><span class='line'>      containers:
</span><span class='line'>      - name: busybox
</span><span class='line'>        image: busybox
</span><span class='line'>        command: ['sh', '-c', 'echo "Hello, Kubernetes!" && sleep 3600']
</span><span class='line'>        env:
</span><span class='line'>        - name: POD_NAME
</span><span class='line'>          valueFrom:
</span><span class='line'>            fieldRef:
</span><span class='line'>              apiVersion: v1
</span><span class='line'>              fieldPath: metadata.name
</span><span class='line'>        volumeMounts:
</span><span class='line'>        - name: data
</span><span class='line'>          mountPath: /data
</span><span class='line'>          subPathExpr: $(POD_NAME)
</span><span class='line'>      volumes:
</span><span class='line'>      - name: data
</span><span class='line'>        persistentVolumeClaim:
</span><span class='line'>          claimName: pvc-nfs
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f dp-pvc.yaml 
</span><span class='line'>deployment.apps/busybox created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get all 
</span><span class='line'>NAME                           READY   STATUS    RESTARTS   AGE
</span><span class='line'>pod/busybox-5497486bf5-csr6q   1/1     Running   0          7s
</span><span class='line'>
</span><span class='line'>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
</span><span class='line'>service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   27d
</span><span class='line'>
</span><span class='line'>NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
</span><span class='line'>deployment.apps/busybox   1/1     1            1           7s
</span><span class='line'>
</span><span class='line'>NAME                                 DESIRED   CURRENT   READY   AGE
</span><span class='line'>replicaset.apps/busybox-5497486bf5   1         1         1       7s
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl exec -ti pod/busybox-5497486bf5-csr6q -- sh 
</span><span class='line'>/ # ls /data
</span><span class='line'>/ # echo $(hostname) &gt; /data/pvc.txt
</span><span class='line'>/ # exit
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># æŸ¥çœ‹æœåŠ¡ç«¯ç›®å½•ä¸‹æ•°æ®
</span><span class='line'>[ec2-user@k8s ~]$ ll /backup/
</span><span class='line'>total 4
</span><span class='line'>-rw-r--r-- 1 root root 33 Apr 14 00:37 1.txt
</span><span class='line'>drwxr-xr-x 2 root root 21 Apr 14 00:51 busybox-5497486bf5-csr6q
</span><span class='line'>[ec2-user@k8s ~]$ cat /backup/busybox-5497486bf5-csr6q/pvc.txt   
</span><span class='line'>busybox-5497486bf5-csr6q
</span></code></pre></td></tr></table></div></figure>


<p>æŠŠreplicasæ”¹æˆ2ï¼Œå†è¯•è¯•ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f dp-pvc.yaml 
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pods
</span><span class='line'>NAME                       READY   STATUS    RESTARTS   AGE
</span><span class='line'>busybox-5497486bf5-fkzls   1/1     Running   0          3m8s
</span><span class='line'>busybox-5497486bf5-rv7k7   1/1     Running   0          3m8s
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl exec busybox-5497486bf5-fkzls -- sh -c 'echo $(hostname) &gt;/data/$(hostname).txt'
</span><span class='line'>[ec2-user@k8s ~]$ kubectl exec busybox-5497486bf5-rv7k7 -- sh -c 'echo $(hostname) &gt;/data/$(hostname).txt'                        
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># æŸ¥çœ‹æœåŠ¡ç«¯ç›®å½•ç»“æ„
</span><span class='line'>[ec2-user@k8s ~]$ ll -R /backup/
</span><span class='line'>/backup/:
</span><span class='line'>total 4
</span><span class='line'>-rw-r--r-- 1 root root 33 Apr 14 00:37 1.txt
</span><span class='line'>drwxr-xr-x 2 root root 21 Apr 14 00:51 busybox-5497486bf5-csr6q
</span><span class='line'>drwxr-xr-x 2 root root 42 Apr 14 01:20 busybox-5497486bf5-fkzls
</span><span class='line'>drwxr-xr-x 2 root root 42 Apr 14 01:20 busybox-5497486bf5-rv7k7
</span><span class='line'>
</span><span class='line'>/backup/busybox-5497486bf5-csr6q:
</span><span class='line'>total 4
</span><span class='line'>-rw-r--r-- 1 root root 25 Apr 14 00:51 pvc.txt
</span><span class='line'>
</span><span class='line'>/backup/busybox-5497486bf5-fkzls:
</span><span class='line'>total 4
</span><span class='line'>-rw-r--r-- 1 root root 25 Apr 14 01:20 busybox-5497486bf5-fkzls.txt
</span><span class='line'>
</span><span class='line'>/backup/busybox-5497486bf5-rv7k7:
</span><span class='line'>total 4
</span><span class='line'>-rw-r--r-- 1 root root 25 Apr 14 01:20 busybox-5497486bf5-rv7k7.txt
</span><span class='line'>[ec2-user@k8s ~]$ 
</span></code></pre></td></tr></table></div></figure>


<h3>NFS Subdir External Provisioner</h3>

<ul>
<li><a href="http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/#NFS-Subdir-External-Provisioner">http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/#NFS-Subdir-External-Provisioner</a></li>
<li><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#nfs">https://kubernetes.io/docs/concepts/storage/storage-classes/#nfs</a></li>
<li><a href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner">https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner</a></li>
</ul>


<p>NFS subdir external provisioner ä½¿ç”¨ç°æœ‰çš„çš„NFS æœåŠ¡å™¨æ¥æ”¯æŒé€šè¿‡ Persistent Volume Claims åŠ¨æ€ä¾›åº” Kubernetes Persistent Volumesã€‚æŒä¹…å·é»˜è®¤è¢«é…ç½®ä¸º${namespace}-${pvcName}-${pvName}ï¼Œä½¿ç”¨è¿™ä¸ªå¿…é¡»å·²ç»æ‹¥æœ‰ NFS æœåŠ¡å™¨ã€‚</p>

<ul>
<li><a href="http://dockone.io/article/2598">http://dockone.io/article/2598</a> External NFSé©±åŠ¨çš„å·¥ä½œåŸç†</li>
</ul>


<blockquote><p>K8Sçš„å¤–éƒ¨NFSé©±åŠ¨ï¼Œå¯ä»¥æŒ‰ç…§å…¶å·¥ä½œæ–¹å¼ï¼ˆæ˜¯ä½œä¸ºNFS serverè¿˜æ˜¯NFS clientï¼‰åˆ†ä¸ºä¸¤ç±»ï¼š</p>

<p>1.nfs-client:</p>

<p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥æ¼”ç¤ºçš„è¿™ä¸€ç±»ï¼Œå®ƒé€šè¿‡K8Sçš„å†…ç½®çš„NFSé©±åŠ¨æŒ‚è½½è¿œç«¯çš„NFSæœåŠ¡å™¨åˆ°æœ¬åœ°ç›®å½•ï¼›ç„¶åå°†è‡ªèº«ä½œä¸ºstorage providerï¼Œå…³è”storage classã€‚å½“ç”¨æˆ·åˆ›å»ºå¯¹åº”çš„PVCæ¥ç”³è¯·PVæ—¶ï¼Œè¯¥providerå°±å°†PVCçš„è¦æ±‚ä¸è‡ªèº«çš„å±æ€§æ¯”è¾ƒï¼Œä¸€æ—¦æ»¡è¶³å°±åœ¨æœ¬åœ°æŒ‚è½½å¥½çš„NFSç›®å½•ä¸­åˆ›å»ºPVæ‰€å±çš„å­ç›®å½•ï¼Œä¸ºPodæä¾›åŠ¨æ€çš„å­˜å‚¨æœåŠ¡ã€‚</p>

<p>2.nfs:
ä¸nfs-clientä¸åŒï¼Œè¯¥é©±åŠ¨å¹¶ä¸ä½¿ç”¨k8sçš„NFSé©±åŠ¨æ¥æŒ‚è½½è¿œç«¯çš„NFSåˆ°æœ¬åœ°å†åˆ†é…ï¼Œè€Œæ˜¯ç›´æ¥å°†æœ¬åœ°æ–‡ä»¶æ˜ å°„åˆ°å®¹å™¨å†…éƒ¨ï¼Œç„¶ååœ¨å®¹å™¨å†…ä½¿ç”¨ganesha.nfsdæ¥å¯¹å¤–æä¾›NFSæœåŠ¡ï¼›åœ¨æ¯æ¬¡åˆ›å»ºPVçš„æ—¶å€™ï¼Œç›´æ¥åœ¨æœ¬åœ°çš„NFSæ ¹ç›®å½•ä¸­åˆ›å»ºå¯¹åº”æ–‡ä»¶å¤¹ï¼Œå¹¶exportå‡ºè¯¥å­ç›®å½•ã€‚</p>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ“ä½œä¸€ä¸ªnfs-clienté©±åŠ¨çš„ä¾‹å­ï¼Œå…ˆå¯¹å…¶æœ‰ä¸ªç›´è§‚çš„è®¤è¯†ï¼</p>

<p>External NFSé©±åŠ¨çš„éƒ¨ç½²å®ä¾‹</p>

<p>è¿™é‡Œï¼Œæˆ‘ä»¬å°†nfs-clienté©±åŠ¨åšä¸€ä¸ªdeploymentéƒ¨ç½²åˆ°K8Sé›†ç¾¤ä¸­ï¼Œç„¶åå¯¹å¤–æä¾›å­˜å‚¨æœåŠ¡ã€‚</p>

<p>1.éƒ¨ç½²nfs-client-provisioner</p>

<p>ç¯å¢ƒå˜é‡çš„PROVISIONER_NAMEã€NFSæœåŠ¡å™¨åœ°å€ã€NFSå¯¹å¤–æä¾›æœåŠ¡çš„è·¯å¾„ä¿¡æ¯ç­‰éœ€è¦è®¾ç½®å¥½ï¼›éƒ¨ç½²æ‰€ä½¿ç”¨çš„yamlæ–‡ä»¶å…³é”®ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<p>2.åˆ›å»ºStorage Class</p>

<p>storage classçš„å®šä¹‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šprovisionerå±æ€§è¦ç­‰äºé©±åŠ¨æ‰€ä¼ å…¥çš„ç¯å¢ƒå˜é‡PROVISIONER_NAMEçš„å€¼ã€‚å¦åˆ™ï¼Œé©±åŠ¨ä¸çŸ¥é“çŸ¥é“å¦‚ä½•ç»‘å®šstorage classã€‚</p>

<p>3.åˆ›å»ºPVC</p>

<p>è¿™é‡ŒæŒ‡å®šäº†å…¶å¯¹åº”çš„storage-classçš„åå­—ä¸ºwise2c-nfs-storageï¼Œå¦‚ä¸‹ï¼š</p>

<p>4.åˆ›å»ºpod</p>

<p>æŒ‡å®šè¯¥podä½¿ç”¨æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„PVCï¼šhenry-claimï¼š</p>

<p>å®Œæˆä¹‹åï¼Œå¦‚æœattachåˆ°podä¸­æ‰§è¡Œä¸€äº›æ–‡ä»¶çš„è¯»å†™æ“ä½œï¼Œå°±å¯ä»¥ç¡®å®špodçš„/mntå·²ç»ä½¿ç”¨äº†NFSçš„å­˜å‚¨æœåŠ¡äº†ã€‚</p></blockquote>

<ul>
<li><a href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner#without-helm">https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner#without-helm</a></li>
</ul>


<p>å®˜æ–¹æ–‡æ¡£ä¸­çš„è„šæœ¬ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Set the subject of the RBAC objects to the current namespace where the provisioner is being deployed
</span><span class='line'>$ NS=$(kubectl config get-contexts|grep -e "^\*" |awk '{print $5}')
</span><span class='line'>$ NAMESPACE=${NS:-default}
</span><span class='line'>$ sed -i'' "s/namespace:.*/namespace: $NAMESPACE/g" ./deploy/rbac.yaml ./deploy/deployment.yaml
</span><span class='line'>$ kubectl create -f deploy/rbac.yaml</span></code></pre></td></tr></table></div></figure>


<p>æ“ä½œæ­¥éª¤ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ git clone https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner/
</span><span class='line'>[ec2-user@k8s ~]$ cd nfs-subdir-external-provisioner/
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ NS=$(kubectl config get-contexts|grep -e "^\*" |awk '{print $5}')
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ NAMESPACE=${NS:-default}
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ sed -i'' "s/namespace:.*/namespace: $NAMESPACE/g" ./deploy/rbac.yaml ./deploy/deployment.yaml
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ kubectl create -f deploy/rbac.yaml
</span><span class='line'>serviceaccount/nfs-client-provisioner created
</span><span class='line'>clusterrole.rbac.authorization.k8s.io/nfs-client-provisioner-runner created
</span><span class='line'>clusterrolebinding.rbac.authorization.k8s.io/run-nfs-client-provisioner created
</span><span class='line'>role.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created
</span><span class='line'>rolebinding.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>$ vi deploy/deployment.yaml
</span><span class='line'>
</span><span class='line'>            - name: NFS_SERVER
</span><span class='line'>              value: 192.168.191.131
</span><span class='line'>            - name: NFS_PATH
</span><span class='line'>              value: /backup
</span><span class='line'>      volumes:
</span><span class='line'>        - name: nfs-client-root
</span><span class='line'>          nfs:
</span><span class='line'>            server: 192.168.191.131
</span><span class='line'>            path: /backup
</span><span class='line'>
</span><span class='line'>$ vi deploy/class.yaml
</span><span class='line'>
</span><span class='line'>parameters:
</span><span class='line'>  archiveOnDelete: "false"
</span><span class='line'>#Specifies a template for creating a directory path via PVC metadata's such as labels, annotations, name or namespace. To specify metadata use ${.PVC.&lt;metadata&gt;}. Example: If folder should be named like &lt;pvc-namespace&gt;-&lt;pvc-name&gt;, use ${.PVC.namespace}-${.PVC.name} as pathPattern.
</span><span class='line'>#  pathPattern: "${.PVC.namespace}/${.PVC.annotations.nfs.io/storage-path}" # waits for nfs.io/storage-path annotation, if not specified will accept as empty string.
</span><span class='line'>#  onDelete: delete
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># å…ˆæŠŠé•œåƒæ‹‰ä¸‹æ¥ k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ kubectl apply -f deploy/deployment.yaml 
</span><span class='line'>deployment.apps/nfs-client-provisioner created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ kubectl apply -f deploy/class.yaml 
</span><span class='line'>storageclass.storage.k8s.io/nfs-client created
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>æµ‹è¯•ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># PVCå†…å®¹
</span><span class='line'># https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner/blob/master/deploy/test-claim.yaml
</span><span class='line'>kind: PersistentVolumeClaim
</span><span class='line'>apiVersion: v1
</span><span class='line'>metadata:
</span><span class='line'>  name: test-claim
</span><span class='line'>spec:
</span><span class='line'>  storageClassName: nfs-client
</span><span class='line'>  accessModes:
</span><span class='line'>    - ReadWriteMany
</span><span class='line'>  resources:
</span><span class='line'>    requests:
</span><span class='line'>      storage: 1Mi
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ kubectl create -f deploy/test-claim.yaml -f deploy/test-pod.yaml
</span><span class='line'>persistentvolumeclaim/test-claim created
</span><span class='line'>pod/test-pod created
</span><span class='line'>
</span><span class='line'># kubectl delete -f deploy/test-pod.yaml -f deploy/test-claim.yaml
</span></code></pre></td></tr></table></div></figure>


<p><code>test pod</code> åœ¨å…±äº«æ–‡ä»¶ç³»ç»Ÿä¸‹å†™äº†ä¸€ä¸ª <code>touch /mnt/SUCCESS</code> æ–‡ä»¶ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s nfs-subdir-external-provisioner]$ ll /backup/default-test-claim-pvc-9857153a-6c2b-42d7-b464-aa5fc2acbf90/
</span><span class='line'>total 0
</span><span class='line'>-rw-r--r-- 1 root root 0 Apr 14 02:14 SUCCESS
</span></code></pre></td></tr></table></div></figure>


<h3>NFS Ganesha server and external provisioner</h3>

<ul>
<li><a href="https://github.com/kubernetes-sigs/nfs-ganesha-server-and-external-provisioner">https://github.com/kubernetes-sigs/nfs-ganesha-server-and-external-provisioner</a></li>
<li><a href="http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/#nfs-ganesha-server-and-external-provisioner">http://www.lishuai.fun/2021/08/12/k8s-nfs-pv/#nfs-ganesha-server-and-external-provisioner</a></li>
</ul>


<p>å°±æ˜¯ç›´æ¥åœ¨k8sé›†ç¾¤ä¸­è£…ä¸€ä¸ªNFS serverã€‚æ„Ÿè§‰æ²¡æœ‰ç›´æ¥åœ¨ç³»ç»Ÿå®‰è£…NFSç®¡ç†æ–¹ä¾¿ï¼Œå…ˆæç½®äº†ã€‚</p>

<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Xiaomi R4a Install Padavan]]></title>
    <link href="http://winse.github.io/blog/2022/04/11/xiaomi-r4a-install-padavan/"/>
    <updated>2022-04-11T21:19:31+08:00</updated>
    <id>http://winse.github.io/blog/2022/04/11/xiaomi-r4a-install-padavan</id>
    <content type="html"><![CDATA[<p>æœ€è¿‘æ¢äº†ä¸ªå°ç±³çš„è·¯ç”±ï¼Œæƒ³ç€ç™»å½•sshï¼Œèƒ½åœ¨è·¯ç”±ä¸Šè·‘ä¸€äº›å°çš„å®šæ—¶ä»»åŠ¡ã€‚ä½†æ˜¯æ— å¥ˆï¼Œç»‘å®šä¸é€šè¿‡ï¼Œé‚£å°±ç›´æ¥åˆ·æœºäº†ã€‚</p>

<p>ä¸€å¼€å§‹æ˜¯æŒ‰ç…§csdnä¸Šçš„æ–‡ç« åˆ·opewrtçš„ï¼Œä½†æ˜¯éƒ½ä¸æˆåŠŸï¼Œæœ€åæ¢æˆ è€æ¯›å­Padavan äº†ã€‚</p>

<h2>å‚è€ƒ</h2>

<ul>
<li><a href="https://blog.csdn.net/qq_43206901/article/details/119106511">å°ç±³è·¯ç”±å™¨R4A(åƒå…†ç‰ˆ)å›ºä»¶åˆ·opewrtã€åˆ·å®˜æ–¹å›ºä»¶</a></li>
<li><a href="https://www.0412.cyou/type/xiaomi.html">å°ç±³è·¯ç”±4Aåƒå…†ç‰ˆå®‰è£…openwrtæ•™ç¨‹ï¼ˆR4Aï¼‰</a></li>
</ul>


<h2>æ­¥éª¤æè¿°</h2>

<h3>è·å–rootæƒé™</h3>

<p>ä½¿ç”¨ <code>WSL Ubuntu</code> è¿›è¡Œè®¿é—®ï¼Œpython3å·²ç»å®‰è£…äº†ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>winse@LAPTOP-I9ECVAQ4:OpenWRTInvasion-master$ python3 --version
</span><span class='line'>Python 3.8.5
</span><span class='line'>
</span><span class='line'># https://github.com/acecilia/OpenWRTInvasion
</span><span class='line'>winse@LAPTOP-I9ECVAQ4:OpenWRTInvasion-master$ ls
</span><span class='line'>Dockerfile  readme                                     requirements.txt  set_english.py
</span><span class='line'>extras      README.md                                  script.sh         speedtest_urls_template.xml
</span><span class='line'>firmwares   remote_command_execution_vulnerability.py  script_tools      tcp_file_server.py
</span><span class='line'>
</span><span class='line'>winse@LAPTOP-I9ECVAQ4:OpenWRTInvasion-master$ sudo apt install python3-pip
</span><span class='line'>
</span><span class='line'>winse@LAPTOP-I9ECVAQ4:OpenWRTInvasion-master$ pip3 install -r requirements.txt
</span><span class='line'>Requirement already satisfied: requests in /usr/lib/python3/dist-packages (from -r requirements.txt (line 1)) (2.22.0)
</span><span class='line'>
</span><span class='line'># stokè·å–ï¼šç™»å½•webè®¿é—®åï¼Œæµè§ˆå™¨çš„åœ°å€ä¸Šå°±æœ‰stokçš„å‚æ•°ã€‚
</span><span class='line'># è¯¦æƒ…å¯æŸ¥çœ‹å‚è€ƒçš„æ–‡ç« 
</span><span class='line'>winse@LAPTOP-I9ECVAQ4:OpenWRTInvasion-master$ python3 remote_command_execution_vulnerability.py
</span><span class='line'>Router IP address [press enter for using the default 'miwifi.com']:
</span><span class='line'>Enter router admin password: __xxx__
</span><span class='line'>There two options to provide the files needed for invasion:
</span><span class='line'>   1. Use a local TCP file server runing on random port to provide files in local directory `script_tools`.
</span><span class='line'>   2. Download needed files from remote github repository. (choose this option only if github is accessable inside router device.)
</span><span class='line'>Which option do you prefer? (default: 1)
</span><span class='line'>****************
</span><span class='line'>router_ip_address: miwifi.com
</span><span class='line'>stok: __xxx__
</span><span class='line'>file provider: local file server
</span><span class='line'>****************
</span><span class='line'>start uploading config file...
</span><span class='line'>start exec command...
</span><span class='line'>local file server is runing on 0.0.0.0:1135. root='script_tools'
</span><span class='line'>local file server is getting 'busybox-mipsel' for 192.168.31.1.
</span><span class='line'>local file server is getting 'dropbearStaticMipsel.tar.bz2' for 192.168.31.1.
</span><span class='line'>done! Now you can connect to the router using several options: (user: root, password: root)
</span><span class='line'>* telnet miwifi.com
</span><span class='line'>* ssh -oKexAlgorithms=+diffie-hellman-group1-sha1 -c 3des-cbc -o UserKnownHostsFile=/dev/null root@miwifi.com
</span><span class='line'>* ftp: using a program like cyberduck
</span><span class='line'>
</span><span class='line'>winse@LAPTOP-I9ECVAQ4:OpenWRTInvasion-master$ ssh -oKexAlgorithms=+diffie-hellman-group1-sha1 -c 3des-cbc -o UserKnownHostsFile=/dev/null root@miwifi.com
</span><span class='line'>The authenticity of host 'miwifi.com (192.168.31.1)' can't be established.
</span><span class='line'>RSA key fingerprint is SHA256:AT91yqVuqPnmOO5wmke6V0Hl67GKXdkb48W/FU3WfEM.
</span><span class='line'>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span><span class='line'>Warning: Permanently added 'miwifi.com,192.168.31.1' (RSA) to the list of known hosts.
</span><span class='line'>root@miwifi.com's password:
</span><span class='line'>
</span><span class='line'>BusyBox v1.19.4 (2021-09-30 03:16:53 UTC) built-in shell (ash)
</span><span class='line'>Enter 'help' for a list of built-in commands.
</span><span class='line'>
</span><span class='line'> -----------------------------------------------------
</span><span class='line'>       Welcome to XiaoQiang!
</span><span class='line'> -----------------------------------------------------
</span><span class='line'>  $$$$$$\  $$$$$$$\  $$$$$$$$\      $$\      $$\        $$$$$$\  $$\   $$\
</span><span class='line'> $$  __$$\ $$  __$$\ $$  _____|     $$ |     $$ |      $$  __$$\ $$ | $$  |
</span><span class='line'> $$ /  $$ |$$ |  $$ |$$ |           $$ |     $$ |      $$ /  $$ |$$ |$$  /
</span><span class='line'> $$$$$$$$ |$$$$$$$  |$$$$$\         $$ |     $$ |      $$ |  $$ |$$$$$  /
</span><span class='line'> $$  __$$ |$$  __$$&lt; $$  __|        $$ |     $$ |      $$ |  $$ |$$  $$&lt;
</span><span class='line'> $$ |  $$ |$$ |  $$ |$$ |           $$ |     $$ |      $$ |  $$ |$$ |\$$\
</span><span class='line'> $$ |  $$ |$$ |  $$ |$$$$$$$$\       $$$$$$$$$  |       $$$$$$  |$$ | \$$\
</span><span class='line'> \__|  \__|\__|  \__|\________|      \_________/        \______/ \__|  \__|
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>root@XiaoQiang:~# 
</span></code></pre></td></tr></table></div></figure>


<h3>å®‰è£…breed</h3>

<p>ç”¨WinSCPç™»å…¥è·¯ç”±ï¼Œä½¿ç”¨ <code>ftpåè®®</code> ï¼Œipåœ°å€ <code>miwifi.com</code> ï¼Œè´¦å· <code>root</code>ï¼ŒæŠŠ <code>breed-mt7621-pbr-m1.bin</code> æ–‡ä»¶ä¸Šä¼ åˆ°tmpæ–‡ä»¶å¤¹å†…ï¼Œä¹‹åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@XiaoQiang:~# cd /tmp
</span><span class='line'>root@XiaoQiang:/tmp# ls breed-mt7621-pbr-*
</span><span class='line'>breed-mt7621-pbr-m1.bin
</span><span class='line'>
</span><span class='line'>root@XiaoQiang:/tmp# mtd -r write breed-mt7621-pbr-m1.bin Bootloader
</span><span class='line'>Unlocking Bootloader ...
</span><span class='line'>
</span><span class='line'>Writing from breed-mt7621-pbr-m1.bin to Bootloader ...
</span><span class='line'>Rebooting ...
</span></code></pre></td></tr></table></div></figure>


<p>æ¥ä¸Šç½‘çº¿ï¼Œå†ç­‰ä¸€é˜µå­ï¼ˆ1,2åˆ†é’Ÿï¼‰ï¼Œç„¶åè®¿é—® <code>http://192.168.1.1/</code> ã€‚</p>

<h3>åˆ·padavan</h3>

<p>ä¸‹è½½r4aç‰ˆæœ¬çš„padavan: <code>https://opt.cn2qq.com/padavan/</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>MI-R4A_3.4.3.9-099.trx</span></code></pre></td></tr></table></div></figure>


<p>è®¿é—® <code>192.168.1.1</code> ï¼Œå¤‡ä»½eepromå’Œå›ºä»¶ï¼ˆé‡è¦ï¼‰ï¼Œç„¶åå‹¾é€‰å›ºä»¶ï¼Œç„¶åå°†å°ç±³4Açš„trxå›ºä»¶æ–‡ä»¶è¿›è¡Œä¸Šä¼ ï¼Œç„¶åå®Œæˆå›ºä»¶æ›´æ–°æµç¨‹ã€‚</p>

<p>æ›´æ–°è¿‡ç¨‹è¯·ä¸è¦åˆ‡æ–­è·¯ç”±ç”µæºï¼æ›´æ–°å®Œæˆå, é¡µé¢å¹¶ä¸ä¼šè‡ªåŠ¨åˆ·æ–°, è‡ªå·±å°è¯•èƒ½å¦è¿›å…¥è·¯ç”±é…ç½®é¡µé¢ã€‚ã€‚</p>

<p>åˆ·å®Œåï¼Œè¿™é‡Œéœ€è¦å¤šç­‰å¾…ä¸€ç‚¹æ—¶é—´ï¼Œè€å¿ƒä¸€ç‚¹ã€‚</p>

<h3>è®¿é—®</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http://192.168.123.1/
</span><span class='line'>admin/admin
</span><span class='line'>
</span><span class='line'>åœ¨ [ç³»ç»Ÿç®¡ç† - æœåŠ¡] é¡µç­¾å¼€å¯sshå…¬é’¥ç™»å½•ã€‚
</span><span class='line'>
</span><span class='line'>[MI-R4A /home/root]# uname -a
</span><span class='line'>Linux MI-R4A 3.4.113 #3 SMP Sun Apr 3 14:26:03 CST 2022 mips GNU/Linux
</span><span class='line'>[MI-R4A /home/root]# uname -r
</span><span class='line'>3.4.113
</span><span class='line'>[MI-R4A /home/root]# uname -m
</span><span class='line'>mips
</span><span class='line'>
</span><span class='line'>#CPU/Memory information
</span><span class='line'>$ cat /proc/cpuinfo
</span><span class='line'>
</span><span class='line'>#Version
</span><span class='line'>$ cat /proc/version
</span><span class='line'>
</span><span class='line'>#SCSI/Sata devices
</span><span class='line'>$ cat /proc/scsi/scsi
</span><span class='line'>
</span><span class='line'>#Partitions
</span><span class='line'>$ cat /proc/partitions
</span><span class='line'>
</span><span class='line'>#å®‰è£… okpg , è¿›å…¥ Shell åï¼Œåœ¨æ ¹ç›®å½•å®‰è£…ï¼Œè¾“å…¥å¦‚ä¸‹ï¼š
</span><span class='line'>[MI-R4A /home/root]# opkg.sh
</span><span class='line'>
</span><span class='line'># å‡çº§ï¼š
</span><span class='line'>[MI-R4A /home/root]# opkg update
</span><span class='line'>Downloading http://bin.entware.net/mipselsf-k3.4/Packages.gz
</span><span class='line'>Updated list of available packages in /opt/var/opkg-lists/entware
</span><span class='line'>
</span><span class='line'>[MI-R4A /home/root]# opkg install jq
</span><span class='line'>Installing jq (1.6-2) to root...
</span><span class='line'>Downloading http://bin.entware.net/mipselsf-k3.4/jq_1.6-2_mipsel-3.4.ipk
</span><span class='line'>Configuring jq.
</span><span class='line'>
</span><span class='line'># opkg list
</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Minikube Guide]]></title>
    <link href="http://winse.github.io/blog/2022/04/06/minikube-guide/"/>
    <updated>2022-04-06T08:00:07+08:00</updated>
    <id>http://winse.github.io/blog/2022/04/06/minikube-guide</id>
    <content type="html"><![CDATA[<p>æ­£å¦‚å…¶åï¼Œminikubeå¿«é€Ÿçš„å®‰è£…ä¸€ä¸ªk8sçš„é›†ç¾¤ï¼Œæ–¹ä¾¿æ–°æ‰‹å’Œåº”ç”¨å¼€å‘äººå‘˜è°ƒè¯•ç­‰ã€‚</p>

<p>æ³¨ï¼šå¦‚æœèµ„æºè¶³å¤Ÿçš„è¯ï¼Œæ­å»ºä¸€ä¸ªkubeadmçš„é›†ç¾¤æ¥çš„å¥½ä¸€äº›ã€‚</p>

<h2>å®˜ç½‘æ–‡æ¡£</h2>

<ul>
<li><a href="https://minikube.sigs.k8s.io/docs/start/">https://minikube.sigs.k8s.io/docs/start/</a></li>
</ul>


<h2>ä¸‹è½½</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># å¢™å¤–ä¸‹è½½
</span><span class='line'>curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
</span><span class='line'>
</span><span class='line'># ä¸Šä¼ 
</span><span class='line'>[ec2-user@amazonlinux ~]$ rz
</span><span class='line'>rz waiting to receive.
</span><span class='line'>Starting zmodem transfer.  Press Ctrl+C to cancel.
</span><span class='line'>Transferring minikube-linux-amd64...
</span><span class='line'>  100%   70948 KB    35474 KB/sec    00:00:02       0 Errors  
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo install minikube-linux-amd64 /usr/local/bin/minikube
</span></code></pre></td></tr></table></div></figure>


<h2>å®‰è£…docker</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@amazonlinux ~]$ sudo amazon-linux-extras install docker
</span><span class='line'>Installing docker
</span><span class='line'>Loaded plugins: langpacks, priorities, update-motd
</span><span class='line'>Cleaning repos: amzn2-core amzn2extra-docker
</span><span class='line'>12 metadata files removed
</span><span class='line'>4 sqlite files removed
</span><span class='line'>0 metadata files removed
</span><span class='line'>Loaded plugins: langpacks, priorities, update-motd
</span><span class='line'>amzn2-core                                                                                                                                        | 3.7 kB  00:00:00     
</span><span class='line'>amzn2extra-docker                                                                                                                                 | 3.0 kB  00:00:00     
</span><span class='line'>(1/5): amzn2-core/2/x86_64/group_gz                                                                                                               | 2.5 kB  00:00:01     
</span><span class='line'>(2/5): amzn2-core/2/x86_64/updateinfo                                                                                                             | 452 kB  00:00:01     
</span><span class='line'>(3/5): amzn2extra-docker/2/x86_64/updateinfo                                                                                                      | 5.9 kB  00:00:00     
</span><span class='line'>(4/5): amzn2extra-docker/2/x86_64/primary_db                                                                                                      |  86 kB  00:00:01     
</span><span class='line'>(5/5): amzn2-core/2/x86_64/primary_db                                                                                                             |  60 MB  00:00:04     
</span><span class='line'>Resolving Dependencies
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package docker.x86_64 0:20.10.7-5.amzn2 will be installed
</span><span class='line'>--&gt; Processing Dependency: runc &gt;= 1.0.0 for package: docker-20.10.7-5.amzn2.x86_64
</span><span class='line'>--&gt; Processing Dependency: libcgroup &gt;= 0.40.rc1-5.15 for package: docker-20.10.7-5.amzn2.x86_64
</span><span class='line'>--&gt; Processing Dependency: containerd &gt;= 1.3.2 for package: docker-20.10.7-5.amzn2.x86_64
</span><span class='line'>--&gt; Processing Dependency: pigz for package: docker-20.10.7-5.amzn2.x86_64
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package containerd.x86_64 0:1.4.6-8.amzn2 will be installed
</span><span class='line'>---&gt; Package libcgroup.x86_64 0:0.41-21.amzn2 will be installed
</span><span class='line'>---&gt; Package pigz.x86_64 0:2.3.4-1.amzn2.0.1 will be installed
</span><span class='line'>---&gt; Package runc.x86_64 0:1.0.0-2.amzn2 will be installed
</span><span class='line'>--&gt; Finished Dependency Resolution
</span><span class='line'>
</span><span class='line'>Dependencies Resolved
</span><span class='line'>
</span><span class='line'>=========================================================================================================================================================================
</span><span class='line'> Package                               Arch                              Version                                      Repository                                    Size
</span><span class='line'>=========================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> docker                                x86_64                            20.10.7-5.amzn2                              amzn2extra-docker                             42 M
</span><span class='line'>Installing for dependencies:
</span><span class='line'> containerd                            x86_64                            1.4.6-8.amzn2                                amzn2extra-docker                             24 M
</span><span class='line'> libcgroup                             x86_64                            0.41-21.amzn2                                amzn2-core                                    66 k
</span><span class='line'> pigz                                  x86_64                            2.3.4-1.amzn2.0.1                            amzn2-core                                    81 k
</span><span class='line'> runc                                  x86_64                            1.0.0-2.amzn2                                amzn2extra-docker                            3.3 M
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>=========================================================================================================================================================================
</span><span class='line'>Install  1 Package (+4 Dependent packages)
</span><span class='line'>
</span><span class='line'>Total download size: 69 M
</span><span class='line'>Installed size: 285 M
</span><span class='line'>Is this ok [y/d/N]: t
</span><span class='line'>Is this ok [y/d/N]: y
</span><span class='line'>Downloading packages:
</span><span class='line'>(1/5): libcgroup-0.41-21.amzn2.x86_64.rpm                                                                                                         |  66 kB  00:00:01     
</span><span class='line'>(2/5): pigz-2.3.4-1.amzn2.0.1.x86_64.rpm                                                                                                          |  81 kB  00:00:01     
</span><span class='line'>(3/5): docker-20.10.7-5.amzn2.x86_64.rpm                                                                                                          |  42 MB  00:00:07     
</span><span class='line'>(4/5): runc-1.0.0-2.amzn2.x86_64.rpm                                                                                                              | 3.3 MB  00:00:00     
</span><span class='line'>(5/5): containerd-1.4.6-8.amzn2.x86_64.rpm                                                                                                        |  24 MB  00:00:12     
</span><span class='line'>-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Total                                                                                                                                    5.5 MB/s |  69 MB  00:00:12     
</span><span class='line'>Running transaction check
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded
</span><span class='line'>Running transaction
</span><span class='line'>  Installing : runc-1.0.0-2.amzn2.x86_64                                                                                                                             1/5 
</span><span class='line'>  Installing : containerd-1.4.6-8.amzn2.x86_64                                                                                                                       2/5 
</span><span class='line'>  Installing : libcgroup-0.41-21.amzn2.x86_64                                                                                                                        3/5 
</span><span class='line'>  Installing : pigz-2.3.4-1.amzn2.0.1.x86_64                                                                                                                         4/5 
</span><span class='line'>  Installing : docker-20.10.7-5.amzn2.x86_64                                                                                                                         5/5 
</span><span class='line'>  Verifying  : docker-20.10.7-5.amzn2.x86_64                                                                                                                         1/5 
</span><span class='line'>  Verifying  : containerd-1.4.6-8.amzn2.x86_64                                                                                                                       2/5 
</span><span class='line'>  Verifying  : runc-1.0.0-2.amzn2.x86_64                                                                                                                             3/5 
</span><span class='line'>  Verifying  : pigz-2.3.4-1.amzn2.0.1.x86_64                                                                                                                         4/5 
</span><span class='line'>  Verifying  : libcgroup-0.41-21.amzn2.x86_64                                                                                                                        5/5 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  docker.x86_64 0:20.10.7-5.amzn2                                                                                                                                        
</span><span class='line'>
</span><span class='line'>Dependency Installed:
</span><span class='line'>  containerd.x86_64 0:1.4.6-8.amzn2           libcgroup.x86_64 0:0.41-21.amzn2           pigz.x86_64 0:2.3.4-1.amzn2.0.1           runc.x86_64 0:1.0.0-2.amzn2          
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>  0  ansible2                 available    \
</span><span class='line'>        [ =2.4.2  =2.4.6  =2.8  =stable ]
</span><span class='line'>  2  httpd_modules            available    [ =1.0  =stable ]
</span><span class='line'>  3  memcached1.5             available    \
</span><span class='line'>        [ =1.5.1  =1.5.16  =1.5.17 ]
</span><span class='line'>  5  postgresql9.6            available    \
</span><span class='line'>        [ =9.6.6  =9.6.8  =stable ]
</span><span class='line'>  6  postgresql10             available    [ =10  =stable ]
</span><span class='line'>  9  R3.4                     available    [ =3.4.3  =stable ]
</span><span class='line'> 10  rust1                    available    \
</span><span class='line'>        [ =1.22.1  =1.26.0  =1.26.1  =1.27.2  =1.31.0  =1.38.0
</span><span class='line'>          =stable ]
</span><span class='line'> 11  vim                      available    [ =8.0  =stable ]
</span><span class='line'> 18  libreoffice              available    \
</span><span class='line'>        [ =5.0.6.2_15  =5.3.6.1  =stable ]
</span><span class='line'> 19  gimp                     available    [ =2.8.22 ]
</span><span class='line'> 20  docker=latest            enabled      \
</span><span class='line'>        [ =17.12.1  =18.03.1  =18.06.1  =18.09.9  =stable ]
</span><span class='line'> 21  mate-desktop1.x          available    \
</span><span class='line'>        [ =1.19.0  =1.20.0  =stable ]
</span><span class='line'> 22  GraphicsMagick1.3        available    \
</span><span class='line'>        [ =1.3.29  =1.3.32  =1.3.34  =stable ]
</span><span class='line'> 23  tomcat8.5                available    \
</span><span class='line'>        [ =8.5.31  =8.5.32  =8.5.38  =8.5.40  =8.5.42  =8.5.50
</span><span class='line'>          =stable ]
</span><span class='line'> 24  epel                     available    [ =7.11  =stable ]
</span><span class='line'> 25  testing                  available    [ =1.0  =stable ]
</span><span class='line'> 26  ecs                      available    [ =stable ]
</span><span class='line'> 27  corretto8                available    \
</span><span class='line'>        [ =1.8.0_192  =1.8.0_202  =1.8.0_212  =1.8.0_222  =1.8.0_232
</span><span class='line'>          =1.8.0_242  =stable ]
</span><span class='line'> 28  firecracker              available    [ =0.11  =stable ]
</span><span class='line'> 29  golang1.11               available    \
</span><span class='line'>        [ =1.11.3  =1.11.11  =1.11.13  =stable ]
</span><span class='line'> 30  squid4                   available    [ =4  =stable ]
</span><span class='line'> 32  lustre2.10               available    \
</span><span class='line'>        [ =2.10.5  =2.10.8  =stable ]
</span><span class='line'> 33  java-openjdk11           available    [ =11  =stable ]
</span><span class='line'> 34  lynis                    available    [ =stable ]
</span><span class='line'> 35  kernel-ng                available    [ =stable ]
</span><span class='line'> 36  BCC                      available    [ =0.x  =stable ]
</span><span class='line'> 37  mono                     available    [ =5.x  =stable ]
</span><span class='line'> 38  nginx1                   available    [ =stable ]
</span><span class='line'> 39  ruby2.6                  available    [ =2.6  =stable ]
</span><span class='line'> 40  mock                     available    [ =stable ]
</span><span class='line'> 41  postgresql11             available    [ =11  =stable ]
</span><span class='line'> 42  php7.4                   available    [ =stable ]
</span><span class='line'> 43  livepatch                available    [ =stable ]
</span><span class='line'> 44  python3.8                available    [ =stable ]
</span><span class='line'> 45  haproxy2                 available    [ =stable ]
</span><span class='line'> 46  collectd                 available    [ =stable ]
</span><span class='line'> 47  aws-nitro-enclaves-cli   available    [ =stable ]
</span><span class='line'> 48  R4                       available    [ =stable ]
</span><span class='line'> 49  kernel-5.4               available    [ =stable ]
</span><span class='line'> 50  selinux-ng               available    [ =stable ]
</span><span class='line'> 51  php8.0                   available    [ =stable ]
</span><span class='line'> 52  tomcat9                  available    [ =stable ]
</span><span class='line'> 53  unbound1.13              available    [ =stable ]
</span><span class='line'> 54  mariadb10.5              available    [ =stable ]
</span><span class='line'> 55  kernel-5.10              available    [ =stable ]
</span><span class='line'> 56  redis6                   available    [ =stable ]
</span><span class='line'> 57  ruby3.0                  available    [ =stable ]
</span><span class='line'> 58  postgresql12             available    [ =stable ]
</span><span class='line'> 59  postgresql13             available    [ =stable ]
</span><span class='line'> 60  mock2                    available    [ =stable ]
</span><span class='line'> 61  dnsmasq2.85              available    [ =stable ]
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo service docker start
</span><span class='line'>Redirecting to /bin/systemctl start docker.service
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo systemctl enable docker
</span><span class='line'>Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo usermod -a -G docker ec2-user
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ exit
</span><span class='line'>logout
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ docker info 
</span><span class='line'>Client:
</span><span class='line'> Context:    default
</span><span class='line'> Debug Mode: false
</span><span class='line'>
</span><span class='line'>Server:
</span><span class='line'> Containers: 0
</span><span class='line'>  Running: 0
</span><span class='line'>  Paused: 0
</span><span class='line'>  Stopped: 0
</span><span class='line'> Images: 0
</span><span class='line'> Server Version: 20.10.7
</span><span class='line'> Storage Driver: overlay2
</span><span class='line'>  Backing Filesystem: xfs
</span><span class='line'>  Supports d_type: true
</span><span class='line'>  Native Overlay Diff: true
</span><span class='line'>  userxattr: false
</span><span class='line'> Logging Driver: json-file
</span><span class='line'> Cgroup Driver: cgroupfs
</span><span class='line'> Cgroup Version: 1
</span><span class='line'> Plugins:
</span><span class='line'>  Volume: local
</span><span class='line'>  Network: bridge host ipvlan macvlan null overlay
</span><span class='line'>  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog
</span><span class='line'> Swarm: inactive
</span><span class='line'> Runtimes: io.containerd.runc.v2 io.containerd.runtime.v1.linux runc
</span><span class='line'> Default Runtime: runc
</span><span class='line'> Init Binary: docker-init
</span><span class='line'> containerd version: d71fcd7d8303cbf684402823e425e9dd2e99285d
</span><span class='line'> runc version: 84113eef6fc27af1b01b3181f31bbaf708715301
</span><span class='line'> init version: de40ad0
</span><span class='line'> Security Options:
</span><span class='line'>  seccomp
</span><span class='line'>   Profile: default
</span><span class='line'> Kernel Version: 4.14.268-205.500.amzn2.x86_64
</span><span class='line'> Operating System: Amazon Linux 2
</span><span class='line'> OSType: linux
</span><span class='line'> Architecture: x86_64
</span><span class='line'> CPUs: 2
</span><span class='line'> Total Memory: 3.828GiB
</span><span class='line'> Name: amazonlinux.onprem
</span><span class='line'> ID: MXVZ:LQK7:BVKI:WECH:XNBN:QJUK:IXYU:FADA:4EYI:JOHA:VS3R:LNLX
</span><span class='line'> Docker Root Dir: /var/lib/docker
</span><span class='line'> Debug Mode: false
</span><span class='line'> Registry: https://index.docker.io/v1/
</span><span class='line'> Labels:
</span><span class='line'> Experimental: false
</span><span class='line'> Insecure Registries:
</span><span class='line'>  127.0.0.0/8
</span><span class='line'> Live Restore Enabled: false
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ docker info
</span><span class='line'>Client:
</span><span class='line'> Context:    default
</span><span class='line'> Debug Mode: false
</span><span class='line'>
</span><span class='line'>Server:
</span><span class='line'> Containers: 0
</span><span class='line'>  Running: 0
</span><span class='line'>  Paused: 0
</span><span class='line'>  Stopped: 0
</span><span class='line'> Images: 0
</span><span class='line'> Server Version: 20.10.7
</span><span class='line'> Storage Driver: overlay2
</span><span class='line'>  Backing Filesystem: xfs
</span><span class='line'>  Supports d_type: true
</span><span class='line'>  Native Overlay Diff: true
</span><span class='line'>  userxattr: false
</span><span class='line'> Logging Driver: json-file
</span><span class='line'> Cgroup Driver: cgroupfs
</span><span class='line'> Cgroup Version: 1
</span><span class='line'> Plugins:
</span><span class='line'>  Volume: local
</span><span class='line'>  Network: bridge host ipvlan macvlan null overlay
</span><span class='line'>  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog
</span><span class='line'> Swarm: inactive
</span><span class='line'> Runtimes: runc io.containerd.runc.v2 io.containerd.runtime.v1.linux
</span><span class='line'> Default Runtime: runc
</span><span class='line'> Init Binary: docker-init
</span><span class='line'> containerd version: d71fcd7d8303cbf684402823e425e9dd2e99285d
</span><span class='line'> runc version: 84113eef6fc27af1b01b3181f31bbaf708715301
</span><span class='line'> init version: de40ad0
</span><span class='line'> Security Options:
</span><span class='line'>  seccomp
</span><span class='line'>   Profile: default
</span><span class='line'> Kernel Version: 4.14.268-205.500.amzn2.x86_64
</span><span class='line'> Operating System: Amazon Linux 2
</span><span class='line'> OSType: linux
</span><span class='line'> Architecture: x86_64
</span><span class='line'> CPUs: 2
</span><span class='line'> Total Memory: 3.828GiB
</span><span class='line'> Name: amazonlinux.onprem
</span><span class='line'> ID: MXVZ:LQK7:BVKI:WECH:XNBN:QJUK:IXYU:FADA:4EYI:JOHA:VS3R:LNLX
</span><span class='line'> Docker Root Dir: /var/lib/docker
</span><span class='line'> Debug Mode: false
</span><span class='line'> Registry: https://index.docker.io/v1/
</span><span class='line'> Labels:
</span><span class='line'> Experimental: false
</span><span class='line'> Insecure Registries:
</span><span class='line'>  127.0.0.0/8
</span><span class='line'> Live Restore Enabled: false
</span></code></pre></td></tr></table></div></figure>


<h2>å¯åŠ¨minikube</h2>

<ul>
<li><a href="https://minikube.sigs.k8s.io/docs/start/">https://minikube.sigs.k8s.io/docs/start/</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@amazonlinux ~]$ minikube start
</span><span class='line'>* minikube v1.25.2 on Amazon 2
</span><span class='line'>* Automatically selected the docker driver. Other choices: none, ssh
</span><span class='line'>* Starting control plane node minikube in cluster minikube
</span><span class='line'>* Pulling base image ...
</span><span class='line'>* Downloading Kubernetes v1.23.3 preload ...
</span><span class='line'>    &gt; preloaded-images-k8s-v17-v1...: 505.68 MiB / 505.68 MiB  100.00% 14.20 Mi
</span><span class='line'>    &gt; index.docker.io/kicbase/sta...: 379.06 MiB / 379.06 MiB  100.00% 2.11 MiB
</span><span class='line'>! minikube was unable to download gcr.io/k8s-minikube/kicbase:v0.0.30, but successfully downloaded docker.io/kicbase/stable:v0.0.30 as a fallback image
</span><span class='line'>* Creating docker container (CPUs=2, Memory=2200MB) ...
</span><span class='line'>! This container is having trouble accessing https://k8s.gcr.io
</span><span class='line'>* To pull new external images, you may need to configure a proxy: https://minikube.sigs.k8s.io/docs/reference/networking/proxy/
</span><span class='line'>* Preparing Kubernetes v1.23.3 on Docker 20.10.12 ...
</span><span class='line'>  - kubelet.housekeeping-interval=5m
</span><span class='line'>  - Generating certificates and keys ...
</span><span class='line'>  - Booting up control plane ...
</span><span class='line'>  - Configuring RBAC rules ...
</span><span class='line'>* Verifying Kubernetes components...
</span><span class='line'>  - Using image gcr.io/k8s-minikube/storage-provisioner:v5
</span><span class='line'>* Enabled addons: default-storageclass, storage-provisioner
</span><span class='line'>* kubectl not found. If you need it, try: 'minikube kubectl -- get pods -A'
</span><span class='line'>* Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default
</span></code></pre></td></tr></table></div></figure>


<p>Interact with your cluster</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@amazonlinux ~]$ minikube kubectl -- get pods -A 
</span><span class='line'>    &gt; kubectl.sha256: 64 B / 64 B [--------------------------] 100.00% ? p/s 0s
</span><span class='line'>    &gt; kubectl: 44.43 MiB / 44.43 MiB [-------------] 100.00% 17.41 MiB p/s 2.8s
</span><span class='line'>NAMESPACE     NAME                               READY   STATUS    RESTARTS       AGE
</span><span class='line'>kube-system   coredns-64897985d-cm6h7            1/1     Running   0              2m3s
</span><span class='line'>kube-system   etcd-minikube                      1/1     Running   0              2m15s
</span><span class='line'>kube-system   kube-apiserver-minikube            1/1     Running   0              2m15s
</span><span class='line'>kube-system   kube-controller-manager-minikube   1/1     Running   0              2m15s
</span><span class='line'>kube-system   kube-proxy-s2sf4                   1/1     Running   0              2m3s
</span><span class='line'>kube-system   kube-scheduler-minikube            1/1     Running   0              2m15s
</span><span class='line'>kube-system   storage-provisioner                1/1     Running   1 (101s ago)   2m14s
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ alias kubectl="minikube kubectl --"
</span><span class='line'>[ec2-user@amazonlinux ~]$ kubectl get pods -A 
</span><span class='line'>NAMESPACE     NAME                               READY   STATUS    RESTARTS        AGE
</span><span class='line'>kube-system   coredns-64897985d-cm6h7            1/1     Running   0               5m5s
</span><span class='line'>kube-system   etcd-minikube                      1/1     Running   0               5m17s
</span><span class='line'>kube-system   kube-apiserver-minikube            1/1     Running   0               5m17s
</span><span class='line'>kube-system   kube-controller-manager-minikube   1/1     Running   0               5m17s
</span><span class='line'>kube-system   kube-proxy-s2sf4                   1/1     Running   0               5m5s
</span><span class='line'>kube-system   kube-scheduler-minikube            1/1     Running   0               5m17s
</span><span class='line'>kube-system   storage-provisioner                1/1     Running   1 (4m43s ago)   5m16s
</span><span class='line'>
</span><span class='line'># æŸ¥çœ‹é…ç½®
</span><span class='line'>[ec2-user@amazonlinux ~]$ cat .kube/config 
</span><span class='line'>apiVersion: v1
</span><span class='line'>clusters:
</span><span class='line'>- cluster:
</span><span class='line'>    certificate-authority: /home/ec2-user/.minikube/ca.crt
</span><span class='line'>    extensions:
</span><span class='line'>    - extension:
</span><span class='line'>        last-update: Sun, 03 Apr 2022 16:43:46 UTC
</span><span class='line'>        provider: minikube.sigs.k8s.io
</span><span class='line'>        version: v1.25.2
</span><span class='line'>      name: cluster_info
</span><span class='line'>    server: https://192.168.49.2:8443
</span><span class='line'>  name: minikube
</span><span class='line'>contexts:
</span><span class='line'>- context:
</span><span class='line'>    cluster: minikube
</span><span class='line'>    extensions:
</span><span class='line'>    - extension:
</span><span class='line'>        last-update: Sun, 03 Apr 2022 16:43:46 UTC
</span><span class='line'>        provider: minikube.sigs.k8s.io
</span><span class='line'>        version: v1.25.2
</span><span class='line'>      name: context_info
</span><span class='line'>    namespace: default
</span><span class='line'>    user: minikube
</span><span class='line'>  name: minikube
</span><span class='line'>current-context: minikube
</span><span class='line'>kind: Config
</span><span class='line'>preferences: {}
</span><span class='line'>users:
</span><span class='line'>- name: minikube
</span><span class='line'>  user:
</span><span class='line'>    client-certificate: /home/ec2-user/.minikube/profiles/minikube/client.crt
</span><span class='line'>    client-key: /home/ec2-user/.minikube/profiles/minikube/client.key
</span><span class='line'>[ec2-user@amazonlinux ~]$ 
</span></code></pre></td></tr></table></div></figure>


<p>æˆ–è€…åšä¸€ä¸ªè½¯è¿æ¥çš„kubectlï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># https://minikube.sigs.k8s.io/docs/handbook/kubectl/
</span><span class='line'># https://kubernetes.io/docs/tasks/tools/included/optional-kubectl-configs-bash-linux/
</span><span class='line'># https://minikube.sigs.k8s.io/docs/handbook/kubectl/
</span><span class='line'>
</span><span class='line'>ln -s $(which minikube) /usr/local/bin/kubectl
</span></code></pre></td></tr></table></div></figure>


<h3>å¯¹ç³»ç»Ÿåšäº†äº›ä»€ä¹ˆï¼Ÿ</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@amazonlinux ~]$ docker images 
</span><span class='line'>REPOSITORY       TAG       IMAGE ID       CREATED       SIZE
</span><span class='line'>kicbase/stable   v0.0.30   1312ccd2422d   7 weeks ago   1.14GB
</span><span class='line'>[ec2-user@amazonlinux ~]$ docker ps 
</span><span class='line'>CONTAINER ID   IMAGE                    COMMAND                  CREATED         STATUS         PORTS                                                                                                                                  NAMES
</span><span class='line'>19887e6799fb   kicbase/stable:v0.0.30   "/usr/local/bin/entrâ€¦"   7 minutes ago   Up 7 minutes   127.0.0.1:49157-&gt;22/tcp, 127.0.0.1:49156-&gt;2376/tcp, 127.0.0.1:49155-&gt;5000/tcp, 127.0.0.1:49154-&gt;8443/tcp, 127.0.0.1:49153-&gt;32443/tcp   minikube
</span><span class='line'>
</span><span class='line'># è¿›åˆ°å®¹å™¨å†…æŸ¥çœ‹
</span><span class='line'>[ec2-user@amazonlinux ~]$ docker exec -ti 19887e6799fb bash 
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ minikube ssh
</span><span class='line'>docker@minikube:~$ sudo su -
</span><span class='line'>root@minikube:/# 
</span><span class='line'>root@minikube:/# docker ps -a 
</span><span class='line'>CONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS                     PORTS     NAMES
</span><span class='line'>317a4dc12504   6e38f40d628d           "/storage-provisioner"   7 minutes ago   Up 7 minutes                         k8s_storage-provisioner_storage-provisioner_kube-system_c4ea2d31-2c3e-4672-9479-719b0082ac5c_1
</span><span class='line'>e0876840ef56   a4ca41631cc7           "/coredns -conf /etcâ€¦"   7 minutes ago   Up 7 minutes                         k8s_coredns_coredns-64897985d-cm6h7_kube-system_0bbdb9ae-d64a-4d74-8b38-ba5bd66af499_0
</span><span class='line'>485899a5fe0c   9b7cc9982109           "/usr/local/bin/kubeâ€¦"   7 minutes ago   Up 7 minutes                         k8s_kube-proxy_kube-proxy-s2sf4_kube-system_2e24cec7-d9b3-430e-8869-b9af785588de_0
</span><span class='line'>0faab30374f5   k8s.gcr.io/pause:3.6   "/pause"                 7 minutes ago   Up 7 minutes                         k8s_POD_coredns-64897985d-cm6h7_kube-system_0bbdb9ae-d64a-4d74-8b38-ba5bd66af499_0
</span><span class='line'>ae99f0b5b873   k8s.gcr.io/pause:3.6   "/pause"                 7 minutes ago   Up 7 minutes                         k8s_POD_kube-proxy-s2sf4_kube-system_2e24cec7-d9b3-430e-8869-b9af785588de_0
</span><span class='line'>fdeeb06fda78   6e38f40d628d           "/storage-provisioner"   7 minutes ago   Exited (1) 7 minutes ago             k8s_storage-provisioner_storage-provisioner_kube-system_c4ea2d31-2c3e-4672-9479-719b0082ac5c_0
</span><span class='line'>f83e36d2d77e   k8s.gcr.io/pause:3.6   "/pause"                 7 minutes ago   Up 7 minutes                         k8s_POD_storage-provisioner_kube-system_c4ea2d31-2c3e-4672-9479-719b0082ac5c_0
</span><span class='line'>df73834cbaf8   b07520cd7ab7           "kube-controller-manâ€¦"   8 minutes ago   Up 8 minutes                         k8s_kube-controller-manager_kube-controller-manager-minikube_kube-system_b965983ec05322d0973594a01d5e8245_0
</span><span class='line'>49ad661cee86   25f8c7f3da61           "etcd --advertise-clâ€¦"   8 minutes ago   Up 8 minutes                         k8s_etcd_etcd-minikube_kube-system_9d3d310935e5fabe942511eec3e2cd0c_0
</span><span class='line'>2c28a97b3875   99a3486be4f2           "kube-scheduler --auâ€¦"   8 minutes ago   Up 8 minutes                         k8s_kube-scheduler_kube-scheduler-minikube_kube-system_be132fe5c6572cb34d93f5e05ce2a540_0
</span><span class='line'>72aca4e710b6   f40be0088a83           "kube-apiserver --adâ€¦"   8 minutes ago   Up 8 minutes                         k8s_kube-apiserver_kube-apiserver-minikube_kube-system_cd6e47233d36a9715b0ab9632f871843_0
</span><span class='line'>97c6ecde381c   k8s.gcr.io/pause:3.6   "/pause"                 8 minutes ago   Up 8 minutes                         k8s_POD_kube-scheduler-minikube_kube-system_be132fe5c6572cb34d93f5e05ce2a540_0
</span><span class='line'>9140211bc570   k8s.gcr.io/pause:3.6   "/pause"                 8 minutes ago   Up 8 minutes                         k8s_POD_kube-controller-manager-minikube_kube-system_b965983ec05322d0973594a01d5e8245_0
</span><span class='line'>b27ec09ec789   k8s.gcr.io/pause:3.6   "/pause"                 8 minutes ago   Up 8 minutes                         k8s_POD_kube-apiserver-minikube_kube-system_cd6e47233d36a9715b0ab9632f871843_0
</span><span class='line'>0aef74ead92e   k8s.gcr.io/pause:3.6   "/pause"                 8 minutes ago   Up 8 minutes                         k8s_POD_etcd-minikube_kube-system_9d3d310935e5fabe942511eec3e2cd0c_0
</span><span class='line'>
</span><span class='line'>root@minikube:/# docker images 
</span><span class='line'>REPOSITORY                                TAG       IMAGE ID       CREATED         SIZE
</span><span class='line'>k8s.gcr.io/kube-apiserver                 v1.23.3   f40be0088a83   2 months ago    135MB
</span><span class='line'>k8s.gcr.io/kube-proxy                     v1.23.3   9b7cc9982109   2 months ago    112MB
</span><span class='line'>k8s.gcr.io/kube-scheduler                 v1.23.3   99a3486be4f2   2 months ago    53.5MB
</span><span class='line'>k8s.gcr.io/kube-controller-manager        v1.23.3   b07520cd7ab7   2 months ago    125MB
</span><span class='line'>k8s.gcr.io/etcd                           3.5.1-0   25f8c7f3da61   5 months ago    293MB
</span><span class='line'>k8s.gcr.io/coredns/coredns                v1.8.6    a4ca41631cc7   5 months ago    46.8MB
</span><span class='line'>k8s.gcr.io/pause                          3.6       6270bb605e12   7 months ago    683kB
</span><span class='line'>kubernetesui/dashboard                    v2.3.1    e1482a24335a   9 months ago    220MB
</span><span class='line'>kubernetesui/metrics-scraper              v1.0.7    7801cfc6d5c0   9 months ago    34.4MB
</span><span class='line'>gcr.io/k8s-minikube/storage-provisioner   v5        6e38f40d628d   12 months ago   31.5MB
</span></code></pre></td></tr></table></div></figure>


<p>æ›´ä¾¿æ·çš„ç®¡ç†minikube dockerï¼š</p>

<ul>
<li><a href="https://minikube.sigs.k8s.io/docs/handbook/pushing/">https://minikube.sigs.k8s.io/docs/handbook/pushing/</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># https://minikube.sigs.k8s.io/docs/handbook/pushing/#1-pushing-directly-to-the-in-cluster-docker-daemon-docker-env
</span><span class='line'>[ec2-user@amazonlinux ~]$ eval $(minikube docker-env)
</span><span class='line'># åŸç†å°±æ˜¯è®¾ç½®äº†ç¯å¢ƒå˜é‡ï¼Œdockerè¿ä¸Šäº†è¿œç¨‹æœåŠ¡ï¼šexport DOCKER_HOST="tcp://192.168.49.2:2376"
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ docker ps
</span><span class='line'>CONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS          PORTS     NAMES
</span><span class='line'>344dc0e8c1e6   7801cfc6d5c0           "/metrics-sidecar"       13 minutes ago   Up 13 minutes             k8s_dashboard-metrics-scraper_dashboard-metrics-scraper-58549894f-mzhg2_kubernetes-dashboard_4d6591df-2ee1-46b1-b44c-46ef748a3cd8_0
</span><span class='line'>276a2b6b591f   e1482a24335a           "/dashboard --insecuâ€¦"   13 minutes ago   Up 13 minutes             k8s_kubernetes-dashboard_kubernetes-dashboard-ccd587f44-w22lx_kubernetes-dashboard_eb06974d-a4e6-459a-b135-b2426696a75f_0
</span><span class='line'>739f9fdc02bf   k8s.gcr.io/pause:3.6   "/pause"                 13 minutes ago   Up 13 minutes             k8s_POD_dashboard-metrics-scraper-58549894f-mzhg2_kubernetes-dashboard_4d6591df-2ee1-46b1-b44c-46ef748a3cd8_0
</span><span class='line'>9b9d38bdb6d7   k8s.gcr.io/pause:3.6   "/pause"                 13 minutes ago   Up 13 minutes             k8s_POD_kubernetes-dashboard-ccd587f44-w22lx_kubernetes-dashboard_eb06974d-a4e6-459a-b135-b2426696a75f_0
</span><span class='line'>8fd387311710   k8s.gcr.io/pause:3.6   "/pause"                 8 hours ago      Up 8 hours                k8s_POD_hello-minikube-74c6b47596-gfxrl_default_689891ce-a761-46a6-aa16-fb33dd037c45_0
</span><span class='line'>317a4dc12504   6e38f40d628d           "/storage-provisioner"   8 hours ago      Up 8 hours                k8s_storage-provisioner_storage-provisioner_kube-system_c4ea2d31-2c3e-4672-9479-719b0082ac5c_1
</span><span class='line'>e0876840ef56   a4ca41631cc7           "/coredns -conf /etcâ€¦"   8 hours ago      Up 8 hours                k8s_coredns_coredns-64897985d-cm6h7_kube-system_0bbdb9ae-d64a-4d74-8b38-ba5bd66af499_0
</span><span class='line'>485899a5fe0c   9b7cc9982109           "/usr/local/bin/kubeâ€¦"   8 hours ago      Up 8 hours                k8s_kube-proxy_kube-proxy-s2sf4_kube-system_2e24cec7-d9b3-430e-8869-b9af785588de_0
</span><span class='line'>0faab30374f5   k8s.gcr.io/pause:3.6   "/pause"                 8 hours ago      Up 8 hours                k8s_POD_coredns-64897985d-cm6h7_kube-system_0bbdb9ae-d64a-4d74-8b38-ba5bd66af499_0
</span><span class='line'>ae99f0b5b873   k8s.gcr.io/pause:3.6   "/pause"                 8 hours ago      Up 8 hours                k8s_POD_kube-proxy-s2sf4_kube-system_2e24cec7-d9b3-430e-8869-b9af785588de_0
</span><span class='line'>f83e36d2d77e   k8s.gcr.io/pause:3.6   "/pause"                 8 hours ago      Up 8 hours                k8s_POD_storage-provisioner_kube-system_c4ea2d31-2c3e-4672-9479-719b0082ac5c_0
</span><span class='line'>df73834cbaf8   b07520cd7ab7           "kube-controller-manâ€¦"   8 hours ago      Up 8 hours                k8s_kube-controller-manager_kube-controller-manager-minikube_kube-system_b965983ec05322d0973594a01d5e8245_0
</span><span class='line'>49ad661cee86   25f8c7f3da61           "etcd --advertise-clâ€¦"   8 hours ago      Up 8 hours                k8s_etcd_etcd-minikube_kube-system_9d3d310935e5fabe942511eec3e2cd0c_0
</span><span class='line'>2c28a97b3875   99a3486be4f2           "kube-scheduler --auâ€¦"   8 hours ago      Up 8 hours                k8s_kube-scheduler_kube-scheduler-minikube_kube-system_be132fe5c6572cb34d93f5e05ce2a540_0
</span><span class='line'>72aca4e710b6   f40be0088a83           "kube-apiserver --adâ€¦"   8 hours ago      Up 8 hours                k8s_kube-apiserver_kube-apiserver-minikube_kube-system_cd6e47233d36a9715b0ab9632f871843_0
</span><span class='line'>97c6ecde381c   k8s.gcr.io/pause:3.6   "/pause"                 8 hours ago      Up 8 hours                k8s_POD_kube-scheduler-minikube_kube-system_be132fe5c6572cb34d93f5e05ce2a540_0
</span><span class='line'>9140211bc570   k8s.gcr.io/pause:3.6   "/pause"                 8 hours ago      Up 8 hours                k8s_POD_kube-controller-manager-minikube_kube-system_b965983ec05322d0973594a01d5e8245_0
</span><span class='line'>b27ec09ec789   k8s.gcr.io/pause:3.6   "/pause"                 8 hours ago      Up 8 hours                k8s_POD_kube-apiserver-minikube_kube-system_cd6e47233d36a9715b0ab9632f871843_0
</span><span class='line'>0aef74ead92e   k8s.gcr.io/pause:3.6   "/pause"                 8 hours ago      Up 8 hours                k8s_POD_etcd-minikube_kube-system_9d3d310935e5fabe942511eec3e2cd0c_0
</span></code></pre></td></tr></table></div></figure>


<p>ç®¡ç†ï¼š</p>

<ul>
<li><a href="https://minikube.sigs.k8s.io/docs/handbook/pushing/#2-push-images-using-cache-command">https://minikube.sigs.k8s.io/docs/handbook/pushing/#2-push-images-using-cache-command</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>minikube cache add alpine:latest
</span><span class='line'>minikube cache reload
</span><span class='line'>minikube cache list
</span><span class='line'>minikube cache delete &lt;image name&gt;
</span></code></pre></td></tr></table></div></figure>


<h2>dashboard</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@amazonlinux ~]$ minikube dashboard
</span><span class='line'>* Enabling dashboard ...
</span><span class='line'>  - Using image kubernetesui/metrics-scraper:v1.0.7
</span><span class='line'>  - Using image kubernetesui/dashboard:v2.3.1
</span><span class='line'>* Verifying dashboard health ...
</span><span class='line'>* Launching proxy ...
</span><span class='line'>* Verifying proxy health ...
</span><span class='line'>* Opening http://127.0.0.1:37163/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser...
</span><span class='line'>  http://127.0.0.1:37163/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo netstat -anp | grep 37163 | grep LISTEN
</span><span class='line'>tcp        0      0 127.0.0.1:37163         0.0.0.0:*               LISTEN      71016/kubectl       
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ ps aux|grep 71016
</span><span class='line'>ec2-user   71016  0.0  0.9 750808 38932 pts/2    Sl+  00:59   0:00 /home/ec2-user/.minikube/cache/linux/amd64/v1.23.3/kubectl --cluster minikube --context minikube proxy --port 0
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># å†è·å–è®¿é—®åœ°å€
</span><span class='line'>[ec2-user@amazonlinux ~]$ minikube dashboard --url
</span><span class='line'>* Verifying dashboard health ...
</span><span class='line'>* Launching proxy ...
</span><span class='line'>* Verifying proxy health ...
</span><span class='line'>http://127.0.0.1:43247/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/
</span></code></pre></td></tr></table></div></figure>


<h2>hello world</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@amazonlinux ~]$ eval $(minikube docker-env)
</span><span class='line'>[ec2-user@amazonlinux ~]$ docker load -i echoserver.tar.gz 
</span><span class='line'>6cc9890d69b6: Loading layer [==================================================&gt;]  61.68MB/61.68MB
</span><span class='line'>5f70bf18a086: Loading layer [==================================================&gt;]  1.024kB/1.024kB
</span><span class='line'>e105cd217163: Loading layer [==================================================&gt;]  8.704kB/8.704kB
</span><span class='line'>9f9b8efa9a34: Loading layer [==================================================&gt;]  83.34MB/83.34MB
</span><span class='line'>4cc84b7b3aba: Loading layer [==================================================&gt;]  3.072kB/3.072kB
</span><span class='line'>e2615e4925e2: Loading layer [==================================================&gt;]  3.072kB/3.072kB
</span><span class='line'>1787713d6d5d: Loading layer [==================================================&gt;]   5.12kB/5.12kB
</span><span class='line'>67639a8a7916: Loading layer [==================================================&gt;]  2.048kB/2.048kB
</span><span class='line'>Loaded image: k8s.gcr.io/echoserver:1.4
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ docker images 
</span><span class='line'>REPOSITORY                                TAG       IMAGE ID       CREATED         SIZE
</span><span class='line'>k8s.gcr.io/kube-apiserver                 v1.23.3   f40be0088a83   2 months ago    135MB
</span><span class='line'>k8s.gcr.io/kube-scheduler                 v1.23.3   99a3486be4f2   2 months ago    53.5MB
</span><span class='line'>k8s.gcr.io/kube-proxy                     v1.23.3   9b7cc9982109   2 months ago    112MB
</span><span class='line'>k8s.gcr.io/kube-controller-manager        v1.23.3   b07520cd7ab7   2 months ago    125MB
</span><span class='line'>k8s.gcr.io/etcd                           3.5.1-0   25f8c7f3da61   5 months ago    293MB
</span><span class='line'>k8s.gcr.io/coredns/coredns                v1.8.6    a4ca41631cc7   6 months ago    46.8MB
</span><span class='line'>k8s.gcr.io/pause                          3.6       6270bb605e12   7 months ago    683kB
</span><span class='line'>kubernetesui/dashboard                    v2.3.1    e1482a24335a   10 months ago   220MB
</span><span class='line'>kubernetesui/metrics-scraper              v1.0.7    7801cfc6d5c0   10 months ago   34.4MB
</span><span class='line'>gcr.io/k8s-minikube/storage-provisioner   v5        6e38f40d628d   12 months ago   31.5MB
</span><span class='line'>k8s.gcr.io/echoserver                     1.4       a90209bb39e3   5 years ago     140MB
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># kubectl create deployment hello-minikube --image=k8s.gcr.io/echoserver:1.4
</span><span class='line'># kubectl expose deployment hello-minikube --type=NodePort --port=8080
</span><span class='line'>
</span><span class='line'># kubectl --help
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ kubectl get svc 
</span><span class='line'>NAME             TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)          AGE
</span><span class='line'>hello-minikube   NodePort    10.98.195.3   &lt;none&gt;        8080:32754/TCP   7h
</span><span class='line'>kubernetes       ClusterIP   10.96.0.1     &lt;none&gt;        443/TCP          12d
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ kubectl get services hello-minikube
</span><span class='line'>NAME             TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)          AGE
</span><span class='line'>hello-minikube   NodePort   10.98.195.3   &lt;none&gt;        8080:32754/TCP   7h59m
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># kubectl port-forward service/hello-minikube 7080:8080
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ kubectl port-forward --address 0.0.0.0 service/hello-minikube 7080:8080
</span><span class='line'>Forwarding from 0.0.0.0:7080 -&gt; 8080
</span><span class='line'>Handling connection for 7080
</span><span class='line'>Handling connection for 7080
</span><span class='line'>
</span><span class='line'>æµè§ˆå™¨è®¿é—® http://192.168.191.133:7080/
</span></code></pre></td></tr></table></div></figure>


<h2>load balancer</h2>

<ul>
<li><a href="https://minikube.sigs.k8s.io/docs/start/#loadbalancer-deployments">https://minikube.sigs.k8s.io/docs/start/#loadbalancer-deployments</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@amazonlinux ~]$ kubectl create deployment balanced --image=k8s.gcr.io/echoserver:1.4  
</span><span class='line'>deployment.apps/balanced created
</span><span class='line'>[ec2-user@amazonlinux ~]$ kubectl expose deployment balanced --type=LoadBalancer --port=8080
</span><span class='line'>service/balanced exposed
</span><span class='line'>[ec2-user@amazonlinux ~]$ minikube tunnel
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ kubectl get services balanced
</span><span class='line'>NAME       TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)          AGE
</span><span class='line'>balanced   LoadBalancer   10.100.193.49   10.100.193.49   8080:30406/TCP   13s
</span><span class='line'>[ec2-user@amazonlinux ~]$ curl 10.100.193.49:8080
</span><span class='line'>CLIENT VALUES:
</span><span class='line'>client_address=172.17.0.1
</span><span class='line'>command=GET
</span><span class='line'>real path=/
</span><span class='line'>query=nil
</span><span class='line'>request_version=1.1
</span><span class='line'>request_uri=http://10.100.193.49:8080/
</span><span class='line'>
</span><span class='line'>SERVER VALUES:
</span><span class='line'>server_version=nginx: 1.10.0 - lua: 10001
</span><span class='line'>
</span><span class='line'>HEADERS RECEIVED:
</span><span class='line'>accept=*/*
</span><span class='line'>host=10.100.193.49:8080
</span><span class='line'>user-agent=curl/7.79.1
</span><span class='line'>BODY:
</span><span class='line'>[ec2-user@amazonlinux ~]$ 
</span></code></pre></td></tr></table></div></figure>


<h2>æ¸…ç†</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@amazonlinux ~]$ minikube pause
</span><span class='line'>* Pausing node minikube ... 
</span><span class='line'>* Paused 18 containers in: kube-system, kubernetes-dashboard, storage-gluster, istio-operator
</span><span class='line'>[ec2-user@amazonlinux ~]$ minikube unpause
</span><span class='line'>* Unpausing node minikube ... 
</span><span class='line'>* Unpaused 18 containers in: kube-system, kubernetes-dashboard, storage-gluster, istio-operator
</span><span class='line'>
</span><span class='line'>###!!!!
</span><span class='line'>[ec2-user@amazonlinux ~]$ minikube config set memory 16384
</span><span class='line'>! These changes will take effect upon a minikube delete and then a minikube start
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ minikube config unset memory
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ docker ps 
</span><span class='line'>CONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS          PORTS     NAMES
</span><span class='line'>01cf3a66eb7c   a90209bb39e3           "nginx -g 'daemon ofâ€¦"   6 minutes ago    Up 6 minutes              k8s_echoserver_balanced-5b98d98bf8-t464f_default_c6b70ff1-d799-4633-bf13-e481052a5da1_0
</span><span class='line'>6a23b4b82131   k8s.gcr.io/pause:3.6   "/pause"                 6 minutes ago    Up 6 minutes              k8s_POD_balanced-5b98d98bf8-t464f_default_c6b70ff1-d799-4633-bf13-e481052a5da1_0
</span><span class='line'>b5817aab4b25   a90209bb39e3           "nginx -g 'daemon ofâ€¦"   17 minutes ago   Up 17 minutes             k8s_echoserver_hello-minikube-7bc9d7884c-m4r4s_default_cef90979-1c63-4497-acb0-d13847c5a60b_0
</span><span class='line'>9d5677d088c6   k8s.gcr.io/pause:3.6   "/pause"                 17 minutes ago   Up 17 minutes             k8s_POD_hello-minikube-7bc9d7884c-m4r4s_default_cef90979-1c63-4497-acb0-d13847c5a60b_0
</span><span class='line'>c13da70206de   e1482a24335a           "/dashboard --insecuâ€¦"   50 minutes ago   Up 50 minutes             k8s_kubernetes-dashboard_kubernetes-dashboard-ccd587f44-w22lx_kubernetes-dashboard_eb06974d-a4e6-459a-b135-b2426696a75f_4
</span><span class='line'>0cead3ead613   6e38f40d628d           "/storage-provisioner"   50 minutes ago   Up 50 minutes             k8s_storage-provisioner_storage-provisioner_kube-system_c4ea2d31-2c3e-4672-9479-719b0082ac5c_5
</span><span class='line'>3a1c19a7a51f   7801cfc6d5c0           "/metrics-sidecar"       51 minutes ago   Up 51 minutes             k8s_dashboard-metrics-scraper_dashboard-metrics-scraper-58549894f-mzhg2_kubernetes-dashboard_4d6591df-2ee1-46b1-b44c-46ef748a3cd8_2
</span><span class='line'>0c48d4f778de   a4ca41631cc7           "/coredns -conf /etcâ€¦"   51 minutes ago   Up 51 minutes             k8s_coredns_coredns-64897985d-cm6h7_kube-system_0bbdb9ae-d64a-4d74-8b38-ba5bd66af499_2
</span><span class='line'>ac2ee5d973c6   9b7cc9982109           "/usr/local/bin/kubeâ€¦"   51 minutes ago   Up 51 minutes             k8s_kube-proxy_kube-proxy-s2sf4_kube-system_2e24cec7-d9b3-430e-8869-b9af785588de_2
</span><span class='line'>dc17216220bb   k8s.gcr.io/pause:3.6   "/pause"                 51 minutes ago   Up 51 minutes             k8s_POD_kubernetes-dashboard-ccd587f44-w22lx_kubernetes-dashboard_eb06974d-a4e6-459a-b135-b2426696a75f_2
</span><span class='line'>9d7f883afb88   k8s.gcr.io/pause:3.6   "/pause"                 51 minutes ago   Up 51 minutes             k8s_POD_storage-provisioner_kube-system_c4ea2d31-2c3e-4672-9479-719b0082ac5c_2
</span><span class='line'>d28d9a0a91b1   k8s.gcr.io/pause:3.6   "/pause"                 51 minutes ago   Up 51 minutes             k8s_POD_coredns-64897985d-cm6h7_kube-system_0bbdb9ae-d64a-4d74-8b38-ba5bd66af499_2
</span><span class='line'>7e7a16e16d03   k8s.gcr.io/pause:3.6   "/pause"                 51 minutes ago   Up 51 minutes             k8s_POD_kube-proxy-s2sf4_kube-system_2e24cec7-d9b3-430e-8869-b9af785588de_2
</span><span class='line'>ace45942773c   k8s.gcr.io/pause:3.6   "/pause"                 51 minutes ago   Up 51 minutes             k8s_POD_dashboard-metrics-scraper-58549894f-mzhg2_kubernetes-dashboard_4d6591df-2ee1-46b1-b44c-46ef748a3cd8_2
</span><span class='line'>8f00f611d713   f40be0088a83           "kube-apiserver --adâ€¦"   51 minutes ago   Up 51 minutes             k8s_kube-apiserver_kube-apiserver-minikube_kube-system_cd6e47233d36a9715b0ab9632f871843_2
</span><span class='line'>79f528bbd4d1   99a3486be4f2           "kube-scheduler --auâ€¦"   51 minutes ago   Up 51 minutes             k8s_kube-scheduler_kube-scheduler-minikube_kube-system_be132fe5c6572cb34d93f5e05ce2a540_2
</span><span class='line'>75ce75e37ceb   b07520cd7ab7           "kube-controller-manâ€¦"   51 minutes ago   Up 51 minutes             k8s_kube-controller-manager_kube-controller-manager-minikube_kube-system_b965983ec05322d0973594a01d5e8245_2
</span><span class='line'>50c302912f4a   25f8c7f3da61           "etcd --advertise-clâ€¦"   51 minutes ago   Up 51 minutes             k8s_etcd_etcd-minikube_kube-system_9d3d310935e5fabe942511eec3e2cd0c_2
</span><span class='line'>0b1c094b5824   k8s.gcr.io/pause:3.6   "/pause"                 51 minutes ago   Up 51 minutes             k8s_POD_kube-controller-manager-minikube_kube-system_b965983ec05322d0973594a01d5e8245_2
</span><span class='line'>7b6d52353935   k8s.gcr.io/pause:3.6   "/pause"                 51 minutes ago   Up 51 minutes             k8s_POD_kube-scheduler-minikube_kube-system_be132fe5c6572cb34d93f5e05ce2a540_2
</span><span class='line'>64ba4b4c1a84   k8s.gcr.io/pause:3.6   "/pause"                 51 minutes ago   Up 51 minutes             k8s_POD_etcd-minikube_kube-system_9d3d310935e5fabe942511eec3e2cd0c_2
</span><span class='line'>92f05324a447   k8s.gcr.io/pause:3.6   "/pause"                 51 minutes ago   Up 51 minutes             k8s_POD_kube-apiserver-minikube_kube-system_cd6e47233d36a9715b0ab9632f871843_2
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ minikube addons list
</span><span class='line'>|-----------------------------|----------|--------------|--------------------------------|
</span><span class='line'>|         ADDON NAME          | PROFILE  |    STATUS    |           MAINTAINER           |
</span><span class='line'>|-----------------------------|----------|--------------|--------------------------------|
</span><span class='line'>| ambassador                  | minikube | disabled     | third-party (ambassador)       |
</span><span class='line'>| auto-pause                  | minikube | disabled     | google                         |
</span><span class='line'>| csi-hostpath-driver         | minikube | disabled     | kubernetes                     |
</span><span class='line'>| dashboard                   | minikube | enabled âœ…   | kubernetes                     |
</span><span class='line'>| default-storageclass        | minikube | enabled âœ…   | kubernetes                     |
</span><span class='line'>| efk                         | minikube | disabled     | third-party (elastic)          |
</span><span class='line'>| freshpod                    | minikube | disabled     | google                         |
</span><span class='line'>| gcp-auth                    | minikube | disabled     | google                         |
</span><span class='line'>| gvisor                      | minikube | disabled     | google                         |
</span><span class='line'>| helm-tiller                 | minikube | disabled     | third-party (helm)             |
</span><span class='line'>| ingress                     | minikube | disabled     | unknown (third-party)          |
</span><span class='line'>| ingress-dns                 | minikube | disabled     | google                         |
</span><span class='line'>| istio                       | minikube | disabled     | third-party (istio)            |
</span><span class='line'>| istio-provisioner           | minikube | disabled     | third-party (istio)            |
</span><span class='line'>| kong                        | minikube | disabled     | third-party (Kong HQ)          |
</span><span class='line'>| kubevirt                    | minikube | disabled     | third-party (kubevirt)         |
</span><span class='line'>| logviewer                   | minikube | disabled     | unknown (third-party)          |
</span><span class='line'>| metallb                     | minikube | disabled     | third-party (metallb)          |
</span><span class='line'>| metrics-server              | minikube | disabled     | kubernetes                     |
</span><span class='line'>| nvidia-driver-installer     | minikube | disabled     | google                         |
</span><span class='line'>| nvidia-gpu-device-plugin    | minikube | disabled     | third-party (nvidia)           |
</span><span class='line'>| olm                         | minikube | disabled     | third-party (operator          |
</span><span class='line'>|                             |          |              | framework)                     |
</span><span class='line'>| pod-security-policy         | minikube | disabled     | unknown (third-party)          |
</span><span class='line'>| portainer                   | minikube | disabled     | portainer.io                   |
</span><span class='line'>| registry                    | minikube | disabled     | google                         |
</span><span class='line'>| registry-aliases            | minikube | disabled     | unknown (third-party)          |
</span><span class='line'>| registry-creds              | minikube | disabled     | third-party (upmc enterprises) |
</span><span class='line'>| storage-provisioner         | minikube | enabled âœ…   | google                         |
</span><span class='line'>| storage-provisioner-gluster | minikube | disabled     | unknown (third-party)          |
</span><span class='line'>| volumesnapshots             | minikube | disabled     | kubernetes                     |
</span><span class='line'>|-----------------------------|----------|--------------|--------------------------------|
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ minikube delete --all
</span><span class='line'>* Deleting "minikube" in docker ...
</span><span class='line'>* Removing /home/ec2-user/.minikube/machines/minikube ...
</span><span class='line'>* Removed all traces of the "minikube" cluster.
</span><span class='line'>* Successfully deleted all profiles
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>#Create a second cluster running an older Kubernetes release:
</span><span class='line'># minikube start -p aged --kubernetes-version=v1.16.1
</span></code></pre></td></tr></table></div></figure>


<h2>k3d</h2>

<ul>
<li><a href="https://k3d.io/v5.4.1/">https://k3d.io/v5.4.1/</a>
k3d is a lightweight wrapper to run k3s (Rancher Labâ€™s minimal Kubernetes distribution) in docker.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@amazonlinux ~]$ wget -q -O - https://raw.githubusercontent.com/k3d-io/k3d/main/install.sh | bash
</span><span class='line'>Preparing to install k3d into /usr/local/bin
</span><span class='line'>k3d installed into /usr/local/bin/k3d
</span><span class='line'>Run 'k3d --help' to see what you can do with it.
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ k3d cluster create mycluster
</span><span class='line'>INFO[0000] Prep: Network                                
</span><span class='line'>INFO[0000] Created network 'k3d-mycluster'              
</span><span class='line'>INFO[0000] Created image volume k3d-mycluster-images    
</span><span class='line'>INFO[0000] Starting new tools node...                   
</span><span class='line'>INFO[0001] Creating node 'k3d-mycluster-server-0'       
</span><span class='line'>INFO[0003] Pulling image 'ghcr.io/k3d-io/k3d-tools:5.4.1' 
</span><span class='line'>INFO[0007] Pulling image 'docker.io/rancher/k3s:v1.22.7-k3s1' 
</span><span class='line'>INFO[0009] Starting Node 'k3d-mycluster-tools'          
</span><span class='line'>INFO[0084] Creating LoadBalancer 'k3d-mycluster-serverlb' 
</span><span class='line'>INFO[0087] Pulling image 'ghcr.io/k3d-io/k3d-proxy:5.4.1' 
</span><span class='line'>INFO[0098] Using the k3d-tools node to gather environment information 
</span><span class='line'>INFO[0098] HostIP: using network gateway 172.18.0.1 address 
</span><span class='line'>INFO[0098] Starting cluster 'mycluster'                 
</span><span class='line'>INFO[0098] Starting servers...                          
</span><span class='line'>INFO[0098] Starting Node 'k3d-mycluster-server-0'       
</span><span class='line'>INFO[0104] All agents already running.                  
</span><span class='line'>INFO[0104] Starting helpers...                          
</span><span class='line'>INFO[0104] Starting Node 'k3d-mycluster-serverlb'       
</span><span class='line'>INFO[0111] Injecting records for hostAliases (incl. host.k3d.internal) and for 2 network members into CoreDNS configmap... 
</span><span class='line'>INFO[0114] Cluster 'mycluster' created successfully!    
</span><span class='line'>INFO[0114] You can now use it like this:                
</span><span class='line'>kubectl cluster-info
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ docker ps 
</span><span class='line'>CONTAINER ID   IMAGE                            COMMAND                  CREATED         STATUS         PORTS                             NAMES
</span><span class='line'>5d57c1328e66   ghcr.io/k3d-io/k3d-proxy:5.4.1   "/bin/sh -c nginx-prâ€¦"   6 minutes ago   Up 6 minutes   80/tcp, 0.0.0.0:41489-&gt;6443/tcp   k3d-mycluster-serverlb
</span><span class='line'>add7ac133348   rancher/k3s:v1.22.7-k3s1         "/bin/k3s server --tâ€¦"   6 minutes ago   Up 6 minutes                                     k3d-mycluster-server-0
</span><span class='line'>
</span><span class='line'># æ³¨æ„ï¼šä¸Šé¢çš„kubectlæ˜¯minikueçš„ï¼Œéœ€è¦ä¸‹è½½
</span><span class='line'>[ec2-user@amazonlinux ~]$ curl -LO https://dl.k8s.io/release/v1.23.0/bin/linux/amd64/kubectl
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'>100   154  100   154    0     0    230      0 --:--:-- --:--:-- --:--:--   230
</span><span class='line'>100 44.4M  100 44.4M    0     0  1989k      0  0:00:22  0:00:22 --:--:-- 2256k
</span><span class='line'>[ec2-user@amazonlinux ~]$ ll
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo cp kubectl /usr/local/bin/
</span><span class='line'>[ec2-user@amazonlinux ~]$ which kubectl
</span><span class='line'>/usr/local/bin/kubectl
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ kubectl get nodes
</span><span class='line'>NAME                     STATUS   ROLES                  AGE   VERSION
</span><span class='line'>k3d-mycluster-server-0   Ready    control-plane,master   47m   v1.22.7+k3s1
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ kubectl get pods -A 
</span><span class='line'>NAMESPACE     NAME                                      READY   STATUS      RESTARTS      AGE
</span><span class='line'>kube-system   local-path-provisioner-84bb864455-s8t7f   1/1     Running     0             45m
</span><span class='line'>kube-system   coredns-96cc4f57d-vvmrx                   1/1     Running     0             45m
</span><span class='line'>kube-system   helm-install-traefik-crd--1-ghv9f         0/1     Completed   0             45m
</span><span class='line'>kube-system   helm-install-traefik--1-s4ktb             0/1     Completed   1             45m
</span><span class='line'>kube-system   svclb-traefik-9jt5d                       2/2     Running     1 (44m ago)   44m
</span><span class='line'>kube-system   metrics-server-ff9dbcb6c-72mwc            1/1     Running     0             45m
</span><span class='line'>kube-system   traefik-56c4b88c4b-f454f                  1/1     Running     0             44m
</span><span class='line'>[ec2-user@amazonlinux ~]$ 
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ k3d cluster list 
</span><span class='line'>NAME        SERVERS   AGENTS   LOADBALANCER
</span><span class='line'>mycluster   1/1       0/0      true
</span><span class='line'>[ec2-user@amazonlinux ~]$ k3d node create worker1 --cluster mycluster
</span><span class='line'>INFO[0000] Adding 1 node(s) to the runtime local cluster 'mycluster'... 
</span><span class='line'>INFO[0000] Using the k3d-tools node to gather environment information 
</span><span class='line'>INFO[0000] Starting new tools node...                   
</span><span class='line'>INFO[0000] Starting Node 'k3d-mycluster-tools'          
</span><span class='line'>INFO[0001] HostIP: using network gateway 172.18.0.1 address 
</span><span class='line'>INFO[0001] Starting Node 'k3d-worker1-0'                
</span><span class='line'>INFO[0009] Successfully created 1 node(s)!              
</span><span class='line'>[ec2-user@amazonlinux ~]$ kubectl get nodes
</span><span class='line'>NAME                     STATUS     ROLES                  AGE   VERSION
</span><span class='line'>k3d-mycluster-server-0   Ready      control-plane,master   50m   v1.22.7+k3s1
</span><span class='line'>k3d-worker1-0            NotReady   &lt;none&gt;                 7s    v1.22.7+k3s1
</span><span class='line'>[ec2-user@amazonlinux ~]$ 
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ kubectl get nodes                          
</span><span class='line'>NAME                     STATUS   ROLES                  AGE   VERSION
</span><span class='line'>k3d-mycluster-server-0   Ready    control-plane,master   50m   v1.22.7+k3s1
</span><span class='line'>k3d-worker1-0            Ready    &lt;none&gt;                 24s   v1.22.7+k3s1
</span><span class='line'>[ec2-user@amazonlinux ~]$ 
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://k3d.io/v5.4.1/usage/exposing_services/">https://k3d.io/v5.4.1/usage/exposing_services/</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@amazonlinux ~]$ cat .vimrc 
</span><span class='line'>set paste
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ cat thatfile.yaml 
</span><span class='line'>apiVersion: networking.k8s.io/v1
</span><span class='line'>kind: Ingress
</span><span class='line'>metadata:
</span><span class='line'>  name: nginx
</span><span class='line'>  annotations:
</span><span class='line'>    ingress.kubernetes.io/ssl-redirect: "false"
</span><span class='line'>spec:
</span><span class='line'>  rules:
</span><span class='line'>  - http:
</span><span class='line'>      paths:
</span><span class='line'>      - path: /
</span><span class='line'>        pathType: Prefix
</span><span class='line'>        backend:
</span><span class='line'>          service:
</span><span class='line'>            name: nginx
</span><span class='line'>            port:
</span><span class='line'>              number: 80
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ export KUBECONFIG="$(k3d kubeconfig write mycluster)"  
</span><span class='line'>[ec2-user@amazonlinux ~]$ kubectl create deployment nginx --image=nginx
</span><span class='line'>deployment.apps/nginx created
</span><span class='line'>[ec2-user@amazonlinux ~]$ kubectl create service clusterip nginx --tcp=80:80
</span><span class='line'>service/nginx created
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ kubectl apply -f thatfile.yaml
</span><span class='line'>ingress.networking.k8s.io/nginx created
</span></code></pre></td></tr></table></div></figure>


<p>æŸ¥çœ‹ç»“æœï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@amazonlinux ~]$ kubectl get all -A -o wide
</span><span class='line'>NAMESPACE     NAME                                          READY   STATUS      RESTARTS      AGE     IP          NODE                     NOMINATED NODE   READINESS GATES
</span><span class='line'>kube-system   pod/local-path-provisioner-84bb864455-s8t7f   1/1     Running     0             64m     10.42.0.5   k3d-mycluster-server-0   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   pod/coredns-96cc4f57d-vvmrx                   1/1     Running     0             64m     10.42.0.6   k3d-mycluster-server-0   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   pod/helm-install-traefik-crd--1-ghv9f         0/1     Completed   0             64m     10.42.0.4   k3d-mycluster-server-0   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   pod/helm-install-traefik--1-s4ktb             0/1     Completed   1             64m     10.42.0.3   k3d-mycluster-server-0   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   pod/svclb-traefik-9jt5d                       2/2     Running     1 (63m ago)   63m     10.42.0.7   k3d-mycluster-server-0   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   pod/metrics-server-ff9dbcb6c-72mwc            1/1     Running     0             64m     10.42.0.2   k3d-mycluster-server-0   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   pod/traefik-56c4b88c4b-f454f                  1/1     Running     0             63m     10.42.0.8   k3d-mycluster-server-0   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   pod/svclb-traefik-dvvrp                       2/2     Running     1 (13m ago)   14m     10.42.1.2   k3d-worker1-0            &lt;none&gt;           &lt;none&gt;
</span><span class='line'>default       pod/nginx-6799fc88d8-vgc9x                    1/1     Running     0             4m34s   10.42.1.3   k3d-worker1-0            &lt;none&gt;           &lt;none&gt;
</span><span class='line'>
</span><span class='line'>NAMESPACE     NAME                     TYPE           CLUSTER-IP      EXTERNAL-IP             PORT(S)                      AGE     SELECTOR
</span><span class='line'>default       service/kubernetes       ClusterIP      10.43.0.1       &lt;none&gt;                  443/TCP                      64m     &lt;none&gt;
</span><span class='line'>kube-system   service/kube-dns         ClusterIP      10.43.0.10      &lt;none&gt;                  53/UDP,53/TCP,9153/TCP       64m     k8s-app=kube-dns
</span><span class='line'>kube-system   service/metrics-server   ClusterIP      10.43.88.129    &lt;none&gt;                  443/TCP                      64m     k8s-app=metrics-server
</span><span class='line'>kube-system   service/traefik          LoadBalancer   10.43.4.2       172.18.0.2,172.18.0.4   80:32037/TCP,443:30484/TCP   63m     app.kubernetes.io/instance=traefik,app.kubernetes.io/name=traefik
</span><span class='line'>default       service/nginx            ClusterIP      10.43.206.223   &lt;none&gt;                  80/TCP                       4m30s   app=nginx
</span><span class='line'>
</span><span class='line'>NAMESPACE     NAME                           DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE   CONTAINERS               IMAGES                                                SELECTOR
</span><span class='line'>kube-system   daemonset.apps/svclb-traefik   2         2         2       2            2           &lt;none&gt;          63m   lb-port-80,lb-port-443   rancher/klipper-lb:v0.3.4,rancher/klipper-lb:v0.3.4   app=svclb-traefik
</span><span class='line'>
</span><span class='line'>NAMESPACE     NAME                                     READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS               IMAGES                                   SELECTOR
</span><span class='line'>kube-system   deployment.apps/local-path-provisioner   1/1     1            1           64m     local-path-provisioner   rancher/local-path-provisioner:v0.0.21   app=local-path-provisioner
</span><span class='line'>kube-system   deployment.apps/coredns                  1/1     1            1           64m     coredns                  rancher/mirrored-coredns-coredns:1.8.6   k8s-app=kube-dns
</span><span class='line'>kube-system   deployment.apps/metrics-server           1/1     1            1           64m     metrics-server           rancher/mirrored-metrics-server:v0.5.2   k8s-app=metrics-server
</span><span class='line'>kube-system   deployment.apps/traefik                  1/1     1            1           63m     traefik                  rancher/mirrored-library-traefik:2.6.1   app.kubernetes.io/instance=traefik,app.kubernetes.io/name=traefik
</span><span class='line'>default       deployment.apps/nginx                    1/1     1            1           4m34s   nginx                    nginx                                    app=nginx
</span><span class='line'>
</span><span class='line'>NAMESPACE     NAME                                                DESIRED   CURRENT   READY   AGE     CONTAINERS               IMAGES                                   SELECTOR
</span><span class='line'>kube-system   replicaset.apps/local-path-provisioner-84bb864455   1         1         1       64m     local-path-provisioner   rancher/local-path-provisioner:v0.0.21   app=local-path-provisioner,pod-template-hash=84bb864455
</span><span class='line'>kube-system   replicaset.apps/coredns-96cc4f57d                   1         1         1       64m     coredns                  rancher/mirrored-coredns-coredns:1.8.6   k8s-app=kube-dns,pod-template-hash=96cc4f57d
</span><span class='line'>kube-system   replicaset.apps/metrics-server-ff9dbcb6c            1         1         1       64m     metrics-server           rancher/mirrored-metrics-server:v0.5.2   k8s-app=metrics-server,pod-template-hash=ff9dbcb6c
</span><span class='line'>kube-system   replicaset.apps/traefik-56c4b88c4b                  1         1         1       63m     traefik                  rancher/mirrored-library-traefik:2.6.1   app.kubernetes.io/instance=traefik,app.kubernetes.io/name=traefik,pod-template-hash=56c4b88c4b
</span><span class='line'>default       replicaset.apps/nginx-6799fc88d8                    1         1         1       4m34s   nginx                    nginx                                    app=nginx,pod-template-hash=6799fc88d8
</span><span class='line'>
</span><span class='line'>NAMESPACE     NAME                                 COMPLETIONS   DURATION   AGE   CONTAINERS   IMAGES                                      SELECTOR
</span><span class='line'>kube-system   job.batch/helm-install-traefik-crd   1/1           52s        64m   helm         rancher/klipper-helm:v0.6.6-build20211022   controller-uid=1d4ac20d-0436-4d54-9d8b-e37fe7c46e6e
</span><span class='line'>kube-system   job.batch/helm-install-traefik       1/1           53s        64m   helm         rancher/klipper-helm:v0.6.6-build20211022   controller-uid=b51475a5-3fac-4b96-b218-7dd7a094512b
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ kubectl get ingress 
</span><span class='line'>NAME    CLASS    HOSTS   ADDRESS                 PORTS   AGE
</span><span class='line'>nginx   &lt;none&gt;   *       172.18.0.2,172.18.0.4   80      3m18s
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ curl 172.18.0.2
</span><span class='line'>&lt;!DOCTYPE html&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;Welcome to nginx!&lt;/title&gt;
</span><span class='line'>&lt;style&gt;
</span><span class='line'>html { color-scheme: light dark; }
</span><span class='line'>body { width: 35em; margin: 0 auto;
</span><span class='line'>font-family: Tahoma, Verdana, Arial, sans-serif; }
</span><span class='line'>&lt;/style&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
</span><span class='line'>&lt;p&gt;If you see this page, the nginx web server is successfully installed and
</span><span class='line'>working. Further configuration is required.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;For online documentation and support please refer to
</span><span class='line'>&lt;a href="http://nginx.org/"&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
</span><span class='line'>Commercial support is available at
</span><span class='line'>&lt;a href="http://nginx.com/"&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span><span class='line'>[ec2-user@amazonlinux ~]$ 
</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[K8s Ingress]]></title>
    <link href="http://winse.github.io/blog/2022/03/26/k8s-ingress/"/>
    <updated>2022-03-26T13:59:16+08:00</updated>
    <id>http://winse.github.io/blog/2022/03/26/k8s-ingress</id>
    <content type="html"><![CDATA[<p>Ingressæ˜¯ä¸€ä¸ªé›†ä¸­çš„é›†ç¾¤åº”ç”¨ç½‘å…³ï¼Œè‡ªåŠ¨åŒ–çš„k8såå‘ä»£ç†ç»„ä»¶ï¼ˆåŠŸèƒ½ç±»æ¯”nginxï¼‰ã€‚</p>

<p>Ingressæ¶‰åŠåˆ°LoadBalancerï¼ŒIngress Controller, Ingress configç­‰ç›¸å…³æ¦‚å¿µã€‚controllerä»LoadBalancer/NodePortæŠŠå½“å‰çš„æœåŠ¡å‘å¸ƒå‡ºå»ï¼ŒåŒæ—¶ç›‘å¬Ingress configå®æ—¶çš„ä¿®æ”¹å½“å‰Ingressé…ç½®(å®æ—¶æ›´æ–°nginx.confé…ç½®æ–‡ä»¶ï¼Œå¹¶é‡è½½)</p>

<p>è¿™é‡Œä»…ä»helloworldå…¥é—¨å®è·µæ“ä½œè¿›è¡Œã€‚</p>

<h2>å…¥é—¨æŒ‡å—</h2>

<h3>å‚è€ƒ</h3>

<ul>
<li><a href="https://kubernetes.github.io/ingress-nginx/deploy/#quick-start">https://kubernetes.github.io/ingress-nginx/deploy/#quick-start</a></li>
<li><p><a href="https://kubernetes.io/zh/docs/concepts/services-networking/ingress/">https://kubernetes.io/zh/docs/concepts/services-networking/ingress/</a></p></li>
<li><p><a href="https://docs.jdcloud.com/cn/jcs-for-kubernetes/deploy-k8s-ingress-nginx">https://docs.jdcloud.com/cn/jcs-for-kubernetes/deploy-k8s-ingress-nginx</a></p></li>
<li><a href="https://jimmysong.io/kubernetes-handbook/concepts/ingress.html">https://jimmysong.io/kubernetes-handbook/concepts/ingress.html</a></li>
</ul>


<p>ç‰ˆæœ¬å…¼å®¹æ€§ï¼š
* <a href="https://github.com/kubernetes/ingress-nginx/#support-versions-table">https://github.com/kubernetes/ingress-nginx/#support-versions-table</a></p>

<h3>ä¸‹è½½é•œåƒ</h3>

<p>é•œåƒåœ¨gcrä¸Šé¢ï¼Œå…ˆè¿œç¨‹ä¸‹è½½å›æ¥ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.1.2/deploy/static/provider/cloud/deploy.yaml 
</span><span class='line'>[ec2-user@k8s ~]$ vi ingress-nginx-controller-v1.1.2.yaml
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ grep image: ingress-nginx-controller-v1.1.2.yaml | sed 's/image: //' | sort -u | xargs echo 
</span><span class='line'>k8s.gcr.io/ingress-nginx/controller:v1.1.2@sha256:28b11ce69e57843de44e3db6413e98d09de0f6688e33d4bd384002a44f78405c k8s.gcr.io/ingress-nginx/kube-webhook-certgen:v1.1.1@sha256:64d8c73dca984af206adf9d6d7e46aa550362b1d7a01f3a0a91b20cc67868660
</span><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# docker pull k8s.gcr.io/ingress-nginx/controller:v1.1.2@sha256:28b11ce69e57843de44e3db6413e98d09de0f6688e33d4bd384002a44f78405c 
</span><span class='line'>k8s.gcr.io/ingress-nginx/controller@sha256:28b11ce69e57843de44e3db6413e98d09de0f6688e33d4bd384002a44f78405c: Pulling from ingress-nginx/controller
</span><span class='line'>a0d0a0d46f8b: Pull complete 
</span><span class='line'>3aae86482564: Pull complete 
</span><span class='line'>c0d03781abb3: Pull complete 
</span><span class='line'>0297e2ef8f7f: Pull complete 
</span><span class='line'>866a68ce3c13: Pull complete 
</span><span class='line'>1c2a7ca65b54: Pull complete 
</span><span class='line'>41fd2de30e46: Pull complete 
</span><span class='line'>637f10464e4d: Pull complete 
</span><span class='line'>998064a16da4: Pull complete 
</span><span class='line'>e63d23220e8c: Pull complete 
</span><span class='line'>8128610547fb: Pull complete 
</span><span class='line'>ae07a1a7f038: Pull complete 
</span><span class='line'>ceb23c4cb607: Pull complete 
</span><span class='line'>Digest: sha256:28b11ce69e57843de44e3db6413e98d09de0f6688e33d4bd384002a44f78405c
</span><span class='line'>Status: Downloaded newer image for k8s.gcr.io/ingress-nginx/controller@sha256:28b11ce69e57843de44e3db6413e98d09de0f6688e33d4bd384002a44f78405c
</span><span class='line'>k8s.gcr.io/ingress-nginx/controller:v1.1.2@sha256:28b11ce69e57843de44e3db6413e98d09de0f6688e33d4bd384002a44f78405c
</span><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# docker pull k8s.gcr.io/ingress-nginx/kube-webhook-certgen:v1.1.1@sha256:64d8c73dca984af206adf9d6d7e46aa550362b1d7a01f3a0a91b20cc67868660 
</span><span class='line'>k8s.gcr.io/ingress-nginx/kube-webhook-certgen@sha256:64d8c73dca984af206adf9d6d7e46aa550362b1d7a01f3a0a91b20cc67868660: Pulling from ingress-nginx/kube-webhook-certgen
</span><span class='line'>ec52731e9273: Pull complete 
</span><span class='line'>b90aa28117d4: Pull complete 
</span><span class='line'>Digest: sha256:64d8c73dca984af206adf9d6d7e46aa550362b1d7a01f3a0a91b20cc67868660
</span><span class='line'>Status: Downloaded newer image for k8s.gcr.io/ingress-nginx/kube-webhook-certgen@sha256:64d8c73dca984af206adf9d6d7e46aa550362b1d7a01f3a0a91b20cc67868660
</span><span class='line'>k8s.gcr.io/ingress-nginx/kube-webhook-certgen:v1.1.1@sha256:64d8c73dca984af206adf9d6d7e46aa550362b1d7a01f3a0a91b20cc67868660
</span><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# docker save k8s.gcr.io/ingress-nginx/controller:v1.1.2@sha256:28b11ce69e57843de44e3db6413e98d09de0f6688e33d4bd384002a44f78405c k8s.gcr.io/ingress-nginx/kube-webhook-certgen:v1.1.1@sha256:64d8c73dca984af206adf9d6d7e46aa550362b1d7a01f3a0a91b20cc67868660 -o ingress-nginx-v1.1.2.tar
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# gzip ingress-nginx-v1.1.2.tar 
</span><span class='line'>
</span><span class='line'>[root@izt4nhcmmx33bjwcsdmf8oz ~]# ll -h ingress-nginx-v1.1.2.tar.gz 
</span><span class='line'>-rw------- 1 root root 116M Mar 24 23:49 ingress-nginx-v1.1.2.tar.gz
</span></code></pre></td></tr></table></div></figure>


<p>æœ¬åœ°LinuxæœåŠ¡å™¨åŠ è½½é•œåƒ</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ docker load -i k8s.gcr.io-ingress-nginx-v1.1.2.tar.gz 
</span><span class='line'>c0d270ab7e0d: Loading layer [==================================================&gt;]  3.697MB/3.697MB
</span><span class='line'>ce7a3c1169b6: Loading layer [==================================================&gt;]  45.38MB/45.38MB
</span><span class='line'>e2eb06d8af82: Loading layer [==================================================&gt;]  5.865MB/5.865MB
</span><span class='line'>ab1476f3fdd9: Loading layer [==================================================&gt;]  120.9MB/120.9MB
</span><span class='line'>ad20729656ef: Loading layer [==================================================&gt;]  4.096kB/4.096kB
</span><span class='line'>0d5022138006: Loading layer [==================================================&gt;]  38.09MB/38.09MB
</span><span class='line'>8f757e3fe5e4: Loading layer [==================================================&gt;]  21.42MB/21.42MB
</span><span class='line'>d2bc6b915bc9: Loading layer [==================================================&gt;]  4.019MB/4.019MB
</span><span class='line'>bbeb6784ed45: Loading layer [==================================================&gt;]  313.9kB/313.9kB
</span><span class='line'>0c411e83ee78: Loading layer [==================================================&gt;]  6.141MB/6.141MB
</span><span class='line'>9c2d86dc137f: Loading layer [==================================================&gt;]  38.45MB/38.45MB
</span><span class='line'>7797e5b3a760: Loading layer [==================================================&gt;]  2.754MB/2.754MB
</span><span class='line'>98ef19df5514: Loading layer [==================================================&gt;]  4.096kB/4.096kB
</span><span class='line'>4cde87c7ecaf: Loading layer [==================================================&gt;]  51.75MB/51.75MB
</span><span class='line'>11536690d74a: Loading layer [==================================================&gt;]  3.584kB/3.584kB
</span><span class='line'>Loaded image ID: sha256:c41e9fcadf5a291120de706b7dfa1af598b9f2ed5138b6dcb9f79a68aad0ef4c
</span><span class='line'>Loaded image ID: sha256:7e5c1cecb086f36c6ef4b319a60853020820997f3600c3687e8ba6139e83674d
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ cat k8s.gcr.io-ingress-nginx-v1.1.2.tar.gz | ssh worker1 docker load 
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ 
</span><span class='line'>docker tag 7e5c1cecb086 k8s.gcr.io/ingress-nginx/controller:v1.1.2
</span><span class='line'>docker tag c41e9fcadf5a k8s.gcr.io/ingress-nginx/kube-webhook-certgen:v1.1.1
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>æ³¨ï¼šç”±äºé…ç½®ä¸­ç”¨äº†shaç ï¼Œä¸‹è½½åtagä¸åŒï¼ŒæŠŠimageæœ€åçš„ @sha256:xxx åˆ æ‰
</span><span class='line'>vi ingress-nginx-controller-v1.1.2.yaml
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<h3>åˆ›å»ºæœåŠ¡</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f ingress-nginx-controller-v1.1.2.yaml
</span><span class='line'>namespace/ingress-nginx created
</span><span class='line'>serviceaccount/ingress-nginx created
</span><span class='line'>serviceaccount/ingress-nginx-admission created
</span><span class='line'>role.rbac.authorization.k8s.io/ingress-nginx created
</span><span class='line'>role.rbac.authorization.k8s.io/ingress-nginx-admission created
</span><span class='line'>clusterrole.rbac.authorization.k8s.io/ingress-nginx created
</span><span class='line'>clusterrole.rbac.authorization.k8s.io/ingress-nginx-admission created
</span><span class='line'>rolebinding.rbac.authorization.k8s.io/ingress-nginx created
</span><span class='line'>rolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created
</span><span class='line'>clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx created
</span><span class='line'>clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created
</span><span class='line'>configmap/ingress-nginx-controller created
</span><span class='line'>service/ingress-nginx-controller created
</span><span class='line'>service/ingress-nginx-controller-admission created
</span><span class='line'>deployment.apps/ingress-nginx-controller created
</span><span class='line'>job.batch/ingress-nginx-admission-create created
</span><span class='line'>job.batch/ingress-nginx-admission-patch created
</span><span class='line'>ingressclass.networking.k8s.io/nginx created
</span><span class='line'>validatingwebhookconfiguration.admissionregistration.k8s.io/ingress-nginx-admission created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl wait --namespace ingress-nginx \
</span><span class='line'>   --for=condition=ready pod \
</span><span class='line'>   --selector=app.kubernetes.io/component=controller \
</span><span class='line'>   --timeout=120s
</span><span class='line'>pod/ingress-nginx-controller-755447bb4d-rnxvl condition met
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># çŠ¶æ€å‚è€ƒï¼š
</span><span class='line'># https://kubernetes.io/zh/docs/tasks/access-application-cluster/ingress-minikube/
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pods --namespace=ingress-nginx
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get all -n ingress-nginx
</span><span class='line'>NAME                                            READY   STATUS      RESTARTS   AGE
</span><span class='line'>pod/ingress-nginx-admission-create-hbt9d        0/1     Completed   0          2m51s
</span><span class='line'>pod/ingress-nginx-admission-patch-j8qfh         0/1     Completed   1          2m51s
</span><span class='line'>pod/ingress-nginx-controller-755447bb4d-rnxvl   1/1     Running     0          2m51s
</span><span class='line'>
</span><span class='line'>NAME                                         TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE
</span><span class='line'>service/ingress-nginx-controller             LoadBalancer   10.104.8.155    &lt;pending&gt;     80:31031/TCP,443:31845/TCP   2m51s
</span><span class='line'>service/ingress-nginx-controller-admission   ClusterIP      10.108.67.255   &lt;none&gt;        443/TCP                      2m51s
</span><span class='line'>
</span><span class='line'>NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE
</span><span class='line'>deployment.apps/ingress-nginx-controller   1/1     1            1           2m51s
</span><span class='line'>
</span><span class='line'>NAME                                                  DESIRED   CURRENT   READY   AGE
</span><span class='line'>replicaset.apps/ingress-nginx-controller-755447bb4d   1         1         1       2m51s
</span><span class='line'>
</span><span class='line'>NAME                                       COMPLETIONS   DURATION   AGE
</span><span class='line'>job.batch/ingress-nginx-admission-create   1/1           3s         2m51s
</span><span class='line'>job.batch/ingress-nginx-admission-patch    1/1           3s         2m51s
</span></code></pre></td></tr></table></div></figure>


<p>çœ‹åˆ° ingress-nginx-controller æœåŠ¡çš„ <code>EXTERNAL-IP</code> ä¸º <code>&lt;pending&gt;</code> ï¼Œç”±äºæœ¬åœ°æ­å»ºå¹¶æ²¡æœ‰é…å¤‡è´Ÿè½½å‡è¡¡å™¨ï¼Œæ‰€ä»¥æ²¡æœ‰æ‰‹æ®µï¼Œè·å–ä¸åˆ°å¯¹å¤–çš„IPã€‚</p>

<h3>æœ¬åœ°æµ‹è¯•</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl create deployment demo --image=httpd --port=80
</span><span class='line'>deployment.apps/demo created
</span><span class='line'>[ec2-user@k8s ~]$ kubectl expose deployment demo
</span><span class='line'>service/demo exposed
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl create ingress demo-localhost --class=nginx \
</span><span class='line'>   --rule=demo.localdev.me/*=demo:80
</span><span class='line'>ingress.networking.k8s.io/demo-localhost created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl port-forward --namespace=ingress-nginx service/ingress-nginx-controller 8080:80
</span><span class='line'>Forwarding from 127.0.0.1:8080 -&gt; 80
</span><span class='line'>Forwarding from [::1]:8080 -&gt; 80
</span><span class='line'>Handling connection for 8080
</span><span class='line'>Handling connection for 8080
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ curl http://demo.localdev.me:8080/
</span><span class='line'>&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;
</span></code></pre></td></tr></table></div></figure>


<p>clean</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kubectl delete deployment demo 
</span><span class='line'>kubectl delete service demo 
</span><span class='line'>kubectl delete ingress demo</span></code></pre></td></tr></table></div></figure>


<h2>é›†æˆï¼ˆå‘å¸ƒï¼‰</h2>

<h3>cloud</h3>

<ul>
<li><a href="https://kubernetes.github.io/ingress-nginx/deploy/#aws">https://kubernetes.github.io/ingress-nginx/deploy/#aws</a></li>
</ul>


<p>é…ç½®äº‘å‚å•†çš„è´Ÿè½½å‡è¡¡å™¨ã€‚</p>

<h3>baremetal: nodeport</h3>

<p>é€‚ç”¨äºéƒ¨ç½²åœ¨è£¸æœºæœåŠ¡å™¨ä¸Šçš„ Kubernetes é›†ç¾¤ï¼Œä»¥åŠä½¿ç”¨é€šç”¨ Linux å‘è¡Œç‰ˆæ‰‹åŠ¨å®‰è£… Kubernetes çš„ [åŸå§‹] è™šæ‹Ÿæœº</p>

<p>ä¸ºäº†å¿«é€Ÿæµ‹è¯•ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ NodePortã€‚è¿™åº”è¯¥é€‚ç”¨äºå‡ ä¹æ¯ä¸ªé›†ç¾¤ï¼Œä½†å®ƒé€šå¸¸ä¼šä½¿ç”¨ 30000-32767 èŒƒå›´å†…çš„ç«¯å£ã€‚</p>

<ul>
<li><a href="https://kubernetes.github.io/ingress-nginx/deploy/#bare-metal-clusters">https://kubernetes.github.io/ingress-nginx/deploy/#bare-metal-clusters</a></li>
<li><a href="https://kubernetes.github.io/ingress-nginx/deploy/baremetal/#over-a-nodeport-service">https://kubernetes.github.io/ingress-nginx/deploy/baremetal/#over-a-nodeport-service</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.1.2/deploy/static/provider/baremetal/deploy.yaml
</span></code></pre></td></tr></table></div></figure>


<p>æ³¨ï¼šä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®ä½¿ç”¨80ï¼Œ443ç­‰ç«¯å£ï¼Œä½†ä¸æ¨èã€‚</p>

<h3>baremetal: hostNetwork</h3>

<p>ingress nginx controllerçš„podç½‘ç»œç›´æ¥ä½¿ç”¨ä¸»æœºç½‘ç»œï¼Œè¿™ä¸ªæ¯”Service Nodeportç¨å¾®çµæ´»ä¸€ç‚¹ï¼Œå¯ä»¥è‡ªå·±é€‰æ‹©/ç®¡ç†ç«¯å£ã€‚</p>

<h3>A pure software solution: MetalLB</h3>

<ul>
<li><a href="https://kubernetes.github.io/ingress-nginx/deploy/baremetal/#a-pure-software-solution-metallb">https://kubernetes.github.io/ingress-nginx/deploy/baremetal/#a-pure-software-solution-metallb</a></li>
<li><a href="https://metallb.universe.tf/concepts/">https://metallb.universe.tf/concepts/</a></li>
</ul>


<p>It has two features that work together to provide this service: address allocation, and external announcement.</p>

<p>After MetalLB has assigned an external IP address to a service, it needs to make the network beyond the cluster aware that the IP â€œlivesâ€ in the cluster. MetalLB uses standard routing protocols to achieve this: ARP, NDP, or BGP.</p>

<h4>å®‰è£…</h4>

<ul>
<li><a href="https://metallb.universe.tf/installation/">https://metallb.universe.tf/installation/</a></li>
</ul>


<p>éœ€è¦kube-proxyé…ç½®arpä¸ºtrueã€‚å¾—ä¸å±€åŸŸç½‘è¿›è¡Œå¹¿æ’­é€šä¿¡ï¼Œæ‰€ä»¥éœ€è¦å¼€å¯arpåŠŸèƒ½ï¼ˆæ ‡å‡†è·¯ç”±åè®®ï¼‰ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kubectl edit configmap -n kube-system kube-proxy
</span><span class='line'>
</span><span class='line'>apiVersion: kubeproxy.config.k8s.io/v1alpha1
</span><span class='line'>kind: KubeProxyConfiguration
</span><span class='line'>mode: "ipvs"
</span><span class='line'>ipvs:
</span><span class='line'>  strictARP: true</span></code></pre></td></tr></table></div></figure>


<p>æˆ–è€…æ‰¹å¤„ç†ä¸€æ­¥åˆ°ä½</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># see what changes would be made, returns nonzero returncode if different
</span><span class='line'>kubectl get configmap kube-proxy -n kube-system -o yaml | \
</span><span class='line'>sed -e "s/strictARP: false/strictARP: true/" | \
</span><span class='line'>kubectl diff -f - -n kube-system
</span><span class='line'>
</span><span class='line'># actually apply the changes, returns nonzero returncode on errors only
</span><span class='line'>kubectl get configmap kube-proxy -n kube-system -o yaml | \
</span><span class='line'>sed -e "s/strictARP: false/strictARP: true/" | \
</span><span class='line'>kubectl apply -f - -n kube-system
</span></code></pre></td></tr></table></div></figure>


<p>å®‰è£…</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.12.1/manifests/namespace.yaml
</span><span class='line'>kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.12.1/manifests/metallb.yaml
</span></code></pre></td></tr></table></div></figure>


<p>ä¸‹è½½é•œåƒæ…¢ä¸€ç‚¹ï¼Œéœ€è¦ç¨å¾®å¤šç­‰ç­‰ã€‚å†æŸ¥çœ‹çŠ¶æ€ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl get all -n metallb-system
</span><span class='line'>NAME                             READY   STATUS    RESTARTS   AGE
</span><span class='line'>pod/controller-57fd9c5bb-kc5zt   1/1     Running   0          5m55s
</span><span class='line'>pod/speaker-8pg4v                1/1     Running   0          5m55s
</span><span class='line'>pod/speaker-95bs8                1/1     Running   0          5m55s
</span><span class='line'>
</span><span class='line'>NAME                     DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
</span><span class='line'>daemonset.apps/speaker   2         2         2       2            2           kubernetes.io/os=linux   5m55s
</span><span class='line'>
</span><span class='line'>NAME                         READY   UP-TO-DATE   AVAILABLE   AGE
</span><span class='line'>deployment.apps/controller   1/1     1            1           5m55s
</span><span class='line'>
</span><span class='line'>NAME                                   DESIRED   CURRENT   READY   AGE
</span><span class='line'>replicaset.apps/controller-57fd9c5bb   1         1         1       5m55s
</span></code></pre></td></tr></table></div></figure>


<h4>é…ç½®åœ°å€</h4>

<ul>
<li><p><a href="https://metallb.universe.tf/configuration/#layer-2-configuration">https://metallb.universe.tf/configuration/#layer-2-configuration</a></p></li>
<li><p><a href="https://kubernetes.github.io/ingress-nginx/deploy/baremetal/#a-pure-software-solution-metallb">https://kubernetes.github.io/ingress-nginx/deploy/baremetal/#a-pure-software-solution-metallb</a></p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># æŸ¥çœ‹ä¸»æœºipï¼Œé¿å¼€è¿™äº›èŠ‚ç‚¹IPçš„åŒºé—´
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get node -o wide
</span><span class='line'>NAME      STATUS   ROLES                  AGE   VERSION   INTERNAL-IP       EXTERNAL-IP   OS-IMAGE         KERNEL-VERSION                  CONTAINER-RUNTIME
</span><span class='line'>k8s       Ready    control-plane,master   10d   v1.23.5   192.168.191.131   &lt;none&gt;        Amazon Linux 2   4.14.268-205.500.amzn2.x86_64   docker://20.10.7
</span><span class='line'>worker1   Ready    &lt;none&gt;                 10d   v1.23.5   192.168.191.132   &lt;none&gt;        Amazon Linux 2   4.14.268-205.500.amzn2.x86_64   docker://20.10.7
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ cat metallb-config.yml
</span><span class='line'>apiVersion: v1
</span><span class='line'>kind: ConfigMap
</span><span class='line'>metadata:
</span><span class='line'>  namespace: metallb-system
</span><span class='line'>  name: config
</span><span class='line'>data:
</span><span class='line'>  config: |
</span><span class='line'>    address-pools:
</span><span class='line'>    - name: default
</span><span class='line'>      protocol: layer2
</span><span class='line'>      addresses:
</span><span class='line'>      - 192.168.191.200-192.168.191.220
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f metallb-config.yml 
</span><span class='line'>configmap/config created
</span></code></pre></td></tr></table></div></figure>


<p>ç„¶åï¼Œå†å›è¿‡å¤´é‡æ–°å®‰è£…ä¸€énginx-ingressï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl get pods --namespace=ingress-nginx
</span><span class='line'>NAME                                        READY   STATUS      RESTARTS   AGE
</span><span class='line'>ingress-nginx-admission-create-b9hkn        0/1     Completed   0          17s
</span><span class='line'>ingress-nginx-admission-patch-xmnbr         0/1     Completed   1          17s
</span><span class='line'>ingress-nginx-controller-755447bb4d-lfrwk   0/1     Running     0          17s
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pods --namespace=ingress-nginx
</span><span class='line'>NAME                                        READY   STATUS      RESTARTS   AGE
</span><span class='line'>ingress-nginx-admission-create-b9hkn        0/1     Completed   0          25s
</span><span class='line'>ingress-nginx-admission-patch-xmnbr         0/1     Completed   1          25s
</span><span class='line'>ingress-nginx-controller-755447bb4d-lfrwk   1/1     Running     0          25s
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl -n ingress-nginx get svc
</span><span class='line'>NAME                                 TYPE           CLUSTER-IP       EXTERNAL-IP       PORT(S)                      AGE
</span><span class='line'>ingress-nginx-controller             LoadBalancer   10.107.221.243   192.168.191.200   80:31443/TCP,443:30099/TCP   57s
</span><span class='line'>ingress-nginx-controller-admission   ClusterIP      10.105.12.185    &lt;none&gt;            443/TCP                      57s
</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ¬¡ EXTERNAL-IP çš„ipå°±æœ‰å€¼äº†ï¼Œä¸Šé¢é…ç½®çš„ipæ®µé‡Œé¢ä¸€ä¸ªipã€‚</p>

<h3>åœ¨çº¿/é›†æˆæµ‹è¯•</h3>

<ul>
<li><a href="https://kubernetes.github.io/ingress-nginx/deploy/#online-testing">https://kubernetes.github.io/ingress-nginx/deploy/#online-testing</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl get service ingress-nginx-controller --namespace=ingress-nginx
</span><span class='line'>NAME                       TYPE           CLUSTER-IP       EXTERNAL-IP       PORT(S)                      AGE
</span><span class='line'>ingress-nginx-controller   LoadBalancer   10.107.221.243   192.168.191.200   80:31443/TCP,443:30099/TCP   4m
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl create deployment demo --image=httpd --port=80
</span><span class='line'>deployment.apps/demo created
</span><span class='line'>[ec2-user@k8s ~]$ kubectl expose deployment demo
</span><span class='line'>service/demo exposed
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl create ingress demo --class=nginx \
</span><span class='line'>   --rule="www.demo.io/*=demo:80"
</span><span class='line'>ingress.networking.k8s.io/demo created
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get ingress 
</span><span class='line'>NAME   CLASS   HOSTS         ADDRESS   PORTS   AGE
</span><span class='line'>demo   nginx   www.demo.io             80      42s
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get ingress 
</span><span class='line'>NAME   CLASS   HOSTS         ADDRESS           PORTS   AGE
</span><span class='line'>demo   nginx   www.demo.io   192.168.191.200   80      27m
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨æœ¬åœ°windowsæœºå™¨çš„ <code>C:/Windows/System32/drivers/etc/hosts</code> å¢åŠ  <code>192.168.191.200 www.demo.io</code> ï¼Œç„¶åæµè§ˆå™¨è®¿é—® <code>http://www.demo.io/</code> ï¼Œé¡ºåˆ©çš„è¯å°±èƒ½åœ¨æµè§ˆå™¨çœ‹åˆ°ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>It works!</span></code></pre></td></tr></table></div></figure>


<h3>åè®°</h3>

<h4>ç†ä¸€ä¸‹ç½‘ç»œè°ƒç”¨ï¼Œå…¶å®å°±æ˜¯nginxçš„æ–¹å¼ï¼š</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl logs --tail=2 pod/demo-764c97f6fd-q5xts
</span><span class='line'>10.244.2.79 - - [28/Mar/2022:09:52:36 +0000] "GET / HTTP/1.1" 200 45
</span><span class='line'>10.244.2.79 - - [28/Mar/2022:09:52:36 +0000] "GET /favicon.ico HTTP/1.1" 404 196
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pods -n ingress-nginx -o wide 
</span><span class='line'>NAME                                        READY   STATUS      RESTARTS   AGE    IP            NODE      NOMINATED NODE   READINESS GATES
</span><span class='line'>ingress-nginx-admission-create-b9hkn        0/1     Completed   0          157m   10.244.2.78   worker1   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>ingress-nginx-admission-patch-xmnbr         0/1     Completed   1          157m   10.244.2.77   worker1   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>ingress-nginx-controller-755447bb4d-lfrwk   1/1     Running     0          157m   10.244.2.79   worker1   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>
</span><span class='line'># 192.168.191.1æ˜¯vmwareè™šæ‹Ÿç½‘å¡çš„åœ°å€
</span><span class='line'>[ec2-user@k8s ~]$ kubectl logs --tail=2 pod/ingress-nginx-controller-755447bb4d-lfrwk -n ingress-nginx 
</span><span class='line'>192.168.191.1 - - [28/Mar/2022:09:52:36 +0000] "GET / HTTP/1.1" 200 45 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.82 Safari/537.36" 566 0.000 [default-demo-80] [] 10.244.2.80:80 45 0.000 200 6d52ef8349eb3101c31c3cc6377b982b
</span><span class='line'>192.168.191.1 - - [28/Mar/2022:09:52:36 +0000] "GET /favicon.ico HTTP/1.1" 404 196 "http://www.demo.io/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.82 Safari/537.36" 506 0.001 [default-demo-80] [] 10.244.2.80:80 196 0.000 404 fefe172a57273977cdcd1455bcf322ac
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>## web
</span><span class='line'>Request URL: http://www.demo.io/
</span><span class='line'>Request Method: GET
</span><span class='line'>Status Code: 200 OK
</span><span class='line'>Remote Address: 192.168.191.200:80
</span><span class='line'>Referrer Policy: strict-origin-when-cross-origin
</span></code></pre></td></tr></table></div></figure>


<h4>çœ‹çœ‹metallbçš„æ—¥å¿—ï¼Œipæ˜¯æ€ä¹ˆåˆ†é…çš„</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># https://metallb.universe.tf/concepts/layer2/
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pods -n metallb-system -o wide
</span><span class='line'>NAME                         READY   STATUS    RESTARTS   AGE     IP                NODE      NOMINATED NODE   READINESS GATES
</span><span class='line'>controller-57fd9c5bb-kc5zt   1/1     Running   0          3h34m   10.244.2.76       worker1   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>speaker-8pg4v                1/1     Running   0          3h34m   192.168.191.132   worker1   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>speaker-95bs8                1/1     Running   0          3h34m   192.168.191.131   k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl logs pod/controller-57fd9c5bb-kc5zt -n metallb-system
</span><span class='line'>{"caller":"level.go:63","event":"ipAllocated","ip":["192.168.191.200"],"level":"info","msg":"IP address assigned by controller","service":"ingress-nginx/ingress-nginx-controller","ts":"2022-03-28T07:16:22.675599527Z"}
</span><span class='line'>{"caller":"level.go:63","event":"serviceUpdated","level":"info","msg":"updated service object","service":"ingress-nginx/ingress-nginx-controller","ts":"2022-03-28T07:1
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl logs speaker-8pg4v -n metallb-system 
</span><span class='line'>{"caller":"level.go:63","event":"serviceAnnounced","ips":["192.168.191.200"],"level":"info","msg":"service has IP, announcing","pool":"default","protocol":"layer2","service":"ingress-nginx/ingress-nginx-controller","ts":"2022-03-28T07:16:42.775467559Z"}
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ ping 192.168.191.200
</span><span class='line'>PING 192.168.191.200 (192.168.191.200) 56(84) bytes of data.
</span><span class='line'>^C
</span><span class='line'>--- 192.168.191.200 ping statistics ---
</span><span class='line'>3 packets transmitted, 0 received, 100% packet loss, time 2055ms
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ arp 
</span><span class='line'>Address                  HWtype  HWaddress           Flags Mask            Iface
</span><span class='line'>192.168.191.200          ether   00:0c:29:d5:4f:0f   C                     eth0
</span><span class='line'>
</span><span class='line'># worker1èŠ‚ç‚¹çš„MAC
</span><span class='line'>[ec2-user@worker1 ~]$ ip a | grep -i -C 10 '00:0c:29:d5:4f:0f' 
</span><span class='line'>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
</span><span class='line'>    link/ether 00:0c:29:d5:4f:0f brd ff:ff:ff:ff:ff:ff
</span><span class='line'>    inet 192.168.191.132/24 brd 192.168.191.255 scope global dynamic eth0
</span><span class='line'>       valid_lft 1714sec preferred_lft 1714sec
</span><span class='line'>
</span><span class='line'># In layer 2 mode, all traffic for a service IP goes to one node. From there, kube-proxy spreads the traffic to all the serviceâ€™s pods.
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pods -A -o wide | grep 192.168.191.132
</span><span class='line'>kube-system            kube-flannel-ds-q4qkt                        1/1     Running     8 (2d10h ago)   11d     192.168.191.132   worker1   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system            kube-proxy-pd77m                             1/1     Running     6 (3d2h ago)    11d     192.168.191.132   worker1   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>metallb-system         speaker-8pg4v                                1/1     Running     0               5h31m   192.168.191.132   worker1   &lt;none&gt;           &lt;none&gt;
</span></code></pre></td></tr></table></div></figure>


<h2>ä¾‹å­ï¼š</h2>

<ul>
<li><a href="https://kubernetes.github.io/ingress-nginx/deploy/#local-testing">https://kubernetes.github.io/ingress-nginx/deploy/#local-testing</a></li>
<li><a href="https://kubernetes.io/zh/docs/tasks/access-application-cluster/ingress-minikube/">https://kubernetes.io/zh/docs/tasks/access-application-cluster/ingress-minikube/</a></li>
</ul>


<h2>éªŒè¯</h2>

<ul>
<li><a href="https://www.qikqiak.com/post/visually-explained-k8s-service/">å›¾è§£ Kubernetes Service</a></li>
<li><a href="https://www.qikqiak.com/post/visually-explained-k8s-ingress/">å›¾è§£ Kubernetes Ingress</a></li>
</ul>


<p>æ–‡ä¸­è¯´loadbalanceræ˜¯é€šè¿‡äº†nodeportï¼ˆä¼šåˆ›å»ºnodeportï¼‰ï¼Œè¿˜æ˜¯æœ‰ç‚¹è¯§å¼‚çš„ã€‚éªŒè¯ä¸€ç•ªï¼ŒæœçœŸå¦‚æ­¤ï¼</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl get service ingress-nginx-controller --namespace=ingress-nginx
</span><span class='line'>NAME                       TYPE           CLUSTER-IP       EXTERNAL-IP       PORT(S)                      AGE
</span><span class='line'>ingress-nginx-controller   LoadBalancer   10.107.221.243   192.168.191.200   80:31443/TCP,443:30099/TCP   34m
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl describe service ingress-nginx-controller --namespace=ingress-nginx
</span><span class='line'>Name:                     ingress-nginx-controller
</span><span class='line'>Namespace:                ingress-nginx
</span><span class='line'>Labels:                   app.kubernetes.io/component=controller
</span><span class='line'>                          app.kubernetes.io/instance=ingress-nginx
</span><span class='line'>                          app.kubernetes.io/managed-by=Helm
</span><span class='line'>                          app.kubernetes.io/name=ingress-nginx
</span><span class='line'>                          app.kubernetes.io/part-of=ingress-nginx
</span><span class='line'>                          app.kubernetes.io/version=1.1.2
</span><span class='line'>                          helm.sh/chart=ingress-nginx-4.0.18
</span><span class='line'>Annotations:              &lt;none&gt;
</span><span class='line'>Selector:                 app.kubernetes.io/component=controller,app.kubernetes.io/instance=ingress-nginx,app.kubernetes.io/name=ingress-nginx
</span><span class='line'>Type:                     LoadBalancer
</span><span class='line'>IP Family Policy:         SingleStack
</span><span class='line'>IP Families:              IPv4
</span><span class='line'>IP:                       10.107.221.243
</span><span class='line'>IPs:                      10.107.221.243
</span><span class='line'>LoadBalancer Ingress:     192.168.191.200
</span><span class='line'>Port:                     http  80/TCP
</span><span class='line'>TargetPort:               http/TCP
</span><span class='line'>NodePort:                 http  31443/TCP
</span><span class='line'>Endpoints:                10.244.2.79:80
</span><span class='line'>Port:                     https  443/TCP
</span><span class='line'>TargetPort:               https/TCP
</span><span class='line'>NodePort:                 https  30099/TCP
</span><span class='line'>Endpoints:                10.244.2.79:443
</span><span class='line'>Session Affinity:         None
</span><span class='line'>External Traffic Policy:  Local
</span><span class='line'>HealthCheck NodePort:     31942
</span><span class='line'>Events:
</span><span class='line'>  Type    Reason        Age   From                Message
</span><span class='line'>  ----    ------        ----  ----                -------
</span><span class='line'>  Normal  IPAllocated   38m   metallb-controller  Assigned IP ["192.168.191.200"]
</span><span class='line'>  Normal  nodeAssigned  38m   metallb-speaker     announcing from node "worker1"
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ netstat -anp | grep 31443 
</span><span class='line'>(No info could be read for "-p": geteuid()=1002 but you should be root.)
</span><span class='line'>tcp        0      0 0.0.0.0:31443           0.0.0.0:*               LISTEN      -       
</span><span class='line'>
</span><span class='line'>[ec2-user@worker1 ~]$ netstat -anp | grep 31443
</span><span class='line'>(No info could be read for "-p": geteuid()=1002 but you should be root.)
</span><span class='line'>tcp        0      0 0.0.0.0:31443           0.0.0.0:*               LISTEN      -                   
</span></code></pre></td></tr></table></div></figure>


<h2>å…¶ä»–å‚è€ƒ</h2>

<ul>
<li><a href="https://blog.51cto.com/tansong/4850092">å¤šç§æ–¹å¼è®¿é—®AWS EKSçš„ Kubernetes Dashboard ä¸‹ç¯‡</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># åˆ›å»ºè¯ä¹¦
</span><span class='line'>opensslÂ genrsaÂ 2048Â &gt;Â k8s-dashboard-private.key
</span><span class='line'>opensslÂ reqÂ -newÂ -x509Â -nodesÂ -sha1Â -daysÂ 3650Â -extensionsÂ v3_caÂ -keyÂ k8s-dashboard-private.keyÂ &gt;Â k8s-dashboard.crt
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://segmentfault.com/a/1190000019908991">k8s ingressåŸç†åŠingress-nginxéƒ¨ç½²æµ‹è¯•</a></li>
</ul>


<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[k8s-v1.23.5å®‰è£…æŒ‡å— - ä½¿ç”¨kubeadm]]></title>
    <link href="http://winse.github.io/blog/2022/03/18/k8s-guide-use-kubeadm/"/>
    <updated>2022-03-18T11:58:48+08:00</updated>
    <id>http://winse.github.io/blog/2022/03/18/k8s-guide-use-kubeadm</id>
    <content type="html"><![CDATA[<p>æ³¨[2022-03-25]ï¼šå¦‚æœåé¢éœ€è¦ç”¨AWSï¼Œç”¨Amazonçš„æ“ä½œç³»ç»Ÿä¼šä¾¿åˆ©ä¸€ç‚¹ã€‚awsçš„å‘½ä»¤è¿™äº›éƒ½è‡ªå¸¦äº†ã€‚</p>

<p>æœ¬æ–‡æ˜¯åœ¨ Amazon Linux 2 ç³»ç»Ÿä¸Šå®‰è£…éƒ¨ç½²çš„ï¼Œå’Œcentos7.3åŸºæœ¬ç›¸ä¼¼ã€‚</p>

<p>å’Œk8sè½¯ä»¶ä¾èµ–éœ€è¦è®¿é—®googleçš„ï¼Œå·²ç»åœ¨å‰é¢ä¸€ç¯‡æ–‡ç« ä¸­ä¸‹è½½å¥½ï¼Œæœ¬æ–‡ä¸­ä¼šç›´æ¥ä½¿ç”¨ã€‚ä¾èµ–çš„è½¯ä»¶å¯ä»¥åœ¨ç™¾åº¦ç½‘ç›˜ä¸‹è½½ï¼š</p>

<pre><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1P3ABqKGt1JhNkg-9yB22yQ 
æå–ç ï¼šk7af
</code></pre>

<h2>å®‰è£… amazon-linux-2 æ“ä½œç³»ç»Ÿ</h2>

<ul>
<li><a href="https://docs.amazonaws.cn/AWSEC2/latest/UserGuide/amazon-linux-2-virtual-machine.html#amazon-linux-2-virtual-machine-download">æ­¥éª¤ 2ï¼šä¸‹è½½ Amazon Linux 2 VM æ˜ åƒ</a></li>
<li>ä¸‹è½½ <a href="https://cdn.amazonlinux.com/os-images/2.0.20220218.3/">https://cdn.amazonlinux.com/os-images/2.0.20220218.3/</a></li>
</ul>


<p>è¿™é‡Œä¸‹è½½vmwareä½¿ç”¨çš„é•œåƒ <code>amzn2-vmware_esx-2.0.20220218.3-x86_64.xfs.gpt.ova</code> å’Œåˆå§‹åŒ–é…ç½® <code>Seed.iso</code> ã€‚</p>

<p>è¿™é‡Œç®€å•è¯´ä¸‹ï¼Œå…¶å®ovaå·²ç»æ˜¯å¯ä»¥ç›´æ¥ç”¨çš„ï¼Œæ–‡æ¡£ä¸­è®²çš„å¾ˆå¤šå†…å®¹æ˜¯è¾…åŠ©ç³»ç»Ÿå®šåˆ¶åˆå§‹åŒ–çš„ã€‚user-dataç”¨äºåˆ›å»ºç”¨æˆ·å’Œä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼Œmeta-dataé…ç½®ä¸»æœºåå’Œç½‘ç»œipè®¾ç½®ã€‚ä¸ºäº†æœ¬åœ°å¼€å‘æµ‹è¯•ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨é»˜è®¤æä¾› <code>Seed.iso</code> å³å¯ï¼Œç™»å½•ä½¿ç”¨ <code>ec2-user:amazon</code> ã€‚</p>

<p>ç„¶ååŒå‡» ova æ–‡ä»¶ï¼Œå°±å¯ä»¥å¯¼å…¥åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºå‡ºæ¥äº†ã€‚</p>

<ul>
<li>ä¿®æ”¹ç½‘ç»œé€‚é…å™¨ä¸ºNATæ¨¡å¼ï¼›</li>
<li>æ·»åŠ CD/DVDè®¾å¤‡ï¼Œé€‰æ‹© <code>Seed.iso</code> ISOæ˜ å°„æ–‡ä»¶ï¼›</li>
<li>å¼€æœºç™»å½•ç³»ç»Ÿåï¼Œæ‰“å¼€sshdçš„å¯†ç ç™»å½•ã€‚</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo ifup eth0
</span><span class='line'>$ ip a
</span><span class='line'>
</span><span class='line'>$ sudo vi /etc/ssh/sshd_config
</span><span class='line'>#PasswordAuthentication no
</span><span class='line'>
</span><span class='line'>$ sudo service sshd reload 
</span></code></pre></td></tr></table></div></figure>


<h2>å®‰è£…docker</h2>

<p>k8séœ€è¦å®¹å™¨è¿è¡Œæ—¶è½¯ä»¶ï¼Œæˆ‘ä»¬å…ˆå®‰è£…å¥½dockerã€‚</p>

<ul>
<li><a href="https://kubernetes.io/zh/docs/setup/production-environment/container-runtimes/#docker">https://kubernetes.io/zh/docs/setup/production-environment/container-runtimes/#docker</a></li>
</ul>


<p>aws linux 2æœ‰å®ƒè‡ªå·±çš„dockeræºï¼Œä½¿ç”¨dockerå®˜ç½‘æ–‡æ¡£çš„æ–¹å¼ä¾èµ–æœ‰äº›æ‰¾ä¸åˆ°ã€‚ç›´æ¥æŒ‰ç…§awså®˜æ–¹æ–‡æ¡£ä¸­æä¾›çš„æ–¹å¼å®‰è£…ã€‚</p>

<h3>å‘</h3>

<p>ä¸€å¼€å§‹æ˜¯æŒ‰ç…§dockerå®˜ç½‘åœ¨centosçš„æ–¹å¼å®‰è£…çš„ï¼Œä½†yum repoçš„å˜é‡ä¸å¯¹ä¸Šï¼Œæ”¹äº†releaseveråï¼Œç„¶åä¾èµ–çš„ç‰ˆæœ¬æ‰¾ä¸åˆ°ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## https://docs.docker.com/engine/install/centos/
</span><span class='line'>[ec2-user@amazonlinux ~]$ cat /etc/issue
</span><span class='line'>\S
</span><span class='line'>Kernel \r on an \m
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ yum-debug-dump
</span><span class='line'>Loaded plugins: langpacks, priorities, update-motd
</span><span class='line'>Output written to: /home/ec2-user/yum_debug_dump-amazonlinux.onprem-2022-03-17_02:16:37.txt.gz
</span><span class='line'>[ec2-user@amazonlinux ~]$ less /home/ec2-user/yum_debug_dump-amazonlinux.onprem-2022-03-17_02:16:37.txt.gz
</span><span class='line'>[ec2-user@amazonlinux ~]$ 
</span><span class='line'>
</span><span class='line'>$releaseverçš„å€¼,è¿™ä¸ªè¡¨ç¤ºå½“å‰ç³»ç»Ÿçš„å‘è¡Œç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡rpm -qi centos-releaseå‘½ä»¤æŸ¥çœ‹ï¼Œç»“æœå¦‚ä¸‹ï¼š
</span><span class='line'>$basearchæ˜¯æˆ‘ä»¬çš„ç³»ç»Ÿç¡¬ä»¶æ¶æ„(CPUæŒ‡ä»¤é›†),ä½¿ç”¨å‘½ä»¤archå¾—åˆ°
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo sed -i 's/$releasever/7/g' /etc/yum.repos.d/docker-ce.repo 
</span><span class='line'>
</span><span class='line'>## ç¼ºå°‘ä¾èµ–
</span></code></pre></td></tr></table></div></figure>


<h3>æ­£å¼å®‰è£…docker</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## https://docs.aws.amazon.com/AmazonECS/latest/developerguide/docker-basics.html
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo yum update -y
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo amazon-linux-extras install docker
</span><span class='line'>Installing docker
</span><span class='line'>Loaded plugins: langpacks, priorities, update-motd
</span><span class='line'>Cleaning repos: amzn2-core amzn2extra-docker
</span><span class='line'>12 metadata files removed
</span><span class='line'>4 sqlite files removed
</span><span class='line'>0 metadata files removed
</span><span class='line'>Loaded plugins: langpacks, priorities, update-motd
</span><span class='line'>amzn2-core                                                                                                                                        | 3.7 kB  00:00:00     
</span><span class='line'>amzn2extra-docker                                                                                                                                 | 3.0 kB  00:00:00     
</span><span class='line'>(1/5): amzn2-core/2/x86_64/group_gz                                                                                                               | 2.5 kB  00:00:00     
</span><span class='line'>(2/5): amzn2extra-docker/2/x86_64/updateinfo                                                                                                      | 5.9 kB  00:00:00     
</span><span class='line'>(3/5): amzn2-core/2/x86_64/updateinfo                                                                                                             | 452 kB  00:00:01     
</span><span class='line'>(4/5): amzn2extra-docker/2/x86_64/primary_db                                                                                                      |  86 kB  00:00:00     
</span><span class='line'>(5/5): amzn2-core/2/x86_64/primary_db                                                                                                             |  60 MB  00:01:42     
</span><span class='line'>Resolving Dependencies
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package docker.x86_64 0:20.10.7-5.amzn2 will be installed
</span><span class='line'>--&gt; Processing Dependency: runc &gt;= 1.0.0 for package: docker-20.10.7-5.amzn2.x86_64
</span><span class='line'>--&gt; Processing Dependency: libcgroup &gt;= 0.40.rc1-5.15 for package: docker-20.10.7-5.amzn2.x86_64
</span><span class='line'>--&gt; Processing Dependency: containerd &gt;= 1.3.2 for package: docker-20.10.7-5.amzn2.x86_64
</span><span class='line'>--&gt; Processing Dependency: pigz for package: docker-20.10.7-5.amzn2.x86_64
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package containerd.x86_64 0:1.4.6-8.amzn2 will be installed
</span><span class='line'>---&gt; Package libcgroup.x86_64 0:0.41-21.amzn2 will be installed
</span><span class='line'>---&gt; Package pigz.x86_64 0:2.3.4-1.amzn2.0.1 will be installed
</span><span class='line'>---&gt; Package runc.x86_64 0:1.0.0-2.amzn2 will be installed
</span><span class='line'>--&gt; Finished Dependency Resolution
</span><span class='line'>
</span><span class='line'>Dependencies Resolved
</span><span class='line'>
</span><span class='line'>=========================================================================================================================================================================
</span><span class='line'> Package                               Arch                              Version                                      Repository                                    Size
</span><span class='line'>=========================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> docker                                x86_64                            20.10.7-5.amzn2                              amzn2extra-docker                             42 M
</span><span class='line'>Installing for dependencies:
</span><span class='line'> containerd                            x86_64                            1.4.6-8.amzn2                                amzn2extra-docker                             24 M
</span><span class='line'> libcgroup                             x86_64                            0.41-21.amzn2                                amzn2-core                                    66 k
</span><span class='line'> pigz                                  x86_64                            2.3.4-1.amzn2.0.1                            amzn2-core                                    81 k
</span><span class='line'> runc                                  x86_64                            1.0.0-2.amzn2                                amzn2extra-docker                            3.3 M
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>=========================================================================================================================================================================
</span><span class='line'>Install  1 Package (+4 Dependent packages)
</span><span class='line'>
</span><span class='line'>Total download size: 69 M
</span><span class='line'>Installed size: 285 M
</span><span class='line'>Is this ok [y/d/N]: y
</span><span class='line'>Downloading packages:
</span><span class='line'>(1/5): pigz-2.3.4-1.amzn2.0.1.x86_64.rpm                                                                                                          |  81 kB  00:00:00     
</span><span class='line'>(2/5): libcgroup-0.41-21.amzn2.x86_64.rpm                                                                                                         |  66 kB  00:00:00     
</span><span class='line'>(3/5): containerd-1.4.6-8.amzn2.x86_64.rpm                                                                                                        |  24 MB  00:01:14     
</span><span class='line'>(4/5): runc-1.0.0-2.amzn2.x86_64.rpm                                                                                                              | 3.3 MB  00:00:10     
</span><span class='line'>(5/5): docker-20.10.7-5.amzn2.x86_64.rpm                                                                                                          |  42 MB  00:01:50     
</span><span class='line'>-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Total                                                                                                                                    641 kB/s |  69 MB  00:01:50     
</span><span class='line'>Running transaction check
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded
</span><span class='line'>Running transaction
</span><span class='line'>  Installing : runc-1.0.0-2.amzn2.x86_64                                                                                                                             1/5 
</span><span class='line'>  Installing : containerd-1.4.6-8.amzn2.x86_64                                                                                                                       2/5 
</span><span class='line'>  Installing : libcgroup-0.41-21.amzn2.x86_64                                                                                                                        3/5 
</span><span class='line'>  Installing : pigz-2.3.4-1.amzn2.0.1.x86_64                                                                                                                         4/5 
</span><span class='line'>  Installing : docker-20.10.7-5.amzn2.x86_64                                                                                                                         5/5 
</span><span class='line'>  Verifying  : docker-20.10.7-5.amzn2.x86_64                                                                                                                         1/5 
</span><span class='line'>  Verifying  : containerd-1.4.6-8.amzn2.x86_64                                                                                                                       2/5 
</span><span class='line'>  Verifying  : runc-1.0.0-2.amzn2.x86_64                                                                                                                             3/5 
</span><span class='line'>  Verifying  : pigz-2.3.4-1.amzn2.0.1.x86_64                                                                                                                         4/5 
</span><span class='line'>  Verifying  : libcgroup-0.41-21.amzn2.x86_64                                                                                                                        5/5 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  docker.x86_64 0:20.10.7-5.amzn2                                                                                                                                        
</span><span class='line'>
</span><span class='line'>Dependency Installed:
</span><span class='line'>  containerd.x86_64 0:1.4.6-8.amzn2           libcgroup.x86_64 0:0.41-21.amzn2           pigz.x86_64 0:2.3.4-1.amzn2.0.1           runc.x86_64 0:1.0.0-2.amzn2          
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>  0  ansible2                 available    \
</span><span class='line'>        [ =2.4.2  =2.4.6  =2.8  =stable ]
</span><span class='line'>  2  httpd_modules            available    [ =1.0  =stable ]
</span><span class='line'>  3  memcached1.5             available    \
</span><span class='line'>        [ =1.5.1  =1.5.16  =1.5.17 ]
</span><span class='line'>  5  postgresql9.6            available    \
</span><span class='line'>        [ =9.6.6  =9.6.8  =stable ]
</span><span class='line'>  6  postgresql10             available    [ =10  =stable ]
</span><span class='line'>  9  R3.4                     available    [ =3.4.3  =stable ]
</span><span class='line'> 10  rust1                    available    \
</span><span class='line'>        [ =1.22.1  =1.26.0  =1.26.1  =1.27.2  =1.31.0  =1.38.0
</span><span class='line'>          =stable ]
</span><span class='line'> 11  vim                      available    [ =8.0  =stable ]
</span><span class='line'> 18  libreoffice              available    \
</span><span class='line'>        [ =5.0.6.2_15  =5.3.6.1  =stable ]
</span><span class='line'> 19  gimp                     available    [ =2.8.22 ]
</span><span class='line'> 20  docker=latest            enabled      \
</span><span class='line'>        [ =17.12.1  =18.03.1  =18.06.1  =18.09.9  =stable ]
</span><span class='line'> 21  mate-desktop1.x          available    \
</span><span class='line'>        [ =1.19.0  =1.20.0  =stable ]
</span><span class='line'> 22  GraphicsMagick1.3        available    \
</span><span class='line'>        [ =1.3.29  =1.3.32  =1.3.34  =stable ]
</span><span class='line'> 23  tomcat8.5                available    \
</span><span class='line'>        [ =8.5.31  =8.5.32  =8.5.38  =8.5.40  =8.5.42  =8.5.50
</span><span class='line'>          =stable ]
</span><span class='line'> 24  epel                     available    [ =7.11  =stable ]
</span><span class='line'> 25  testing                  available    [ =1.0  =stable ]
</span><span class='line'> 26  ecs                      available    [ =stable ]
</span><span class='line'> 27  corretto8                available    \
</span><span class='line'>        [ =1.8.0_192  =1.8.0_202  =1.8.0_212  =1.8.0_222  =1.8.0_232
</span><span class='line'>          =1.8.0_242  =stable ]
</span><span class='line'> 28  firecracker              available    [ =0.11  =stable ]
</span><span class='line'> 29  golang1.11               available    \
</span><span class='line'>        [ =1.11.3  =1.11.11  =1.11.13  =stable ]
</span><span class='line'> 30  squid4                   available    [ =4  =stable ]
</span><span class='line'> 32  lustre2.10               available    \
</span><span class='line'>        [ =2.10.5  =2.10.8  =stable ]
</span><span class='line'> 33  java-openjdk11           available    [ =11  =stable ]
</span><span class='line'> 34  lynis                    available    [ =stable ]
</span><span class='line'> 35  kernel-ng                available    [ =stable ]
</span><span class='line'> 36  BCC                      available    [ =0.x  =stable ]
</span><span class='line'> 37  mono                     available    [ =5.x  =stable ]
</span><span class='line'> 38  nginx1                   available    [ =stable ]
</span><span class='line'> 39  ruby2.6                  available    [ =2.6  =stable ]
</span><span class='line'> 40  mock                     available    [ =stable ]
</span><span class='line'> 41  postgresql11             available    [ =11  =stable ]
</span><span class='line'> 42  php7.4                   available    [ =stable ]
</span><span class='line'> 43  livepatch                available    [ =stable ]
</span><span class='line'> 44  python3.8                available    [ =stable ]
</span><span class='line'> 45  haproxy2                 available    [ =stable ]
</span><span class='line'> 46  collectd                 available    [ =stable ]
</span><span class='line'> 47  aws-nitro-enclaves-cli   available    [ =stable ]
</span><span class='line'> 48  R4                       available    [ =stable ]
</span><span class='line'> 49  kernel-5.4               available    [ =stable ]
</span><span class='line'> 50  selinux-ng               available    [ =stable ]
</span><span class='line'> 51  php8.0                   available    [ =stable ]
</span><span class='line'> 52  tomcat9                  available    [ =stable ]
</span><span class='line'> 53  unbound1.13              available    [ =stable ]
</span><span class='line'> 54  mariadb10.5              available    [ =stable ]
</span><span class='line'> 55  kernel-5.10              available    [ =stable ]
</span><span class='line'> 56  redis6                   available    [ =stable ]
</span><span class='line'> 57  ruby3.0                  available    [ =stable ]
</span><span class='line'> 58  postgresql12             available    [ =stable ]
</span><span class='line'> 59  postgresql13             available    [ =stable ]
</span><span class='line'> 60  mock2                    available    [ =stable ]
</span><span class='line'> 61  dnsmasq2.85              available    [ =stable ]
</span><span class='line'>[ec2-user@amazonlinux ~]$ 
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo service docker start
</span><span class='line'>Redirecting to /bin/systemctl start docker.service
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo systemctl enable docker
</span><span class='line'>Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo usermod -a -G docker ec2-user
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ docker info
</span><span class='line'>Client:
</span><span class='line'> Context:    default
</span><span class='line'> Debug Mode: false
</span><span class='line'>
</span><span class='line'>Server:
</span><span class='line'>ERROR: Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get "http://%2Fvar%2Frun%2Fdocker.sock/v1.24/info": dial unix /var/run/docker.sock: connect: permission denied
</span><span class='line'>errors pretty printing info
</span><span class='line'>[ec2-user@amazonlinux ~]$ exit
</span><span class='line'>é€€å‡ºåå†æ¬¡è¿æ¥ï¼š
</span><span class='line'>[ec2-user@amazonlinux ~]$ docker info 
</span><span class='line'>Client:
</span><span class='line'> Context:    default
</span><span class='line'> Debug Mode: false
</span><span class='line'>
</span><span class='line'>Server:
</span><span class='line'> Containers: 0
</span><span class='line'>  Running: 0
</span><span class='line'>  Paused: 0
</span><span class='line'>  Stopped: 0
</span><span class='line'> Images: 0
</span><span class='line'> Server Version: 20.10.7
</span><span class='line'> Storage Driver: overlay2
</span><span class='line'>  Backing Filesystem: xfs
</span><span class='line'>  Supports d_type: true
</span><span class='line'>  Native Overlay Diff: true
</span><span class='line'>  userxattr: false
</span><span class='line'> Logging Driver: json-file
</span><span class='line'> Cgroup Driver: cgroupfs
</span><span class='line'> Cgroup Version: 1
</span><span class='line'> Plugins:
</span><span class='line'>  Volume: local
</span><span class='line'>  Network: bridge host ipvlan macvlan null overlay
</span><span class='line'>  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog
</span><span class='line'> Swarm: inactive
</span><span class='line'> Runtimes: io.containerd.runc.v2 io.containerd.runtime.v1.linux runc
</span><span class='line'> Default Runtime: runc
</span><span class='line'> Init Binary: docker-init
</span><span class='line'> containerd version: d71fcd7d8303cbf684402823e425e9dd2e99285d
</span><span class='line'> runc version: 84113eef6fc27af1b01b3181f31bbaf708715301
</span><span class='line'> init version: de40ad0
</span><span class='line'> Security Options:
</span><span class='line'>  seccomp
</span><span class='line'>   Profile: default
</span><span class='line'> Kernel Version: 4.14.268-205.500.amzn2.x86_64
</span><span class='line'> Operating System: Amazon Linux 2
</span><span class='line'> OSType: linux
</span><span class='line'> Architecture: x86_64
</span><span class='line'> CPUs: 2
</span><span class='line'> Total Memory: 3.828GiB
</span><span class='line'> Name: amazonlinux.onprem
</span><span class='line'> ID: GENW:47BV:UJR2:247P:CPFE:PHSO:RA6Z:H4RK:HYEE:LXN3:XDIZ:SI6Q
</span><span class='line'> Docker Root Dir: /var/lib/docker
</span><span class='line'> Debug Mode: false
</span><span class='line'> Registry: https://index.docker.io/v1/
</span><span class='line'> Labels:
</span><span class='line'> Experimental: false
</span><span class='line'> Insecure Registries:
</span><span class='line'>  127.0.0.0/8
</span><span class='line'> Live Restore Enabled: false
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo yum install telnet -y
</span></code></pre></td></tr></table></div></figure>


<h2>å‡†å¤‡å·¥ä½œ</h2>

<p>å¯ä»¥å…ˆäº†è§£ä¸€äº›åŸºæœ¬æ¦‚å¿µ
* <a href="https://www.jianshu.com/p/7bc34ff88d9d">Kubernetes in Action ç¬”è®° â€”â€” éƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨</a></p>

<ul>
<li><a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B">å‡†å¤‡å¼€å§‹</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹ä¸Š MAC åœ°å€å’Œ product_uuid çš„å”¯ä¸€æ€§
</span><span class='line'>[ec2-user@amazonlinux ~]$ ip link
</span><span class='line'>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
</span><span class='line'>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span><span class='line'>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000
</span><span class='line'>    link/ether 00:0c:29:a4:a6:fc brd ff:ff:ff:ff:ff:ff
</span><span class='line'>[ec2-user@amazonlinux ~]$ ifconfig -a
</span><span class='line'>eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
</span><span class='line'>        inet 192.168.191.131  netmask 255.255.255.0  broadcast 192.168.191.255
</span><span class='line'>        inet6 fe80::20c:29ff:fea4:a6fc  prefixlen 64  scopeid 0x20&lt;link&gt;
</span><span class='line'>        ether 00:0c:29:a4:a6:fc  txqueuelen 1000  (Ethernet)
</span><span class='line'>        RX packets 1737  bytes 288390 (281.6 KiB)
</span><span class='line'>        RX errors 0  dropped 0  overruns 0  frame 0
</span><span class='line'>        TX packets 1704  bytes 139101 (135.8 KiB)
</span><span class='line'>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span><span class='line'>
</span><span class='line'>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
</span><span class='line'>        inet 127.0.0.1  netmask 255.0.0.0
</span><span class='line'>        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;
</span><span class='line'>        loop  txqueuelen 1000  (Local Loopback)
</span><span class='line'>        RX packets 625  bytes 57768 (56.4 KiB)
</span><span class='line'>        RX errors 0  dropped 0  overruns 0  frame 0
</span><span class='line'>        TX packets 625  bytes 57768 (56.4 KiB)
</span><span class='line'>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo cat /sys/class/dmi/id/product_uuid
</span><span class='line'>564DD81E-DEBE-B06D-CF35-D7E3DDA4A6FC
</span><span class='line'>
</span><span class='line'>## æ£€æŸ¥ç½‘ç»œé€‚é…å™¨
</span><span class='line'># åªæœ‰ä¸€ä¸ªç½‘å¡ï¼Œè·³è¿‡
</span><span class='line'>
</span><span class='line'>## å…è®¸ iptables æ£€æŸ¥æ¡¥æ¥æµé‡
</span><span class='line'>[ec2-user@amazonlinux ~]$ lsmod | grep br_netfilter
</span><span class='line'>[ec2-user@amazonlinux ~]$ 
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo modprobe br_netfilter
</span><span class='line'>[ec2-user@amazonlinux ~]$ lsmod | grep br_netfilter 
</span><span class='line'>br_netfilter           24576  0
</span><span class='line'>bridge                172032  1 br_netfilter
</span><span class='line'>[ec2-user@amazonlinux ~]$ 
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
</span><span class='line'>br_netfilter
</span><span class='line'>EOF
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
</span><span class='line'>net.bridge.bridge-nf-call-ip6tables = 1
</span><span class='line'>net.bridge.bridge-nf-call-iptables = 1
</span><span class='line'>EOF
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo sysctl --system
</span><span class='line'>* Applying /etc/sysctl.d/00-defaults.conf ...
</span><span class='line'>kernel.printk = 8 4 1 7
</span><span class='line'>kernel.panic = 30
</span><span class='line'>net.ipv4.neigh.default.gc_thresh1 = 0
</span><span class='line'>net.ipv6.neigh.default.gc_thresh1 = 0
</span><span class='line'>net.ipv4.neigh.default.gc_thresh2 = 15360
</span><span class='line'>net.ipv6.neigh.default.gc_thresh2 = 15360
</span><span class='line'>net.ipv4.neigh.default.gc_thresh3 = 16384
</span><span class='line'>net.ipv6.neigh.default.gc_thresh3 = 16384
</span><span class='line'>* Applying /usr/lib/sysctl.d/00-system.conf ...
</span><span class='line'>net.bridge.bridge-nf-call-ip6tables = 0
</span><span class='line'>net.bridge.bridge-nf-call-iptables = 0
</span><span class='line'>net.bridge.bridge-nf-call-arptables = 0
</span><span class='line'>* Applying /usr/lib/sysctl.d/10-default-yama-scope.conf ...
</span><span class='line'>kernel.yama.ptrace_scope = 0
</span><span class='line'>* Applying /usr/lib/sysctl.d/50-default.conf ...
</span><span class='line'>kernel.sysrq = 16
</span><span class='line'>kernel.core_uses_pid = 1
</span><span class='line'>kernel.kptr_restrict = 1
</span><span class='line'>net.ipv4.conf.default.rp_filter = 1
</span><span class='line'>net.ipv4.conf.all.rp_filter = 1
</span><span class='line'>net.ipv4.conf.default.accept_source_route = 0
</span><span class='line'>net.ipv4.conf.all.accept_source_route = 0
</span><span class='line'>net.ipv4.conf.default.promote_secondaries = 1
</span><span class='line'>net.ipv4.conf.all.promote_secondaries = 1
</span><span class='line'>fs.protected_hardlinks = 1
</span><span class='line'>fs.protected_symlinks = 1
</span><span class='line'>* Applying /etc/sysctl.d/99-amazon.conf ...
</span><span class='line'>kernel.sched_autogroup_enabled = 0
</span><span class='line'>* Applying /etc/sysctl.d/99-sysctl.conf ...
</span><span class='line'>* Applying /etc/sysctl.d/k8s.conf ...
</span><span class='line'>net.bridge.bridge-nf-call-ip6tables = 1
</span><span class='line'>net.bridge.bridge-nf-call-iptables = 1
</span><span class='line'>* Applying /etc/sysctl.conf ...
</span><span class='line'>
</span><span class='line'>## SELINUX
</span><span class='line'>sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config 
</span><span class='line'>setenforce 0
</span><span class='line'>
</span><span class='line'>## Docker
</span><span class='line'>cat &lt;&lt;EOF | sudo tee /etc/docker/daemon.json
</span><span class='line'>{
</span><span class='line'>  "exec-opts": ["native.cgroupdriver=systemd"],
</span><span class='line'>  "log-driver": "json-file",
</span><span class='line'>  "log-opts": {
</span><span class='line'>    "max-size": "100m"
</span><span class='line'>  },
</span><span class='line'>  "storage-driver": "overlay2"
</span><span class='line'>}
</span><span class='line'>EOF
</span><span class='line'>
</span><span class='line'>sudo systemctl enable docker
</span><span class='line'>sudo systemctl daemon-reload
</span><span class='line'>sudo systemctl restart docker
</span></code></pre></td></tr></table></div></figure>


<p>ä¿®æ”¹æ—¶åŒº</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo rm -rf /etc/localtime 
</span><span class='line'>sudo ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime </span></code></pre></td></tr></table></div></figure>


<h2>ä¸»èŠ‚ç‚¹å®‰è£…kubeadmå¹¶åŠ è½½dockeré•œåƒ</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## ä¿®æ”¹ä¸»æœºå
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo hostnamectl --static set-hostname k8s 
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo hostname k8s 
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ rz
</span><span class='line'>rz waiting to receive.
</span><span class='line'>Starting zmodem transfer.  Press Ctrl+C to cancel.
</span><span class='line'>Transferring ab0e12925be5251baf5dd3b31493663d46e4a7b458c7a5b6b717f4ae87a81bd4-kubeadm-1.23.5-0.x86_64.rpm...
</span><span class='line'>  100%    9253 KB    9253 KB/sec    00:00:01       0 Errors  
</span><span class='line'>Transferring d39aa6eb38a6a8326b7e88c622107327dfd02ac8aaae32eceb856643a2ad9981-kubelet-1.23.5-0.x86_64.rpm...
</span><span class='line'>  100%   21041 KB    21041 KB/sec    00:00:01       0 Errors  
</span><span class='line'>Transferring 4d300a7655f56307d35f127d99dc192b6aa4997f322234e754f16aaa60fd8906-cri-tools-1.23.0-0.x86_64.rpm...
</span><span class='line'>  100%    7228 KB    7228 KB/sec    00:00:01       0 Errors  
</span><span class='line'>Transferring db7cb5cb0b3f6875f54d10f02e625573988e3e91fd4fc5eef0b1876bb18604ad-kubernetes-cni-0.8.7-0.x86_64.rpm...
</span><span class='line'>  100%   19030 KB    19030 KB/sec    00:00:01       0 Errors  
</span><span class='line'>Transferring 96b208380314a19ded917eaf125ed748f5e2b28a3cc8707a10a76a9f5b61c0df-kubectl-1.23.5-0.x86_64.rpm...
</span><span class='line'>  100%    9689 KB    9689 KB/sec    00:00:01       0 Errors  
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ sudo yum install -y *.rpm
</span><span class='line'>Loaded plugins: langpacks, priorities, update-motd
</span><span class='line'>Examining 4d300a7655f56307d35f127d99dc192b6aa4997f322234e754f16aaa60fd8906-cri-tools-1.23.0-0.x86_64.rpm: cri-tools-1.23.0-0.x86_64
</span><span class='line'>Marking 4d300a7655f56307d35f127d99dc192b6aa4997f322234e754f16aaa60fd8906-cri-tools-1.23.0-0.x86_64.rpm to be installed
</span><span class='line'>Examining 96b208380314a19ded917eaf125ed748f5e2b28a3cc8707a10a76a9f5b61c0df-kubectl-1.23.5-0.x86_64.rpm: kubectl-1.23.5-0.x86_64
</span><span class='line'>Marking 96b208380314a19ded917eaf125ed748f5e2b28a3cc8707a10a76a9f5b61c0df-kubectl-1.23.5-0.x86_64.rpm to be installed
</span><span class='line'>Examining ab0e12925be5251baf5dd3b31493663d46e4a7b458c7a5b6b717f4ae87a81bd4-kubeadm-1.23.5-0.x86_64.rpm: kubeadm-1.23.5-0.x86_64
</span><span class='line'>Marking ab0e12925be5251baf5dd3b31493663d46e4a7b458c7a5b6b717f4ae87a81bd4-kubeadm-1.23.5-0.x86_64.rpm to be installed
</span><span class='line'>Examining d39aa6eb38a6a8326b7e88c622107327dfd02ac8aaae32eceb856643a2ad9981-kubelet-1.23.5-0.x86_64.rpm: kubelet-1.23.5-0.x86_64
</span><span class='line'>Marking d39aa6eb38a6a8326b7e88c622107327dfd02ac8aaae32eceb856643a2ad9981-kubelet-1.23.5-0.x86_64.rpm to be installed
</span><span class='line'>Examining db7cb5cb0b3f6875f54d10f02e625573988e3e91fd4fc5eef0b1876bb18604ad-kubernetes-cni-0.8.7-0.x86_64.rpm: kubernetes-cni-0.8.7-0.x86_64
</span><span class='line'>Marking db7cb5cb0b3f6875f54d10f02e625573988e3e91fd4fc5eef0b1876bb18604ad-kubernetes-cni-0.8.7-0.x86_64.rpm to be installed
</span><span class='line'>Resolving Dependencies
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package cri-tools.x86_64 0:1.23.0-0 will be installed
</span><span class='line'>---&gt; Package kubeadm.x86_64 0:1.23.5-0 will be installed
</span><span class='line'>---&gt; Package kubectl.x86_64 0:1.23.5-0 will be installed
</span><span class='line'>---&gt; Package kubelet.x86_64 0:1.23.5-0 will be installed
</span><span class='line'>--&gt; Processing Dependency: conntrack for package: kubelet-1.23.5-0.x86_64
</span><span class='line'>--&gt; Processing Dependency: ebtables for package: kubelet-1.23.5-0.x86_64
</span><span class='line'>--&gt; Processing Dependency: socat for package: kubelet-1.23.5-0.x86_64
</span><span class='line'>---&gt; Package kubernetes-cni.x86_64 0:0.8.7-0 will be installed
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package conntrack-tools.x86_64 0:1.4.4-5.amzn2.2 will be installed
</span><span class='line'>--&gt; Processing Dependency: libnetfilter_cttimeout.so.1(LIBNETFILTER_CTTIMEOUT_1.1)(64bit) for package: conntrack-tools-1.4.4-5.amzn2.2.x86_64
</span><span class='line'>--&gt; Processing Dependency: libnetfilter_cttimeout.so.1(LIBNETFILTER_CTTIMEOUT_1.0)(64bit) for package: conntrack-tools-1.4.4-5.amzn2.2.x86_64
</span><span class='line'>--&gt; Processing Dependency: libnetfilter_cthelper.so.0(LIBNETFILTER_CTHELPER_1.0)(64bit) for package: conntrack-tools-1.4.4-5.amzn2.2.x86_64
</span><span class='line'>--&gt; Processing Dependency: libnetfilter_queue.so.1()(64bit) for package: conntrack-tools-1.4.4-5.amzn2.2.x86_64
</span><span class='line'>--&gt; Processing Dependency: libnetfilter_cttimeout.so.1()(64bit) for package: conntrack-tools-1.4.4-5.amzn2.2.x86_64
</span><span class='line'>--&gt; Processing Dependency: libnetfilter_cthelper.so.0()(64bit) for package: conntrack-tools-1.4.4-5.amzn2.2.x86_64
</span><span class='line'>---&gt; Package ebtables.x86_64 0:2.0.10-16.amzn2.0.1 will be installed
</span><span class='line'>---&gt; Package socat.x86_64 0:1.7.3.2-2.amzn2.0.1 will be installed
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package libnetfilter_cthelper.x86_64 0:1.0.0-10.amzn2.1 will be installed
</span><span class='line'>---&gt; Package libnetfilter_cttimeout.x86_64 0:1.0.0-6.amzn2.1 will be installed
</span><span class='line'>---&gt; Package libnetfilter_queue.x86_64 0:1.0.2-2.amzn2.0.2 will be installed
</span><span class='line'>--&gt; Finished Dependency Resolution
</span><span class='line'>
</span><span class='line'>Dependencies Resolved
</span><span class='line'>
</span><span class='line'>======================================================================================================================================================
</span><span class='line'> Package                Arch   Version             Repository                                                                                    Size
</span><span class='line'>======================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> cri-tools              x86_64 1.23.0-0            /4d300a7655f56307d35f127d99dc192b6aa4997f322234e754f16aaa60fd8906-cri-tools-1.23.0-0.x86_64   34 M
</span><span class='line'> kubeadm                x86_64 1.23.5-0            /ab0e12925be5251baf5dd3b31493663d46e4a7b458c7a5b6b717f4ae87a81bd4-kubeadm-1.23.5-0.x86_64     43 M
</span><span class='line'> kubectl                x86_64 1.23.5-0            /96b208380314a19ded917eaf125ed748f5e2b28a3cc8707a10a76a9f5b61c0df-kubectl-1.23.5-0.x86_64     44 M
</span><span class='line'> kubelet                x86_64 1.23.5-0            /d39aa6eb38a6a8326b7e88c622107327dfd02ac8aaae32eceb856643a2ad9981-kubelet-1.23.5-0.x86_64    119 M
</span><span class='line'> kubernetes-cni         x86_64 0.8.7-0             /db7cb5cb0b3f6875f54d10f02e625573988e3e91fd4fc5eef0b1876bb18604ad-kubernetes-cni-0.8.7-0.x86_64
</span><span class='line'>                                                                                                                                                 55 M
</span><span class='line'>Installing for dependencies:
</span><span class='line'> conntrack-tools        x86_64 1.4.4-5.amzn2.2     amzn2-core                                                                                   186 k
</span><span class='line'> ebtables               x86_64 2.0.10-16.amzn2.0.1 amzn2-core                                                                                   122 k
</span><span class='line'> libnetfilter_cthelper  x86_64 1.0.0-10.amzn2.1    amzn2-core                                                                                    18 k
</span><span class='line'> libnetfilter_cttimeout x86_64 1.0.0-6.amzn2.1     amzn2-core                                                                                    18 k
</span><span class='line'> libnetfilter_queue     x86_64 1.0.2-2.amzn2.0.2   amzn2-core                                                                                    24 k
</span><span class='line'> socat                  x86_64 1.7.3.2-2.amzn2.0.1 amzn2-core                                                                                   291 k
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>======================================================================================================================================================
</span><span class='line'>Install  5 Packages (+6 Dependent packages)
</span><span class='line'>
</span><span class='line'>Total size: 296 M
</span><span class='line'>Total download size: 658 k
</span><span class='line'>Installed size: 298 M
</span><span class='line'>Downloading packages:
</span><span class='line'>(1/6): ebtables-2.0.10-16.amzn2.0.1.x86_64.rpm                                                                                 | 122 kB  00:00:10     
</span><span class='line'>(2/6): libnetfilter_cthelper-1.0.0-10.amzn2.1.x86_64.rpm                                                                       |  18 kB  00:00:00     
</span><span class='line'>(3/6): conntrack-tools-1.4.4-5.amzn2.2.x86_64.rpm                                                                              | 186 kB  00:00:10     
</span><span class='line'>(4/6): libnetfilter_cttimeout-1.0.0-6.amzn2.1.x86_64.rpm                                                                       |  18 kB  00:00:00     
</span><span class='line'>(5/6): libnetfilter_queue-1.0.2-2.amzn2.0.2.x86_64.rpm                                                                         |  24 kB  00:00:00     
</span><span class='line'>(6/6): socat-1.7.3.2-2.amzn2.0.1.x86_64.rpm                                                                                    | 291 kB  00:00:00     
</span><span class='line'>------------------------------------------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Total                                                                                                                  45 kB/s | 658 kB  00:00:14     
</span><span class='line'>Running transaction check
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded
</span><span class='line'>Running transaction
</span><span class='line'>  Installing : libnetfilter_cthelper-1.0.0-10.amzn2.1.x86_64                                                                                     1/11 
</span><span class='line'>  Installing : libnetfilter_cttimeout-1.0.0-6.amzn2.1.x86_64                                                                                     2/11 
</span><span class='line'>  Installing : libnetfilter_queue-1.0.2-2.amzn2.0.2.x86_64                                                                                       3/11 
</span><span class='line'>  Installing : conntrack-tools-1.4.4-5.amzn2.2.x86_64                                                                                            4/11 
</span><span class='line'>  Installing : ebtables-2.0.10-16.amzn2.0.1.x86_64                                                                                               5/11 
</span><span class='line'>  Installing : cri-tools-1.23.0-0.x86_64                                                                                                         6/11 
</span><span class='line'>  Installing : socat-1.7.3.2-2.amzn2.0.1.x86_64                                                                                                  7/11 
</span><span class='line'>  Installing : kubelet-1.23.5-0.x86_64                                                                                                           8/11 
</span><span class='line'>  Installing : kubernetes-cni-0.8.7-0.x86_64                                                                                                     9/11 
</span><span class='line'>  Installing : kubectl-1.23.5-0.x86_64                                                                                                          10/11 
</span><span class='line'>  Installing : kubeadm-1.23.5-0.x86_64                                                                                                          11/11 
</span><span class='line'>  Verifying  : kubernetes-cni-0.8.7-0.x86_64                                                                                                     1/11 
</span><span class='line'>  Verifying  : kubectl-1.23.5-0.x86_64                                                                                                           2/11 
</span><span class='line'>  Verifying  : socat-1.7.3.2-2.amzn2.0.1.x86_64                                                                                                  3/11 
</span><span class='line'>  Verifying  : cri-tools-1.23.0-0.x86_64                                                                                                         4/11 
</span><span class='line'>  Verifying  : ebtables-2.0.10-16.amzn2.0.1.x86_64                                                                                               5/11 
</span><span class='line'>  Verifying  : libnetfilter_queue-1.0.2-2.amzn2.0.2.x86_64                                                                                       6/11 
</span><span class='line'>  Verifying  : conntrack-tools-1.4.4-5.amzn2.2.x86_64                                                                                            7/11 
</span><span class='line'>  Verifying  : libnetfilter_cttimeout-1.0.0-6.amzn2.1.x86_64                                                                                     8/11 
</span><span class='line'>  Verifying  : kubeadm-1.23.5-0.x86_64                                                                                                           9/11 
</span><span class='line'>  Verifying  : kubelet-1.23.5-0.x86_64                                                                                                          10/11 
</span><span class='line'>  Verifying  : libnetfilter_cthelper-1.0.0-10.amzn2.1.x86_64                                                                                    11/11 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  cri-tools.x86_64 0:1.23.0-0   kubeadm.x86_64 0:1.23.5-0   kubectl.x86_64 0:1.23.5-0   kubelet.x86_64 0:1.23.5-0   kubernetes-cni.x86_64 0:0.8.7-0  
</span><span class='line'>
</span><span class='line'>Dependency Installed:
</span><span class='line'>  conntrack-tools.x86_64 0:1.4.4-5.amzn2.2          ebtables.x86_64 0:2.0.10-16.amzn2.0.1           libnetfilter_cthelper.x86_64 0:1.0.0-10.amzn2.1  
</span><span class='line'>  libnetfilter_cttimeout.x86_64 0:1.0.0-6.amzn2.1   libnetfilter_queue.x86_64 0:1.0.2-2.amzn2.0.2   socat.x86_64 0:1.7.3.2-2.amzn2.0.1               
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>[ec2-user@k8s ~]$ 
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ sudo yum install ebtables ethtool             
</span></code></pre></td></tr></table></div></figure>


<p>åŠ è½½dockeré•œåƒï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ docker load -i k8s.tar.gz 
</span><span class='line'>194a408e97d8: Loading layer [==================================================&gt;]  68.57MB/68.57MB
</span><span class='line'>2b8347a02bc5: Loading layer [==================================================&gt;]  1.509MB/1.509MB
</span><span class='line'>618b3e11ccba: Loading layer [==================================================&gt;]  44.17MB/44.17MB
</span><span class='line'>Loaded image: k8s.gcr.io/kube-proxy:v1.23.5
</span><span class='line'>5b1fa8e3e100: Loading layer [==================================================&gt;]  3.697MB/3.697MB
</span><span class='line'>83e216f0eb98: Loading layer [==================================================&gt;]  1.509MB/1.509MB
</span><span class='line'>a70573edad24: Loading layer [==================================================&gt;]  121.1MB/121.1MB
</span><span class='line'>Loaded image: k8s.gcr.io/kube-controller-manager:v1.23.5
</span><span class='line'>46576c5a6a97: Loading layer [==================================================&gt;]  49.63MB/49.63MB
</span><span class='line'>Loaded image: k8s.gcr.io/kube-scheduler:v1.23.5
</span><span class='line'>6d75f23be3dd: Loading layer [==================================================&gt;]  3.697MB/3.697MB
</span><span class='line'>b6e8c573c18d: Loading layer [==================================================&gt;]  2.257MB/2.257MB
</span><span class='line'>d80003ff5706: Loading layer [==================================================&gt;]    267MB/267MB
</span><span class='line'>664dd6f2834b: Loading layer [==================================================&gt;]  2.137MB/2.137MB
</span><span class='line'>62ae031121b1: Loading layer [==================================================&gt;]  18.86MB/18.86MB
</span><span class='line'>Loaded image: k8s.gcr.io/etcd:3.5.1-0
</span><span class='line'>256bc5c338a6: Loading layer [==================================================&gt;]  336.4kB/336.4kB
</span><span class='line'>80e4a2390030: Loading layer [==================================================&gt;]  46.62MB/46.62MB
</span><span class='line'>Loaded image: k8s.gcr.io/coredns/coredns:v1.8.6
</span><span class='line'>1021ef88c797: Loading layer [==================================================&gt;]  684.5kB/684.5kB
</span><span class='line'>Loaded image: k8s.gcr.io/pause:3.6
</span><span class='line'>50098fdfecae: Loading layer [==================================================&gt;]  131.3MB/131.3MB
</span><span class='line'>Loaded image: k8s.gcr.io/kube-apiserver:v1.23.5
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ docker images 
</span><span class='line'>REPOSITORY                           TAG       IMAGE ID       CREATED        SIZE
</span><span class='line'>k8s.gcr.io/kube-apiserver            v1.23.5   3fc1d62d6587   15 hours ago   135MB
</span><span class='line'>k8s.gcr.io/kube-proxy                v1.23.5   3c53fa8541f9   15 hours ago   112MB
</span><span class='line'>k8s.gcr.io/kube-controller-manager   v1.23.5   b0c9e5e4dbb1   15 hours ago   125MB
</span><span class='line'>k8s.gcr.io/kube-scheduler            v1.23.5   884d49d6d8c9   15 hours ago   53.5MB
</span><span class='line'>k8s.gcr.io/etcd                      3.5.1-0   25f8c7f3da61   4 months ago   293MB
</span><span class='line'>k8s.gcr.io/coredns/coredns           v1.8.6    a4ca41631cc7   5 months ago   46.8MB
</span><span class='line'>k8s.gcr.io/pause                     3.6       6270bb605e12   6 months ago   683kB
</span><span class='line'>[ec2-user@k8s ~]$ 
</span></code></pre></td></tr></table></div></figure>


<h2>ä¸»èŠ‚ç‚¹(æ§åˆ¶å¹³é¢control-plane node)å¯åŠ¨æœåŠ¡</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ sudo su - 
</span><span class='line'>
</span><span class='line'>[root@k8s ~]# kubeadm init 
</span><span class='line'>[init] Using Kubernetes version: v1.23.5
</span><span class='line'>[preflight] Running pre-flight checks
</span><span class='line'>        [WARNING FileExisting-tc]: tc not found in system path
</span><span class='line'>        [WARNING Hostname]: hostname "k8s" could not be reached
</span><span class='line'>        [WARNING Hostname]: hostname "k8s": lookup k8s on 192.168.191.2:53: no such host
</span><span class='line'>        [WARNING Service-Kubelet]: kubelet service is not enabled, please run 'systemctl enable kubelet.service'
</span><span class='line'>[preflight] Pulling images required for setting up a Kubernetes cluster
</span><span class='line'>[preflight] This might take a minute or two, depending on the speed of your internet connection
</span><span class='line'>[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'
</span><span class='line'>[certs] Using certificateDir folder "/etc/kubernetes/pki"
</span><span class='line'>[certs] Generating "ca" certificate and key
</span><span class='line'>[certs] Generating "apiserver" certificate and key
</span><span class='line'>[certs] apiserver serving cert is signed for DNS names [k8s kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.191.131]
</span><span class='line'>[certs] Generating "apiserver-kubelet-client" certificate and key
</span><span class='line'>[certs] Generating "front-proxy-ca" certificate and key
</span><span class='line'>[certs] Generating "front-proxy-client" certificate and key
</span><span class='line'>[certs] Generating "etcd/ca" certificate and key
</span><span class='line'>[certs] Generating "etcd/server" certificate and key
</span><span class='line'>[certs] etcd/server serving cert is signed for DNS names [k8s localhost] and IPs [192.168.191.131 127.0.0.1 ::1]
</span><span class='line'>[certs] Generating "etcd/peer" certificate and key
</span><span class='line'>[certs] etcd/peer serving cert is signed for DNS names [k8s localhost] and IPs [192.168.191.131 127.0.0.1 ::1]
</span><span class='line'>[certs] Generating "etcd/healthcheck-client" certificate and key
</span><span class='line'>[certs] Generating "apiserver-etcd-client" certificate and key
</span><span class='line'>[certs] Generating "sa" key and public key
</span><span class='line'>[kubeconfig] Using kubeconfig folder "/etc/kubernetes"
</span><span class='line'>[kubeconfig] Writing "admin.conf" kubeconfig file
</span><span class='line'>[kubeconfig] Writing "kubelet.conf" kubeconfig file
</span><span class='line'>[kubeconfig] Writing "controller-manager.conf" kubeconfig file
</span><span class='line'>[kubeconfig] Writing "scheduler.conf" kubeconfig file
</span><span class='line'>[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"
</span><span class='line'>[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"
</span><span class='line'>[kubelet-start] Starting the kubelet
</span><span class='line'>[control-plane] Using manifest folder "/etc/kubernetes/manifests"
</span><span class='line'>[control-plane] Creating static Pod manifest for "kube-apiserver"
</span><span class='line'>[control-plane] Creating static Pod manifest for "kube-controller-manager"
</span><span class='line'>[control-plane] Creating static Pod manifest for "kube-scheduler"
</span><span class='line'>[etcd] Creating static Pod manifest for local etcd in "/etc/kubernetes/manifests"
</span><span class='line'>[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory "/etc/kubernetes/manifests". This can take up to 4m0s
</span><span class='line'>[kubelet-check] Initial timeout of 40s passed.
</span><span class='line'>[apiclient] All control plane components are healthy after 87.001525 seconds
</span><span class='line'>[upload-config] Storing the configuration used in ConfigMap "kubeadm-config" in the "kube-system" Namespace
</span><span class='line'>[kubelet] Creating a ConfigMap "kubelet-config-1.23" in namespace kube-system with the configuration for the kubelets in the cluster
</span><span class='line'>NOTE: The "kubelet-config-1.23" naming of the kubelet ConfigMap is deprecated. Once the UnversionedKubeletConfigMap feature gate graduates to Beta the default name will become just "kubelet-config". Kubeadm upgrade will handle this transition transparently.
</span><span class='line'>[upload-certs] Skipping phase. Please see --upload-certs
</span><span class='line'>[mark-control-plane] Marking the node k8s as control-plane by adding the labels: [node-role.kubernetes.io/master(deprecated) node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]
</span><span class='line'>[mark-control-plane] Marking the node k8s as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]
</span><span class='line'>[bootstrap-token] Using token: sj6fff.bpak7gkd3hnyzcm5
</span><span class='line'>[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
</span><span class='line'>[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes
</span><span class='line'>[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
</span><span class='line'>[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
</span><span class='line'>[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
</span><span class='line'>[bootstrap-token] Creating the "cluster-info" ConfigMap in the "kube-public" namespace
</span><span class='line'>[kubelet-finalize] Updating "/etc/kubernetes/kubelet.conf" to point to a rotatable kubelet client certificate and key
</span><span class='line'>[addons] Applied essential addon: CoreDNS
</span><span class='line'>[addons] Applied essential addon: kube-proxy
</span><span class='line'>
</span><span class='line'>Your Kubernetes control-plane has initialized successfully!
</span><span class='line'>
</span><span class='line'>To start using your cluster, you need to run the following as a regular user:
</span><span class='line'>
</span><span class='line'>  mkdir -p $HOME/.kube
</span><span class='line'>  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span><span class='line'>  sudo chown $(id -u):$(id -g) $HOME/.kube/config
</span><span class='line'>
</span><span class='line'>Alternatively, if you are the root user, you can run:
</span><span class='line'>
</span><span class='line'>  export KUBECONFIG=/etc/kubernetes/admin.conf
</span><span class='line'>
</span><span class='line'>You should now deploy a pod network to the cluster.
</span><span class='line'>Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:
</span><span class='line'>  https://kubernetes.io/docs/concepts/cluster-administration/addons/
</span><span class='line'>
</span><span class='line'>Then you can join any number of worker nodes by running the following on each as root:
</span><span class='line'>
</span><span class='line'>kubeadm join 192.168.191.131:6443 --token sj6fff.bpak7gkd3hnyzcm5 \
</span><span class='line'>        --discovery-token-ca-cert-hash sha256:8e15649afc0771e80cce7f1dfdbb0933f4fdbd45ea1f9e03be1f3b78449a6d3c 
</span><span class='line'>[root@k8s ~]# 
</span></code></pre></td></tr></table></div></figure>


<p>æ™®é€šç”¨æˆ·é…ç½®kubectlï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ mkdir -p $HOME/.kube
</span><span class='line'>[ec2-user@k8s ~]$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span><span class='line'>[ec2-user@k8s ~]$ sudo chown $(id -u):$(id -g) $HOME/.kube/config
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ which kubectl
</span><span class='line'>/usr/bin/kubectl
</span><span class='line'>[ec2-user@k8s ~]$ 
</span><span class='line'>[ec2-user@k8s ~]$ kubectl cluster-info
</span><span class='line'>Kubernetes control plane is running at https://192.168.191.131:6443
</span><span class='line'>CoreDNS is running at https://192.168.191.131:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</span><span class='line'>
</span><span class='line'>To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get nodes -o wide
</span><span class='line'>NAME   STATUS     ROLES                  AGE   VERSION   INTERNAL-IP       EXTERNAL-IP   OS-IMAGE         KERNEL-VERSION                  CONTAINER-RUNTIME
</span><span class='line'>k8s    NotReady   control-plane,master   14m   v1.23.5   192.168.191.131   &lt;none&gt;        Amazon Linux 2   4.14.268-205.500.amzn2.x86_64   docker://20.10.7
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pods --all-namespaces -o wide
</span><span class='line'>NAMESPACE     NAME                          READY   STATUS    RESTARTS   AGE   IP                NODE     NOMINATED NODE   READINESS GATES
</span><span class='line'>kube-system   coredns-64897985d-pcxpd       0/1     Pending   0          14m   &lt;none&gt;            &lt;none&gt;   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   coredns-64897985d-pfsj6       0/1     Pending   0          14m   &lt;none&gt;            &lt;none&gt;   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   etcd-k8s                      1/1     Running   0          14m   192.168.191.131   k8s      &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   kube-apiserver-k8s            1/1     Running   0          14m   192.168.191.131   k8s      &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   kube-controller-manager-k8s   1/1     Running   0          14m   192.168.191.131   k8s      &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   kube-proxy-qj6lw              1/1     Running   0          14m   192.168.191.131   k8s      &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   kube-scheduler-k8s            1/1     Running   0          14m   192.168.191.131   k8s      &lt;none&gt;           &lt;none&gt;
</span><span class='line'>[ec2-user@k8s ~]$ 
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœå¸Œæœ›ä¸»èŠ‚ç‚¹ï¼ˆæ§åˆ¶å¹³é¢èŠ‚ç‚¹control-plane node)ä¸Šä¹Ÿè°ƒåº¦ Podï¼Œ ä¾‹å¦‚ç”¨äºå¼€å‘çš„å•æœº Kubernetes é›†ç¾¤ï¼Œè¯·è¿è¡Œï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@k8s ~]# export KUBECONFIG=/etc/kubernetes/admin.conf
</span><span class='line'>[root@k8s ~]# kubectl taint nodes --all node-role.kubernetes.io/master-
</span><span class='line'>node/k8s untainted
</span><span class='line'>[root@k8s ~]# 
</span></code></pre></td></tr></table></div></figure>


<h2>åŠ å…¥å·¥ä½œèŠ‚ç‚¹(nodes)</h2>

<p>å…ˆæŠŠdockerå®‰è£…å¥½ï¼Œä»¥åŠç³»ç»ŸåŸºç¡€é…ç½®ï¼Œå‚è€ƒä¸Šé¢çš„æ­¥éª¤ã€‚ç„¶åå®‰è£…kubeadmï¼Œä»¥åŠåŠ è½½gcrçš„dockeré•œåƒã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@amazonlinux ~]$ ll
</span><span class='line'>total 285480
</span><span class='line'>-rw-r--r-- 1 ec2-user ec2-user   7401938 Mar 17 15:22 4d300a7655f56307d35f127d99dc192b6aa4997f322234e754f16aaa60fd8906-cri-tools-1.23.0-0.x86_64.rpm
</span><span class='line'>-rw-r--r-- 1 ec2-user ec2-user   9921646 Mar 17 15:22 96b208380314a19ded917eaf125ed748f5e2b28a3cc8707a10a76a9f5b61c0df-kubectl-1.23.5-0.x86_64.rpm
</span><span class='line'>-rw-r--r-- 1 ec2-user ec2-user   9475514 Mar 17 15:22 ab0e12925be5251baf5dd3b31493663d46e4a7b458c7a5b6b717f4ae87a81bd4-kubeadm-1.23.5-0.x86_64.rpm
</span><span class='line'>-rw-r--r-- 1 ec2-user ec2-user  21546750 Mar 17 15:22 d39aa6eb38a6a8326b7e88c622107327dfd02ac8aaae32eceb856643a2ad9981-kubelet-1.23.5-0.x86_64.rpm
</span><span class='line'>-rw-r--r-- 1 ec2-user ec2-user  19487362 Mar 17 15:22 db7cb5cb0b3f6875f54d10f02e625573988e3e91fd4fc5eef0b1876bb18604ad-kubernetes-cni-0.8.7-0.x86_64.rpm
</span><span class='line'>-rw-r--r-- 1 ec2-user ec2-user 224482960 Mar 17 15:22 k8s.tar.gz
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo yum install *.rpm 
</span><span class='line'>Loaded plugins: langpacks, priorities, update-motd
</span><span class='line'>Examining 4d300a7655f56307d35f127d99dc192b6aa4997f322234e754f16aaa60fd8906-cri-tools-1.23.0-0.x86_64.rpm: cri-tools-1.23.0-0.x86_64
</span><span class='line'>Marking 4d300a7655f56307d35f127d99dc192b6aa4997f322234e754f16aaa60fd8906-cri-tools-1.23.0-0.x86_64.rpm to be installed
</span><span class='line'>Examining 96b208380314a19ded917eaf125ed748f5e2b28a3cc8707a10a76a9f5b61c0df-kubectl-1.23.5-0.x86_64.rpm: kubectl-1.23.5-0.x86_64
</span><span class='line'>Marking 96b208380314a19ded917eaf125ed748f5e2b28a3cc8707a10a76a9f5b61c0df-kubectl-1.23.5-0.x86_64.rpm to be installed
</span><span class='line'>Examining ab0e12925be5251baf5dd3b31493663d46e4a7b458c7a5b6b717f4ae87a81bd4-kubeadm-1.23.5-0.x86_64.rpm: kubeadm-1.23.5-0.x86_64
</span><span class='line'>Marking ab0e12925be5251baf5dd3b31493663d46e4a7b458c7a5b6b717f4ae87a81bd4-kubeadm-1.23.5-0.x86_64.rpm to be installed
</span><span class='line'>Examining d39aa6eb38a6a8326b7e88c622107327dfd02ac8aaae32eceb856643a2ad9981-kubelet-1.23.5-0.x86_64.rpm: kubelet-1.23.5-0.x86_64
</span><span class='line'>Marking d39aa6eb38a6a8326b7e88c622107327dfd02ac8aaae32eceb856643a2ad9981-kubelet-1.23.5-0.x86_64.rpm to be installed
</span><span class='line'>Examining db7cb5cb0b3f6875f54d10f02e625573988e3e91fd4fc5eef0b1876bb18604ad-kubernetes-cni-0.8.7-0.x86_64.rpm: kubernetes-cni-0.8.7-0.x86_64
</span><span class='line'>Marking db7cb5cb0b3f6875f54d10f02e625573988e3e91fd4fc5eef0b1876bb18604ad-kubernetes-cni-0.8.7-0.x86_64.rpm to be installed
</span><span class='line'>Resolving Dependencies
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package cri-tools.x86_64 0:1.23.0-0 will be installed
</span><span class='line'>---&gt; Package kubeadm.x86_64 0:1.23.5-0 will be installed
</span><span class='line'>---&gt; Package kubectl.x86_64 0:1.23.5-0 will be installed
</span><span class='line'>---&gt; Package kubelet.x86_64 0:1.23.5-0 will be installed
</span><span class='line'>--&gt; Processing Dependency: conntrack for package: kubelet-1.23.5-0.x86_64
</span><span class='line'>amzn2-core                                                                                                                                  | 3.7 kB  00:00:00     
</span><span class='line'>--&gt; Processing Dependency: ebtables for package: kubelet-1.23.5-0.x86_64
</span><span class='line'>--&gt; Processing Dependency: socat for package: kubelet-1.23.5-0.x86_64
</span><span class='line'>---&gt; Package kubernetes-cni.x86_64 0:0.8.7-0 will be installed
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package conntrack-tools.x86_64 0:1.4.4-5.amzn2.2 will be installed
</span><span class='line'>--&gt; Processing Dependency: libnetfilter_cttimeout.so.1(LIBNETFILTER_CTTIMEOUT_1.1)(64bit) for package: conntrack-tools-1.4.4-5.amzn2.2.x86_64
</span><span class='line'>--&gt; Processing Dependency: libnetfilter_cttimeout.so.1(LIBNETFILTER_CTTIMEOUT_1.0)(64bit) for package: conntrack-tools-1.4.4-5.amzn2.2.x86_64
</span><span class='line'>--&gt; Processing Dependency: libnetfilter_cthelper.so.0(LIBNETFILTER_CTHELPER_1.0)(64bit) for package: conntrack-tools-1.4.4-5.amzn2.2.x86_64
</span><span class='line'>--&gt; Processing Dependency: libnetfilter_queue.so.1()(64bit) for package: conntrack-tools-1.4.4-5.amzn2.2.x86_64
</span><span class='line'>--&gt; Processing Dependency: libnetfilter_cttimeout.so.1()(64bit) for package: conntrack-tools-1.4.4-5.amzn2.2.x86_64
</span><span class='line'>--&gt; Processing Dependency: libnetfilter_cthelper.so.0()(64bit) for package: conntrack-tools-1.4.4-5.amzn2.2.x86_64
</span><span class='line'>---&gt; Package ebtables.x86_64 0:2.0.10-16.amzn2.0.1 will be installed
</span><span class='line'>---&gt; Package socat.x86_64 0:1.7.3.2-2.amzn2.0.1 will be installed
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package libnetfilter_cthelper.x86_64 0:1.0.0-10.amzn2.1 will be installed
</span><span class='line'>---&gt; Package libnetfilter_cttimeout.x86_64 0:1.0.0-6.amzn2.1 will be installed
</span><span class='line'>---&gt; Package libnetfilter_queue.x86_64 0:1.0.2-2.amzn2.0.2 will be installed
</span><span class='line'>--&gt; Finished Dependency Resolution
</span><span class='line'>
</span><span class='line'>Dependencies Resolved
</span><span class='line'>
</span><span class='line'>===================================================================================================================================================================
</span><span class='line'> Package                  Arch     Version                 Repository                                                                                         Size
</span><span class='line'>===================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> cri-tools                x86_64   1.23.0-0                /4d300a7655f56307d35f127d99dc192b6aa4997f322234e754f16aaa60fd8906-cri-tools-1.23.0-0.x86_64        34 M
</span><span class='line'> kubeadm                  x86_64   1.23.5-0                /ab0e12925be5251baf5dd3b31493663d46e4a7b458c7a5b6b717f4ae87a81bd4-kubeadm-1.23.5-0.x86_64          43 M
</span><span class='line'> kubectl                  x86_64   1.23.5-0                /96b208380314a19ded917eaf125ed748f5e2b28a3cc8707a10a76a9f5b61c0df-kubectl-1.23.5-0.x86_64          44 M
</span><span class='line'> kubelet                  x86_64   1.23.5-0                /d39aa6eb38a6a8326b7e88c622107327dfd02ac8aaae32eceb856643a2ad9981-kubelet-1.23.5-0.x86_64         119 M
</span><span class='line'> kubernetes-cni           x86_64   0.8.7-0                 /db7cb5cb0b3f6875f54d10f02e625573988e3e91fd4fc5eef0b1876bb18604ad-kubernetes-cni-0.8.7-0.x86_64    55 M
</span><span class='line'>Installing for dependencies:
</span><span class='line'> conntrack-tools          x86_64   1.4.4-5.amzn2.2         amzn2-core                                                                                        186 k
</span><span class='line'> ebtables                 x86_64   2.0.10-16.amzn2.0.1     amzn2-core                                                                                        122 k
</span><span class='line'> libnetfilter_cthelper    x86_64   1.0.0-10.amzn2.1        amzn2-core                                                                                         18 k
</span><span class='line'> libnetfilter_cttimeout   x86_64   1.0.0-6.amzn2.1         amzn2-core                                                                                         18 k
</span><span class='line'> libnetfilter_queue       x86_64   1.0.2-2.amzn2.0.2       amzn2-core                                                                                         24 k
</span><span class='line'> socat                    x86_64   1.7.3.2-2.amzn2.0.1     amzn2-core                                                                                        291 k
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>===================================================================================================================================================================
</span><span class='line'>Install  5 Packages (+6 Dependent packages)
</span><span class='line'>
</span><span class='line'>Total size: 296 M
</span><span class='line'>Total download size: 658 k
</span><span class='line'>Installed size: 298 M
</span><span class='line'>Is this ok [y/d/N]: y
</span><span class='line'>Downloading packages:
</span><span class='line'>(1/6): ebtables-2.0.10-16.amzn2.0.1.x86_64.rpm                                                                                              | 122 kB  00:00:00     
</span><span class='line'>(2/6): libnetfilter_cthelper-1.0.0-10.amzn2.1.x86_64.rpm                                                                                    |  18 kB  00:00:00     
</span><span class='line'>(3/6): libnetfilter_cttimeout-1.0.0-6.amzn2.1.x86_64.rpm                                                                                    |  18 kB  00:00:00     
</span><span class='line'>(4/6): conntrack-tools-1.4.4-5.amzn2.2.x86_64.rpm                                                                                           | 186 kB  00:00:00     
</span><span class='line'>(5/6): libnetfilter_queue-1.0.2-2.amzn2.0.2.x86_64.rpm                                                                                      |  24 kB  00:00:00     
</span><span class='line'>(6/6): socat-1.7.3.2-2.amzn2.0.1.x86_64.rpm                                                                                                 | 291 kB  00:00:00     
</span><span class='line'>-------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Total                                                                                                                              1.0 MB/s | 658 kB  00:00:00     
</span><span class='line'>Running transaction check
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded
</span><span class='line'>Running transaction
</span><span class='line'>  Installing : libnetfilter_cthelper-1.0.0-10.amzn2.1.x86_64                                                                                                  1/11 
</span><span class='line'>  Installing : libnetfilter_cttimeout-1.0.0-6.amzn2.1.x86_64                                                                                                  2/11 
</span><span class='line'>  Installing : libnetfilter_queue-1.0.2-2.amzn2.0.2.x86_64                                                                                                    3/11 
</span><span class='line'>  Installing : conntrack-tools-1.4.4-5.amzn2.2.x86_64                                                                                                         4/11 
</span><span class='line'>  Installing : ebtables-2.0.10-16.amzn2.0.1.x86_64                                                                                                            5/11 
</span><span class='line'>  Installing : cri-tools-1.23.0-0.x86_64                                                                                                                      6/11 
</span><span class='line'>  Installing : socat-1.7.3.2-2.amzn2.0.1.x86_64                                                                                                               7/11 
</span><span class='line'>  Installing : kubelet-1.23.5-0.x86_64                                                                                                                        8/11 
</span><span class='line'>  Installing : kubernetes-cni-0.8.7-0.x86_64                                                                                                                  9/11 
</span><span class='line'>  Installing : kubectl-1.23.5-0.x86_64                                                                                                                       10/11 
</span><span class='line'>  Installing : kubeadm-1.23.5-0.x86_64                                                                                                                       11/11 
</span><span class='line'>  Verifying  : kubernetes-cni-0.8.7-0.x86_64                                                                                                                  1/11 
</span><span class='line'>  Verifying  : kubectl-1.23.5-0.x86_64                                                                                                                        2/11 
</span><span class='line'>  Verifying  : socat-1.7.3.2-2.amzn2.0.1.x86_64                                                                                                               3/11 
</span><span class='line'>  Verifying  : cri-tools-1.23.0-0.x86_64                                                                                                                      4/11 
</span><span class='line'>  Verifying  : ebtables-2.0.10-16.amzn2.0.1.x86_64                                                                                                            5/11 
</span><span class='line'>  Verifying  : libnetfilter_queue-1.0.2-2.amzn2.0.2.x86_64                                                                                                    6/11 
</span><span class='line'>  Verifying  : conntrack-tools-1.4.4-5.amzn2.2.x86_64                                                                                                         7/11 
</span><span class='line'>  Verifying  : libnetfilter_cttimeout-1.0.0-6.amzn2.1.x86_64                                                                                                  8/11 
</span><span class='line'>  Verifying  : kubeadm-1.23.5-0.x86_64                                                                                                                        9/11 
</span><span class='line'>  Verifying  : kubelet-1.23.5-0.x86_64                                                                                                                       10/11 
</span><span class='line'>  Verifying  : libnetfilter_cthelper-1.0.0-10.amzn2.1.x86_64                                                                                                 11/11 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  cri-tools.x86_64 0:1.23.0-0     kubeadm.x86_64 0:1.23.5-0     kubectl.x86_64 0:1.23.5-0     kubelet.x86_64 0:1.23.5-0     kubernetes-cni.x86_64 0:0.8.7-0    
</span><span class='line'>
</span><span class='line'>Dependency Installed:
</span><span class='line'>  conntrack-tools.x86_64 0:1.4.4-5.amzn2.2              ebtables.x86_64 0:2.0.10-16.amzn2.0.1               libnetfilter_cthelper.x86_64 0:1.0.0-10.amzn2.1      
</span><span class='line'>  libnetfilter_cttimeout.x86_64 0:1.0.0-6.amzn2.1       libnetfilter_queue.x86_64 0:1.0.2-2.amzn2.0.2       socat.x86_64 0:1.7.3.2-2.amzn2.0.1                   
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo yum install ebtables ethtool  
</span><span class='line'>Loaded plugins: langpacks, priorities, update-motd
</span><span class='line'>Package ebtables-2.0.10-16.amzn2.0.1.x86_64 already installed and latest version
</span><span class='line'>Package 2:ethtool-4.8-10.amzn2.x86_64 already installed and latest version
</span><span class='line'>Nothing to do
</span></code></pre></td></tr></table></div></figure>


<p>åŠ è½½dockeré•œåƒ</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ docker load -i k8s.tar.gz 
</span><span class='line'>194a408e97d8: Loading layer [==================================================&gt;]  68.57MB/68.57MB
</span><span class='line'>2b8347a02bc5: Loading layer [==================================================&gt;]  1.509MB/1.509MB
</span><span class='line'>618b3e11ccba: Loading layer [==================================================&gt;]  44.17MB/44.17MB
</span><span class='line'>Loaded image: k8s.gcr.io/kube-proxy:v1.23.5
</span><span class='line'>5b1fa8e3e100: Loading layer [==================================================&gt;]  3.697MB/3.697MB
</span><span class='line'>83e216f0eb98: Loading layer [==================================================&gt;]  1.509MB/1.509MB
</span><span class='line'>a70573edad24: Loading layer [==================================================&gt;]  121.1MB/121.1MB
</span><span class='line'>Loaded image: k8s.gcr.io/kube-controller-manager:v1.23.5
</span><span class='line'>46576c5a6a97: Loading layer [==================================================&gt;]  49.63MB/49.63MB
</span><span class='line'>Loaded image: k8s.gcr.io/kube-scheduler:v1.23.5
</span><span class='line'>6d75f23be3dd: Loading layer [==================================================&gt;]  3.697MB/3.697MB
</span><span class='line'>b6e8c573c18d: Loading layer [==================================================&gt;]  2.257MB/2.257MB
</span><span class='line'>d80003ff5706: Loading layer [==================================================&gt;]    267MB/267MB
</span><span class='line'>664dd6f2834b: Loading layer [==================================================&gt;]  2.137MB/2.137MB
</span><span class='line'>62ae031121b1: Loading layer [==================================================&gt;]  18.86MB/18.86MB
</span><span class='line'>Loaded image: k8s.gcr.io/etcd:3.5.1-0
</span><span class='line'>256bc5c338a6: Loading layer [==================================================&gt;]  336.4kB/336.4kB
</span><span class='line'>80e4a2390030: Loading layer [==================================================&gt;]  46.62MB/46.62MB
</span><span class='line'>Loaded image: k8s.gcr.io/coredns/coredns:v1.8.6
</span><span class='line'>1021ef88c797: Loading layer [==================================================&gt;]  684.5kB/684.5kB
</span><span class='line'>Loaded image: k8s.gcr.io/pause:3.6
</span><span class='line'>50098fdfecae: Loading layer [==================================================&gt;]  131.3MB/131.3MB
</span><span class='line'>Loaded image: k8s.gcr.io/kube-apiserver:v1.23.5
</span><span class='line'>
</span><span class='line'>[ec2-user@amazonlinux ~]$ docker images 
</span><span class='line'>REPOSITORY                           TAG       IMAGE ID       CREATED        SIZE
</span><span class='line'>k8s.gcr.io/kube-apiserver            v1.23.5   3fc1d62d6587   15 hours ago   135MB
</span><span class='line'>k8s.gcr.io/kube-proxy                v1.23.5   3c53fa8541f9   15 hours ago   112MB
</span><span class='line'>k8s.gcr.io/kube-controller-manager   v1.23.5   b0c9e5e4dbb1   15 hours ago   125MB
</span><span class='line'>k8s.gcr.io/kube-scheduler            v1.23.5   884d49d6d8c9   15 hours ago   53.5MB
</span><span class='line'>k8s.gcr.io/etcd                      3.5.1-0   25f8c7f3da61   4 months ago   293MB
</span><span class='line'>k8s.gcr.io/coredns/coredns           v1.8.6    a4ca41631cc7   5 months ago   46.8MB
</span><span class='line'>k8s.gcr.io/pause                     3.6       6270bb605e12   6 months ago   683kB
</span><span class='line'>[ec2-user@amazonlinux ~]$ 
</span></code></pre></td></tr></table></div></figure>


<p>ä¸­é—´å‡ºäº†ä¸ªå°æ’æ›²ï¼Œä¸€å¼€å§‹æ²¡æœ‰æ”¹ä¸»æœºåï¼Œå¯¼è‡´åŠ å…¥èŠ‚ç‚¹çš„æ—¶åˆ»ç”¨çš„æ˜¯é»˜è®¤çš„ï¼Œè¿™æ ·çœ‹èµ·æ¥ä¸æ¸…æ™°ï¼Œåé¢æ”¹äº†åç§°åå°±ä¸è®¤äº†ã€‚å¾—é‡æ–°å¼„ä¸€éã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## åŠ å…¥èŠ‚ç‚¹
</span><span class='line'>[ec2-user@amazonlinux ~]$ sudo su -
</span><span class='line'>[root@amazonlinux ~]# kubeadm join 192.168.191.131:6443 --token sj6fff.bpak7gkd3hnyzcm5 \
</span><span class='line'>         --discovery-token-ca-cert-hash sha256:8e15649afc0771e80cce7f1dfdbb0933f4fdbd45ea1f9e03be1f3b78449a6d3c 
</span><span class='line'>[preflight] Running pre-flight checks
</span><span class='line'>        [WARNING FileExisting-tc]: tc not found in system path
</span><span class='line'>        [WARNING Hostname]: hostname "amazonlinux.onprem" could not be reached
</span><span class='line'>        [WARNING Hostname]: hostname "amazonlinux.onprem": lookup amazonlinux.onprem on 192.168.191.2:53: no such host
</span><span class='line'>        [WARNING Service-Kubelet]: kubelet service is not enabled, please run 'systemctl enable kubelet.service'
</span><span class='line'>[preflight] Reading configuration from the cluster...
</span><span class='line'>[preflight] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'
</span><span class='line'>[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"
</span><span class='line'>[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"
</span><span class='line'>[kubelet-start] Starting the kubelet
</span><span class='line'>[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...
</span><span class='line'>
</span><span class='line'>This node has joined the cluster:
</span><span class='line'>* Certificate signing request was sent to apiserver and a response was received.
</span><span class='line'>* The Kubelet was informed of the new secure connection details.
</span><span class='line'>
</span><span class='line'>Run 'kubectl get nodes' on the control-plane to see this node join the cluster.
</span><span class='line'>
</span><span class='line'>[root@amazonlinux ~]# 
</span><span class='line'>
</span><span class='line'>## æ”¹ä¸‹ä¸»æœºåç§°ï¼š
</span><span class='line'>[root@amazonlinux ~]# hostnamectl --static set-hostname worker1
</span><span class='line'>[root@amazonlinux ~]# hostname worker1
</span><span class='line'>[root@amazonlinux ~]# exit
</span><span class='line'>
</span><span class='line'>## æ”¹äº†ä¸€ä¸‹åï¼Œé‡å¯åä¸è¡Œäº†ï¼Œé‡æ–°åŠ å…¥
</span><span class='line'>[ec2-user@worker1 ~]$ sudo su - 
</span><span class='line'>Last login: Thu Mar 17 15:24:32 CST 2022 on pts/0
</span><span class='line'>
</span><span class='line'>[root@worker1 ~]# kubeadm join 192.168.191.131:6443 --token sj6fff.bpak7gkd3hnyzcm5 \
</span><span class='line'>          --discovery-token-ca-cert-hash sha256:8e15649afc0771e80cce7f1dfdbb0933f4fdbd45ea1f9e03be1f3b78449a6d3c 
</span><span class='line'>[preflight] Running pre-flight checks
</span><span class='line'>        [WARNING FileExisting-tc]: tc not found in system path
</span><span class='line'>        [WARNING Hostname]: hostname "worker1" could not be reached
</span><span class='line'>        [WARNING Hostname]: hostname "worker1": lookup worker1 on 192.168.191.2:53: no such host
</span><span class='line'>        [WARNING Service-Kubelet]: kubelet service is not enabled, please run 'systemctl enable kubelet.service'
</span><span class='line'>error execution phase preflight: [preflight] Some fatal errors occurred:
</span><span class='line'>        [ERROR FileAvailable--etc-kubernetes-kubelet.conf]: /etc/kubernetes/kubelet.conf already exists
</span><span class='line'>        [ERROR Port-10250]: Port 10250 is in use
</span><span class='line'>        [ERROR FileAvailable--etc-kubernetes-pki-ca.crt]: /etc/kubernetes/pki/ca.crt already exists
</span><span class='line'>[preflight] If you know what you are doing, you can make a check non-fatal with `--ignore-preflight-errors=...`
</span><span class='line'>To see the stack trace of this error execute with --v=5 or higher
</span><span class='line'>
</span><span class='line'>## ç›´æ¥é‡æ–°åŠ å…¥ä¸è¡Œï¼Œéœ€è¦å…ˆé‡ç½®å†åŠ å…¥
</span><span class='line'>[root@worker1 ~]# kubeadm reset 
</span><span class='line'>[reset] WARNING: Changes made to this host by 'kubeadm init' or 'kubeadm join' will be reverted.
</span><span class='line'>[reset] Are you sure you want to proceed? [y/N]: y
</span><span class='line'>[preflight] Running pre-flight checks
</span><span class='line'>W0317 17:42:03.050519    6887 removeetcdmember.go:80] [reset] No kubeadm config, using etcd pod spec to get data directory
</span><span class='line'>[reset] No etcd config found. Assuming external etcd
</span><span class='line'>[reset] Please, manually reset etcd to prevent further issues
</span><span class='line'>[reset] Stopping the kubelet service
</span><span class='line'>[reset] Unmounting mounted directories in "/var/lib/kubelet"
</span><span class='line'>[reset] Deleting contents of config directories: [/etc/kubernetes/manifests /etc/kubernetes/pki]
</span><span class='line'>[reset] Deleting files: [/etc/kubernetes/admin.conf /etc/kubernetes/kubelet.conf /etc/kubernetes/bootstrap-kubelet.conf /etc/kubernetes/controller-manager.conf /etc/kubernetes/scheduler.conf]
</span><span class='line'>[reset] Deleting contents of stateful directories: [/var/lib/kubelet /var/lib/dockershim /var/run/kubernetes /var/lib/cni]
</span><span class='line'>
</span><span class='line'>The reset process does not clean CNI configuration. To do so, you must remove /etc/cni/net.d
</span><span class='line'>
</span><span class='line'>The reset process does not reset or clean up iptables rules or IPVS tables.
</span><span class='line'>If you wish to reset iptables, you must do so manually by using the "iptables" command.
</span><span class='line'>
</span><span class='line'>If your cluster was setup to utilize IPVS, run ipvsadm --clear (or similar)
</span><span class='line'>to reset your system's IPVS tables.
</span><span class='line'>
</span><span class='line'>The reset process does not clean your kubeconfig files and you must remove them manually.
</span><span class='line'>Please, check the contents of the $HOME/.kube/config file.
</span><span class='line'>
</span><span class='line'>[root@worker1 ~]# kubeadm join 192.168.191.131:6443 --token sj6fff.bpak7gkd3hnyzcm5 \
</span><span class='line'>         --discovery-token-ca-cert-hash sha256:8e15649afc0771e80cce7f1dfdbb0933f4fdbd45ea1f9e03be1f3b78449a6d3c 
</span><span class='line'>[preflight] Running pre-flight checks
</span><span class='line'>        [WARNING FileExisting-tc]: tc not found in system path
</span><span class='line'>        [WARNING Hostname]: hostname "worker1" could not be reached
</span><span class='line'>        [WARNING Hostname]: hostname "worker1": lookup worker1 on 192.168.191.2:53: no such host
</span><span class='line'>        [WARNING Service-Kubelet]: kubelet service is not enabled, please run 'systemctl enable kubelet.service'
</span><span class='line'>[preflight] Reading configuration from the cluster...
</span><span class='line'>[preflight] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'
</span><span class='line'>[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"
</span><span class='line'>[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"
</span><span class='line'>[kubelet-start] Starting the kubelet
</span><span class='line'>[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...
</span><span class='line'>
</span><span class='line'>This node has joined the cluster:
</span><span class='line'>* Certificate signing request was sent to apiserver and a response was received.
</span><span class='line'>* The Kubelet was informed of the new secure connection details.
</span><span class='line'>
</span><span class='line'>Run 'kubectl get nodes' on the control-plane to see this node join the cluster.
</span></code></pre></td></tr></table></div></figure>


<p>åŠ å…¥èŠ‚ç‚¹åï¼ŒæŸ¥çœ‹çŠ¶æ€ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl get nodes 
</span><span class='line'>NAME      STATUS     ROLES                  AGE    VERSION
</span><span class='line'>k8s       Ready      control-plane,master   166m   v1.23.5
</span><span class='line'>worker1   NotReady   &lt;none&gt;                 30s    v1.23.5
</span></code></pre></td></tr></table></div></figure>


<h2>å®‰è£…ç½‘ç»œ</h2>

<ul>
<li><a href="https://kubernetes.io/zh/docs/concepts/cluster-administration/networking/#how-to-implement-the-kubernetes-networking-model">https://kubernetes.io/zh/docs/concepts/cluster-administration/networking/#how-to-implement-the-kubernetes-networking-model</a></li>
<li><a href="https://kubernetes.io/zh/docs/concepts/cluster-administration/addons/">https://kubernetes.io/zh/docs/concepts/cluster-administration/addons/</a></li>
<li><a href="https://github.com/flannel-io/flannel#deploying-flannel-manually">https://github.com/flannel-io/flannel#deploying-flannel-manually</a></li>
</ul>


<p>githubä¸Šçš„èµ„æºå¥½åƒä¹Ÿä¸èƒ½ä¸‹è½½äº†ï¼Œæ‰“å¼€åå¤åˆ¶å†…å®¹åˆ°æ–°å»ºçš„æ–‡ä»¶ä¸­ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># For Kubernetes v1.17+ kubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml
</span><span class='line'>[ec2-user@k8s ~]$ vi kube-flannel.yml 
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f kube-flannel.yml
</span></code></pre></td></tr></table></div></figure>


<p>ç”±äºåˆå§‹åŒ– <code>kubeadm init</code> æ—¶æ²¡æœ‰æ·»åŠ ç½‘ç»œå‚æ•°ï¼Œå¯¼è‡´è¿™é‡Œflannelç½‘ç»œæ’ä»¶ä¸€ç›´å¤„äº CrashLoopBackOff çŠ¶æ€ï¼ŒæŸ¥çœ‹æ—¥å¿—æç¤ºæ²¡æœ‰åˆ†é… cidr æŠ¥é”™æŸ¥æ—¥å¿—</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## https://cloud-atlas.readthedocs.io/zh_CN/latest/kubernetes/debug/k8s_crashloopbackoff.html
</span><span class='line'># æŸ¥çœ‹æ—¥å¿—
</span><span class='line'>[ec2-user@k8s ~]$ kubectl describe -n kube-system pod kube-flannel-ds-sbx86 
</span><span class='line'>  Warning  BackOff    2m5s (x69 over 16m)  kubelet            Back-off restarting failed container
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl logs -n kube-system kube-flannel-ds-sbx86 
</span><span class='line'>E0317 09:19:27.915383       1 main.go:317] Error registering network: failed to acquire lease: node "k8s" pod cidr not assigned
</span><span class='line'>W0317 09:19:27.915664       1 reflector.go:436] github.com/flannel-io/flannel/subnet/kube/kube.go:379: watch of *v1.Node ended with: an error on the server ("unable to decode an event from the watch stream: context canceled") has prevented the request from succeeding
</span><span class='line'>
</span><span class='line'>å¯ä»¥å†é€šè¿‡dockeræŸ¥çœ‹flannelæ—¥å¿—
</span><span class='line'>[root@test4 profile]# docker ps -l
</span><span class='line'>[root@test4 profile]# docker logs f7be3ebe77fd 
</span><span class='line'>
</span><span class='line'>## https://www.talkwithtrend.com/Article/251751
</span><span class='line'># kube-controller-manager æ²¡æœ‰ç»™æ–°åŠ å…¥çš„èŠ‚ç‚¹åˆ†é… IP æ®µï¼Œinit çš„æ—¶å€™æ²¡æœ‰æŒ‡å®š IP æ®µ
</span><span class='line'># åŠ æœ€åä¸¤è¡Œï¼Œå’Œ kube-flannel.yml ä¸­çš„ net-conf.json/Network å¯¹åº”ï¼š
</span><span class='line'>[ec2-user@k8s ~]$ sudo vi /etc/kubernetes/manifests/kube-controller-manager.yaml 
</span><span class='line'>  - command:
</span><span class='line'>    - kube-controller-manager
</span><span class='line'>    - --authentication-kubeconfig=/etc/kubernetes/controller-manager.conf
</span><span class='line'>    - --authorization-kubeconfig=/etc/kubernetes/controller-manager.conf
</span><span class='line'>    - --bind-address=127.0.0.1
</span><span class='line'>    - --client-ca-file=/etc/kubernetes/pki/ca.crt
</span><span class='line'>    - --cluster-name=kubernetes
</span><span class='line'>    - --cluster-signing-cert-file=/etc/kubernetes/pki/ca.crt
</span><span class='line'>    - --cluster-signing-key-file=/etc/kubernetes/pki/ca.key
</span><span class='line'>    - --controllers=*,bootstrapsigner,tokencleaner
</span><span class='line'>    - --kubeconfig=/etc/kubernetes/controller-manager.conf
</span><span class='line'>    - --leader-elect=true
</span><span class='line'>    - --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt
</span><span class='line'>    - --root-ca-file=/etc/kubernetes/pki/ca.crt
</span><span class='line'>    - --service-account-private-key-file=/etc/kubernetes/pki/sa.key
</span><span class='line'>    - --use-service-account-credentials=true
</span><span class='line'>    - --allocate-node-cidrs=true
</span><span class='line'>    - --cluster-cidr=10.244.0.0/16
</span><span class='line'>
</span><span class='line'># é‡å¯æœåŠ¡
</span><span class='line'>## https://stackoverflow.com/questions/51375940/kubernetes-master-node-is-down-after-restarting-host-machine
</span><span class='line'>[ec2-user@k8s ~]$ sudo systemctl restart kubelet  
</span><span class='line'>
</span><span class='line'># é‡æ–°éƒ¨ç½²
</span><span class='line'># ç„¶ååˆ é™¤flannelå®¹å™¨ï¼Œé‡æ–°éƒ¨ç½²
</span><span class='line'>[ec2-user@k8s ~]$ kubectl delete -f kube-flannel.yml 
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f kube-flannel.yml
</span></code></pre></td></tr></table></div></figure>


<p>æ³¨ï¼šè¿˜æœ‰å¯ä»¥ä¸´æ—¶ç¼–è¾‘èŠ‚ç‚¹çš„é…ç½® æ‰‹åŠ¨åˆ†é…podCIDRã€‚è¿™é‡Œä¸åšå…·ä½“æè¿°ï¼Œå‚è€ƒï¼š <a href="http://www.hyhblog.cn/2021/02/21/k8s-flannel-pod-cidr-not-assigned/">http://www.hyhblog.cn/2021/02/21/k8s-flannel-pod-cidr-not-assigned/</a> ã€‚</p>

<p>å†æ¬¡æŸ¥çœ‹podçŠ¶æ€ï¼Œç½‘ç»œç»„ä»¶å®‰è£…å¥½åï¼Œdnsç»„ä»¶ä¹Ÿè·‘èµ·æ¥äº†ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl get pods --all-namespaces -o wide 
</span><span class='line'>NAMESPACE     NAME                          READY   STATUS    RESTARTS   AGE     IP                NODE      NOMINATED NODE   READINESS GATES
</span><span class='line'>kube-system   coredns-64897985d-4d5rx       1/1     Running   0          2m30s   10.244.0.3        k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   coredns-64897985d-m9p9q       1/1     Running   0          2m30s   10.244.0.2        k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   etcd-k8s                      1/1     Running   0          166m    192.168.191.131   k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   kube-apiserver-k8s            1/1     Running   0          166m    192.168.191.131   k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   kube-controller-manager-k8s   1/1     Running   0          12m     192.168.191.131   k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   kube-flannel-ds-q4qkt         1/1     Running   0          60s     192.168.191.132   worker1   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   kube-flannel-ds-ttcwt         1/1     Running   0          6m1s    192.168.191.131   k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   kube-proxy-pd77m              1/1     Running   0          60s     192.168.191.132   worker1   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   kube-proxy-qj6lw              1/1     Running   0          166m    192.168.191.131   k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system   kube-scheduler-k8s            1/1     Running   0          166m    192.168.191.131   k8s       &lt;none&gt;           &lt;none&gt;
</span></code></pre></td></tr></table></div></figure>


<h2>å®‰è£…dashboard</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## https://github.com/kubernetes/dashboard#kubernetes-dashboard
</span><span class='line'># kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.5.1/aio/deploy/recommended.yaml
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f dashboard-v2.5.1.yml 
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pods -A -o wide
</span><span class='line'>NAMESPACE              NAME                                         READY   STATUS    RESTARTS   AGE     IP                NODE      NOMINATED NODE   READINESS GATES
</span><span class='line'>kube-system            coredns-64897985d-4d5rx                      1/1     Running   0          36m     10.244.0.3        k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system            coredns-64897985d-m9p9q                      1/1     Running   0          36m     10.244.0.2        k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system            etcd-k8s                                     1/1     Running   0          3h20m   192.168.191.131   k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system            kube-apiserver-k8s                           1/1     Running   0          3h19m   192.168.191.131   k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system            kube-controller-manager-k8s                  1/1     Running   0          46m     192.168.191.131   k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system            kube-flannel-ds-q4qkt                        1/1     Running   0          34m     192.168.191.132   worker1   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system            kube-flannel-ds-ttcwt                        1/1     Running   0          39m     192.168.191.131   k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system            kube-proxy-pd77m                             1/1     Running   0          34m     192.168.191.132   worker1   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system            kube-proxy-qj6lw                             1/1     Running   0          3h20m   192.168.191.131   k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kube-system            kube-scheduler-k8s                           1/1     Running   0          3h20m   192.168.191.131   k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kubernetes-dashboard   dashboard-metrics-scraper-799d786dbf-q87wv   1/1     Running   0          59s     10.244.2.3        worker1   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>kubernetes-dashboard   kubernetes-dashboard-fb8648fd9-vprpt         1/1     Running   0          59s     10.244.2.2        worker1   &lt;none&gt;           &lt;none&gt;
</span></code></pre></td></tr></table></div></figure>


<p>å®‰è£…è¿˜æ˜¯å¾ˆä¾¿æ·å’Œå®¹æ˜“çš„ï¼Œè®¿é—®æèµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œç”±äºæ˜¯åœ¨è™šæ‹Ÿæœºé‡Œé¢éƒ¨ç½²ï¼Œkubectlå‘½ä»¤ä¹Ÿéƒ½åœ¨è™šæ‹Ÿæœºæ“ä½œï¼Œç”¨ <code>kubectl proxy</code> è®¿é—®dashboardï¼Œå¦‚æœä¸æ˜¯localhostæˆ–è€…httpsçš„è¯ä¸ç»™è®¿é—®çš„ã€‚</p>

<p>å°è¯•äº†ç»‘å®šç½‘å¡ipï¼Œä½†æ˜¯ç”±äºä¸æ˜¯httpsï¼Œè¿˜æ˜¯ä¸èƒ½è®¿é—®dashboardï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl proxy --address='0.0.0.0' --accept-hosts='.*'
</span><span class='line'>Starting to serve on [::]:8001
</span></code></pre></td></tr></table></div></figure>


<p>è®¿é—®dashboardæ–¹æ³•ä¸€ï¼škubectl proxy åŠ ä¸Š sshçš„locally port forwardï¼ŒæŠŠæœ¬åœ°çš„8001çš„è¯·æ±‚è½¬å‘åˆ° è¿œç¨‹æœåŠ¡å™¨çš„localhost:8001ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## https://github.com/kubernetes/dashboard#access
</span><span class='line'>[ec2-user@k8s ~]$ kubectl proxy 
</span><span class='line'>Starting to serve on 127.0.0.1:8001
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨SecureCRTçš„sshä¼šè¯çš„é…ç½® Session Options çš„ Connection - Port Forwarding å¢åŠ  Local Port Forwarding çš„ç«¯å£è½¬å‘ã€‚åœ¨Localå’ŒRemoteçš„Portè¾“å…¥æ¡†ä¸­éƒ½å¡«å…¥8001å³å¯ã€‚</p>

<p>é‡æ–°è¿æ¥ï¼Œè¿™æ ·æˆ‘ä»¬è®¿é—® <code>http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/login</code> å°±èƒ½è®¿é—®åˆ°dashboardé¡µé¢äº†ã€‚</p>

<p>æ–¹æ³•äºŒï¼šåé¢ç›´æ¥é€šè¿‡æŸ¥çœ‹dashboardæœåŠ¡çš„ipï¼Œé€šè¿‡ sshçš„socks5ä»£ç† æ¥è®¿é—® ä½¿ç”¨å†…éƒ¨åœ°å€çš„dashboardã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl -n kubernetes-dashboard get service kubernetes-dashboard
</span><span class='line'>NAME                   TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
</span><span class='line'>kubernetes-dashboard   ClusterIP   10.101.193.109   &lt;none&gt;        443/TCP   6h38m
</span><span class='line'>
</span><span class='line'>## é€šè¿‡æœåŠ¡ipè®¿é—®ï¼ˆLocally Port Forwarding - socks5æ–¹å¼ä»£ç†ï¼‰ï¼š
</span><span class='line'>https://10.101.193.109/#/login
</span><span class='line'>https://10.101.193.109/#/pod?namespace=kube-system
</span></code></pre></td></tr></table></div></figure>


<p>æ–¹æ³•ä¸‰ï¼šæˆ–è€…ç½‘ä¸Šè¯´çš„ä½¿ç”¨ç«¯å£è½¬å‘ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## https://kubernetes.io/zh/docs/tasks/access-application-cluster/port-forward-access-application-cluster/
</span><span class='line'>kubectl port-forward -n kubernetes-dashboard service/kubernetes-dashboard 8080:443 --address='0.0.0.0'
</span></code></pre></td></tr></table></div></figure>


<p>èƒ½è®¿é—®äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è·å–tokenè¿›è¡Œç™»å½•ã€‚åŒæ ·æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æš´åŠ›è®¾ç½®è·³è¿‡ç™»å½•ï¼Œç¬¬äºŒç§æ–¹å¼ä»ç³»ç»Ÿä¸­è·å–/åˆ›å»ºä¸€ä¸ªtokenæ¥ç™»å½•ã€‚</p>

<p>ç™»å½•æ–¹æ³•ä¸€ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## https://www.cnblogs.com/tylerzhou/p/11117956.html
</span><span class='line'># åœ¨1.10.1é‡Œé¢é»˜è®¤ä¸å†æ˜¾ç„¶skipæŒ‰é’®,å…¶å®dashboardå®‰è£…æœ‰å¾ˆå¤šå‘,å¦‚æœæœ‰è¯»è€…æŒ‰ç…§ä»¥ä¸Šè®¾ç½®ä»ç„¶ä¸èƒ½æ­£å¸¸æˆåŠŸç™»é™†,ä½†æ˜¯ä»ç„¶æƒ³è¦ä½“éªŒdashboard,å¯ä»¥å¼€å¯é»˜è®¤å…³é—­çš„skipæŒ‰é’®,è¿™æ ·å°±å¯ä»¥è¿›å…¥åˆ°dashboardç®¡ç†ç•Œé¢äº†.
</span><span class='line'>      containers:
</span><span class='line'>      - args:
</span><span class='line'>        - --auto-generate-certificates
</span><span class='line'>        - --enable-skip-login            # &lt;-- add this line
</span><span class='line'>        image: k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1
</span></code></pre></td></tr></table></div></figure>


<p>æ”¹äº†é…ç½®åè®°å¾—é‡æ–°åŠ è½½ã€‚</p>

<p>æ–¹æ³•äºŒï¼šå¦ä¸€ç§æ–¹å¼æ˜¯ä»ç³»ç»Ÿè·å–tokenï¼Œç„¶åå¡«åˆ°ç•Œé¢ä¸Šç„¶åç™»å½•ã€‚è®¿é—®dashboardï¼š</p>

<ul>
<li><a href="https://stackoverflow.com/questions/46664104/how-to-sign-in-kubernetes-dashboard">https://stackoverflow.com/questions/46664104/how-to-sign-in-kubernetes-dashboard</a></li>
<li><a href="https://jimmysong.io/kubernetes-handbook/guide/auth-with-kubeconfig-or-token.html">https://jimmysong.io/kubernetes-handbook/guide/auth-with-kubeconfig-or-token.html</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl -n kube-system get secret
</span><span class='line'># è¿™äº›secretsä¸­çš„å¤§éƒ¨åˆ†éƒ½å¯ä»¥ç”¨æ¥è®¿é—®dashboardçš„,åªæœ‰ä¸åŒçš„è´¦æˆ·æƒé™ä¸åŒ,å¾ˆå¤šè´¦æˆ·è¢«é™åˆ¶ä¸èƒ½è¿›è¡Œæ“ä½œ.
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl -n kube-system describe secret deployment-controller-token
</span><span class='line'>
</span><span class='line'># ä½¿ç”¨ä¸€æ¡å‘½ä»¤æ¥æ˜¾ç¤ºtoken
</span><span class='line'>[ec2-user@k8s ~]$ kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | awk '/^deployment-controller-token-/{print $1}') | awk '$1=="token:"{print $2}'
</span><span class='line'>eyJhbGciOiJSUzI1NiIsImtpZCI6IjQzNllWOFFBYU5qaXdtUmdLelJQSDU5T2FVbGVpREJFZTlMQU12MXFhN1UifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkZXBsb3ltZW50LWNvbnRyb2xsZXItdG9rZW4tejVwbWQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGVwbG95bWVudC1jb250cm9sbGVyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiNTcwNWJiMzYtMTMyNi00MGY5LWI3ZWUtNzE3ZTAyMTM1NzA2Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRlcGxveW1lbnQtY29udHJvbGxlciJ9.Av-RwOQGdEyZn56xmH_siz-7yU07OrhLhfiPqfJRaNJ5DL8wEDIZkxgNMzHrrthTsOJl7Tky3ABo5z3c_4xjgADGSqKqP0rvWtaLSHZFZR16c5S2c08aHdSH7KIAdoCy0muMiKHRw67QRf7zo5bPUyqfCyPY2vcB-pxqYnrTTAw71f34rgIPA-LACc5LIQwv8DT5O-KE1TopYF7lX5hXZIHOGP3sYpmbR7yIzO3MDNRUIfiZutYiQnHwXRQGBwHu1iUVk8Lu69gnqggkjp2cXa4d2ZUpCxrpeLGGdjPv6JPZEFLDhLbiBLF04b7IOdFQO4bH6BbXBNs9e0AGPbvp4Q
</span><span class='line'>[ec2-user@k8s ~]$ 
</span></code></pre></td></tr></table></div></figure>


<p>æ–¹æ³•ä¸‰ï¼šå½“ç„¶ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªdashboardçš„æ‹¥æœ‰å®Œæ•´æƒé™çš„tokenï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ kubectl create serviceaccount cluster-admin-dashboard-sa -n kube-system
</span><span class='line'>
</span><span class='line'>$ kubectl create clusterrolebinding cluster-admin-dashboard-sa \
</span><span class='line'>  --clusterrole=cluster-admin \
</span><span class='line'>  --serviceaccount=kube-system:cluster-admin-dashboard-sa -n kube-system
</span><span class='line'>
</span><span class='line'>And then, you can use the token of just created cluster admin service account.
</span><span class='line'>$ kubectl get secret | grep cluster-admin-dashboard-sa
</span><span class='line'>cluster-admin-dashboard-sa-token-6xm8l   kubernetes.io/service-account-token   3         18m
</span><span class='line'>$ kubectl describe secret cluster-admin-dashboard-sa-token-6xm8l
</span><span class='line'>
</span><span class='line'># Parse the token
</span><span class='line'>$ TOKEN=$(kubectl describe secret -n kube-system $(kubectl get secret -n kube-system | awk '/^cluster-admin-dashboard-sa-token-/{print $1}') | awk '$1=="token:"{print $2}')
</span><span class='line'>$ echo $TOKEN
</span><span class='line'>
</span><span class='line'>## -OR-
</span><span class='line'>[ec2-user@k8s ~]$ kubectl describe secret cluster-admin-dashboard-sa
</span><span class='line'>## -OR-
</span><span class='line'>[ec2-user@k8s ~]$ kubectl describe secret -n kube-system | grep deployment -A 12
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœä½¿ç”¨tokenç™»å½•ï¼Œä¸€æ®µäº‹ä»¶æ²¡æœ‰æ“ä½œå°±ä¼šæœ‰è¶…æ—¶çš„å›°æ‰°ï¼Œå¯ä»¥ä¿®æ”¹token-ttlé…ç½®ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>##--&gt; Unauthorized (401): You have been logged out because your token has expired.
</span><span class='line'>
</span><span class='line'>## https://blog.csdn.net/otoyix/article/details/118758736
</span><span class='line'># å¢åŠ ä¸€è¡Œå‚æ•° token-ttl=68400
</span><span class='line'>  containers:
</span><span class='line'>    - name: kubernetes-dashboard
</span><span class='line'>      image: 'kubernetesui/dashboard:v2.0.0-rc5'
</span><span class='line'>      args:
</span><span class='line'>        - '--auto-generate-certificates'
</span><span class='line'>        - '--namespace=kubernetes-dashboard'
</span><span class='line'>        - '--token-ttl=68400'    -- å¢åŠ äº†æ­¤è¡Œ
</span></code></pre></td></tr></table></div></figure>


<h2>å®‰è£…metrics-server</h2>

<p>å¦‚æœæ²¡æœ‰å®‰è£…metrics-serverï¼Œåœ¨dashboardä¸­ä¸èƒ½çœ‹åˆ°cpu/å†…å­˜ä½¿ç”¨æƒ…å†µå›¾å½¢ï¼Œkubectl topçš„å‘½ä»¤ä¹Ÿè·å–ä¸åˆ°æ•°æ®ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl top nodes
</span><span class='line'>error: Metrics API not available
</span><span class='line'>[ec2-user@k8s ~]$ kubectl top pods -A
</span><span class='line'>error: Metrics API not available
</span></code></pre></td></tr></table></div></figure>


<p>å®‰è£…metrics-serverä¼šæœ‰é•œåƒä¸‹è½½å’Œè¯ä¹¦çš„é—®é¢˜ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># æ¯å°ä¸»æœºéƒ½å¯¼å…¥ä¸€ä¸‹è¯¥é•œåƒ
</span><span class='line'>[ec2-user@k8s ~]$ docker load -i metrics-server-v0.6.1.tar.gz 
</span><span class='line'>3dc34f14eb83: Loading layer [==================================================&gt;]  66.43MB/66.43MB
</span><span class='line'>Loaded image: k8s.gcr.io/metrics-server/metrics-server:v0.6.1
</span><span class='line'>
</span><span class='line'># kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
</span><span class='line'>[ec2-user@k8s ~]$ vi metrics-server.yml
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f metrics-server.yml 
</span></code></pre></td></tr></table></div></figure>


<p>è¿˜æ˜¯å¯åŠ¨ä¸èµ·æ¥ï¼Œç”±äºmetrics-serveréœ€è¦è¿æœåŠ¡ç«¯ï¼Œè¯ä¹¦ä¸å¯¹ï¼Œä¸ºäº†å…ˆè·‘èµ·æ¥ï¼Œå…ˆå¿½ç•¥å®‰å…¨è¯ä¹¦ã€‚åœ¨containerså‚æ•°æœ€ååŠ ä¸Š <code>--kubelet-insecure-tls</code> ï¼Œç„¶ååˆ é™¤åé‡æ–°åˆ›å»ºä¸€æ¬¡ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## [k8s metrics-server è½»é‡åŒ–ç›‘æ§](https://www.jianshu.com/p/5fe108d70310)
</span><span class='line'>## https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/troubleshooting-kubeadm/#cannot-use-the-metrics-server-securely-in-a-kubeadm-cluster
</span><span class='line'>
</span><span class='line'>## è¯ä¹¦ https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-certs/#kubelet-serving-certs
</span><span class='line'>
</span><span class='line'>## https://github.com/kubernetes-sigs/metrics-server/blob/master/FAQ.md#how-to-run-metrics-server-securely
</span><span class='line'>## https://github.com/kubernetes-sigs/metrics-server/issues/196
</span><span class='line'>## https://cloud.tencent.com/developer/article/1819955
</span><span class='line'>    spec:
</span><span class='line'>      containers:
</span><span class='line'>      - args:
</span><span class='line'>        - --cert-dir=/tmp
</span><span class='line'>        - --secure-port=4443
</span><span class='line'>        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname
</span><span class='line'>        - --kubelet-use-node-status-port
</span><span class='line'>        - --metric-resolution=15s
</span><span class='line'>        - --kubelet-insecure-tls
</span><span class='line'>        image: k8s.gcr.io/metrics-server/metrics-server:v0.6.1
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl delete -f metrics-server.yml 
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f metrics-server.yml 
</span></code></pre></td></tr></table></div></figure>


<p>ç­‰ä¸€å°ä¼šï¼Œå†æ¬¡æŸ¥çœ‹topå‘½ä»¤ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl top nodes 
</span><span class='line'>NAME      CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%   
</span><span class='line'>k8s       91m          4%     913Mi           23%       
</span><span class='line'>worker1   38m          1%     431Mi           11%       
</span><span class='line'>[ec2-user@k8s ~]$ 
</span><span class='line'>[ec2-user@k8s ~]$ kubectl top pods -n kube-system
</span><span class='line'>NAME                              CPU(cores)   MEMORY(bytes)   
</span><span class='line'>coredns-64897985d-4d5rx           1m           12Mi            
</span><span class='line'>coredns-64897985d-m9p9q           1m           12Mi            
</span><span class='line'>etcd-k8s                          11m          60Mi            
</span><span class='line'>kube-apiserver-k8s                32m          312Mi           
</span><span class='line'>kube-controller-manager-k8s       13m          46Mi            
</span><span class='line'>kube-flannel-ds-q4qkt             2m           11Mi            
</span><span class='line'>kube-flannel-ds-ttcwt             2m           11Mi            
</span><span class='line'>kube-proxy-pd77m                  7m           16Mi            
</span><span class='line'>kube-proxy-qj6lw                  2m           16Mi            
</span><span class='line'>kube-scheduler-k8s                3m           17Mi            
</span><span class='line'>metrics-server-7cf8b65d65-trtcj   33m          11Mi            
</span><span class='line'>[ec2-user@k8s ~]$ 
</span></code></pre></td></tr></table></div></figure>


<p>åŒæ—¶dashboard webç•Œé¢å°±èƒ½çœ‹åˆ°cpu/å†…å­˜çš„æ€§èƒ½å›¾å½¢äº†ã€‚</p>

<h2>Hello world</h2>

<p>ç¼–å†™ä¸€ä¸ªé…ç½®ï¼Œç„¶åè¿è¡Œä¸€ä¸ªå®ä¾‹ï¼Œçœ‹çœ‹ä¸¤å°æœºå™¨ä¸Šçš„podç½‘ç»œæ˜¯å¦äº’é€šã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## docker run -it public.ecr.aws/amazonlinux/amazonlinux /bin/bash
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ cat replicaset.yml 
</span><span class='line'>apiVersion: apps/v1
</span><span class='line'>kind: ReplicaSet
</span><span class='line'>metadata:
</span><span class='line'>  name: hello-world
</span><span class='line'>spec:
</span><span class='line'>  replicas: 2
</span><span class='line'>  selector:
</span><span class='line'>    matchLabels:
</span><span class='line'>      app: hello-world
</span><span class='line'>  template:
</span><span class='line'>    metadata:
</span><span class='line'>      labels:
</span><span class='line'>        app: hello-world
</span><span class='line'>    spec:
</span><span class='line'>      containers:
</span><span class='line'>      - name: hello-world
</span><span class='line'>        image: amazonlinux:2
</span><span class='line'>        command: ["/bin/sh"]
</span><span class='line'>        args: ["-c", "while true; do echo hello; sleep 10;done"]
</span><span class='line'>[ec2-user@k8s ~]$ 
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f replicaset.yml  
</span><span class='line'>replicaset.apps/hello-world created
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl get pods -o wide
</span><span class='line'>NAME                READY   STATUS    RESTARTS   AGE   IP            NODE      NOMINATED NODE   READINESS GATES
</span><span class='line'>hello-world-d2tss   1/1     Running   0          8s    10.244.0.7    k8s       &lt;none&gt;           &lt;none&gt;
</span><span class='line'>hello-world-h9jxq   1/1     Running   0          8s    10.244.2.12   worker1   &lt;none&gt;           &lt;none&gt;
</span><span class='line'>[ec2-user@k8s ~]$ 
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl exec -ti hello-world-d2tss bash 
</span><span class='line'>kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.
</span><span class='line'>bash-4.2# cat /etc/hosts 
</span><span class='line'>
</span><span class='line'>bash-4.2# yum install -y iputils net-tools 
</span><span class='line'>
</span><span class='line'>bash-4.2# ping hello-world-h9jxq           
</span><span class='line'>ping: hello-world-h9jxq: Name or service not known
</span><span class='line'>æœåŠ¡serviceæ‰æœ‰åŸŸåã€‚åé¢è¯•ä¸€ä¸‹æœåŠ¡çš„ï¼Œæ¥pingåŸŸåï¼Œæµ‹è¯•ä¸‹dnsã€‚
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>bash-4.2# ping 10.244.0.7 
</span><span class='line'>PING 10.244.0.7 (10.244.0.7) 56(84) bytes of data.
</span><span class='line'>64 bytes from 10.244.0.7: icmp_seq=1 ttl=255 time=0.012 ms
</span><span class='line'>64 bytes from 10.244.0.7: icmp_seq=2 ttl=255 time=0.021 ms
</span><span class='line'>^C
</span><span class='line'>--- 10.244.0.7 ping statistics ---
</span><span class='line'>2 packets transmitted, 2 received, 0% packet loss, time 1007ms
</span><span class='line'>rtt min/avg/max/mdev = 0.012/0.016/0.021/0.006 ms
</span><span class='line'>
</span><span class='line'>bash-4.2# ping 10.244.2.12
</span><span class='line'>PING 10.244.2.12 (10.244.2.12) 56(84) bytes of data.
</span><span class='line'>64 bytes from 10.244.2.12: icmp_seq=1 ttl=253 time=0.508 ms
</span><span class='line'>64 bytes from 10.244.2.12: icmp_seq=2 ttl=253 time=0.425 ms
</span><span class='line'>^C
</span><span class='line'>--- 10.244.2.12 ping statistics ---
</span><span class='line'>2 packets transmitted, 2 received, 0% packet loss, time 1027ms
</span><span class='line'>rtt min/avg/max/mdev = 0.425/0.466/0.508/0.046 ms
</span></code></pre></td></tr></table></div></figure>


<h2>Service domain</h2>

<p>é…ç½®å¯åŠ¨å®¹å™¨å’ŒæœåŠ¡ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ cat pg-db.yml 
</span><span class='line'>---
</span><span class='line'>apiVersion: v1
</span><span class='line'>kind: Pod
</span><span class='line'>metadata:
</span><span class='line'>  name: db-op-1 
</span><span class='line'>  labels:
</span><span class='line'>    name: postgres
</span><span class='line'>spec:
</span><span class='line'>  hostname: db-op-1
</span><span class='line'>  containers:
</span><span class='line'>  - name: postgres
</span><span class='line'>    image: postgis/postgis:9.6-2.5
</span><span class='line'>    imagePullPolicy: IfNotPresent
</span><span class='line'>---
</span><span class='line'>apiVersion: v1
</span><span class='line'>kind: Service
</span><span class='line'>metadata:
</span><span class='line'>  name: db-op-1
</span><span class='line'>spec:
</span><span class='line'>  ports:
</span><span class='line'>  - protocol: TCP
</span><span class='line'>    port: 5432
</span><span class='line'>  selector:
</span><span class='line'>    name: postgres
</span><span class='line'>
</span><span class='line'>[ec2-user@k8s ~]$ kubectl apply -f pg-db.yml 
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨é»˜è®¤çš„namespaceä¸­å†å¯åŠ¨ä¸€ä¸ªpostgisçš„å®¹å™¨ï¼Œç”¨æ¥æµ‹è¯•è®¿é—®åŸŸåï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ kubectl run busybox --image=postgis/postgis:9.6-2.5 -ti --restart=Never --rm  --command -- sh                
</span><span class='line'>If you don't see a command prompt, try pressing enter.
</span><span class='line'>
</span><span class='line'># apt update ; apt-get install net-tools iproute2 iputils-ping -y
</span><span class='line'>
</span><span class='line'># cat /etc/resolv.conf
</span><span class='line'>nameserver 10.96.0.10
</span><span class='line'>search default.svc.cluster.local svc.cluster.local cluster.local localdomain
</span><span class='line'>options ndots:5
</span><span class='line'>
</span><span class='line'># ping db-op-1
</span><span class='line'>PING db-op-1.default.svc.cluster.local (10.107.190.149) 56(84) bytes of data.
</span><span class='line'>
</span><span class='line'># psql -h db-op-1 -U postgres
</span><span class='line'>Password for user postgres: 
</span><span class='line'>psql (9.6.24)
</span><span class='line'>Type "help" for help.
</span><span class='line'>
</span><span class='line'>postgres=# \q
</span></code></pre></td></tr></table></div></figure>


<h2>å‚è€ƒ</h2>

<ul>
<li><a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/">https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/</a></li>
</ul>


<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[k8s-v1.23.5ä¾èµ–ä¸‹è½½]]></title>
    <link href="http://winse.github.io/blog/2022/03/18/k8s-deps-download/"/>
    <updated>2022-03-18T10:57:38+08:00</updated>
    <id>http://winse.github.io/blog/2022/03/18/k8s-deps-download</id>
    <content type="html"><![CDATA[<p>å‡ å¹´å‰å®‰è£…ä½¿ç”¨è¿‡k8s(kubernetes)ï¼Œæ˜ç™½å®‰è£…è¿‡ç¨‹æœ€å¤§çš„ä¸€ä¸ªéš¾å…³æ˜¯å®¹å™¨é•œåƒçš„ä¸‹è½½ï¼Œæ‰€ä»¥æ‰¾å›åŸæ¥çš„æ–‡ç« ï¼Œè¯•ç€ç”¨åŸæ¥çš„ä»£ç†ç¿»å¢™çš„æ–¹å¼ï¼Œä½†æ˜¯åŸæ¥å¯è¡Œçš„ <code>ssh -D</code> socks5 çš„æ–¹å¼åœ¨ Amazon Linux 2 ä¸Šé¢ä¸å¥½ä½¿ï¼Œæœ€åç›´æ¥åœ¨å¤–ç½‘ä¸»æœºä¸Šå®‰è£…å¹¶ç¼“å†²RPMï¼Œç„¶åä¸‹è½½æ‰“åŒ… k8s.gcr.io ä¸‹çš„æ‰€æœ‰é•œåƒã€‚</p>

<p>å°½ç®¡è¿‡ç¨‹æ²¡æœ‰é‚£ä¹ˆçš„ä¸¥è°¨ï¼Œä½†æ˜¯æ¯ä¸ªæ­¥éª¤è¿˜æ˜¯éƒ½å¾—æ‰§è¡Œçš„ã€‚</p>

<h2>å‚è€ƒæ–‡ç« </h2>

<ul>
<li><p><a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">å®‰è£… kubeadm</a></p></li>
<li><p><a href="https://docs.docker.com/engine/install/centos/">Install Docker Engine on CentOS</a></p></li>
<li><a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/docker-basics.html">Docker basics for Amazon ECS</a></li>
<li><p><a href="https://kubernetes.io/zh/docs/setup/production-environment/container-runtimes/#docker">å®¹å™¨è¿è¡Œæ—¶ - Docker</a></p></li>
<li><p><a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#%E5%AE%89%E8%A3%85-kubeadm-kubelet-%E5%92%8C-kubectl">å®‰è£… kubeadmã€kubelet å’Œ kubectl</a></p></li>
<li><p><a href="https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init/#%E5%9C%A8%E6%B2%A1%E6%9C%89%E4%BA%92%E8%81%94%E7%BD%91%E8%BF%9E%E6%8E%A5%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E8%BF%90%E8%A1%8C-kubeadm">åœ¨æ²¡æœ‰äº’è”ç½‘è¿æ¥çš„æƒ…å†µä¸‹è¿è¡Œ kubeadm</a></p></li>
<li><p><a href="https://www.jianshu.com/p/5fe108d70310">k8s metrics-server è½»é‡åŒ–ç›‘æ§</a></p></li>
</ul>


<h2>å®‰è£…Docker</h2>

<p>k8sçš„podéœ€è¦å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer Runtimeï¼‰ï¼Œè¿™é‡Œç›´æ¥é€‰æ‹©ç†Ÿæ‚‰çš„dockerã€‚å¤–ç½‘çš„ä¸»æœºæ˜¯centos7çš„ï¼ŒæŒ‰ç…§dockerå®˜ç½‘æ­¥éª¤å®‰è£…ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## https://docs.docker.com/engine/install/centos/
</span><span class='line'>$ sudo yum remove docker \
</span><span class='line'>                   docker-client \
</span><span class='line'>                   docker-client-latest \
</span><span class='line'>                   docker-common \
</span><span class='line'>                   docker-latest \
</span><span class='line'>                   docker-latest-logrotate \
</span><span class='line'>                   docker-logrotate \
</span><span class='line'>                   docker-engine
</span><span class='line'>
</span><span class='line'>$ sudo yum install -y yum-utils
</span><span class='line'>$ sudo yum-config-manager \
</span><span class='line'>     --add-repo \
</span><span class='line'>     https://download.docker.com/linux/centos/docker-ce.repo
</span><span class='line'>
</span><span class='line'>$ yum list docker-ce --showduplicates | sort -r
</span><span class='line'>
</span><span class='line'>$ sudo yum clean all
</span><span class='line'>$ sudo yum install docker-ce docker-ce-cli containerd.io
</span><span class='line'>
</span><span class='line'>$ sudo service docker start
</span><span class='line'>$ sudo systemctl enable docker
</span><span class='line'># docker info
</span><span class='line'>
</span><span class='line'>## https://kubernetes.io/zh/docs/setup/production-environment/container-runtimes/#docker
</span><span class='line'>$ cat &lt;&lt;EOF | sudo tee /etc/docker/daemon.json
</span><span class='line'>{
</span><span class='line'>  "exec-opts": ["native.cgroupdriver=systemd"],
</span><span class='line'>  "log-driver": "json-file",
</span><span class='line'>  "log-opts": {
</span><span class='line'>    "max-size": "100m"
</span><span class='line'>  },
</span><span class='line'>  "storage-driver": "overlay2"
</span><span class='line'>}
</span><span class='line'>EOF
</span><span class='line'>
</span><span class='line'>$ sudo systemctl enable docker
</span><span class='line'>$ sudo systemctl daemon-reload
</span><span class='line'>$ sudo systemctl restart docker
</span></code></pre></td></tr></table></div></figure>


<h2>å®‰è£… kubeadmã€kubelet å’Œ kubectl</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## è®¾ç½®ç¼“å†²
</span><span class='line'># vi /etc/yum.conf 
</span><span class='line'>keepcache=1
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>## https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#%E5%AE%89%E8%A3%85-kubeadm-kubelet-%E5%92%8C-kubectl
</span><span class='line'>## åœ¨å®˜ç½‘åŸºç¡€ä¸Šï¼Œç¦ç”¨gpgcheck
</span><span class='line'># cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
</span><span class='line'>[kubernetes]
</span><span class='line'>name=Kubernetes
</span><span class='line'>baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\$basearch
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=0
</span><span class='line'>repo_gpgcheck=0
</span><span class='line'>gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
</span><span class='line'>exclude=kubelet kubeadm kubectl
</span><span class='line'>EOF
</span><span class='line'>
</span><span class='line'>## å°† SELinux è®¾ç½®ä¸º permissive æ¨¡å¼ï¼ˆç›¸å½“äºå°†å…¶ç¦ç”¨ï¼‰
</span><span class='line'># sudo setenforce 0
</span><span class='line'># sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config
</span><span class='line'>
</span><span class='line'># sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes
</span><span class='line'>
</span><span class='line'>## æ— éœ€å¯åŠ¨ sudo systemctl enable --now kubelet
</span></code></pre></td></tr></table></div></figure>


<p>æŠŠç¼“å†²çš„rpmä¸‹è½½åˆ°æœ¬åœ°</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@ea5df05219bb /]# cd /var/cache/yum/
</span><span class='line'>[root@ea5df05219bb yum]# ll -R 
</span><span class='line'>
</span><span class='line'>[root@ea5df05219bb yum]# yum install lrzsz 
</span><span class='line'>
</span><span class='line'>[root@ea5df05219bb yum]# sz x86_64/7/kubernetes/packages/*
</span></code></pre></td></tr></table></div></figure>


<h2>åœ¨æ²¡æœ‰äº’è”ç½‘è¿æ¥çš„æƒ…å†µä¸‹è¿è¡Œkubeadm</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init/#%E5%9C%A8%E6%B2%A1%E6%9C%89%E4%BA%92%E8%81%94%E7%BD%91%E8%BF%9E%E6%8E%A5%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E8%BF%90%E8%A1%8C-kubeadm
</span><span class='line'>
</span><span class='line'># kubeadm config images list
</span><span class='line'>k8s.gcr.io/kube-apiserver:v1.23.5
</span><span class='line'>k8s.gcr.io/kube-controller-manager:v1.23.5
</span><span class='line'>k8s.gcr.io/kube-scheduler:v1.23.5
</span><span class='line'>k8s.gcr.io/kube-proxy:v1.23.5
</span><span class='line'>k8s.gcr.io/pause:3.6
</span><span class='line'>k8s.gcr.io/etcd:3.5.1-0
</span><span class='line'>k8s.gcr.io/coredns/coredns:v1.8.6
</span><span class='line'>
</span><span class='line'># kubeadm config images pull
</span><span class='line'>[config/images] Pulled k8s.gcr.io/kube-apiserver:v1.23.5
</span><span class='line'>[config/images] Pulled k8s.gcr.io/kube-controller-manager:v1.23.5
</span><span class='line'>[config/images] Pulled k8s.gcr.io/kube-scheduler:v1.23.5
</span><span class='line'>[config/images] Pulled k8s.gcr.io/kube-proxy:v1.23.5
</span><span class='line'>[config/images] Pulled k8s.gcr.io/pause:3.6
</span><span class='line'>[config/images] Pulled k8s.gcr.io/etcd:3.5.1-0
</span><span class='line'>[config/images] Pulled k8s.gcr.io/coredns/coredns:v1.8.6
</span><span class='line'>
</span><span class='line'># docker images
</span><span class='line'>REPOSITORY                           TAG       IMAGE ID       CREATED         SIZE
</span><span class='line'>k8s.gcr.io/kube-apiserver            v1.23.5   3fc1d62d6587   14 hours ago    135MB
</span><span class='line'>k8s.gcr.io/kube-proxy                v1.23.5   3c53fa8541f9   14 hours ago    112MB
</span><span class='line'>k8s.gcr.io/kube-controller-manager   v1.23.5   b0c9e5e4dbb1   14 hours ago    125MB
</span><span class='line'>k8s.gcr.io/kube-scheduler            v1.23.5   884d49d6d8c9   14 hours ago    53.5MB
</span><span class='line'>k8s.gcr.io/etcd                      3.5.1-0   25f8c7f3da61   4 months ago    293MB
</span><span class='line'>k8s.gcr.io/coredns/coredns           v1.8.6    a4ca41631cc7   5 months ago    46.8MB
</span><span class='line'>k8s.gcr.io/pause                     3.6       6270bb605e12   6 months ago    683kB
</span><span class='line'>centos                               7         8652b9f0cb4c   16 months ago   204MB
</span><span class='line'>
</span><span class='line'># docker images | awk '{print $1}' | grep k8s | xargs echo 
</span><span class='line'>k8s.gcr.io/kube-apiserver k8s.gcr.io/kube-proxy k8s.gcr.io/kube-controller-manager k8s.gcr.io/kube-scheduler k8s.gcr.io/etcd k8s.gcr.io/coredns/coredns k8s.gcr.io/pause
</span><span class='line'>
</span><span class='line'># docker save -o k8s-v1.23.5.tar k8s.gcr.io/kube-apiserver k8s.gcr.io/kube-proxy k8s.gcr.io/kube-controller-manager k8s.gcr.io/kube-scheduler k8s.gcr.io/etcd k8s.gcr.io/coredns/coredns k8s.gcr.io/pause
</span><span class='line'># gzip k8s-v1.23.5.tar
</span></code></pre></td></tr></table></div></figure>


<p>æŠŠå¯¼å‡ºçš„imagesä¸‹è½½å›æ¥åï¼ŒåŠ è½½åˆ°æœ¬åœ°ä¸»æœº</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ docker load -i k8s-v1.23.5.tar.gz 
</span></code></pre></td></tr></table></div></figure>


<h2>metrics-server</h2>

<p>metrics serverçš„é•œåƒä¹Ÿæ˜¯åœ¨googleçš„æœåŠ¡ä¸Šçš„ï¼Œä¹Ÿä¸‹è½½ä¿å­˜ä¸‹æ¥ã€‚åœ¨dashboardä¸Šå¯ä»¥é€šè¿‡å®ƒæŸ¥çœ‹node/podçš„cpu/å†…å­˜å ç”¨å›¾å½¢æƒ…å†µã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># docker pull k8s.gcr.io/metrics-server/metrics-server:v0.6.1
</span><span class='line'>
</span><span class='line'># docker save -o metrics-server-v0.6.1.tar k8s.gcr.io/metrics-server/metrics-server:v0.6.1
</span><span class='line'># gzip metrics-server-v0.6.1.tar 
</span></code></pre></td></tr></table></div></figure>


<p>ä¸‹è½½å›æ¥åï¼ŒåŠ è½½åˆ°æœ¬åœ°ä¸»æœº</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ docker load -i metrics-server-v0.6.1.tar.gz 
</span></code></pre></td></tr></table></div></figure>


<p>åŸºæœ¬å®‰è£…å¥½åï¼Œæœ¬åœ°é•œåƒå¦‚ä¸‹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ec2-user@k8s ~]$ docker images 
</span><span class='line'>REPOSITORY                                       TAG       IMAGE ID       CREATED        SIZE
</span><span class='line'>k8s.gcr.io/kube-apiserver                        v1.23.5   3fc1d62d6587   39 hours ago   135MB
</span><span class='line'>k8s.gcr.io/kube-proxy                            v1.23.5   3c53fa8541f9   39 hours ago   112MB
</span><span class='line'>k8s.gcr.io/kube-scheduler                        v1.23.5   884d49d6d8c9   39 hours ago   53.5MB
</span><span class='line'>k8s.gcr.io/kube-controller-manager               v1.23.5   b0c9e5e4dbb1   39 hours ago   125MB
</span><span class='line'>rancher/mirrored-flannelcni-flannel              v0.17.0   9247abf08677   2 weeks ago    59.8MB
</span><span class='line'>k8s.gcr.io/metrics-server/metrics-server         v0.6.1    e57a417f15d3   5 weeks ago    68.8MB
</span><span class='line'>rancher/mirrored-flannelcni-flannel-cni-plugin   v1.0.1    ac40ce625740   8 weeks ago    8.1MB
</span><span class='line'>k8s.gcr.io/etcd                                  3.5.1-0   25f8c7f3da61   4 months ago   293MB
</span><span class='line'>k8s.gcr.io/coredns/coredns                       v1.8.6    a4ca41631cc7   5 months ago   46.8MB
</span><span class='line'>k8s.gcr.io/pause                                 3.6       6270bb605e12   6 months ago   683kB
</span><span class='line'>
</span><span class='line'>[ec2-user@worker1 ~]$ docker images 
</span><span class='line'>REPOSITORY                                       TAG       IMAGE ID       CREATED        SIZE
</span><span class='line'>k8s.gcr.io/kube-apiserver                        v1.23.5   3fc1d62d6587   39 hours ago   135MB
</span><span class='line'>k8s.gcr.io/kube-proxy                            v1.23.5   3c53fa8541f9   39 hours ago   112MB
</span><span class='line'>k8s.gcr.io/kube-controller-manager               v1.23.5   b0c9e5e4dbb1   39 hours ago   125MB
</span><span class='line'>k8s.gcr.io/kube-scheduler                        v1.23.5   884d49d6d8c9   39 hours ago   53.5MB
</span><span class='line'>kubernetesui/dashboard                           v2.5.1    7fff914c4a61   7 days ago     243MB
</span><span class='line'>rancher/mirrored-flannelcni-flannel              v0.17.0   9247abf08677   2 weeks ago    59.8MB
</span><span class='line'>k8s.gcr.io/metrics-server/metrics-server         v0.6.1    e57a417f15d3   5 weeks ago    68.8MB
</span><span class='line'>rancher/mirrored-flannelcni-flannel-cni-plugin   v1.0.1    ac40ce625740   8 weeks ago    8.1MB
</span><span class='line'>k8s.gcr.io/etcd                                  3.5.1-0   25f8c7f3da61   4 months ago   293MB
</span><span class='line'>k8s.gcr.io/coredns/coredns                       v1.8.6    a4ca41631cc7   5 months ago   46.8MB
</span><span class='line'>k8s.gcr.io/pause                                 3.6       6270bb605e12   6 months ago   683kB
</span><span class='line'>kubernetesui/metrics-scraper                     v1.0.7    7801cfc6d5c0   9 months ago   34.4MB
</span></code></pre></td></tr></table></div></figure>


<h2>å°ç»“</h2>

<p>æœ¬æ–‡å°±è¦åœ¨å¤–ç½‘æ¨¡æ‹Ÿäº†ä¸€ä¸‹å®‰è£…ï¼ŒæŠŠéœ€è¦ç¿»å¢™çš„ä¸¤ä¸ªç»„ä»¶ï¼ˆrpmï¼Œdocker imageï¼‰ç¼“å†²ä¸‹æ¥ï¼Œç„¶ååœ¨æœ¬åœ°æœºå™¨ä¸Šç›´æ¥ä½¿ç”¨ã€‚</p>

<p>ä¸‹è½½çš„ æœ€æ–°ç‰ˆæœ¬v1.23.5 çš„ï¼ˆéœ€ç¿»å¢™çš„ï¼‰ä¾èµ–å¯ä»¥åœ¨ç™¾åº¦ç½‘ç›˜ä¸‹è½½ï¼š</p>

<pre><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1P3ABqKGt1JhNkg-9yB22yQ 
æå–ç ï¼šk7af
</code></pre>

<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æ¬§æ‹‰20.03LTS_SP3å®‰è£…docker]]></title>
    <link href="http://winse.github.io/blog/2022/01/13/openeuler20-dot-03lts-sp3-install-docker/"/>
    <updated>2022-01-13T11:46:25+08:00</updated>
    <id>http://winse.github.io/blog/2022/01/13/openeuler20-dot-03lts-sp3-install-docker</id>
    <content type="html"><![CDATA[<p>éšç€æ—¶é—´è½¦è½®å¾€å‰æ»šæ»šï¼ŒCentos-7æ­£é€æ¸çš„èµ°ä¸‹ç¥å›ï¼Œå›½å†…å¼€æºæ“ä½œç³»ç»Ÿè“¬å‹ƒå‘å±•ï¼Œè·Ÿä¸Šæ—¶ä»£çš„æ­¥ä¼ï¼Œå…ˆæŠŠdockeråœ¨æ¬§æ‹‰ä¸Šå®‰è£…èµ·æ¥ã€‚</p>

<p>ä½¿ç”¨æ¬§æ‹‰è‡ªå¸¦åº“éå¸¸å®¹æ˜“å®‰è£…ï¼Œä½†æ˜¯ç›¸å¯¹ç‰ˆæœ¬æ¯”è¾ƒæ—§ï¼š18.09ã€‚è¿˜æœ‰å°±æ˜¯ï¼Œä½¿ç”¨dockerå®˜ç½‘æœ€æ–°ç‰ˆï¼Œå¯ä»¥ä½¿ç”¨centos-8ç‰ˆæœ¬çš„åº“æ¥è¿›è¡Œå®‰è£…ã€‚</p>

<p>è¿™é‡Œä¸¤ç§æ–¹å¼éƒ½è¯•äº†ä¸€ä¸‹ï¼Œå…³é”®æ­¥éª¤ç½—åˆ—å¦‚ä¸‹ï¼š</p>

<h2>æ¬§æ‹‰è‡ªå¸¦</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost ~]# cat /etc/yum.repos.d/openEuler.repo   
</span><span class='line'>[root@localhost ~]# yum search docker 
</span><span class='line'>[root@localhost ~]# yum list | grep docker 
</span><span class='line'>docker-engine.x86_64                                    18.09.0-206.oe1                           OS        
</span><span class='line'>
</span><span class='line'># é»˜è®¤å·²ç»disabled
</span><span class='line'>[root@localhost ~]# getenforce 
</span><span class='line'>Disabled
</span><span class='line'>[root@localhost ~]# cat /etc/sysconfig/selinux
</span><span class='line'>
</span><span class='line'># å®‰è£…
</span><span class='line'>[root@localhost ~]# yum install docker
</span><span class='line'>Last metadata expiration check: 1:22:48 ago on Thu 13 Jan 2022 10:19:38 AM CST.
</span><span class='line'>Dependencies resolved.
</span><span class='line'>================================================================================================================================================================
</span><span class='line'> Package                                   Architecture                       Version                                      Repository                      Size
</span><span class='line'>================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> docker-engine                             x86_64                             18.09.0-206.oe1                              OS                              45 M
</span><span class='line'>Installing dependencies:
</span><span class='line'> libcgroup                                 x86_64                             0.42.2-1.oe1                                 OS                              96 k
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>================================================================================================================================================================
</span><span class='line'>Install  2 Packages
</span><span class='line'>
</span><span class='line'>[root@localhost ~]# docker version 
</span><span class='line'>Client:
</span><span class='line'> Version:           18.09.0
</span><span class='line'> EulerVersion:      18.09.0.206
</span><span class='line'> API version:       1.39
</span><span class='line'> Go version:        go1.15.7
</span><span class='line'> Git commit:        e4c0fb8
</span><span class='line'> Built:             Fri Dec 31 21:47:09 2021
</span><span class='line'> OS/Arch:           linux/amd64
</span><span class='line'> Experimental:      false
</span><span class='line'>
</span><span class='line'>Server:
</span><span class='line'> Engine:
</span><span class='line'>  Version:          18.09.0
</span><span class='line'>  EulerVersion:     18.09.0.206
</span><span class='line'>  API version:      1.39 (minimum version 1.12)
</span><span class='line'>  Go version:       go1.15.7
</span><span class='line'>  Git commit:       e4c0fb8
</span><span class='line'>  Built:            Fri Dec 31 21:46:37 2021
</span><span class='line'>  OS/Arch:          linux/amd64
</span><span class='line'>  Experimental:     false
</span><span class='line'>
</span><span class='line'>[root@localhost ~]# docker ps -a 
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span></code></pre></td></tr></table></div></figure>


<h2>å®‰è£…æœ€æ–°ç‰ˆ</h2>

<ul>
<li><a href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></li>
<li><a href="https://blog.csdn.net/Jairoguo/article/details/118403323">https://blog.csdn.net/Jairoguo/article/details/118403323</a></li>
</ul>


<h3>å®‰è£…åŒ…repoçš„å›½å†…æº</h3>

<ul>
<li>aliyunæºï¼š</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dnf config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></code></pre></td></tr></table></div></figure>


<ul>
<li>huaweiæºï¼š</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo yum-config-manager \
</span><span class='line'>    --add-repo \
</span><span class='line'>    https://repo.huaweicloud.com/docker-ce/linux/centos/docker-ce.repo
</span><span class='line'>sudo sed -i 's+download.docker.com+repo.huaweicloud.com/docker-ce+' /etc/yum.repos.d/docker-ce.repo</span></code></pre></td></tr></table></div></figure>


<h3>é—®é¢˜1ï¼š$releasever</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost ~]# yum search docker 
</span><span class='line'>Docker CE Stable - x86_64                                                                                                       240  B/s | 394  B     00:01    
</span><span class='line'>Errors during downloading metadata for repository 'docker-ce-stable':
</span><span class='line'>  - Status code: 404 for https://download.docker.com/linux/centos/20.03LTS_SP3/x86_64/stable/repodata/repomd.xml (IP: 13.224.160.26)
</span><span class='line'>Error: Failed to download metadata for repo 'docker-ce-stable': Cannot download repomd.xml: Cannot download repodata/repomd.xml: All mirrors were tried
</span></code></pre></td></tr></table></div></figure>


<p>è§£å†³ï¼š</p>

<p>è·Ÿcentosçš„å¯¹ä¸ä¸Šï¼Œç›´æ¥ç”¨centos-8çš„ç‰ˆæœ¬ï¼ŒæŠŠ <code>$releasever</code> æ”¹æˆ <code>8</code> :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost ~]# cat /etc/os-release 
</span><span class='line'>NAME="openEuler"
</span><span class='line'>VERSION="20.03 (LTS-SP3)"
</span><span class='line'>ID="openEuler"
</span><span class='line'>VERSION_ID="20.03"
</span><span class='line'>PRETTY_NAME="openEuler 20.03 (LTS-SP3)"
</span><span class='line'>ANSI_COLOR="0;31"
</span><span class='line'>
</span><span class='line'>[root@localhost ~]# arch
</span><span class='line'>x86_64
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># ä¿®æ”¹release-versionç‰ˆæœ¬ä¸º8ï¼š
</span><span class='line'>vi /etc/yum.repos.d/docker-ce.repo 
</span><span class='line'>:%s/$releasever/8/g
</span></code></pre></td></tr></table></div></figure>


<h3>é—®é¢˜2ï¼šBaseä¾èµ–</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  - cannot install the best candidate for the job
</span><span class='line'>  - nothing provides fuse-overlayfs &gt;= 0.7 needed by docker-ce-rootless-extras-20.10.0-3.el8.x86_64
</span><span class='line'>  - nothing provides slirp4netns &gt;= 0.4 needed by docker-ce-rootless-extras-20.10.0-3.el8.x86_64</span></code></pre></td></tr></table></div></figure>


<p>è§£å†³ï¼š</p>

<p>æ·»åŠ centos-baseåº“ï¼ŒåŒæ ·æ›¿æ¢æˆcentos-8çš„ç‰ˆæœ¬ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget -O /etc/yum.repos.d/CentOS-Base.repo https://repo.huaweicloud.com/repository/conf/CentOS-8-reg.repo
</span><span class='line'>[root@localhost ~]# vi /etc/yum.repos.d/CentOS-Base.repo 
</span><span class='line'>:%s/$releasever/8/g
</span></code></pre></td></tr></table></div></figure>


<h3>æ­£å¼å®‰è£…</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost ~]# yum install docker-ce docker-ce-cli containerd.io
</span><span class='line'>CentOS-8 - Base - repo.huaweicloud.com                                                                                          583 kB/s | 4.6 MB     00:08    
</span><span class='line'>CentOS-8 - AppStream - repo.huaweicloud.com                                                                                     565 kB/s | 8.4 MB     00:15    
</span><span class='line'>CentOS-8 - PowerTools - repo.huaweicloud.com                                                                                    626 kB/s | 2.3 MB     00:03    
</span><span class='line'>CentOS-8 - Extras - repo.huaweicloud.com                                                                                         43 kB/s |  10 kB     00:00    
</span><span class='line'>Dependencies resolved.
</span><span class='line'>================================================================================================================================================================
</span><span class='line'> Package                                  Architecture          Version                                                   Repository                       Size
</span><span class='line'>================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> containerd.io                            x86_64                1.4.12-3.1.el8                                            docker-ce-stable                 28 M
</span><span class='line'> docker-ce                                x86_64                3:20.10.12-3.el8                                          docker-ce-stable                 22 M
</span><span class='line'> docker-ce-cli                            x86_64                1:20.10.12-3.el8                                          docker-ce-stable                 30 M
</span><span class='line'>Upgrading:
</span><span class='line'> selinux-policy                           noarch                3.14.3-80.el8_5.2                                         BaseOS                          636 k
</span><span class='line'> selinux-policy-targeted                  noarch                3.14.3-80.el8_5.2                                         BaseOS                           15 M
</span><span class='line'>Installing dependencies:
</span><span class='line'> container-selinux                        noarch                2:2.167.0-1.module_el8.5.0+911+f19012f9                   AppStream                        54 k
</span><span class='line'> docker-ce-rootless-extras                x86_64                20.10.12-3.el8                                            docker-ce-stable                4.6 M
</span><span class='line'> docker-scan-plugin                       x86_64                0.12.0-3.el8                                              docker-ce-stable                3.7 M
</span><span class='line'> fuse-overlayfs                           x86_64                1.7.1-1.module_el8.5.0+890+6b136101                       AppStream                        73 k
</span><span class='line'> fuse3                                    x86_64                3.9.2-8.oe1                                               OS                              112 k
</span><span class='line'> libcgroup                                x86_64                0.42.2-1.oe1                                              OS                               96 k
</span><span class='line'> libslirp                                 x86_64                4.4.0-1.module_el8.5.0+890+6b136101                       AppStream                        70 k
</span><span class='line'> slirp4netns                              x86_64                1.1.8-1.module_el8.5.0+890+6b136101                       AppStream                        51 k
</span><span class='line'>Installing weak dependencies:
</span><span class='line'> fuse3-help                               x86_64                3.9.2-8.oe1                                               OS                               14 k
</span><span class='line'>Enabling module streams:
</span><span class='line'> container-tools                                                rhel8                                                                                          
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>================================================================================================================================================================
</span><span class='line'>Install  12 Packages
</span><span class='line'>Upgrade   2 Packages
</span><span class='line'>
</span><span class='line'>Total download size: 105 M
</span></code></pre></td></tr></table></div></figure>


<h3>ä½¿ç”¨</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost ~]# docker version
</span><span class='line'>Client: Docker Engine - Community
</span><span class='line'> Version:           20.10.12
</span><span class='line'> API version:       1.41
</span><span class='line'> Go version:        go1.16.12
</span><span class='line'> Git commit:        e91ed57
</span><span class='line'> Built:             Mon Dec 13 11:45:22 2021
</span><span class='line'> OS/Arch:           linux/amd64
</span><span class='line'> Context:           default
</span><span class='line'> Experimental:      true
</span><span class='line'>
</span><span class='line'>Server: Docker Engine - Community
</span><span class='line'> Engine:
</span><span class='line'>  Version:          20.10.12
</span><span class='line'>  API version:      1.41 (minimum version 1.12)
</span><span class='line'>  Go version:       go1.16.12
</span><span class='line'>  Git commit:       459d0df
</span><span class='line'>  Built:            Mon Dec 13 11:43:44 2021
</span><span class='line'>  OS/Arch:          linux/amd64
</span><span class='line'>  Experimental:     false
</span><span class='line'> containerd:
</span><span class='line'>  Version:          1.4.12
</span><span class='line'>  GitCommit:        7b11cfaabd73bb80907dd23182b9347b4245eb5d
</span><span class='line'> runc:
</span><span class='line'>  Version:          1.0.2
</span><span class='line'>  GitCommit:        v1.0.2-0-g52b36a2
</span><span class='line'> docker-init:
</span><span class='line'>  Version:          0.19.0
</span><span class='line'>  GitCommit:        de40ad0
</span><span class='line'>
</span><span class='line'>[root@localhost ~]# docker ps -a 
</span><span class='line'>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</span><span class='line'>
</span><span class='line'>[root@localhost ~]# docker pull centos:7
</span><span class='line'>7: Pulling from library/centos
</span><span class='line'>2d473b07cdd5: Pull complete 
</span><span class='line'>Digest: sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987
</span><span class='line'>Status: Downloaded newer image for centos:7
</span><span class='line'>docker.io/library/centos:7
</span><span class='line'>[root@localhost ~]# 
</span><span class='line'>[root@localhost ~]# docker images 
</span><span class='line'>REPOSITORY   TAG       IMAGE ID       CREATED        SIZE
</span><span class='line'>centos       7         eeb6ee3f44bd   3 months ago   204MB
</span><span class='line'>
</span><span class='line'>[root@localhost ~]# docker run --rm centos:7 hostname 
</span><span class='line'>3c7a047ec95e
</span><span class='line'>[root@localhost ~]# docker run --rm centos:7 date 
</span><span class='line'>Thu Jan 13 03:33:12 UTC 2022
</span></code></pre></td></tr></table></div></figure>


<h2>dockeré•œåƒåŠ é€Ÿ</h2>

<ul>
<li><a href="https://www.runoob.com/docker/docker-mirror-acceleration.html">https://www.runoob.com/docker/docker-mirror-acceleration.html</a></li>
<li><a href="https://mirrors.ustc.edu.cn/help/dockerhub.html">https://mirrors.ustc.edu.cn/help/dockerhub.html</a></li>
</ul>


<p>æ·»åŠ é•œåƒé…ç½®ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># https://docker.mirrors.ustc.edu.cn/
</span><span class='line'># https://hub-mirror.c.163.com
</span><span class='line'># https://reg-mirror.qiniu.com
</span><span class='line'>[root@localhost ~]# cat /etc/docker/daemon.json
</span><span class='line'>{
</span><span class='line'>"registry-mirrors":["https://reg-mirror.qiniu.com/"]
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>[root@localhost ~]# service docker restart 
</span><span class='line'>Redirecting to /bin/systemctl restart docker.service
</span><span class='line'>[root@localhost ~]# docker info 
</span><span class='line'>Registry Mirrors:
</span><span class='line'> https://reg-mirror.qiniu.com/
</span></code></pre></td></tr></table></div></figure>


<p>è¿è¡Œä¸€ä¸ªhello-worldçœ‹çœ‹é€Ÿåº¦ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost ~]# docker run hello-world 
</span><span class='line'>Unable to find image 'hello-world:latest' locally
</span><span class='line'>latest: Pulling from library/hello-world
</span><span class='line'>2db29710123e: Pull complete 
</span><span class='line'>Digest: sha256:975f4b14f326b05db86e16de00144f9c12257553bba9484fed41f9b6f2257800
</span><span class='line'>Status: Downloaded newer image for hello-world:latest
</span><span class='line'>
</span><span class='line'>Hello from Docker!
</span><span class='line'>This message shows that your installation appears to be working correctly.
</span><span class='line'>
</span><span class='line'>To generate this message, Docker took the following steps:
</span><span class='line'> 1. The Docker client contacted the Docker daemon.
</span><span class='line'> 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
</span><span class='line'>    (amd64)
</span><span class='line'> 3. The Docker daemon created a new container from that image which runs the
</span><span class='line'>    executable that produces the output you are currently reading.
</span><span class='line'> 4. The Docker daemon streamed that output to the Docker client, which sent it
</span><span class='line'>    to your terminal.
</span><span class='line'>
</span><span class='line'>To try something more ambitious, you can run an Ubuntu container with:
</span><span class='line'> $ docker run -it ubuntu bash
</span><span class='line'>
</span><span class='line'>Share images, automate workflows, and more with a free Docker ID:
</span><span class='line'> https://hub.docker.com/
</span><span class='line'>
</span><span class='line'>For more examples and ideas, visit:
</span><span class='line'> https://docs.docker.com/get-started/
</span></code></pre></td></tr></table></div></figure>


<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[octopressç”ŸæˆTOC]]></title>
    <link href="http://winse.github.io/blog/2021/12/08/octopress-generate-toc/"/>
    <updated>2021-12-08T18:23:23+08:00</updated>
    <id>http://winse.github.io/blog/2021/12/08/octopress-generate-toc</id>
    <content type="html"><![CDATA[<p>å°è¯•äº†jekyllç›´æ¥ç”Ÿæˆtocçš„æ–¹å¼éƒ½å¤±è´¥äº†ï¼Œæœ€ç»ˆé€šè¿‡jqueryè¿è¡Œæ—¶ç”Ÿæˆçš„æ–¹å¼å®ç°ç›®å½•å¯¼èˆªã€‚</p>

<h2>å‚è€ƒ</h2>

<ul>
<li><a href="http://brizzled.clapper.org/blog/2012/02/04/generating-a-table-of-contents-in-octopress/">Generating a Table of Contents in Octopress</a></li>
</ul>


<h2>æ­¥éª¤å®ç°</h2>

<h3>æ·»åŠ jquery.toc.min.js</h3>

<p>1ã€ä¸‹è½½ <a href="https://ndabas.github.io/toc/">https://ndabas.github.io/toc/</a> å½“å‰æ˜¯ 0.4.0 ç‰ˆæœ¬ã€‚è§£å‹æŠŠ jquery.toc.min.js æ”¾åˆ° source/javascripts/libs/ ç›®å½•ä¸‹ã€‚</p>

<p>2ã€åœ¨ source/_includes/head.html æ–‡ä»¶çš„ jquery.min.js ä¸‹ä¸€è¡Œå¼•å…¥ jquery.toc.min.js ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>  &lt;script&gt;!window.jQuery && document.write(unescape('%3Cscript src="{{ root_url }}/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))&lt;/script&gt;
</span><span class='line'>  &lt;script src="{{ root_url }}/javascripts/libs/jquery.toc.min.js" type="text/javascript"&gt;&lt;/script&gt;
</span><span class='line'></span></code></pre></td></tr></table></div></figure>


<h3>ä½¿ç”¨tocåˆ›å»ºç›®å½•å¯¼èˆª</h3>

<p>3ã€åœ¨ source/javascripts ç›®å½•ä¸‹åˆ›å»º generate-toc.js ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>function generateTOC(insertBefore, heading) {
</span><span class='line'>  var container = jQuery("&lt;div id='tocBlock'&gt;&lt;/div&gt;");
</span><span class='line'>  var div = jQuery("&lt;ul id='toc'&gt;&lt;/ul&gt;");
</span><span class='line'>  
</span><span class='line'>  var content = $(insertBefore).first();
</span><span class='line'>
</span><span class='line'>  if (heading != undefined && heading != null) {
</span><span class='line'>    container.append('&lt;span class="tocHeading"&gt;' + heading + '&lt;/span&gt;');
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>// div.tableOfContents(content);
</span><span class='line'>  div.toc({content: content, headings: "h2,h3,h4"});
</span><span class='line'>  container.append(div);
</span><span class='line'>  container.insertBefore(insertBefore);
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>å¹¶åœ¨ source/_includes/custom/head.html å¼•å…¥è¯¥æ–‡ä»¶ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>&lt;script src="{{ root_url }}/javascripts/generate-toc.js" type="text/javascript"&gt;&lt;/script&gt;
</span><span class='line'></span></code></pre></td></tr></table></div></figure>


<p>4ã€è¿è¡Œæ—¶è°ƒç”¨tocåˆ›å»ºç›®å½•ï¼Œåœ¨ source/_includes/custom/after_footer.html æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>{% if index %}
</span><span class='line'>  {% comment %}
</span><span class='line'>  No table of contents on the index page.
</span><span class='line'>  {% endcomment %}
</span><span class='line'>
</span><span class='line'>{% elsif page.toc == true %}
</span><span class='line'>  &lt;script type="text/javascript"&gt;
</span><span class='line'>  jQuery(document).ready(function() {
</span><span class='line'>    // Put a TOC right before the entry content.
</span><span class='line'>    generateTOC('.entry-content', 'ç›®å½•');
</span><span class='line'>  });
</span><span class='line'>  &lt;/script&gt;
</span><span class='line'>{% endif %}
</span><span class='line'></span></code></pre></td></tr></table></div></figure>


<h3>CSSæ ·å¼</h3>

<p>5ã€æ·»åŠ æ ·å¼ï¼Œåœ¨ sass/custom ç›®å½•ä¸‹æ·»åŠ  _screen.scss æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$toc-bg: #dfdfdf;
</span><span class='line'>
</span><span class='line'>$toc-incr: 5px;
</span><span class='line'>
</span><span class='line'>div#tocBlock {
</span><span class='line'>border-radius: 10px;
</span><span class='line'>padding: 10px;
</span><span class='line'>box-shadow: 5px 5px 5px #999;
</span><span class='line'>
</span><span class='line'>    float: right;
</span><span class='line'>    font-size: 10pt;
</span><span class='line'>    width: 300px;
</span><span class='line'>    padding-left: 20px;
</span><span class='line'>    padding-right: 10px;
</span><span class='line'>    padding-top: 10px;
</span><span class='line'>    padding-bottom: 0px;
</span><span class='line'>
</span><span class='line'>    background: $toc-bg;
</span><span class='line'>    border: solid 1px #999999;
</span><span class='line'>    margin: 0 0 10px 15px;
</span><span class='line'>
</span><span class='line'>    .tocHeading {
</span><span class='line'>        font-weight: bold;
</span><span class='line'>        font-size: 125%;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    #toc {
</span><span class='line'>        background: $toc-bg;
</span><span class='line'>        ul {
</span><span class='line'>            list-style: disc;
</span><span class='line'>            li {
</span><span class='line'>                margin-left: $toc-incr !important;
</span><span class='line'>                padding: 0 !important;
</span><span class='line'>            }
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>å¹¶æŠŠè¯¥æ–‡ä»¶æ·»åŠ åˆ° sass/screen.scss ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@import "custom/screen";
</span></code></pre></td></tr></table></div></figure>


<h3>è¿è¡Œè°ƒè¯•</h3>

<p>6ã€åˆ é™¤ source/stylesheets/screen.css</p>

<p>7ã€é¢„è§ˆçœ‹æ•ˆæœ <code>rake preview</code></p>

<h2>jekyllç”Ÿæˆ æŸ¥çœ‹</h2>

<blockquote><p>{:toc} ï¼Œjekyll-toc ï¼Œjekyll html éƒ½æ²¡è¯•æˆåŠŸï¼Œéš¾é“æ˜¯jekyll-2å¤ªè€äº†ï¼Ÿ</p></blockquote>

<ul>
<li><a href="https://plutotree.me/jekyll/2019/01/30/jekyll-toc-solution.html">https://plutotree.me/jekyll/2019/01/30/jekyll-toc-solution.html</a></li>
<li><a href="http://www.zhengjiachao.com/topics/github.io/add-outline-on-jekyll-post.html">http://www.zhengjiachao.com/topics/github.io/add-outline-on-jekyll-post.html</a></li>
<li><a href="https://github.com/allejo/jekyll-toc#usage">https://github.com/allejo/jekyll-toc#usage</a></li>
</ul>


<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è®¤çœŸçš„åšå®¢]]></title>
    <link href="http://winse.github.io/blog/2021/12/08/recommand-blogs/"/>
    <updated>2021-12-08T14:37:36+08:00</updated>
    <id>http://winse.github.io/blog/2021/12/08/recommand-blogs</id>
    <content type="html"><![CDATA[<p>å¹³æ—¶æŸ¥é˜…ä¸€äº›èµ„æ–™ï¼Œå¯¹ä¸€ä¸ªé—®é¢˜æè¿°æ˜ç¡®ã€è§£å†³é—®é¢˜æ–¹æ³•æ¸…æ™°çš„ï¼Œå¸¸å¸¸ä¼šç¿»ä¸€ç¿»è¿™ä¸ªåšå®¢æ‰€æœ‰æ–‡ç« ã€‚</p>

<p>çœ‹åˆ°è®¤çœŸå†™æ–‡ç« ï¼Œè®¤çœŸå­¦ä¹ ï¼Œè®¤çœŸå·¥ä½œï¼Œè®¤çœŸç”Ÿæ´»ï¼Œå¹¶ä¸”æŠŠè¿™äº›èƒ½è®°å½•ä¸‹æ¥çš„å……æ»¡æ•¬æ„ã€‚ä»ä»Šå¤©å¼€å§‹é™¤äº†æŠŠå®ƒä»¬åŠ å…¥æ”¶è—å¤¹ï¼Œä¹ŸæŠŠå®ƒä»¬å½’é›†åˆ°ä¸€èµ·ï¼Œä»¥åæ—¶å¸¸çš„å»ç¿»ä¸€ç¿»æµè§ˆï¼Œä»è¿™äº›è®¤çœŸçš„äººèº«ä¸Šå¸å–çŸ¥è¯†å’ŒåŠ›é‡ã€‚</p>

<h2>é˜³æ˜ k8s</h2>

<ul>
<li><p><a href="https://www.qikqiak.com/archives/">https://www.qikqiak.com/archives/</a></p></li>
<li><p><a href="https://www.qikqiak.com/post/visually-explained-k8s-service/">å›¾è§£ Kubernetes Service</a></p></li>
<li><a href="https://www.qikqiak.com/post/visually-explained-k8s-ingress/">å›¾è§£ Kubernetes Ingress</a></li>
</ul>


<h2>å’–å•¡æœº(K.F.J)</h2>

<ul>
<li><a href="https://www.cnblogs.com/strick/">https://www.cnblogs.com/strick/</a></li>
</ul>


<h2>è£æ˜åŒå­¦</h2>

<ul>
<li><a href="https://www.rmliu.com/">https://www.rmliu.com/</a></li>
<li><a href="https://github.com/Kate-liu">https://github.com/Kate-liu</a></li>
</ul>


<h2>fishedeeä¸ªäººæ„Ÿæ‚Ÿ</h2>

<p><img src="https://image.fishedee.com/FulTCoakq411USQX_3HiZ79_fH0i" alt="" /></p>

<ul>
<li><a href="https://blog.fishedee.com/2021/07/06/%E3%80%8ATypeScript%E7%BC%96%E7%A8%8B%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0">ã€ŠTypeScriptç¼–ç¨‹ã€‹è¯»ä¹¦ç¬”è®°</a></li>
<li><a href="https://blog.fishedee.com/2021/02/11/2020%E5%B9%B4%E5%B9%B4%E6%9C%AB%E6%80%BB%E7%BB%93">2020å¹´å¹´æœ«æ€»ç»“</a></li>
<li><a href="https://blog.fishedee.com/2017/12/23/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E4%B8%AD%E5%B9%B4%E5%8D%B1%E6%9C%BA">ç¨‹åºå‘˜çš„ä¸­å¹´å±æœº</a></li>
</ul>


<p>æåˆ°ä¸¤æœ¬ä¹¦ï¼šã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡æ¨¡å¼ã€åŸç†ä¸å®è·µã€‹å’Œã€Šæ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡ã€‹</p>

<h2>cutesunshineriver</h2>

<p><img src="https://www.iteye.com/upload/logo/user/1252039/ef863f68-2eab-3e79-a10f-a49b4995911f.jpg" title="å‘¨è€å¸ˆ" alt="" /></p>

<ul>
<li><a href="https://www.iteye.com/blog/cutesunshineriver-2274933">è¿™ä¸¤å¹´å…³æ³¨çš„æŠ€æœ¯åšå®¢</a></li>
</ul>


<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æ–è®¯K2åˆ·æœºpadavan]]></title>
    <link href="http://winse.github.io/blog/2021/09/15/k2-again/"/>
    <updated>2021-09-15T17:48:41+08:00</updated>
    <id>http://winse.github.io/blog/2021/09/15/k2-again</id>
    <content type="html"><![CDATA[<p>å¾ˆä¹…ä»¥å‰åˆ·äº†è¿‡ä¸€æ¬¡ï¼Œæœ€è¿‘æœ‹å‹åœ¨è·¯ç”±å™¨ä¸ŠåŠ äº†clashä»£ç†ç”šæ˜¯ç¾¡æ…•å•Šï¼Œäºæ˜¯ä¹æƒ³ç€è‡ªå·±ä¹Ÿé‡æ–°åˆ·ä¸ªé«˜çº§ä¸€ç‚¹çš„å›ºä»¶ç³»ç»Ÿï¼Œç„¶åæ•´ä¸ªç½‘ç»œçš„éƒ½å¯ä»¥googleäº†ï¼Œæ‰‹æœºä¹Ÿå¯ä»¥ï¼Œé‚£å®šæ˜¯çˆ½æäº†ã€‚</p>

<p>ä¸èµ°ä¸çŸ¥é“ï¼Œé‡è¿ˆæ­¥ã€ä¸‡é‡å±±ã€å˜äº†å¤©å‘€ã€‚é‚£ä¸€èº«æ±‰ä¸çŸ¥æ˜¯å“å‡ºè¿˜æ˜¯å¹²å‡ºæ¥çš„ã€‚</p>

<p>ä»¥ä¸‹è¿‡ç¨‹ä»…ä¾›å‚è€ƒï¼Œå› ä¸ºæˆ‘ä¹Ÿæ˜¯å‚è€ƒåˆ«äººçš„ï¼Œä½†æ˜¯è¿‡ç¨‹ä¹Ÿæ˜¯è†æ£˜ä¸›ä¸›ã€‚</p>

<h2>äº†è§£k2åˆ·padavançš„æµç¨‹</h2>

<ul>
<li><a href="https://blog.csdn.net/bingyu880101/article/details/82915433">æ–è®¯K2 åˆ·bread å’Œç¬¬ä¸‰æ–¹è€æ¯›å­Padavanå›ºä»¶</a></li>
<li><a href="https://www.cnblogs.com/DamonDing/p/8546617.html">åˆ·æœºæ•´ä¸ªè¿‡ç¨‹</a> *</li>
<li><a href="https://vircloud.net/linux/openwrt-psg1218.html">https://vircloud.net/linux/openwrt-psg1218.html</a> å›¾æ–‡*</li>
</ul>


<p>ç‰ˆæœ¬å¾ˆé‡è¦ï¼Œä¸å¯¹è¦å‘½é‚£å°±å¯èƒ½ç›´æ¥å˜ç –äº†ï¼</p>

<p>1) ä¸­é—´å‡çº§æ–è®¯ç‰ˆæœ¬æäº†å¾ˆå¤šæ¬¡ï¼Œå…ˆå‡åˆ° ã€K2_V22.6.506.28 + breed Webæ§åˆ¶å°åŠ©æ‰‹v5.8ç‰ˆæœ¬ã€‘ ä¸è¡Œï¼ˆå¯èƒ½æ˜¯å„ä¸ªé›¶ä»¶æ²¡é…å€¼å¯¹ï¼Œåˆæˆ–è€…windowsçš„ç—…æ¯’é˜²æŠ¤å’Œé˜²ç«å¢™æ²¡å…³ï¼‰ï¼Œ    <br/>
2) ç„¶ååˆå‡åˆ° K2_V22.6.507.43 è¿˜æ˜¯ä¸è¡Œï¼Œ    <br/>
3) åˆé™å› K2_V22.6.506.28ï¼Œä½¿ç”¨ã€è·¯ç”±å™¨åˆ·breed Webæ§åˆ¶å°åŠ©æ‰‹v4.8ç‰ˆæœ¬ã€‘åˆ·æˆåŠŸäº†ã€‚</p>

<ul>
<li>æ­£ç¡®æ–è®¯k2åˆ·breedç‰ˆæœ¬</li>
</ul>


<p><a href="https://github.com/kuangyeheng/k2_router_files">https://github.com/kuangyeheng/k2_router_files</a></p>

<ul>
<li>æœ€ååˆ·æˆåŠŸåè®¿é—®åœ°å€æ˜¯ï¼š192.168.123.1</li>
</ul>


<h2>ç®€å•æµç¨‹ä»‹ç»</h2>

<p>åˆ·æˆåŠŸä½¿ç”¨çš„æ–‡ä»¶å¦‚ä¸‹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Hå¤§1001ç‰ˆæœ¬RT-AC54U-GPIO-1-PSG1218-64M_3.4.3.9-099.trx
</span><span class='line'>K2_V22.6.506.28.bin
</span><span class='line'>RoutAckProV1B2.rar
</span><span class='line'>è·¯ç”±å™¨åˆ·breed+Webæ§åˆ¶å°åŠ©æ‰‹v4.8ç‰ˆæœ¬.7z</span></code></pre></td></tr></table></div></figure>


<p>æ­¥éª¤å¦‚ä¸‹ï¼š</p>

<p>1) æ¥æœ‰çº¿ï¼Œè¿›å…¥192.168.2.1ç®¡ç†ç•Œé¢ <code>æ‰‹åŠ¨å‡çº§</code> åˆ° K2_V22.6.506.28</p>

<p>2) æ‰“å¼€ <code>RoutAckProV1B2.exe</code> ç‚¹å‡» <code>æ‰“å¼€Telnet</code></p>

<p>3) å…³é—­æ€æ¯’/é˜²ç—…æ¯’è½¯ä»¶ï¼ˆä¼šè¢«æ£€æµ‹å‡ºæ¯’ï¼‰å’Œé˜²ç«å¢™ï¼ˆä¼šå¼€å¯ä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨ï¼‰ï¼Œå³é”®ä½¿ç”¨ç®¡ç†å‘˜èº«ä»½è¿è¡Œ <code>è·¯ç”±å™¨åˆ·breed Webæ§åˆ¶å°åŠ©æ‰‹v4.8ç‰ˆæœ¬.exe</code> ï¼Œé€‰k2çš„åˆ·æœºæ–¹æ¡ˆ      <br/>
4) ç¨å¾®ç­‰ç­‰ï¼Œä¼šå¼¹å‡ºåˆ·æˆåŠŸæç¤ºã€‚ç„¶åä¼šå¼¹å‡ºæ‡’äººæ¨¡å¼ï¼Œä¸ç®¡ç›´æ¥å…³æ‰</p>

<p>5) æ–­è·¯ç”±å™¨çš„ç”µï¼Œç„¶åæŒ‰ç€reseté”®ä¸æ¾æ‰‹ï¼Œæœ€åé€šç”µ5ç§’åå†æ¾å¼€reseté”®      <br/>
6) è®¿é—® <a href="http://192.168.1.1">http://192.168.1.1</a> è¿›å…¥Breed Webæ¢å¤æ§åˆ¶å°   <br/>
7) æ¢å¤å‡ºå‚è®¾ç½®ï¼Œé€‰ <code>ConfigåŒºï¼ˆå…¬ç‰ˆï¼‰</code>   <br/>
8) å›ºä»¶æ›´æ–°ï¼Œé€‰ <code>å›ºä»¶</code> ä¸Šé¢çš„trxæ–‡ä»¶ï¼Œç„¶åç­‰     <br/>
9) å¶å°”åˆ·æ–° 192.168.123.1 , è®¿é—®æˆåŠŸå°±è¯´æ˜okäº†ã€‚é»˜è®¤å¯†ç admin/admin</p>

<h2>ç§‘å­¦ä¸Šç½‘</h2>

<p><a href="https://ssrv2ray.xyz/posts/%E8%80%81%E6%AF%9B%E5%AD%90padavan%E5%9B%BA%E4%BB%B6ssv2ray%E6%9C%BA%E5%9C%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AE%A2%E9%98%85%E4%B8%8Eclash%E9%85%8D%E7%BD%AE">https://ssrv2ray.xyz/posts/%E8%80%81%E6%AF%9B%E5%AD%90padavan%E5%9B%BA%E4%BB%B6ssv2ray%E6%9C%BA%E5%9C%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AE%A2%E9%98%85%E4%B8%8Eclash%E9%85%8D%E7%BD%AE</a></p>

<p><a href="https://viencoding.com/article/155">https://viencoding.com/article/155</a></p>

<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[åœ¨æ ‘è“æ´¾ä¸Šéƒ¨ç½²redmine - Respberrypi]]></title>
    <link href="http://winse.github.io/blog/2020/05/11/redmine-on-arm-pi/"/>
    <updated>2020-05-11T10:33:44+08:00</updated>
    <id>http://winse.github.io/blog/2020/05/11/redmine-on-arm-pi</id>
    <content type="html"><![CDATA[<p>å˜åºŸä¸ºå®ã€‚</p>

<p>æœåŠ¡å™¨æ²¡æ€ä¹ˆç”¨ï¼Œä½†æ˜¯å¶å°”åˆæƒ³è®¿é—®ä¸‹æ–‡æ¡£æˆ–è€…redmineï¼Œç‹ ç‹ å¿ƒå’¬å’¬ç‰™æœ€åæŠŠx64ä¸Šçš„è¿ç§»åˆ°äº†æ ‘è“æ´¾2ï¼š Raspbian GNU/Linux 9 (stretch) ã€‚</p>

<p>æ¸©æ•…ä¸‹åŸæ¥redmineçš„å®‰è£…è¿‡ç¨‹ï¼š <a href="http://www.winseliu.com/blog/2017/09/18/redmine-deploy-and-install-plugins/">Redmineéƒ¨ç½²ä»¥åŠæ’ä»¶å®‰è£…</a></p>

<p>è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°äº†dockerçš„é‡æ–°ç¼–è¯‘ï¼Œè¿™å…¶ä¸­ä¸»è¦ä½¿ç”¨ubuntu aptæºç åœ¨æœ¬åœ°armä¸Šè¿›è¡Œå†ç¼–è¯‘ã€‚å…¶ä¸­æ¶‰åŠçš„é•œåƒæœ‰ï¼š</p>

<ul>
<li><a href="https://github.com/sameersbn/docker-ubuntu/tree/14.04">https://github.com/sameersbn/docker-ubuntu/tree/14.04</a></li>
<li><a href="https://github.com/sameersbn/docker-postgresql/tree/9.6-2">https://github.com/sameersbn/docker-postgresql/tree/9.6-2</a></li>
<li><a href="https://github.com/sameersbn/docker-redmine/tree/3.4.6">https://github.com/sameersbn/docker-redmine/tree/3.4.6</a></li>
</ul>


<h2>å¤‡ä»½</h2>

<p>redmineç›´æ¥æ•´ä¸ªç›®å½•æ‰“åŒ… /srv/docker/redmine/redmine ã€‚æ•°æ®åº“çš„è¦å¤‡ä»½å‡ºæ¥ï¼Œæ¶æ„ä¸åŒä¸å…¼å®¹ã€‚</p>

<p>è¿™æ˜¯ç¼–è¯‘åarm postgresç›´æ¥ç”¨x64çš„/srv/docker/redmine/postgresqlçš„æŠ¥é”™ä¿¡æ¯ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@raspberrypi:~# docker run --rm -ti --entrypoint="bash" -v /srv/docker/redmine/postgresql:/var/lib/postgresql sameersbn/postgresql:9.6-2 
</span><span class='line'>
</span><span class='line'>root@8f39c2904607:/var/lib/postgresql# sudo -HEu postgres /usr/lib/postgresql/9.6/bin/pg_ctl -D /var/lib/postgresql/9.6/main -w start
</span><span class='line'>waiting for server to start....FATAL:  database files are incompatible with server
</span><span class='line'>DETAIL:  The database cluster was initialized with USE_FLOAT8_BYVAL but the server was compiled without USE_FLOAT8_BYVAL.
</span><span class='line'>HINT:  It looks like you need to recompile or initdb.
</span><span class='line'>LOG:  database system is shut down
</span><span class='line'>stopped waiting
</span><span class='line'>pg_ctl: could not start server
</span><span class='line'>Examine the log output.</span></code></pre></td></tr></table></div></figure>


<h2>ç¼–è¯‘ubuntué•œåƒ</h2>

<p>ç›´æ¥ä½¿ç”¨æœ€æ–°çš„trustyå‘å¸ƒç‰ˆé•œåƒã€‚ç”±äºä½ç‰ˆæœ¬çš„å¯èƒ½ä¼šæ²¡æœ‰ linux/arm/v7 : <a href="https://hub.docker.com/_/ubuntu/?tab=tags&amp;page=1&amp;name=trusty">https://hub.docker.com/_/ubuntu/?tab=tags&amp;page=1&amp;name=trusty</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@raspberrypi:~/docker-ubuntu# vi Dockerfile
</span><span class='line'>FROM ubuntu:trusty
</span><span class='line'>
</span><span class='line'>docker build -t sameersbn/ubuntu:14.04.20170123 . 
</span><span class='line'>docker tag sameersbn/ubuntu:14.04.20170123 sameersbn/ubuntu:14.04.20170711 
</span></code></pre></td></tr></table></div></figure>


<h2>ç¼–è¯‘postgresé•œåƒ</h2>

<p>ç”±äºpostgresql aptçš„åº“ä¸­æ²¡æœ‰armhfçš„debï¼Œéœ€è¦å…ˆæ‰‹åŠ¨ç¼–è¯‘å¥½å¯¹åº”çš„debã€‚å…ˆè¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œå†é‡Œé¢ç¼–è¯‘å¥½postgresã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - \
</span><span class='line'> && echo 'deb-src http://mirrors.zju.edu.cn/postgresql/repos/apt/ trusty-pgdg main' &gt; /etc/apt/sources.list.d/pgdg.list \
</span><span class='line'> && sed -i 's/ports.ubuntu.com/mirrors.aliyun.com/' /etc/apt/sources.list \
</span><span class='line'> && sed -Ei 's/^# deb-src /deb-src /' /etc/apt/sources.list \
</span><span class='line'> && apt-get update
</span><span class='line'>
</span><span class='line'>root@7d55994af11e:/# apt-get build-dep dh-exec postgresql-common  pgdg-keyring     
</span><span class='line'>root@7d55994af11e:/# apt-get source --compile dh-exec postgresql-common  pgdg-keyring   
</span><span class='line'>
</span><span class='line'>root@7d55994af11e:/# apt-get build-dep postgresql-${PG_VERSION} postgresql-client-${PG_VERSION} postgresql-contrib-${PG_VERSION} dh-exec
</span><span class='line'>root@7d55994af11e:/# apt-get source --compile postgresql-${PG_VERSION} postgresql-client-${PG_VERSION} postgresql-contrib-${PG_VERSION} 
</span></code></pre></td></tr></table></div></figure>


<p>å†æµ‹è¯•å®‰è£…ä¸€ä¸‹è¿™äº›debï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - \
</span><span class='line'> && echo 'deb-src http://mirrors.zju.edu.cn/postgresql/repos/apt/ trusty-pgdg main' &gt; /etc/apt/sources.list.d/pgdg.list \
</span><span class='line'> && sed -i 's/ports.ubuntu.com/mirrors.aliyun.com/' /etc/apt/sources.list \
</span><span class='line'> && sed -Ei 's/^# deb-src /deb-src /' /etc/apt/sources.list \
</span><span class='line'> && apt-get update
</span><span class='line'>
</span><span class='line'>apt-get install -y acl \
</span><span class='line'>    libpipeline1 debhelper ssl-cert libxml2 libedit2 libxslt1.1 libperl5.18 libpython2.7 libpython3.4 libtcl8.6
</span><span class='line'>
</span><span class='line'>dpkg -i pgdg-keyring_2018.2_all.deb postgresql-common_201.pgdg14.04+1_all.deb  postgresql-client-common_201.pgdg14.04+1_all.deb
</span><span class='line'>
</span><span class='line'>dpkg -i libpq5_9.6.13-1.pgdg14.04+1_armhf.deb  postgresql-9.6_9.6.13-1.pgdg14.04+1_armhf.deb postgresql-client-9.6_9.6.13-1.pgdg14.04+1_armhf.deb postgresql-contrib-9.6_9.6.13-1.pgdg14.04+1_armhf.deb
</span></code></pre></td></tr></table></div></figure>


<p>ä¿®æ”¹Dockerfileï¼Œç›´æ¥é€šè¿‡dpkgå®‰è£…postgresqlçš„debï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@raspberrypi:~/docker-postgresql# less Dockerfile 
</span><span class='line'>...
</span><span class='line'>COPY deb/ /tmp/psql/
</span><span class='line'>
</span><span class='line'>RUN wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - \
</span><span class='line'> && echo 'deb-src http://mirrors.zju.edu.cn/postgresql/repos/apt/ trusty-pgdg main' &gt; /etc/apt/sources.list.d/pgdg.list \
</span><span class='line'> && sed -i 's/ports.ubuntu.com/mirrors.aliyun.com/' /etc/apt/sources.list \
</span><span class='line'> && sed -Ei 's/^# deb-src /deb-src /' /etc/apt/sources.list \
</span><span class='line'> && apt-get update \
</span><span class='line'> && DEBIAN_FRONTEND=noninteractive apt-get install -y acl \
</span><span class='line'>    libpipeline1 debhelper ssl-cert libxml2 libedit2 libxslt1.1 libperl5.18 libpython2.7 libpython3.4 libtcl8.6 \
</span><span class='line'> && cd /tmp/psql \
</span><span class='line'> && dpkg -i pgdg-keyring_2018.2_all.deb postgresql-common_201.pgdg14.04+1_all.deb  postgresql-client-common_201.pgdg14.04+1_all.deb \
</span><span class='line'> && dpkg -i libpq5_9.6.13-1.pgdg14.04+1_armhf.deb  postgresql-9.6_9.6.13-1.pgdg14.04+1_armhf.deb postgresql-client-9.6_9.6.13-1.pgdg14.04+1_armhf.deb postgresql-contrib-9.6_9.6.13-1.pgdg14.04+1_armhf.deb \
</span><span class='line'> && rm -rf /tmp/psql \
</span><span class='line'>...
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~/docker-postgresql# docker build -t sameersbn/postgresql:9.6-2 .</span></code></pre></td></tr></table></div></figure>


<h2>ç¼–è¯‘redmineé•œåƒ</h2>

<p>redmineä¸»è¦æ˜¯ç¼ºå°‘ruby2.3çš„åŒ…ï¼Œè·Ÿä¸Šé¢çš„æ­¥éª¤ç±»ä¼¼ã€‚å…ˆç¼–è¯‘å‡ºarmçš„ruby2.3ï¼Œå†ç¼–è¯‘é•œåƒã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sed -i 's/ports.ubuntu.com/mirrors.aliyun.com/' /etc/apt/sources.list \
</span><span class='line'>&& sed -Ei 's/^# deb-src /deb-src /' /etc/apt/sources.list
</span><span class='line'>
</span><span class='line'>apt-get build-dep ruby${RUBY_VERSION} ruby${RUBY_VERSION}-dev
</span><span class='line'>apt-get source --compile ruby${RUBY_VERSION} ruby${RUBY_VERSION}-dev
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~/docker-redmine# vi Dockerfile 
</span><span class='line'>...
</span><span class='line'>COPY deb/ /tmp/ruby/
</span><span class='line'>
</span><span class='line'>RUN apt-key adv --keyserver keyserver.ubuntu.com --recv E1DD270288B4E6030699E45FA1715D88E1DF1F24 \
</span><span class='line'> && echo "deb http://ppa.launchpad.net/git-core/ppa/ubuntu trusty main" &gt;&gt; /etc/apt/sources.list \
</span><span class='line'> && apt-key adv --keyserver keyserver.ubuntu.com --recv 80F70E11F0F0D5F10CB20E62F5DA5F09C3173AA6 \
</span><span class='line'> && echo "deb http://ppa.launchpad.net/brightbox/ruby-ng/ubuntu trusty main" &gt;&gt; /etc/apt/sources.list \
</span><span class='line'> && apt-key adv --keyserver keyserver.ubuntu.com --recv 8B3981E7A6852F782CC4951600A6F0A3C300EE8C \
</span><span class='line'> && echo "deb http://ppa.launchpad.net/nginx/stable/ubuntu trusty main" &gt;&gt; /etc/apt/sources.list \
</span><span class='line'> && wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - \
</span><span class='line'> && echo 'deb-src http://apt.postgresql.org/pub/repos/apt/ trusty-pgdg main' &gt; /etc/apt/sources.list.d/pgdg.list \
</span><span class='line'> && sed -i 's/ports.ubuntu.com/mirrors.aliyun.com/' /etc/apt/sources.list \
</span><span class='line'> && sed -Ei 's/^# deb-src /deb-src /' /etc/apt/sources.list \
</span><span class='line'> && apt-get update \
</span><span class='line'> && DEBIAN_FRONTEND=noninteractive apt-get install -y supervisor logrotate nginx mysql-client postgresql-client \
</span><span class='line'>      imagemagick subversion git cvs bzr mercurial darcs rsync   locales openssh-client \
</span><span class='line'>      gcc g++ make patch pkg-config gettext-base   libc6-dev zlib1g-dev libxml2-dev \
</span><span class='line'>      libmysqlclient18 libpq5 libyaml-0-2 libcurl3 libssl1.0.0 uuid-dev xz-utils \
</span><span class='line'>      libxslt1.1 libffi6 zlib1g gsfonts \
</span><span class='line'>      libgmpxx4ldbl libgmp-dev libtk8.5 libxft2 libxrender1 libxss1 x11-common libtcl8.5 rubygems-integration \
</span><span class='line'> && dpkg -i /tmp/ruby/*.deb \
</span><span class='line'> && rm -rf /tmp/ruby \
</span><span class='line'> && update-locale LANG=C.UTF-8 LC_MESSAGES=POSIX \
</span><span class='line'> && gem install --no-document --version '&lt; 2.0' bundler \
</span><span class='line'> && rm -rf /var/lib/apt/lists/*
</span><span class='line'>...
</span><span class='line'>
</span><span class='line'>root@raspberrypi:~/docker-redmine# docker build -t sameersbn/redmine:3.4.6 .</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœdockeræ„å»ºå¤±è´¥ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥è¿›è¡Œè°ƒè¯•ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 1
</span><span class='line'>docker commit $container-id image-id
</span><span class='line'>docker run -ti $image-id bash
</span><span class='line'>
</span><span class='line'># 2 
</span><span class='line'>å¤±è´¥ä¹Ÿä¼šæœ‰å‰ä¸€æ­¥éª¤çš„é•œåƒå·²ç»æäº¤ï¼Œå†æ¬¡åŸºç¡€ä¸Šæ£€æŸ¥åé¢çš„æ­¥éª¤
</span><span class='line'>The last successful step is 2. It produced an image a3acfa4ab179. Now you start a container
</span><span class='line'>docker run -it a3acfa4ab179 bash</span></code></pre></td></tr></table></div></figure>


<h2>ç»“åˆåŸæœ‰æ•°æ®è¿›è¡Œè¿ç§»</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># å¤‡ä»½
</span><span class='line'>psql -U postgres -cC --if-exists -d redmine_production &gt;redmine.dump 
</span><span class='line'>
</span><span class='line'># å®‰è£…compose
</span><span class='line'>root@raspberrypi:~/redmine/bin# python -m pip install --upgrade pip
</span><span class='line'>root@raspberrypi:~/redmine/bin# pip install docker-compose
</span><span class='line'>
</span><span class='line'># å¯åŠ¨
</span><span class='line'>root@raspberrypi:~/redmine/bin# docker-compose up -d 
</span><span class='line'>
</span><span class='line'># æ•°æ®åº“è¿˜åŸ
</span><span class='line'>docker cp redmine.dump e472d9ec3124:/var/lib/postgresql/
</span><span class='line'>psql -U postgres &lt;redmine.dump
</span><span class='line'>
</span><span class='line'># redmineä¿®å¤
</span><span class='line'>root@3f0774db222d:/home/redmine/redmine# apt-get install libmysqlclient-dev                                    
</span><span class='line'>
</span><span class='line'>https://stackoverflow.com/questions/13086073/rails-install-pg-cant-find-the-libpq-fe-h-header
</span><span class='line'>root@3f0774db222d:/home/redmine/redmine# apt-get install libpq-dev
</span><span class='line'>https://stackoverflow.com/questions/38200015/package-magickcore-was-not-found-in-the-pkg-config-search-path
</span><span class='line'>root@3f0774db222d:/home/redmine/redmine# apt-get install libmagickwand-dev
</span><span class='line'>
</span><span class='line'>root@3f0774db222d:/home/redmine/redmine# bundle install                    
</span></code></pre></td></tr></table></div></figure>


<p>åé¢å°±ç›´æ¥å®‰è£…docker-compose.ymlä¸­çš„ç«¯å£æ˜ å°„é…ç½®è®¿é—®å³å¯ã€‚</p>

<p>&ndash;END</p>
]]></content>
  </entry>
  
</feed>
