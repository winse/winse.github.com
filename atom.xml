<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Winse Blog]]></title>
  <link href="http://winse.github.io/atom.xml" rel="self"/>
  <link href="http://winse.github.io/"/>
  <updated>2014-07-29T22:10:40+08:00</updated>
  <id>http://winse.github.io/</id>
  <author>
    <name><![CDATA[Winse Liu]]></name>
    <email><![CDATA[winseliu@foxmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Hadoop2 Use ShortCircuit Local Reading]]></title>
    <link href="http://winse.github.io/blog/2014/07/29/hadoop2-use-shortcircuit-local-reading/"/>
    <updated>2014-07-29T20:11:58+08:00</updated>
    <id>http://winse.github.io/blog/2014/07/29/hadoop2-use-shortcircuit-local-reading</id>
    <content type="html"><![CDATA[<p>hadoop一直以来认为是本地读写文件的，但是其实也是通过TCP端口去获取数据，只是都在同一台机器。在hivetuning调优hive的文档中看到了ShortCircuit的HDFS配置属性，查看了ShortCircuit的来由，真正的实现了本地读取文件。蒙查查表示看的不是很明白，最终大致就是通过linux的<strong>文件描述符</strong>来实现功能同时保证文件的权限。</p>

<p>由于仅在自己的机器上面配置来查询hbase的数据，性能方面提升感觉不是很明显。等以后整到正式环境再对比对比。</p>

<p>配置如下。</p>

<p>1 修改hdfs-site.xml</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;property&gt;
</span><span class='line'>        &lt;name&gt;dfs.client.read.shortcircuit&lt;/name&gt;
</span><span class='line'>        &lt;value&gt;true&lt;/value&gt;
</span><span class='line'>&lt;/property&gt;
</span><span class='line'>
</span><span class='line'>&lt;property&gt;
</span><span class='line'>        &lt;name&gt;dfs.domain.socket.path&lt;/name&gt;
</span><span class='line'>        &lt;value&gt;/home/hadoop/data/sockets/dn_socket&lt;/value&gt;
</span><span class='line'>&lt;/property&gt;</span></code></pre></td></tr></table></div></figure>


<p>注意：socket路径的权限控制的比较严格。dn_socket<strong>所有的父路径</strong>要么仅有当前启动用户的读权限，要么仅root可读。</p>

<p><img src="http://file.bmob.cn/M00/05/52/wKhkA1PXfbKANLOrAADWJQ5taVs391.png" alt="" /></p>

<p>2 修改hbase的配置，并添加HADOOP_HOME（hbase查找hadoop-native）</p>

<p><img src="http://file.bmob.cn/M00/05/52/wKhkA1PXhRKAZDs6AAChrEauBoU738.png" alt="" /></p>

<p>hbase的脚本找到hadoop命令后，会把hadoop的java.library.path的路径加入到hbase的启动脚本中。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[hadoop@master1 ~]$ tail -15 hbase-0.98.3-hadoop2/conf/hbase-site.xml 
</span><span class='line'>    &lt;name&gt;hbase.tmp.dir&lt;/name&gt;
</span><span class='line'>    &lt;value&gt;/home/hadoop/data/hbase&lt;/value&gt;
</span><span class='line'>  &lt;/property&gt;
</span><span class='line'>
</span><span class='line'>&lt;property&gt;
</span><span class='line'>        &lt;name&gt;dfs.client.read.shortcircuit&lt;/name&gt;
</span><span class='line'>        &lt;value&gt;true&lt;/value&gt;
</span><span class='line'>&lt;/property&gt;
</span><span class='line'>
</span><span class='line'>&lt;property&gt;
</span><span class='line'>        &lt;name&gt;dfs.domain.socket.path&lt;/name&gt;
</span><span class='line'>        &lt;value&gt;/home/hadoop/data/sockets/dn_socket&lt;/value&gt;
</span><span class='line'>&lt;/property&gt;
</span><span class='line'>
</span><span class='line'>&lt;/configuration&gt;
</span><span class='line'>
</span><span class='line'>[hadoop@master1 ~]$ cat hbase-0.98.3-hadoop2/conf/hbase-env.sh
</span><span class='line'>...
</span><span class='line'>export HADOOP_HOME=/home/hadoop/hadoop-2.2.0
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<p>3 同步到其他节点，然后重启hdfs,hbase</p>

<h2>参考</h2>

<ul>
<li><a href="http://vdisk.weibo.com/s/z_44nz36hNM3Z">hive-tuning</a></li>
<li><a href="http://blog.cloudera.com/blog/2013/08/how-improved-short-circuit-local-reads-bring-better-performance-and-security-to-hadoop/">How Improved Short-Circuit Local Reads Bring Better Performance and Security to Hadoop</a></li>
<li><a href="http://hbase.apache.org/book/perf.hdfs.html">HDFS&ndash;Apache HBase Performance Tuning</a></li>
<li><a href="http://archive.cloudera.com/cdh4/cdh/4/hadoop/hadoop-project-dist/hadoop-hdfs/ShortCircuitLocalReads.html">HDFS Short-Circuit Local Reads</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hadoop安全的关闭datanode节点]]></title>
    <link href="http://winse.github.io/blog/2014/07/29/safely-remove-datanode/"/>
    <updated>2014-07-29T15:08:41+08:00</updated>
    <id>http://winse.github.io/blog/2014/07/29/safely-remove-datanode</id>
    <content type="html"><![CDATA[<p>hadoop默认就有冗余（dfs.replication）的机制，所以一般情况下，一台机器挂了也没所谓。集群会自动的进行复制均衡处理。</p>

<p>作为测试，如果dfs.replication设置为1的情况下，怎么安全的把datanode节点服务关闭呢？例如说，刚刚开始搭建环境是把namenode、datanode放在一台机器上，后面增加了机器如何把datanode分离出来呢？</p>

<p>借助于<strong>dfs.hosts.exclude</strong>即可完成顺序的完成此项任务。</p>

<p>修改hdfs-site.xml配置。我操作的时刻仅修改了master1上的hdfs-site.xml。把<strong>master1</strong>值写入到对应的文件中。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[hadoop@master1 hadoop]$ cat hdfs-site.xml 
</span><span class='line'>...
</span><span class='line'>&lt;property&gt;
</span><span class='line'>        &lt;name&gt;dfs.hosts.exclude&lt;/name&gt;
</span><span class='line'>        &lt;value&gt;/home/hadoop/hadoop-2.2.0/etc/hadoop/exclude&lt;/value&gt;
</span><span class='line'>&lt;/property&gt;
</span><span class='line'>
</span><span class='line'>&lt;/configuration&gt;
</span><span class='line'>[hadoop@master1 hadoop]$ cat /home/hadoop/hadoop-2.2.0/etc/hadoop/exclude
</span><span class='line'>master1
</span></code></pre></td></tr></table></div></figure>


<p>修改完成后，刷新节点即可(完全没有必要重启集dfs)。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hadoop dfsadmin -refreshNodes</span></code></pre></td></tr></table></div></figure>


<p>可以通过<code>dfsadmin -report</code>或者网页查看master1已经变成<em>Decommission In Progress</em>了。</p>

<p><img src="http://file.bmob.cn/M00/05/4C/wKhkA1PXUMOAVvvWAAED6CN-3Rg187.png" alt="" /></p>

<p>注：</p>

<p>问题一： 在新建节点是slaver1的防火墙没关闭，由于master1已经被exclude，而slaver1不能提供服务，上传文件时报错：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[hadoop@master1 hadoop]$ hadoop fs -put slaves  /
</span><span class='line'>14/07/29 15:18:21 WARN hdfs.DFSClient: DataStreamer Exception
</span><span class='line'>org.apache.hadoop.ipc.RemoteException(java.io.IOException): File /slaves._COPYING_ could only be replicated to 0 nodes instead of minReplication (=1).  There are 2 datanode(s) running and no node(s) are excluded in this operation.
</span><span class='line'>        at org.apache.hadoop.hdfs.server.blockmanagement.BlockManager.chooseTarget(BlockManager.java:1384)
</span><span class='line'>        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getAdditionalBlock(FSNamesystem.java:2477)</span></code></pre></td></tr></table></div></figure>


<p>关闭防火墙一样再次上传，还是报同样的错误。此时，也可以通过刷新节点<code>hadoop dfsadmin -refreshNodes</code>来解决。</p>

<p>问题二： 设置备份数量</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[hadoop@master1 hadoop]$ hadoop fs -setrep 3 /slaves 
</span><span class='line'>Replication 3 set: /slaves</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>问题三： 新增节点</p>

<p>拷贝程序到新增节点，然后启动</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[hadoop@master1 ~]$ tar zc hadoop-2.2.0 --exclude=logs | ssh slaver2 'cat | tar zx'
</span><span class='line'>
</span><span class='line'>[hadoop@slaver2 ~]$ cd hadoop-2.2.0/
</span><span class='line'>[hadoop@slaver2 hadoop-2.2.0]$ sbin/hadoop-daemon.sh start datanode</span></code></pre></td></tr></table></div></figure>


<p>也可以修改master上的slavers文件再<code>sbin/start-dfs.sh</code>启动。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Win编译32位openjdk]]></title>
    <link href="http://winse.github.io/blog/2014/07/21/build-openjdk/"/>
    <updated>2014-07-21T14:23:57+08:00</updated>
    <id>http://winse.github.io/blog/2014/07/21/build-openjdk</id>
    <content type="html"><![CDATA[<p>win编译32位openjdk7u60:</p>

<div><script src='https://gist.github.com/3e6b42012dfb228a5b02.js?file=OpenJDK-Build-README.md'></script>
<noscript><pre><code>## 编译jdk7u60过程中的注意点: 

0. 先看目录下的README-builds.html，不要太认真看个大概就行
1. 下载最新的Microsoft DirectX SDK，安装时路径不要带括号
2. 安装procps代替free.exe(检查可用内存是会用到，没有应该也可以就是多个警告而已)
3. cygwin-make的版本问题，使用3.81 [snapshot](http://farm6.staticflickr.com/5486/14325549816_da7343282b_o.png)
4. VS2010的cl命令显示的信息一直是中文的话，需要修改源码跳过版本号的检查 [snapshot](http://farm3.staticflickr.com/2928/14162188587_7874083086_o.png)
5. 语言问题，导致编译corba失败！而后面有需要用到这个工程！ [snapshot](http://farm3.staticflickr.com/2936/14347140552_0f29391905_o.png)
6. PATH顺序问题，link.exe和find.exe [snapshot](http://farm6.staticflickr.com/5483/14347108132_9abdac5ae8_o.png)
7. 编译时间有点长！ [snapshot](http://farm4.staticflickr.com/3867/14162097680_40d5f69561_o.png) [java-version](http://farm4.staticflickr.com/3881/14162098450_7e86bd5b0b_o.png)
8. 默认的make不带调试信息的，需要用`make fastdebug_build`。

## 步骤：

1、 下载

可以的话，通过cygwin的setup.exe安装mercurial也行。

* hg: &lt;http://tortoisehg.bitbucket.org/download/index.html&gt;
* source: http://hg.openjdk.java.net/jdk7u/jdk7u60/

```
cd E:
cd git/
mkdir openjdk
cd openjdk/

HG_HOME=/cygdrive/c/Program\ Files/TortoiseHg/
PATH=$PATH:$HG_HOME

hg clone http://hg.openjdk.java.net/jdk7u/jdk7u60/
cd jdk7u60/
ls
./get_source.sh
```

2、 安装依赖软件

* jdk1.7.0_02/apache-ant-1.9.0
* Visual Studio2010
* Cygwin
  * 按照README-builds.html#cygwin，能找的必须安装，找不到的随意。
  * 安装procps，包括了free.exe。
  * 安装binutils，包括了ar.exe。
  * 替换[make.exe](http://www.cmake.org/files/cygwin/make.exe), 添加[cygintl-3.dll](http://www.opendll.com/dll/c/__32-cygintl-3.dll.zip)。
* 下载解压[freetype](http://jaist.dl.sourceforge.net/project/gnuwin32/freetype/2.3.5-1/freetype-2.3.5-1-bin.zip) 
  * 把bin目录下的freetype6.dll文件拷贝到../lib/freetype.dll
  * 添加[zlib1.dll](http://75.duote.org/win_dll/zlib1.zip) 也可以下载[安装版本](http://jaist.dl.sourceforge.net/project/gnuwin32/freetype/2.3.5-1/)包括了zlib1.dll
  * [snapshot](http://farm4.staticflickr.com/3922/14162193337_65d281fc73_o.png)
* 下载安装[Microsoft DirectX](http://download.microsoft.com/download/F/1/7/F178BCE4-FA19-428F-BB60-F3DEE1130BFA/DXSDK_Feb10.exe)
  * 安装路径不要带括号 

3、 配置环境

* 切换为英文语言环境，当你重新启动看到的是【Welcome】的时刻说明你修改成功了！重启后记得make clean再进行后面的操作！
 * Windows7安装更新，添加英文语言包
* 环境变量的所有路径最好是/ 而不是\，不能带双引号（否则中间编译的时刻会遇到问题）[snapshot](http://farm4.staticflickr.com/3862/14162030769_8766efa9a5_o.png)
* PATH路径顺序的问题，cygwin/bin放在vs的后面，但需要放在windows的前面。link.exe和find.exe的问题

如果是在X64机器上编译，需要加ARCH_DATA_MODEL的参数。参见【README-builds.html#creating】

## 参考：

* 【膜拜】[openjdk windows 编译](http://blog.csdn.net/instruder/article/details/8834117)
* 【有点老，不过注意事项还是相同的】 [自己动手编译Windows版的OpenJDK 7](http://icyfenix.iteye.com/blog/1097344) 
* 【linux下安装】&lt;http://khotyn.iteye.com/blog/1225348&gt;
* 【cl版本问题，以及make程序问题】&lt;http://www.myexception.cn/program/779678.html&gt;
* 【emitPermissionCheck问题】&lt;http://mail.openjdk.java.net/pipermail/jdk6-dev/2013-November/003104.html&gt; &lt;http://comments.gmane.org/gmane.comp.java.openjdk.jdk6.devel/976&gt;</code></pre></noscript></div>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Install Ganglia on Redhat5+]]></title>
    <link href="http://winse.github.io/blog/2014/07/18/install-ganglia-on-redhat/"/>
    <updated>2014-07-18T14:53:44+08:00</updated>
    <id>http://winse.github.io/blog/2014/07/18/install-ganglia-on-redhat</id>
    <content type="html"><![CDATA[<p>对使用C写的复杂的程序安装心里有阴影，还有本来可以上网的话，使用yum安装会省很多的事情。
但是没办法，环境是这样，正式环境没有提供网络环境，搭建的本地yum环境也不知道行不行。</p>

<p>上次在自己电脑的虚拟机上面成功安装过ganglia，但apache、rrdtool依赖使用yum安装的，安装过程比较揪心。把ganglia安装到正式环境就不了了之的。
上个星期生产环境出现了用户查询数据久久不能返回的问题，由于查询程序写的比较差的缘故。但同时也给自己敲了警钟，都不知道集群机器运行情况，终究是大隐患；安装后监测集群同时为以后程序的调优工作带来便利。</p>

<p>本次安装全部使用源码包安装，有部分lib有重复编译。</p>

<p>总结下，原来安装ganglia就仅是按照网络的步骤一步步的弄，同时各个程序的版本又有可能不一致，每一步都胆战心惊！没有重点重心，以至于浪费了很多的事情。
分步骤有条不紊的操作就可以踏实多了，安装ganglia主要涉及三个核心部分(安装程序包<a href="http://yunpan.cn/QCFUiuyAWSyZI">下载</a>（提取码：0ec4）)：</p>

<ul>
<li>rrdtool</li>
<li>gmetad / gmond</li>
<li>apache / web</li>
<li>集群子节点部署</li>
<li>配置hadoop metrics监控hadoop集群</li>
</ul>


<p>按照顺序一个个的安装就可以了。无需为一个个依赖的版本不一致问题而忧心，同时可以更好的参考网络上的实践。</p>

<h2>安装rrdtool</h2>

<p>推荐按照<a href="http://oss.oetiker.ch/rrdtool/doc/rrdbuild.en.html#IBUILDING_DEPENDENCIES">官网教程</a>步骤操作，很&amp;非常的详细。
教程中环境变量必须得设置！这个很重点！</p>

<p>下面是安装rrdtool过程中用到的软件，列出的顺序即为安装的次序：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[hadoop@umcc97-44 rrdbuild]$ ll -tr | grep -v 'tar'
</span><span class='line'>总计 24132
</span><span class='line'>drwxrwxrwx  6   1000          1000    4096 07-17 12:12 pkg-config-0.23
</span><span class='line'>drwxr-xr-x 11 hadoop            80    4096 07-17 12:28 zlib-1.2.3
</span><span class='line'>drwxr-xr-x  7   1004 avahi-autoipd    4096 07-17 12:29 libpng-1.2.18
</span><span class='line'>drwxr-xr-x  8   1000 users            4096 07-17 12:31 freetype-2.3.5
</span><span class='line'>drwxrwxrwx 15  50138 vcsa            12288 07-17 16:37 libxml2-2.6.32
</span><span class='line'>drwxrwxrwx 15   1488 users            4096 07-17 16:53 fontconfig-2.4.2
</span><span class='line'>drwxrwxrwx  4 sjyw   sjyw             4096 07-17 16:56 pixman-0.10.0
</span><span class='line'>drwxrwsrwx  8   1000 ftp              4096 07-17 16:59 cairo-1.6.4
</span><span class='line'>drwxrwxrwx 12 sjyw   sjyw             4096 07-17 17:01 glib-2.15.4
</span><span class='line'>drwxrwxrwx  9 sjyw   sjyw             4096 07-17 17:16 pango-1.21.1
</span><span class='line'>drwxr-xr-x 11   1003          1001    4096 07-17 17:36 rrdtool-1.4.8</span></code></pre></td></tr></table></div></figure>


<p>具体操作的步骤（原来包括操作步骤，发现太累赘了重新调整了一下）：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 下面几个环境变量时基础！
</span><span class='line'>BUILD_DIR=/home/ganglia/rrdbuild
</span><span class='line'>INSTALL_DIR=/opt/rrdtool-1.4.8
</span><span class='line'>
</span><span class='line'>export PKG_CONFIG_PATH=${INSTALL_DIR}/lib/pkgconfig
</span><span class='line'>export PATH=$INSTALL_DIR/bin:$PATH
</span><span class='line'>
</span><span class='line'>export LDFLAGS="-Wl,--rpath -Wl,${INSTALL_DIR}/lib" 
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 rrdbuild]# tar zxvf pkg-config-0.23.tar.gz 
</span><span class='line'>[root@umcc97-44 rrdbuild]# cd pkg-config-0.23
</span><span class='line'>[root@umcc97-44 pkg-config-0.23]# ./configure --prefix=$INSTALL_DIR CFLAGS="-O3 -fPIC"
</span><span class='line'>[root@umcc97-44 pkg-config-0.23]# make && make install
</span><span class='line'>
</span><span class='line'># 这个环境变量也很重要
</span><span class='line'>[root@umcc97-44 pkg-config-0.23]# export PKG_CONFIG=$INSTALL_DIR/bin/pkg-config
</span><span class='line'>[root@umcc97-44 pkg-config-0.23]# cd ..
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 rrdbuild]# tar zxvf zlib-1.2.3.tar.gz 
</span><span class='line'>[root@umcc97-44 rrdbuild]# cd zlib-1.2.3
</span><span class='line'># 修改了下官网的命令; 64位问题 recompile with -fPIC
</span><span class='line'>[root@umcc97-44 zlib-1.2.3]# CFLAGS="-O3 -fPIC" ./configure
</span><span class='line'>[root@umcc97-44 zlib-1.2.3]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 rrdbuild]# tar zxvf libpng-1.2.18.tar.gz 
</span><span class='line'>[root@umcc97-44 rrdbuild]# cd libpng-1.2.18
</span><span class='line'>[root@umcc97-44 zlib-1.2.3]# cd ../libpng-1.2.18
</span><span class='line'>[root@umcc97-44 libpng-1.2.18]# env CFLAGS="-O3 -fPIC" ./configure --prefix=$INSTALL_DIR
</span><span class='line'>[root@umcc97-44 libpng-1.2.18]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 libpng-1.2.18]# cd ..
</span><span class='line'>[root@umcc97-44 rrdbuild]# tar zxvf freetype-2.3.5.tar.gz 
</span><span class='line'>[root@umcc97-44 rrdbuild]# cd freetype-2.3.5
</span><span class='line'>[root@umcc97-44 freetype-2.3.5]# ./configure --prefix=$INSTALL_DIR CFLAGS="-O3 -fPIC"
</span><span class='line'>[root@umcc97-44 freetype-2.3.5]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 rrdbuild]# tar zxvf libxml2-2.6.32.tar.gz 
</span><span class='line'>[root@umcc97-44 rrdbuild]# cd libxml2-2.6.32
</span><span class='line'>[root@umcc97-44 libxml2-2.6.32]#  ./configure --prefix=$INSTALL_DIR CFLAGS="-O3 -fPIC"
</span><span class='line'>[root@umcc97-44 libxml2-2.6.32]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 libxml2-2.6.32]# cd ..
</span><span class='line'>[root@umcc97-44 rrdbuild]# tar zxvf fontconfig-2.4.2.tar.gz 
</span><span class='line'>[root@umcc97-44 rrdbuild]# cd fontconfig-2.4.2
</span><span class='line'>[root@umcc97-44 fontconfig-2.4.2]# ./configure --prefix=$INSTALL_DIR CFLAGS="-O3 -fPIC" --with-freetype-config=$INSTALL_DIR/bin/freetype-config
</span><span class='line'>[root@umcc97-44 fontconfig-2.4.2]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 fontconfig-2.4.2]# cd ..
</span><span class='line'>[root@umcc97-44 rrdbuild]# cd pixman-0.10.0
</span><span class='line'>[root@umcc97-44 pixman-0.10.0]# ./configure --prefix=$INSTALL_DIR CFLAGS="-O3 -fPIC"
</span><span class='line'>[root@umcc97-44 pixman-0.10.0]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 pixman-0.10.0]# cd ../cairo-1.6.4
</span><span class='line'>[root@umcc97-44 cairo-1.6.4]# ./configure --prefix=$INSTALL_DIR \
</span><span class='line'>&gt;     --enable-xlib=no \
</span><span class='line'>&gt;     --enable-xlib-render=no \
</span><span class='line'>&gt;     --enable-win32=no \
</span><span class='line'>&gt;     CFLAGS="-O3 -fPIC"
</span><span class='line'>[root@umcc97-44 cairo-1.6.4]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 cairo-1.6.4]# cd ..
</span><span class='line'>[root@umcc97-44 rrdbuild]# tar zxvf glib-2.15.4.tar.gz 
</span><span class='line'>[root@umcc97-44 rrdbuild]# cd glib-2.15.4
</span><span class='line'>[root@umcc97-44 glib-2.15.4]# ./configure --prefix=$INSTALL_DIR CFLAGS="-O3 -fPIC"
</span><span class='line'>[root@umcc97-44 glib-2.15.4]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 rrdbuild]# bunzip2 -c pango-1.21.1.tar.bz2 | tar xf -
</span><span class='line'>[root@umcc97-44 rrdbuild]# ll
</span><span class='line'>[root@umcc97-44 rrdbuild]# cd pango-1.21.1
</span><span class='line'>[root@umcc97-44 pango-1.21.1]# ./configure --prefix=$INSTALL_DIR CFLAGS="-O3 -fPIC" --without-x
</span><span class='line'>[root@umcc97-44 pango-1.21.1]# export PATH=$INSTALL_DIR/bin:$PATH
</span><span class='line'>[root@umcc97-44 pango-1.21.1]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 rrdbuild]# cd rrdtool-1.4.8/
</span><span class='line'>[root@umcc97-44 rrdtool-1.4.8]#  ./configure --prefix=$INSTALL_DIR --disable-tcl --disable-python
</span><span class='line'>[root@umcc97-44 rrdtool-1.4.8]# make clean
</span><span class='line'>[root@umcc97-44 rrdtool-1.4.8]# make 
</span><span class='line'>[root@umcc97-44 rrdtool-1.4.8]# make install
</span><span class='line'>   
</span><span class='line'>## 安装完后，搞个例子玩玩   
</span><span class='line'>[root@umcc97-44 rrdtool-1.4.8]# cd /opt/rrdtool-1.4.8/share/rrdtool/examples/
</span><span class='line'>[root@umcc97-44 examples]# ll
</span><span class='line'>[root@umcc97-44 examples]# ./4charts.pl 
</span><span class='line'>This script has created 4charts.png in the current directory
</span><span class='line'>This demonstrates the use of the TIME and % RPN operators
</span><span class='line'># 运行完后，会在当前目录生成不同尺寸的png的图片
</span><span class='line'> 
</span><span class='line'>[hadoop@umcc97-44 ~]$ /opt/rrdtool-1.4.8/bin/rrdtool -v
</span><span class='line'>RRDtool 1.4.8  Copyright 1997-2013 by Tobias Oetiker &lt;tobi@oetiker.ch&gt;
</span><span class='line'>               Compiled Jul 17 2014 17:37:58
</span><span class='line'>
</span><span class='line'>Usage: rrdtool [options] command command_options
</span><span class='line'>Valid commands: create, update, updatev, graph, graphv,  dump, restore,
</span><span class='line'>      last, lastupdate, first, info, fetch, tune,
</span><span class='line'>      resize, xport, flushcached
</span><span class='line'>
</span><span class='line'>RRDtool is distributed under the Terms of the GNU General
</span><span class='line'>Public License Version 2. (www.gnu.org/copyleft/gpl.html)
</span><span class='line'>
</span><span class='line'>For more information read the RRD manpages</span></code></pre></td></tr></table></div></figure>


<p>到这里rrd安装好，遇到zlib的CFLAGS变量设置的问题，以及终端断了必须重新设置<strong>环境变量</strong>两个大点的问题！其他如果按照官网的顺序安装基本顺顺利利了。</p>

<p>同时认识到了pkg，其实类似于java的jar嘛，依赖包不一定非要安装在系统的默认位置，自己管理也是一种简单易行的方式。接下来安装gmetad/gmond也使用这样方式，为后面部署gmond带来便利：所有依赖的包都放在一个目录下嘛！
接下来ganglia程序。</p>

<h2>gmetad安装</h2>

<p>需要用到的软件包：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./gangliabuild/ganglia-web-3.5.12
</span><span class='line'>./gangliabuild/apr-1.5.1
</span><span class='line'>./gangliabuild/apr-util-1.5.3
</span><span class='line'>./gangliabuild/confuse-2.7
</span><span class='line'>./gangliabuild/expat-2.0.1
</span><span class='line'>./gangliabuild/ganglia-3.6.0</span></code></pre></td></tr></table></div></figure>


<p>整个安装过程，除了make的时刻rrd的库找不到的问题（通过LD_LIBRARY_PATH解决），其他都安装的很顺。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 把下载来的tar全部解压
</span><span class='line'>[root@umcc97-44 gangliabuild]# find . -name "*.tar.gz" -exec tar zxvf {} \;
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 gangliabuild]# cd expat-2.0.1
</span><span class='line'>[root@umcc97-44 expat-2.0.1]# INSTALL_DIR=/opt/ganglia
</span><span class='line'>[root@umcc97-44 expat-2.0.1]# ./configure --prefix=$INSTALL_DIR 
</span><span class='line'>[root@umcc97-44 expat-2.0.1]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 expat-2.0.1]# cd ../apr-1.5.1
</span><span class='line'>[root@umcc97-44 apr-1.5.1]# ./configure --prefix=$INSTALL_DIR 
</span><span class='line'>[root@umcc97-44 apr-1.5.1]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 apr-1.5.1]# cd ../apr-util-1.5.3
</span><span class='line'>[root@umcc97-44 apr-util-1.5.3]# ./configure --with-apr=/opt/ganglia --with-expat=/opt/ganglia --prefix=$INSTALL_DIR 
</span><span class='line'>[root@umcc97-44 apr-util-1.5.3]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 apr-util-1.5.3]# cd ../confuse-2.7
</span><span class='line'>[root@umcc97-44 confuse-2.7]# ./configure CFLAGS=-fPIC --disable-nls --prefix=$INSTALL_DIR 
</span><span class='line'>[root@umcc97-44 confuse-2.7]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 confuse-2.7]# cd ../ganglia-3.6.0
</span><span class='line'>[root@umcc97-44 ganglia-3.6.0]# export LDFLAGS="-Wl,--rpath -Wl,${INSTALL_DIR}/lib" 
</span><span class='line'>[root@umcc97-44 ganglia-3.6.0]# export PKG_CONFIG_PATH=${INSTALL_DIR}/lib/pkgconfig
</span><span class='line'># 注意sysconfdir，运行程序配置所在的目录
</span><span class='line'>[root@umcc97-44 ganglia-3.6.0]# ./configure --prefix=$INSTALL_DIR --with-librrd=/opt/rrdtool-1.4.8 --with-libexpat=/opt/ganglia --with-libconfuse=/opt/ganglia --with-libpcre=no  --with-gmetad --enable-gexec --enable-status -sysconfdir=/etc/ganglia
</span><span class='line'>...
</span><span class='line'>Welcome to..
</span><span class='line'>     ______                  ___
</span><span class='line'>    / ____/___ _____  ____ _/ (_)___ _
</span><span class='line'>   / / __/ __ `/ __ \/ __ `/ / / __ `/
</span><span class='line'>  / /_/ / /_/ / / / / /_/ / / / /_/ /
</span><span class='line'>  \____/\__,_/_/ /_/\__, /_/_/\__,_/
</span><span class='line'>                   /____/
</span><span class='line'>
</span><span class='line'>Copyright (c) 2005 University of California, Berkeley
</span><span class='line'>
</span><span class='line'>Version: 3.6.0
</span><span class='line'>Library: Release 3.6.0 0:0:0
</span><span class='line'>
</span><span class='line'>Type "make" to compile.
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 ganglia-3.6.0]# 
</span><span class='line'># 设置rrd的LIB路径
</span><span class='line'>[root@umcc97-44 ganglia-3.6.0]# export LD_LIBRARY_PATH=/opt/rrdtool-1.4.8/lib
</span><span class='line'>[root@umcc97-44 ganglia-3.6.0]# make
</span><span class='line'>[root@umcc97-44 ganglia-3.6.0]# make install</span></code></pre></td></tr></table></div></figure>


<p>接下来是配置gmetad</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@umcc97-44 ganglia-3.6.0]#  cd gmetad
</span><span class='line'>[root@umcc97-44 gmetad]# cp gmetad.init /etc/init.d/gmetad
</span><span class='line'>[root@umcc97-44 gmetad]# chkconfig gmetad on
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 gmetad]# chkconfig --list gmetad
</span><span class='line'>gmetad            0:off   1:off   2:on    3:on    4:on    5:on    6:off
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 gmetad]# mkdir -p /var/lib/ganglia/rrds
</span><span class='line'>[root@umcc97-44 gmetad]# chown nobody:nobody /var/lib/ganglia/rrds
</span><span class='line'>[root@umcc97-44 gmetad]# 
</span><span class='line'># 没有启动起来，程序的路径不对
</span><span class='line'>[root@umcc97-44 gmetad]# service gmetad start
</span><span class='line'>Starting GANGLIA gmetad: 
</span><span class='line'>[root@umcc97-44 gmetad]# 
</span><span class='line'>[root@umcc97-44 gmetad]# ln -s /opt/ganglia/sbin/gmetad /usr/sbin/gmetad
</span><span class='line'>[root@umcc97-44 gmetad]# service gmetad start
</span><span class='line'>Starting GANGLIA gmetad: [  OK  ]
</span><span class='line'>
</span><span class='line'># 配置
</span><span class='line'>[root@umcc97-44 gmetad]# cp gmetad.conf /etc/ganglia/gmetad.conf
</span><span class='line'>[root@umcc97-44 gmetad]# vi /etc/ganglia/gmetad.conf 
</span><span class='line'> datasource "hadoop" localhost
</span><span class='line'> rrd_rootdir "/var/lib/ganglia/rrds"
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 gmetad]# service gmetad restart
</span><span class='line'>Shutting down GANGLIA gmetad: [  OK  ]
</span><span class='line'>Starting GANGLIA gmetad: [  OK  ]
</span><span class='line'>
</span><span class='line'># 测试下
</span><span class='line'>[root@umcc97-44 gmetad]# telnet localhost 8651</span></code></pre></td></tr></table></div></figure>


<h2>gmond安装</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@umcc97-44 gmetad]# pwd
</span><span class='line'>/home/ganglia/gangliabuild/ganglia-3.6.0/gmetad
</span><span class='line'>[root@umcc97-44 gmetad]# cd ..
</span><span class='line'>[root@umcc97-44 ganglia-3.6.0]# ./configure --prefix=$INSTALL_DIR  --with-libpcre=no
</span><span class='line'>...
</span><span class='line'>Welcome to..
</span><span class='line'>     ______                  ___
</span><span class='line'>    / ____/___ _____  ____ _/ (_)___ _
</span><span class='line'>   / / __/ __ `/ __ \/ __ `/ / / __ `/
</span><span class='line'>  / /_/ / /_/ / / / / /_/ / / / /_/ /
</span><span class='line'>  \____/\__,_/_/ /_/\__, /_/_/\__,_/
</span><span class='line'>                   /____/
</span><span class='line'>
</span><span class='line'>Copyright (c) 2005 University of California, Berkeley
</span><span class='line'>
</span><span class='line'>Version: 3.6.0
</span><span class='line'>Library: Release 3.6.0 0:0:0
</span><span class='line'>
</span><span class='line'>Type "make" to compile.
</span><span class='line'>
</span><span class='line'># 尽管检查通过了，但是make会报错
</span><span class='line'># 需要指定lib包位置
</span><span class='line'>[root@umcc97-44 ganglia-3.6.0]# ./configure --prefix=$INSTALL_DIR  --with-libpcre=no  --with-libexpat=/opt/ganglia --with-libconfuse=/opt/ganglia -sysconfdir=/etc/ganglia
</span><span class='line'>[root@umcc97-44 ganglia-3.6.0]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 ganglia-3.6.0]# cd gmond/
</span><span class='line'>[root@umcc97-44 gmond]# ./gmond -t &gt; /etc/ganglia/gmond.conf
</span><span class='line'>
</span><span class='line'># 和gmetad一样，需要把路径把程序做个软连接
</span><span class='line'>[root@umcc97-44 gmond]# cat gmond.init
</span><span class='line'>  #!/bin/sh
</span><span class='line'>  #
</span><span class='line'>  # chkconfig: 2345 70 40
</span><span class='line'>  # description: gmond startup script
</span><span class='line'>  #
</span><span class='line'>  GMOND=/usr/sbin/gmond
</span><span class='line'>
</span><span class='line'>...
</span><span class='line'>[root@umcc97-44 gmond]# ln -s /opt/ganglia/sbin/gmond /usr/sbin/gmond
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 gmond]# cp gmond.init /etc/init.d/gmond
</span><span class='line'>[root@umcc97-44 gmond]# chkconfig --add gmond
</span><span class='line'>[root@umcc97-44 gmond]# chkconfig --list gmond
</span><span class='line'>gmond             0:off   1:off   2:on    3:on    4:on    5:on    6:off
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 ganglia-3.6.0]# vi /etc/ganglia/gmond.conf 
</span><span class='line'> cluster-name
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 ganglia-3.6.0]# service gmond start
</span><span class='line'>Starting GANGLIA gmond: [  OK  ]
</span><span class='line'>
</span><span class='line'># 测试下
</span><span class='line'>[root@umcc97-44 ganglia-3.6.0]# telnet localhost 8649</span></code></pre></td></tr></table></div></figure>


<p>查看运行情况：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@umcc97-44 ganglia-3.6.0]# ldconfig -v
</span><span class='line'>[root@umcc97-44 ganglia-3.6.0]# /opt/ganglia/bin/gstat -a</span></code></pre></td></tr></table></div></figure>


<h2>apache和php环境安装</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@umcc97-44 webbuild]# tar zxvf httpd-2.4.9.tar.gz 
</span><span class='line'>[root@umcc97-44 webbuild]# cd httpd-2.4.9
</span><span class='line'>[root@umcc97-44 httpd-2.4.9]# ./configure -with-enable-so -sysconfdir=/etc/httpd
</span><span class='line'>...
</span><span class='line'>checking for APR... no
</span><span class='line'>configure: error: APR not found.  Please read the documentation.
</span><span class='line'>
</span><span class='line'># 前面安装ganglia时也安装过APR但是安装的目录指定的，混用不是很好。查看官方安装2.4的安装文档，可以直接把apr放到srclib下，编译时会同时编译这些依赖
</span><span class='line'>[root@umcc97-44 httpd-2.4.9]# cd srclib/
</span><span class='line'>[root@umcc97-44 srclib]# cp -r /home/ganglia/gangliabuild/apr-1.5.1 ./
</span><span class='line'>[root@umcc97-44 srclib]# cp -r /home/ganglia/gangliabuild/apr-util-1.5.3 ./
</span><span class='line'>[root@umcc97-44 srclib]# mv apr-1.5.1 apr
</span><span class='line'>[root@umcc97-44 srclib]# mv apr-util-1.5.3 apr-util
</span><span class='line'>[root@umcc97-44 srclib]# ll
</span><span class='line'>[root@umcc97-44 srclib]# cd ..
</span><span class='line'>[root@umcc97-44 httpd-2.4.9]#  cd ../
</span><span class='line'>[root@umcc97-44 webbuild]# tar zxvf pcre-8.35.tar.gz 
</span><span class='line'># 正则表达式的包，这里安装默认位置
</span><span class='line'>[root@umcc97-44 webbuild]# cd pcre-8.35
</span><span class='line'>[root@umcc97-44 pcre-8.35]# ./configure 
</span><span class='line'>[root@umcc97-44 pcre-8.35]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 pcre-8.35]# cd ../httpd-2.4.9
</span><span class='line'>[root@umcc97-44 httpd-2.4.9]# ./configure --with-included-apr -with-enable-so -sysconfdir=/etc/httpd
</span><span class='line'>[root@umcc97-44 httpd-2.4.9]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 httpd-2.4.9]# cd /usr/local/apache2/
</span><span class='line'>[root@umcc97-44 apache2]# cd /etc/httpd
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 httpd]# cd /home/ganglia/webbuild/
</span><span class='line'>[root@umcc97-44 webbuild]# tar zxvf php-5.5.14\ \(2\).tar.gz 
</span><span class='line'>[root@umcc97-44 webbuild]# cd php-5.5.14
</span><span class='line'># 用了安装rrd时的libxml
</span><span class='line'>[root@umcc97-44 php-5.5.14]# ./configure -with-apxs2=/usr/local/apache2/bin/apxs --with-libxml-dir=/opt/rrdtool-1.4.8/ -sysconfdir=/etc -with-config-file-path=/etc -with-config-file-scan-dir=/usr/etc/php.d -with-zlib
</span><span class='line'>[root@umcc97-44 php-5.5.14]# make && make install
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 php-5.5.14]#  
</span><span class='line'>[root@umcc97-44 php-5.5.14]#  vi /etc/httpd/httpd.conf
</span><span class='line'>
</span><span class='line'>  LoadModule php5_module        modules/libphp5.so #这个安装php后自动加上了
</span><span class='line'>
</span><span class='line'>  DocumentRoot "/var/www/html"
</span><span class='line'>  &lt;Directory "/var/www/html"&gt;
</span><span class='line'>
</span><span class='line'>  AddType application/x-httpd-php .php
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 php-5.5.14]# /usr/local/apache2/bin/apachectl start
</span><span class='line'>AH00526: Syntax error on line 215 of /etc/httpd/httpd.conf:
</span><span class='line'>DocumentRoot must be a directory
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 php-5.5.14]# mkdir -p /var/www/html
</span><span class='line'>[root@umcc97-44 php-5.5.14]# /usr/local/apache2/bin/apachectl start
</span><span class='line'>AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.18.97.44. Set the 'ServerName' directive globally to suppress this message
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 php-5.5.14]#  vi /etc/httpd/httpd.conf
</span><span class='line'>  ServerName
</span><span class='line'>[root@umcc97-44 php-5.5.14]#/usr/local/apache2/bin/apachectl start
</span><span class='line'>httpd (pid 31416) already running
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 php-5.5.14]# cp /usr/local/apache2/bin/apachectl /etc/init.d/httpd
</span><span class='line'>[root@umcc97-44 php-5.5.14]# chkconfig --add httpd
</span><span class='line'>service httpd does not support chkconfig
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 ~]# vi /etc/init.d/httpd 
</span><span class='line'> #chkconfig: 2345 10 90
</span><span class='line'> #description: Activates/Deactivates Apache Web Server
</span><span class='line'> 
</span><span class='line'>[root@umcc97-44 ~]# service httpd start
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 ~]# cd /var/www/html/
</span><span class='line'>[root@umcc97-44 ~]# vi index.php
</span><span class='line'># http://umcc97-44 浏览器查看下结果
</span><span class='line'>
</span><span class='line'># /usr/local/apache2/bin/apachectl -k stop
</span><span class='line'>[root@umcc97-44 ganglia-web]# service httpd -k stop   
</span><span class='line'># 等apache结束
</span><span class='line'>[root@umcc97-44 ganglia-web]# tail -f /usr/local/apache2/logs/error_log </span></code></pre></td></tr></table></div></figure>


<p>部署ganglia-web：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@umcc97-44 ~]# cd /home/ganglia/gangliabuild/ganglia-web-3.5.12
</span><span class='line'>[root@umcc97-44 ganglia-web-3.5.12]# ls
</span><span class='line'>[root@umcc97-44 ganglia-web-3.5.12]# make install
</span><span class='line'>rsync --exclude "rpmbuild" --exclude "*.gz" --exclude "Makefile" --exclude "*debian*" --exclude "ganglia-web-3.5.12" --exclude ".git*" --exclude "*.in" --exclude "*~" --exclude "#*#" --exclude "ganglia-web.spec" --exclude "apache.conf" -a . ganglia-web-3.5.12
</span><span class='line'>mkdir -p //var/lib/ganglia-web/dwoo/compiled && \
</span><span class='line'>  mkdir -p //var/lib/ganglia-web/dwoo/cache && \
</span><span class='line'>  mkdir -p //var/lib/ganglia-web && \
</span><span class='line'>  rsync -a ganglia-web-3.5.12/conf //var/lib/ganglia-web && \
</span><span class='line'>  mkdir -p //usr/share/ganglia-webfrontend && \
</span><span class='line'>  rsync --exclude "conf" -a ganglia-web-3.5.12/* //usr/share/ganglia-webfrontend && \
</span><span class='line'>  chown -R root:root //var/lib/ganglia-web
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 ganglia-web-3.5.12]# mv /usr/share/ganglia-webfrontend /var/www/html/ganglia
</span><span class='line'>[root@umcc97-44 ganglia-web-3.5.12]# cd /var/www/html/ganglia/    
</span><span class='line'>
</span><span class='line'># 修改配置，在安装完gmetad后有新建/var/lib/ganglia/rrds其实和conf中的配置是一致的
</span><span class='line'>[root@umcc97-44 ganglia]# cp conf_default.php conf.php    
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 ganglia]# cd /var/lib/ganglia-web/
</span><span class='line'>[root@umcc97-44 ganglia-web]# cd dwoo/
</span><span class='line'>[root@umcc97-44 dwoo]# ll
</span><span class='line'>total 8
</span><span class='line'>drwxr-xr-x 2 root root 4096 Jul 17 21:34 cache
</span><span class='line'>drwxr-xr-x 2 root root 4096 Jul 17 21:34 compiled
</span><span class='line'>[root@umcc97-44 dwoo]# chmod 777 *    
</span><span class='line'># http://umcc97-44/ganglia</span></code></pre></td></tr></table></div></figure>


<p>部署gmond到其他集群节点</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>[root@umcc97-44 opt]# cat /etc/init.d/gmond 
</span><span class='line'>  #!/bin/sh
</span><span class='line'>  #
</span><span class='line'>  # chkconfig: 2345 70 40
</span><span class='line'>  # description: gmond startup script
</span><span class='line'>  #
</span><span class='line'>  GMOND=/usr/sbin/gmond   
</span><span class='line'>
</span><span class='line'>[root@umcc97-44 opt]# vi /etc/ganglia/gmetad.conf     
</span><span class='line'> data_source
</span><span class='line'> # 重启gmetad
</span><span class='line'>[root@umcc97-44 opt]# ssh-copy-id -i ~/.ssh/id_rsa.pub umcc97-144
</span><span class='line'>[root@umcc97-44 opt]# scp /etc/init.d/gmond umcc97-144:/etc/init.d/
</span><span class='line'>[root@umcc97-44 opt]# ssh umcc97-144 'mkdir /etc/ganglia' 
</span><span class='line'>[root@umcc97-44 opt]# scp /etc/ganglia/gmond.conf  umcc97-144:/etc/ganglia/
</span><span class='line'>[root@umcc97-44 opt]# rsync -vaz ganglia umcc97-144:/opt/
</span><span class='line'>[root@umcc97-44 opt]# ssh umcc97-144
</span><span class='line'>Last login: Tue Jun 10 12:08:47 2014
</span><span class='line'>
</span><span class='line'>[root@umcc97-144 ~]# ln -s /opt/ganglia/sbin/gmond /usr/sbin/gmond
</span><span class='line'>[root@umcc97-144 ~]# chkconfig --add gmond
</span><span class='line'>[root@umcc97-144 ~]# service gmond start
</span><span class='line'>Starting GANGLIA gmond: [  OK  ]
</span><span class='line'>
</span><span class='line'>[root@umcc97-144 ~]# </span></code></pre></td></tr></table></div></figure>


<h2>Hadoop/Hbase Metrics配置</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[hadoop@umcc97-44 ~]$ cat hadoop-2.2.0/etc/hadoop/hadoop-metrics*
</span><span class='line'>#
</span><span class='line'>#   Licensed to the Apache Software Foundation (ASF) under one or more
</span><span class='line'>#   contributor license agreements.  See the NOTICE file distributed with
</span><span class='line'>#   this work for additional information regarding copyright ownership.
</span><span class='line'>#   The ASF licenses this file to You under the Apache License, Version 2.0
</span><span class='line'>#   (the "License"); you may not use this file except in compliance with
</span><span class='line'>#   the License.  You may obtain a copy of the License at
</span><span class='line'>#
</span><span class='line'>#       http://www.apache.org/licenses/LICENSE-2.0
</span><span class='line'>#
</span><span class='line'>#   Unless required by applicable law or agreed to in writing, software
</span><span class='line'>#   distributed under the License is distributed on an "AS IS" BASIS,
</span><span class='line'>#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span><span class='line'>#   See the License for the specific language governing permissions and
</span><span class='line'>#   limitations under the License.
</span><span class='line'>#
</span><span class='line'>
</span><span class='line'># syntax: [prefix].[source|sink].[instance].[options]
</span><span class='line'># See javadoc of package-info.java for org.apache.hadoop.metrics2 for details
</span><span class='line'>
</span><span class='line'># @changed
</span><span class='line'>#*.sink.file.class=org.apache.hadoop.metrics2.sink.FileSink
</span><span class='line'># default sampling period, in seconds
</span><span class='line'>#*.period=10
</span><span class='line'>
</span><span class='line'># The namenode-metrics.out will contain metrics from all context
</span><span class='line'>#namenode.sink.file.filename=namenode-metrics.out
</span><span class='line'># Specifying a special sampling period for namenode:
</span><span class='line'>#namenode.sink.*.period=8
</span><span class='line'>
</span><span class='line'>#datanode.sink.file.filename=datanode-metrics.out
</span><span class='line'>
</span><span class='line'># the following example split metrics of different
</span><span class='line'># context to different sinks (in this case files)
</span><span class='line'>#jobtracker.sink.file_jvm.context=jvm
</span><span class='line'>#jobtracker.sink.file_jvm.filename=jobtracker-jvm-metrics.out
</span><span class='line'>#jobtracker.sink.file_mapred.context=mapred
</span><span class='line'>#jobtracker.sink.file_mapred.filename=jobtracker-mapred-metrics.out
</span><span class='line'>
</span><span class='line'>#tasktracker.sink.file.filename=tasktracker-metrics.out
</span><span class='line'>
</span><span class='line'>#maptask.sink.file.filename=maptask-metrics.out
</span><span class='line'>
</span><span class='line'>#reducetask.sink.file.filename=reducetask-metrics.out
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>*.sink.ganglia.class=org.apache.hadoop.metrics2.sink.ganglia.GangliaSink31
</span><span class='line'>*.sink.ganglia.period=10
</span><span class='line'>
</span><span class='line'>*.sink.ganglia.slope=jvm.metrics.gcCount=zero,jvm.metrics.memHeapUsedM=both
</span><span class='line'>*.sink.ganglia.dmax=jvm.metrics.threadsBlocked=70,jvm.metrics.memHeapUsedM=40
</span><span class='line'>
</span><span class='line'>namenode.sink.ganglia.servers=umcc97-44:8649
</span><span class='line'>resourcemanager.sink.ganglia.servers=umcc97-44:8649
</span><span class='line'>
</span><span class='line'>datanode.sink.ganglia.servers=umcc97-44:8649
</span><span class='line'>nodemanager.sink.ganglia.servers=umcc97-44:8649
</span><span class='line'>
</span><span class='line'>maptask.sink.ganglia.servers=umcc97-44:8649
</span><span class='line'>reducetask.sink.ganglia.servers=umcc97-44:8649
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># Configuration of the "dfs" context for null
</span><span class='line'>dfs.class=org.apache.hadoop.metrics.spi.NullContext
</span><span class='line'>
</span><span class='line'># Configuration of the "dfs" context for file
</span><span class='line'>#dfs.class=org.apache.hadoop.metrics.file.FileContext
</span><span class='line'>#dfs.period=10
</span><span class='line'>#dfs.fileName=/tmp/dfsmetrics.log
</span><span class='line'>
</span><span class='line'># Configuration of the "dfs" context for ganglia
</span><span class='line'># Pick one: Ganglia 3.0 (former) or Ganglia 3.1 (latter)
</span><span class='line'># dfs.class=org.apache.hadoop.metrics.ganglia.GangliaContext
</span><span class='line'># dfs.class=org.apache.hadoop.metrics.ganglia.GangliaContext31
</span><span class='line'># dfs.period=10
</span><span class='line'># dfs.servers=localhost:8649
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># Configuration of the "mapred" context for null
</span><span class='line'>mapred.class=org.apache.hadoop.metrics.spi.NullContext
</span><span class='line'>
</span><span class='line'># Configuration of the "mapred" context for file
</span><span class='line'>#mapred.class=org.apache.hadoop.metrics.file.FileContext
</span><span class='line'>#mapred.period=10
</span><span class='line'>#mapred.fileName=/tmp/mrmetrics.log
</span><span class='line'>
</span><span class='line'># Configuration of the "mapred" context for ganglia
</span><span class='line'># Pick one: Ganglia 3.0 (former) or Ganglia 3.1 (latter)
</span><span class='line'># mapred.class=org.apache.hadoop.metrics.ganglia.GangliaContext
</span><span class='line'># mapred.class=org.apache.hadoop.metrics.ganglia.GangliaContext31
</span><span class='line'># mapred.period=10
</span><span class='line'># mapred.servers=localhost:8649
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># Configuration of the "jvm" context for null
</span><span class='line'>#jvm.class=org.apache.hadoop.metrics.spi.NullContext
</span><span class='line'>
</span><span class='line'># Configuration of the "jvm" context for file
</span><span class='line'>#jvm.class=org.apache.hadoop.metrics.file.FileContext
</span><span class='line'>#jvm.period=10
</span><span class='line'>#jvm.fileName=/tmp/jvmmetrics.log
</span><span class='line'>
</span><span class='line'># Configuration of the "jvm" context for ganglia
</span><span class='line'># jvm.class=org.apache.hadoop.metrics.ganglia.GangliaContext
</span><span class='line'># jvm.class=org.apache.hadoop.metrics.ganglia.GangliaContext31
</span><span class='line'># jvm.period=10
</span><span class='line'># jvm.servers=localhost:8649
</span><span class='line'>
</span><span class='line'># Configuration of the "rpc" context for null
</span><span class='line'>rpc.class=org.apache.hadoop.metrics.spi.NullContext
</span><span class='line'>
</span><span class='line'># Configuration of the "rpc" context for file
</span><span class='line'>#rpc.class=org.apache.hadoop.metrics.file.FileContext
</span><span class='line'>#rpc.period=10
</span><span class='line'>#rpc.fileName=/tmp/rpcmetrics.log
</span><span class='line'>
</span><span class='line'># Configuration of the "rpc" context for ganglia
</span><span class='line'># rpc.class=org.apache.hadoop.metrics.ganglia.GangliaContext
</span><span class='line'># rpc.class=org.apache.hadoop.metrics.ganglia.GangliaContext31
</span><span class='line'># rpc.period=10
</span><span class='line'># rpc.servers=localhost:8649
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># Configuration of the "ugi" context for null
</span><span class='line'>ugi.class=org.apache.hadoop.metrics.spi.NullContext
</span><span class='line'>
</span><span class='line'># Configuration of the "ugi" context for file
</span><span class='line'>#ugi.class=org.apache.hadoop.metrics.file.FileContext
</span><span class='line'>#ugi.period=10
</span><span class='line'>#ugi.fileName=/tmp/ugimetrics.log
</span><span class='line'>
</span><span class='line'># Configuration of the "ugi" context for ganglia
</span><span class='line'># ugi.class=org.apache.hadoop.metrics.ganglia.GangliaContext
</span><span class='line'># ugi.class=org.apache.hadoop.metrics.ganglia.GangliaContext31
</span><span class='line'># ugi.period=10
</span><span class='line'># ugi.servers=localhost:8649
</span><span class='line'>
</span><span class='line'>[hadoop@umcc97-44 ~]$ cat hbase-0.98.3-hadoop2/conf/hadoop-metrics2-hbase.properties 
</span><span class='line'># syntax: [prefix].[source|sink].[instance].[options]
</span><span class='line'># See javadoc of package-info.java for org.apache.hadoop.metrics2 for details
</span><span class='line'>
</span><span class='line'>#*.sink.file*.class=org.apache.hadoop.metrics2.sink.FileSink
</span><span class='line'># default sampling period
</span><span class='line'>#*.period=10
</span><span class='line'>
</span><span class='line'># Below are some examples of sinks that could be used
</span><span class='line'># to monitor different hbase daemons.
</span><span class='line'>
</span><span class='line'># hbase.sink.file-all.class=org.apache.hadoop.metrics2.sink.FileSink
</span><span class='line'># hbase.sink.file-all.filename=all.metrics
</span><span class='line'>
</span><span class='line'># hbase.sink.file0.class=org.apache.hadoop.metrics2.sink.FileSink
</span><span class='line'># hbase.sink.file0.context=hmaster
</span><span class='line'># hbase.sink.file0.filename=master.metrics
</span><span class='line'>
</span><span class='line'># hbase.sink.file1.class=org.apache.hadoop.metrics2.sink.FileSink
</span><span class='line'># hbase.sink.file1.context=thrift-one
</span><span class='line'># hbase.sink.file1.filename=thrift-one.metrics
</span><span class='line'>
</span><span class='line'># hbase.sink.file2.class=org.apache.hadoop.metrics2.sink.FileSink
</span><span class='line'># hbase.sink.file2.context=thrift-two
</span><span class='line'># hbase.sink.file2.filename=thrift-one.metrics
</span><span class='line'>
</span><span class='line'># hbase.sink.file3.class=org.apache.hadoop.metrics2.sink.FileSink
</span><span class='line'># hbase.sink.file3.context=rest
</span><span class='line'># hbase.sink.file3.filename=rest.metrics
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>*.sink.ganglia.class=org.apache.hadoop.metrics2.sink.ganglia.GangliaSink31
</span><span class='line'>*.sink.ganglia.period=10
</span><span class='line'>
</span><span class='line'>hbase.sink.ganglia.period=10
</span><span class='line'>hbase.sink.ganglia.servers=umcc97-44:8649
</span></code></pre></td></tr></table></div></figure>


<p>然后properties配置同步到集群的从节点（datanode/regionserver），重启集群。等一会儿就能在ganglia-web界面看到多了很多很多的指标量。</p>

<h2>参考</h2>

<h3>ganglia</h3>

<ul>
<li><a href="http://oss.oetiker.ch/rrdtool/doc/rrdbuild.en.html#IBUILDING_DEPENDENCIES">RRDTool安装</a></li>
<li><a href="http://www.cnblogs.com/qq78292959/archive/2012/05/30/2526761.html">CFLAGS=&ldquo;-O3 -fPIC&#8221;为64位编译参数</a></li>
<li><a href="http://www.codesky.net/article/201107/174186.html">pkgconfig作用处理包依赖</a></li>
<li><a href="http://blog.chinaunix.net/uid-23916356-id-3290237.html">gmetad和gmond安装以及配置</a></li>
<li><a href="http://wenku.baidu.com/link?url=RH4EhSP3U_dp4I7goEVA_DFkb0DrgZ3uWw_mSt2hhaRb6mQJLtWxaa75RrwETwtY5e8BvOCI_p9RNrmXn_qbEexTE-PGlgtf6f5T3cGglKq">gmond节点拷贝安装</a></li>
<li><a href="http://blog.chinaunix.net/uid-11121450-id-3147002.html">http://blog.chinaunix.net/uid-11121450-id-3147002.html</a></li>
<li><a href="http://blog.chinaunix.net/uid-23916356-id-3290237.html">http://blog.chinaunix.net/uid-23916356-id-3290237.html</a></li>
<li><a href="http://wenku.baidu.com/link?url=qY7vCTyodgSCsoIg6c2UiHXWv0nEGkS9nd0DbQERxFGEaTvgvi7FMQTKv5Sn1L9H8CX5_gDgAbJJ5jaQh3KhZED7PoB2Bgr2I6mS-vDc1LS">虚拟机操作从零开始弄, 搭了个本地源, 配置</a></li>
<li><a href="http://www.linuxidc.com/Linux/2014-01/95804p2.htm">Hadoop/Hbase metrics2配置</a></li>
<li><a href="https://github.com/cbuchner1/CudaMiner/issues/23">https://github.com/cbuchner1/CudaMiner/issues/23</a></li>
<li><a href="http://bbs.csdn.net/topics/390546319">http://bbs.csdn.net/topics/390546319</a> LIBRARY_PATH是编译时使用的，LD_LIBRARY_PATH是运行时使用的。</li>
</ul>


<h3>apache web</h3>

<ul>
<li><a href="http://blog.sina.com.cn/s/blog_70121e200100lq0h.html">apache程序安装</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_5d15305b0101ceft.html">apache服务安装配置</a></li>
<li><a href="http://www.cnblogs.com/yuboyue/archive/2011/07/18/2109875.html">apache关闭服务</a></li>
<li><a href="http://www.soadmin.com/zonghe/operating-system/1008085.htm">目录权限处理</a></li>
<li><a href="http://blog.163.com/figo_2007@126/blog/static/2318076520111149413935/">http://blog.163.com/figo_2007@126/blog/static/2318076520111149413935/</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_70121e200100lq0h.html">http://blog.sina.com.cn/s/blog_70121e200100lq0h.html</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_815611fb0101cxnl.html">http://blog.sina.com.cn/s/blog_815611fb0101cxnl.html</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Upgrade Hive: 0.12.0 to 0.13.1]]></title>
    <link href="http://winse.github.io/blog/2014/06/21/upgrade-hive/"/>
    <updated>2014-06-21T02:34:59+08:00</updated>
    <id>http://winse.github.io/blog/2014/06/21/upgrade-hive</id>
    <content type="html"><![CDATA[<p>由于hive-0.12.0的FileSystem使用不当导致内存溢出问题，最终考虑升级hive。升级的过程没想象中的那么可怕，步骤很简单：对源数据库执行升级脚本，拷贝原hive-0.12.0的配置和jar，然后把添加jar重启hiverserver2即可。</p>

<h2>修改环境变量</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>HIVE_HOME=/home/hadoop/apache-hive-0.13.1-bin
</span><span class='line'>PATH=$JAVA_HOME/bin:$HIVE_HOME/bin:$PATH</span></code></pre></td></tr></table></div></figure>


<h2>升级metadata</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[hadoop@ismp0 ~]$ cd apache-hive-0.13.1-bin/scripts/metastore/upgrade/mysql/
</span><span class='line'>
</span><span class='line'>[hadoop@ismp0 mysql]$ mysql -uXXX -hXXX -pXXX
</span><span class='line'>mysql&gt; use hive
</span><span class='line'>Reading table information for completion of table and column names
</span><span class='line'>You can turn off this feature to get a quicker startup with -A
</span><span class='line'>
</span><span class='line'>Database changed
</span><span class='line'>mysql&gt; source upgrade-0.12.0-to-0.13.0.mysql.sql
</span><span class='line'>+--------------------------------------------------+
</span><span class='line'>|                                                  |
</span><span class='line'>+--------------------------------------------------+
</span><span class='line'>| Upgrading MetaStore schema from 0.12.0 to 0.13.0 |
</span><span class='line'>+--------------------------------------------------+
</span><span class='line'>1 row in set, 1 warning (0.00 sec)
</span><span class='line'>
</span><span class='line'>+-----------------------------------------------------------------------+
</span><span class='line'>|                                                                       |
</span><span class='line'>+-----------------------------------------------------------------------+
</span><span class='line'>| &lt; HIVE-5700 enforce single date format for partition column storage &gt; |
</span><span class='line'>+-----------------------------------------------------------------------+
</span><span class='line'>1 row in set, 1 warning (0.00 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 0 rows affected (0.22 sec)
</span><span class='line'>Rows matched: 0  Changed: 0  Warnings: 0
</span><span class='line'>
</span><span class='line'>+--------------------------------------------+
</span><span class='line'>|                                            |
</span><span class='line'>+--------------------------------------------+
</span><span class='line'>| &lt; HIVE-6386: Add owner filed to database &gt; |
</span><span class='line'>+--------------------------------------------+
</span><span class='line'>1 row in set, 1 warning (0.00 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 1 row affected (0.33 sec)
</span><span class='line'>Records: 1  Duplicates: 0  Warnings: 0
</span><span class='line'>
</span><span class='line'>Query OK, 1 row affected (0.16 sec)
</span><span class='line'>Records: 1  Duplicates: 0  Warnings: 0
</span><span class='line'>
</span><span class='line'>+---------------------------------------------------------------------------------------------+
</span><span class='line'>|                                                                                             |
</span><span class='line'>+---------------------------------------------------------------------------------------------+
</span><span class='line'>| &lt;HIVE-6458 Add schema upgrade scripts for metastore changes related to permanent functions&gt; |
</span><span class='line'>+---------------------------------------------------------------------------------------------+
</span><span class='line'>1 row in set, 1 warning (0.00 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 0 rows affected (0.06 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 0 rows affected (0.06 sec)
</span><span class='line'>
</span><span class='line'>+----------------------------------------------------------------------------------+
</span><span class='line'>|                                                                                  |
</span><span class='line'>+----------------------------------------------------------------------------------+
</span><span class='line'>| &lt;HIVE-6757 Remove deprecated parquet classes from outside of org.apache package&gt; |
</span><span class='line'>+----------------------------------------------------------------------------------+
</span><span class='line'>1 row in set, 1 warning (0.00 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 0 rows affected (0.04 sec)
</span><span class='line'>Rows matched: 0  Changed: 0  Warnings: 0
</span><span class='line'>
</span><span class='line'>Query OK, 0 rows affected (0.01 sec)
</span><span class='line'>Rows matched: 0  Changed: 0  Warnings: 0
</span><span class='line'>
</span><span class='line'>Query OK, 0 rows affected (0.01 sec)
</span><span class='line'>Rows matched: 0  Changed: 0  Warnings: 0
</span><span class='line'>
</span><span class='line'>Query OK, 0 rows affected (0.07 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 0 rows affected (0.12 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 0 rows affected (0.07 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 0 rows affected (0.06 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 1 row affected (0.05 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 0 rows affected (0.06 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 0 rows affected (0.15 sec)
</span><span class='line'>Records: 0  Duplicates: 0  Warnings: 0
</span><span class='line'>
</span><span class='line'>Query OK, 0 rows affected (0.06 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 1 row affected (0.05 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 0 rows affected (0.07 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 0 rows affected (0.06 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 1 row affected (0.05 sec)
</span><span class='line'>
</span><span class='line'>Query OK, 1 row affected (0.07 sec)
</span><span class='line'>Rows matched: 1  Changed: 1  Warnings: 0
</span><span class='line'>
</span><span class='line'>+-----------------------------------------------------------+
</span><span class='line'>|                                                           |
</span><span class='line'>+-----------------------------------------------------------+
</span><span class='line'>| Finished upgrading MetaStore schema from 0.12.0 to 0.13.0 |
</span><span class='line'>+-----------------------------------------------------------+
</span><span class='line'>1 row in set, 1 warning (0.00 sec)
</span><span class='line'>
</span><span class='line'>mysql&gt; 
</span><span class='line'>mysql&gt; 
</span><span class='line'>mysql&gt; exit
</span><span class='line'>Bye
</span><span class='line'>
</span><span class='line'>[hadoop@ismp0 ~]$ vi .bash_profile
</span><span class='line'>[hadoop@ismp0 ~]$ source .bash_profile
</span><span class='line'>[hadoop@ismp0 ~]$ cd apache-hive-0.13.1-bin
</span><span class='line'>[hadoop@ismp0 apache-hive-0.13.1-bin]$ cd conf/
</span><span class='line'>[hadoop@ismp0 conf]$ cp ~/hive-0.12.0/conf/hive-site.xml ./
</span><span class='line'>[hadoop@ismp0 conf]$ cd ..
</span><span class='line'>[hadoop@ismp0 apache-hive-0.13.1-bin]$ cp ~/hive-0.12.0/lib/mysql-connector-java-5.1.21-bin.jar lib/
</span><span class='line'>[hadoop@ismp0 apache-hive-0.13.1-bin]$ hive
</span><span class='line'>[hadoop@ismp0 apache-hive-0.13.1-bin]$ hive
</span><span class='line'>
</span><span class='line'>hive&gt;  select count(*) from t_ods_idc_isp_log2 where day=20140624;
</span><span class='line'>Total jobs = 1
</span><span class='line'>Launching Job 1 out of 1
</span><span class='line'>Number of reduce tasks determined at compile time: 1
</span><span class='line'>In order to change the average load for a reducer (in bytes):
</span><span class='line'>  set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;
</span><span class='line'>In order to limit the maximum number of reducers:
</span><span class='line'>  set hive.exec.reducers.max=&lt;number&gt;
</span><span class='line'>In order to set a constant number of reducers:
</span><span class='line'>  set mapreduce.job.reduces=&lt;number&gt;
</span><span class='line'>Starting Job = job_1403006477300_3403, Tracking URL = http://umcc97-79:8088/proxy/application_1403006477300_3403/
</span><span class='line'>Kill Command = /home/hadoop/hadoop-2.2.0/bin/hadoop job  -kill job_1403006477300_3403
</span><span class='line'>Hadoop job information for Stage-1: number of mappers: 2; number of reducers: 1
</span><span class='line'>2014-06-24 17:19:07,618 Stage-1 map = 0%,  reduce = 0%
</span><span class='line'>2014-06-24 17:19:15,283 Stage-1 map = 50%,  reduce = 0%, Cumulative CPU 2.37 sec
</span><span class='line'>2014-06-24 17:19:16,360 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 5.49 sec
</span><span class='line'>2014-06-24 17:19:22,749 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 7.99 sec
</span><span class='line'>MapReduce Total cumulative CPU time: 7 seconds 990 msec
</span><span class='line'>Ended Job = job_1403006477300_3403
</span><span class='line'>MapReduce Jobs Launched: 
</span><span class='line'>Job 0: Map: 2  Reduce: 1   Cumulative CPU: 7.99 sec   HDFS Read: 19785618 HDFS Write: 6 SUCCESS
</span><span class='line'>Total MapReduce CPU Time Spent: 7 seconds 990 msec
</span><span class='line'>OK
</span><span class='line'>77625
</span><span class='line'>Time taken: 36.387 seconds, Fetched: 1 row(s)
</span><span class='line'>hive&gt; 
</span><span class='line'>
</span><span class='line'>[hadoop@ismp0 apache-hive-0.13.1-bin]$ nohup bin/hiveserver2 &
</span><span class='line'>
</span><span class='line'># 测试hive-jdbc
</span><span class='line'>[hadoop@ismp0 apache-hive-0.13.1-bin]$ bin/beeline 
</span><span class='line'>Beeline version 0.13.1 by Apache Hive
</span><span class='line'>beeline&gt; !connect jdbc:hive2://10.18.97.22:10000/
</span><span class='line'>scan complete in 7ms
</span><span class='line'>Connecting to jdbc:hive2://10.18.97.22:10000/
</span><span class='line'>Enter username for jdbc:hive2://10.18.97.22:10000/: hadoop
</span><span class='line'>Enter password for jdbc:hive2://10.18.97.22:10000/: 
</span><span class='line'>Connected to: Apache Hive (version 0.13.1)
</span><span class='line'>Driver: Hive JDBC (version 0.13.1)
</span><span class='line'>Transaction isolation: TRANSACTION_REPEATABLE_READ
</span><span class='line'>0: jdbc:hive2://10.18.97.22:10000/&gt; show tables;
</span><span class='line'>+-------------------------+
</span><span class='line'>|        tab_name         |
</span><span class='line'>+-------------------------+
</span><span class='line'>...
</span><span class='line'>| test_123                |
</span><span class='line'>+-------------------------+
</span><span class='line'>10 rows selected (2.547 seconds)
</span><span class='line'>0: jdbc:hive2://10.18.97.22:10000/&gt;  select count(*) from t_ods_idc_isp_log2 where day=20140624;
</span><span class='line'>+--------+
</span><span class='line'>|  _c0   |
</span><span class='line'>+--------+
</span><span class='line'>| 77625  |
</span><span class='line'>+--------+
</span><span class='line'>1 row selected (37.463 seconds)
</span><span class='line'>0: jdbc:hive2://10.18.97.22:10000/&gt; 
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>上一篇tez的安装使用中由于hive的缘故进行了回退，现在升级到hive-0.13后，也在hive上试下tez的功能：</p>

<ul>
<li>本地添加tez依赖，设置环境变量</li>
<li>MR添加tez依赖，添加tez-site.xml</li>
<li>切换到tez的engine</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 已上传到HDFS
</span><span class='line'>$ cat etc/hadoop/tez-site.xml 
</span><span class='line'>&lt;?xml version="1.0"?&gt;
</span><span class='line'>&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;
</span><span class='line'>
</span><span class='line'>&lt;!-- Put site-specific property overrides in this file. --&gt;
</span><span class='line'>
</span><span class='line'>&lt;configuration&gt;
</span><span class='line'>  &lt;property&gt;
</span><span class='line'>    &lt;name&gt;tez.lib.uris&lt;/name&gt;
</span><span class='line'>    &lt;value&gt;${fs.default.name}/apps/tez-0.4.0-incubating,${fs.default.name}/apps/tez-0.4.0-incubating/lib/&lt;/value&gt;
</span><span class='line'>  &lt;/property&gt;
</span><span class='line'>&lt;/configuration&gt;
</span><span class='line'>
</span><span class='line'>$ export HADOOP_CLASSPATH=${HADOOP_HOME}/share/hadoop/tez/*:${HADOOP_HOME}/share/hadoop/tez/lib/*:$HADOOP_CLASSPATH
</span><span class='line'>$ apache-hive-0.13.1-bin/bin/hive
</span><span class='line'>hive&gt; set hive.execution.engine=tez;
</span><span class='line'>hive&gt; select count(*) from t_ods_idc_isp_log2 ;
</span><span class='line'>Time taken: 24.926 seconds, Fetched: 1 row(s)
</span><span class='line'>
</span><span class='line'>hive&gt; set hive.execution.engine=mr;                              
</span><span class='line'>hive&gt; select count(*) from t_ods_idc_isp_log2 where day=20140720;
</span><span class='line'>Time taken: 40.585 seconds, Fetched: 1 row(s)</span></code></pre></td></tr></table></div></figure>


<p>简单从时间上看，还是有效果的。</p>

<p><img src="http://file.bmob.cn/M00/04/A2/wKhkA1PSPSeAb1wWAAER_4gjIug339.png" alt="" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tez编译及使用]]></title>
    <link href="http://winse.github.io/blog/2014/06/18/hadoop-tez-firststep/"/>
    <updated>2014-06-18T04:22:58+08:00</updated>
    <id>http://winse.github.io/blog/2014/06/18/hadoop-tez-firststep</id>
    <content type="html"><![CDATA[<h2>初步了解</h2>

<p>hadoop2自带的mapreduce任务中间只能传递一次，也即一个任务只能聚合一次。而tez项目是对原有yarn架构的一个拓展，使用DAG（无环有向图）实现MRR的任务框架。</p>

<p><img src="http://farm6.staticflickr.com/5571/14256993179_4990fc86d5_o.png" alt="" /></p>

<p>上图中，左边的MR任务完成一个步骤后，需要进行<strong>数据存储</strong>后再执行另一个任务来进行第二个“reduce”； 而tez则可以在reduce后继续执行reduce，减少了中间过程的IO以及mapreduce的启动时间。</p>

<h2>环境整合</h2>

<ul>
<li><a href="http://tez.incubator.apache.org/install.html">Install/Deploy</a></li>
<li>hadoop-2.2.0（umcc97-44：hdfs， umcc97-79：yarn）</li>
<li>windows下使用Cygwin编译</li>
</ul>


<h3>下载编译tez</h3>

<p>首先下载<a href="http://apache.fayea.com/apache-mirror/incubator/tez/tez-0.4.0-incubating/">tez-0.4.0-incubating.tar.gz</a>，同时还需要<a href="http://code.google.com/p/protobuf">protoc</a>的程序支持（编译<a href="http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/SingleCluster.html">hadoop源码</a>也需要这个的）。
解压后，使用mvn编译。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@winseliu /cygdrive/e/local/libs/big
</span><span class='line'>$ tar zxvf tez-0.4.0-incubating.tar.gz
</span><span class='line'>
</span><span class='line'>Administrator@winseliu /cygdrive/e/local/libs/big
</span><span class='line'>$ cd tez-0.4.0-incubating/
</span><span class='line'>
</span><span class='line'>Administrator@winseliu /cygdrive/e/local/libs/big/tez-0.4.0-incubating
</span><span class='line'>$ mvn install -DskipTests -Dmaven.javadoc.skip
</span><span class='line'>...
</span><span class='line'>[INFO] Reactor Summary:
</span><span class='line'>[INFO]
</span><span class='line'>[INFO] tez ............................................... SUCCESS [1.518s]
</span><span class='line'>[INFO] tez-api ........................................... SUCCESS [8.890s]
</span><span class='line'>[INFO] tez-common ........................................ SUCCESS [0.725s]
</span><span class='line'>[INFO] tez-runtime-internals ............................. SUCCESS [2.529s]
</span><span class='line'>[INFO] tez-runtime-library ............................... SUCCESS [5.100s]
</span><span class='line'>[INFO] tez-mapreduce ..................................... SUCCESS [3.666s]
</span><span class='line'>[INFO] tez-mapreduce-examples ............................ SUCCESS [2.692s]
</span><span class='line'>[INFO] tez-dag ........................................... SUCCESS [13.943s]
</span><span class='line'>[INFO] tez-tests ......................................... SUCCESS [1.691s]
</span><span class='line'>[INFO] tez-dist .......................................... SUCCESS [14.370s]
</span><span class='line'>[INFO] Tez ............................................... SUCCESS [0.245s]
</span><span class='line'>[INFO] ------------------------------------------------------------------------
</span><span class='line'>[INFO] BUILD SUCCESS
</span><span class='line'>[INFO] ------------------------------------------------------------------------
</span><span class='line'>[INFO] Total time: 55.791s
</span><span class='line'>[INFO] Finished at: Tue Jun 17 17:33:45 CST 2014
</span><span class='line'>[INFO] Final Memory: 35M/151M
</span><span class='line'>[INFO] ------------------------------------------------------------------------
</span></code></pre></td></tr></table></div></figure>


<h3>上传tez程序的jars到HDFS</h3>

<p>为了简单我直接把tez放到开发环境的集群上面去测试了。放到本地环境应该也类似。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@winseliu /cygdrive/e/local/libs/big/tez-0.4.0-incubating
</span><span class='line'>$ cd tez-dist/
</span><span class='line'>
</span><span class='line'>Administrator@winseliu /cygdrive/e/local/libs/big/tez-0.4.0-incubating/tez-dist
</span><span class='line'>$ cd target/
</span><span class='line'>
</span><span class='line'>Administrator@winseliu /cygdrive/e/local/libs/big/tez-0.4.0-incubating/tez-dist/target
</span><span class='line'>$ export HADOOP_USER_NAME=hadoop
</span><span class='line'>
</span><span class='line'>Administrator@winseliu /cygdrive/e/local/libs/big/tez-0.4.0-incubating/tez-dist/target
</span><span class='line'>$  hadoop dfs -put tez-0.4.0-incubating/tez-0.4.0-incubating/ hdfs://umcc97-44:9000/apps/
</span><span class='line'>DEPRECATED: Use of this script to execute hdfs command is deprecated.
</span><span class='line'>Instead use the hdfs command for it.
</span></code></pre></td></tr></table></div></figure>


<h3>配置集群环境</h3>

<p>首先看下原来集群的classpath路径，由于已经包括了etc/hadoop目录，所以这里我直接把<code>tez-site.xml</code>放到该目录下。把所有的tez-lib上传到share目录下，并添加到HADOOP_CLASSPATH。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  [hadoop@umcc97-79 hadoop]$ hadoop classpath
</span><span class='line'>  /home/hadoop/hadoop-2.2.0/etc/hadoop:/home/hadoop/hadoop-2.2.0/share/hadoop/common/lib/*:/home/hadoop/hadoop-2.2.0/share/hadoop/common/*:/home/hadoop/hadoop-2.2.0/share/hadoop/hdfs:/home/hadoop/hadoop-2.2.0/share/hadoop/hdfs/lib/*:/home/hadoop/hadoop-2.2.0/share/hadoop/hdfs/*:/home/hadoop/hadoop-2.2.0/share/hadoop/yarn/lib/*:/home/hadoop/hadoop-2.2.0/share/hadoop/yarn/*:/home/hadoop/hadoop-2.2.0/share/hadoop/mapreduce/lib/*:/home/hadoop/hadoop-2.2.0/share/hadoop/mapreduce/*:/home/hadoop/hadoop-2.2.0/contrib/capacity-scheduler/*.jar
</span><span class='line'>  
</span><span class='line'>  # 用于map/reduce
</span><span class='line'>  [hadoop@umcc97-79 hadoop]$ cat tez-site.xml 
</span><span class='line'>  &lt;?xml version="1.0"?&gt;
</span><span class='line'>  &lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;
</span><span class='line'>  
</span><span class='line'>  &lt;!-- Put site-specific property overrides in this file. --&gt;
</span><span class='line'>  
</span><span class='line'>  &lt;configuration&gt;
</span><span class='line'>    &lt;property&gt;
</span><span class='line'>      &lt;name&gt;tez.lib.uris&lt;/name&gt;
</span><span class='line'>      &lt;value&gt;${fs.default.name}/apps/tez-0.4.0-incubating,${fs.default.name}/apps/tez-0.4.0-incubating/lib/&lt;/value&gt;
</span><span class='line'>    &lt;/property&gt;
</span><span class='line'>  &lt;/configuration&gt;
</span><span class='line'>  [hadoop@umcc97-79 hadoop]$ 
</span><span class='line'>  
</span><span class='line'>  [hadoop@umcc97-79 hadoop]$ cd ~/hadoop-2.2.0/share/hadoop/tez/
</span><span class='line'>  [hadoop@umcc97-79 tez]$ ll
</span><span class='line'>  total 9616
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop  303139 Jun 17 17:33 avro-1.7.4.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop   41123 Jun 17 17:33 commons-cli-1.2.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop  610259 Jun 17 17:33 commons-collections4-4.0.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop 1648200 Jun 17 17:33 guava-11.0.2.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop  710492 Jun 17 17:33 guice-3.0.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop  656365 Jun 17 17:33 hadoop-mapreduce-client-common-2.2.0.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop 1455001 Jun 17 17:33 hadoop-mapreduce-client-core-2.2.0.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop   21537 Jun 17 17:33 hadoop-mapreduce-client-shuffle-2.2.0.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop   81743 Jun 17 17:33 jettison-1.3.4.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop  533455 Jun 17 17:33 protobuf-java-2.5.0.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop  995968 Jun 17 17:33 snappy-java-1.0.4.1.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop  749917 Jun 17 17:33 tez-api-0.4.0-incubating.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop   34049 Jun 17 17:33 tez-common-0.4.0-incubating.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop  970987 Jun 17 17:33 tez-dag-0.4.0-incubating.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop  246409 Jun 17 17:33 tez-mapreduce-0.4.0-incubating.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop  199934 Jun 17 17:33 tez-mapreduce-examples-0.4.0-incubating.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop  114692 Jun 17 17:33 tez-runtime-internals-0.4.0-incubating.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop  352177 Jun 17 17:33 tez-runtime-library-0.4.0-incubating.jar
</span><span class='line'>  -rw-r--r-- 1 hadoop hadoop    6845 Jun 17 17:33 tez-tests-0.4.0-incubating.jar
</span><span class='line'>  [hadoop@umcc97-79 tez]$ 
</span><span class='line'>  
</span><span class='line'>  # 用于client任务提交
</span><span class='line'>  [hadoop@umcc97-79 hadoop]$ grep HADOOP_CLASSPATH hadoop-env.sh
</span><span class='line'>  export HADOOP_CLASSPATH=${HADOOP_HOME}/share/hadoop/tez/*:${HADOOP_HOME}/share/hadoop/tez/lib/*:$HADOOP_CLASSPATH
</span><span class='line'>  
</span><span class='line'>  [hadoop@umcc97-79 hadoop]$ sed -n 19,23p mapred-site.xml
</span><span class='line'>  &lt;configuration&gt;
</span><span class='line'>    &lt;property&gt;
</span><span class='line'>      &lt;name&gt;mapreduce.framework.name&lt;/name&gt;
</span><span class='line'>      &lt;value&gt;yarn-tez&lt;/value&gt;
</span><span class='line'>    &lt;/property&gt;
</span></code></pre></td></tr></table></div></figure>


<h3>同步，重启yarn</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>for h in `cat hadoop-2.2.0/etc/hadoop/slaves ` ; do rsync -vaz --exclude=logs --exclude=pid --exclude=tmp  hadoop-2.2.0 $h:~/ ; done
</span><span class='line'>
</span><span class='line'>rsync -vaz --exclude=logs --exclude=pid --exclude=tmp  hadoop-2.2.0 umcc97-44:~/</span></code></pre></td></tr></table></div></figure>


<h3>测试效果</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  [hadoop@umcc97-79 ~]$ hadoop classpath
</span><span class='line'>  /home/hadoop/hadoop-2.2.0/etc/hadoop:/home/hadoop/hadoop-2.2.0/share/hadoop/common/lib/*:/home/hadoop/hadoop-2.2.0/share/hadoop/common/*:/home/hadoop/hadoop-2.2.0/share/hadoop/hdfs:/home/hadoop/hadoop-2.2.0/share/hadoop/hdfs/lib/*:/home/hadoop/hadoop-2.2.0/share/hadoop/hdfs/*:/home/hadoop/hadoop-2.2.0/share/hadoop/yarn/lib/*:/home/hadoop/hadoop-2.2.0/share/hadoop/yarn/*:/home/hadoop/hadoop-2.2.0/share/hadoop/mapreduce/lib/*:/home/hadoop/hadoop-2.2.0/share/hadoop/mapreduce/*:/home/hadoop/hadoop-2.2.0/share/hadoop/tez/*:/home/hadoop/hadoop-2.2.0/share/hadoop/tez/lib/*:/home/hadoop/hadoop-2.2.0/contrib/capacity-scheduler/*.jar
</span><span class='line'>  [hadoop@umcc97-79 ~]$ cd hadoop-2.2.0/share/hadoop/mapreduce/
</span><span class='line'>  [hadoop@umcc97-79 mapreduce]$ hadoop jar hadoop-mapreduce-client-jobclient-2.2.0-tests.jar sleep -mt 1 -rt 1 -m 1 -r 1
</span><span class='line'>  
</span><span class='line'>    hadoop jar hadoop-2.2.0/share/hadoop/tez/tez-mapreduce-examples-0.4.0-incubating.jar orderedwordcount  /hello/in /hello/out
</span><span class='line'>    hadoop fs -put hadoop-2.2.0/logs/yarn-hadoop-resourcemanager-umcc97-79.* /hello/in
</span><span class='line'>    hadoop fs -rmr /hello/out
</span><span class='line'>    hadoop jar hadoop-2.2.0/share/hadoop/tez/tez-mapreduce-examples-0.4.0-incubating.jar orderedwordcount  /hello/in /hello/out
</span></code></pre></td></tr></table></div></figure>


<h3>回滚，使用时临时修改环境变量即可</h3>

<p>使用了tez后，使用hive-0.12.0不能运行了。由于其他同事需要用hive，得把配置全部修改回去【<a href="http://winse.github.io/blog/2014/06/21/upgrade-hive/">hive-0.13中使用tez</a>】。</p>

<p>其实在<strong>提交任务</strong>时指定配置参数即可。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[hadoop@umcc97-79 ~]$ export HADOOP_CLASSPATH=${HADOOP_HOME}/share/hadoop/tez/*:${HADOOP_HOME}/share/hadoop/tez/lib/*:$HADOOP_CLASSPATH
</span><span class='line'>[hadoop@umcc97-79 ~]$ hadoop jar hadoop-2.2.0/share/hadoop/tez/tez-mapreduce-examples-0.4.0-incubating.jar orderedwordcount -Dmapreduce.framework.name=yarn-tez  /hello/in /hello/out</span></code></pre></td></tr></table></div></figure>


<p>org.apache.tez.mapreduce.examples.OrderedWordCount不仅计算出了结果，同时按个数大小进行了排序。</p>

<p>问题： tez的任务的history还不知道怎么弄的，启动historyserver没作用。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[远程调试hadoop2以及错误处理方法]]></title>
    <link href="http://winse.github.io/blog/2014/04/22/remote-debug-hadoop2/"/>
    <updated>2014-04-22T06:47:48+08:00</updated>
    <id>http://winse.github.io/blog/2014/04/22/remote-debug-hadoop2</id>
    <content type="html"><![CDATA[<p>了解程序运行过程，除了一行行代码的扫射源代码。更快捷的方式是运行调试源码，通过F6/F7来一步步的带领我们熟悉程序。针对特定细节具体数据，打个断点调试则是水到渠成的方式。</p>

<h2>Java远程调试</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> * JDK 1.3 or earlier -Xnoagent -Djava.compiler=NONE -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=6006
</span><span class='line'> * JDK 1.4(linux ok) -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=6006
</span><span class='line'> * newer JDK(win7 & jdk7) -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=6006</span></code></pre></td></tr></table></div></figure>


<h2>同一操作系统任务提交</h2>

<p>windows提交到windows，linux提交到linux，可以直接通过命令行添加参数调试wordcount任务：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>E:\local\dotfile&gt;hdfs dfs -rmr /out # native-lib放在非path路径下，cmd脚本中有对其进行处理
</span><span class='line'>
</span><span class='line'>E:\local\dotfile&gt;hadoop org.apache.hadoop.examples.WordCount  "-Dmapreduce.map.java.opts=-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=8090 -Djava.library.path=E:\local\libs\big\hadoop-2.2.0\lib\native -Dmapreduce.reduce.java.opts=-Djava.library.path=E:\local\libs\big\hadoop-2.2.0\lib\native"  /in /out</span></code></pre></td></tr></table></div></figure>


<p><strong>suspend设置为y，会等待客户端连接再运行</strong>。在eclipse中在WordCount$TokenizerMapper#map打个断点，然后再使用<code>Remote Java Application</code>就可以调试程序了。</p>

<h2>Hadoop集群环境下调试任务</h2>

<p>hadoop有很多的程序，同样有对应的环境变量选项来进行设置！</p>

<ul>
<li>主程序-调试Job提交

<ul>
<li><code>set HADOOP_OPTS="-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=8090"</code></li>
<li>可以在配置文件中进行设置。需要注意可能会覆盖已经设置的该参数的值。</li>
</ul>
</li>
<li>Nodemanager调试

<ul>
<li><code>set HADOOP_NODEMANAGER_OPTS="-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=8092"</code></li>
<li>(linux下需要定义在文件中)<code>YARN_NODEMANAGER_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8092"</code></li>
</ul>
</li>
<li>ResourceManager调试

<ul>
<li>HADOOP_RESOURCEMANAGER_OPTS</li>
<li><code>export YARN_RESOURCEMANAGER_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8091"</code></li>
</ul>
</li>
</ul>


<p>Linux上的设置略有不同，通过SSH再调用的进程(如NodeManager)需要把其OPTS写到命令行脚本文件中！！
linux需要远程调试NodeManager的话，需要写到etc/hadoop/yarn-env.sh文件中！不然，nodemanger不生效（通过ssh去执行的）！</p>

<h3>其他调试技巧</h3>

<p>调试测试集群环境，比本地windows开发环境复杂点。毕竟本地windows的就一个主一个从。而把<strong>任务放到分布式集群</strong>上时，例如调试分布式缓存的！
那么就需要一些小技巧来获取任务运行所在的机器！下面的步骤中有具体操作命令。</p>

<h3>任务配置及运行</h3>

<p>eclipse下windows提交job到linux的补丁，查阅<a href="https://issues.apache.org/jira/browse/MAPREDUCE-5655">[MAPREDUCE-5655]</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 配置
</span><span class='line'>  &lt;property&gt;
</span><span class='line'>      &lt;name&gt;mapred.remote.os&lt;/name&gt;
</span><span class='line'>      &lt;value&gt;Linux&lt;/value&gt;
</span><span class='line'>  &lt;/property&gt;
</span><span class='line'>  &lt;property&gt;
</span><span class='line'>      &lt;name&gt;mapreduce.job.jar&lt;/name&gt;
</span><span class='line'>      &lt;value&gt;dta-analyser-all.jar&lt;/value&gt;
</span><span class='line'>  &lt;/property&gt;
</span><span class='line'>
</span><span class='line'>  &lt;property&gt;
</span><span class='line'>      &lt;name&gt;mapreduce.map.java.opts&lt;/name&gt;
</span><span class='line'>      &lt;value&gt;-Xmx1024m -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=18090&lt;/value&gt;
</span><span class='line'>  &lt;/property&gt;
</span><span class='line'>
</span><span class='line'>  &lt;property&gt;
</span><span class='line'>      &lt;name&gt;mapred.task.timeout&lt;/name&gt;
</span><span class='line'>      &lt;value&gt;1800000&lt;/value&gt;
</span><span class='line'>  &lt;/property&gt;
</span><span class='line'>
</span><span class='line'># 代码，map/reduce数都设置为1 
</span><span class='line'>job.setNumReduceTasks(1);
</span><span class='line'>job.getConfiguration().setInt(MRJobConfig.NUM_MAPS, 1);
</span></code></pre></td></tr></table></div></figure>


<p></p>

<ul>
<li>调试的时刻把超时时间设置的久一点，否则：</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> Got exception: java.net.SocketTimeoutException: Call From winseliu/127.0.0.1 to winse.com:2850 failed on socket timeout exception: java.net.SocketTimeoutException: 60000 millis timeout while waiting for channel to be ready for read. ch :</span></code></pre></td></tr></table></div></figure>


<ul>
<li>调试main方法参数设置</li>
</ul>


<p>调试main（转瞬即逝的把suspend设置为true！），map的调试选项的语句写在配置文件里面</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export HADOOP_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8073"
</span><span class='line'>
</span><span class='line'>Administrator@winseliu ~/hadoop
</span><span class='line'>$ sh -x bin/hadoop org.apache.hadoop.examples.WordCount /in /out </span></code></pre></td></tr></table></div></figure>


<h3>遍历所有子节点，查找节点运行map程序的信息</h3>

<p>map调试的端口配置为18090，根据这个选项来查找程序运行的机器。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[hadoop@umcc97-44 ~]$ for h in `cat hadoop-2.2.0/etc/hadoop/slaves` ; do ssh $h 'ps aux|grep java | grep 18090'; echo $h;  done
</span><span class='line'>hadoop    8667  0.0  0.0  63888  1268 ?        Ss   18:21   0:00 bash -c ps aux|grep java | grep 18090
</span><span class='line'>umcc97-142
</span><span class='line'>hadoop   12686  0.0  0.0  63868  1260 ?        Ss   18:21   0:00 bash -c ps aux|grep java | grep 18090
</span><span class='line'>umcc97-143
</span><span class='line'>hadoop   23516  0.0  0.0  63856  1108 ?        Ss   18:11   0:00 /bin/bash -c /home/java/jdk1.7.0_45/bin/java -Djava.net.preferIPv4Stack=true -Dhadoop.metrics.log.level=WARN  -Xmx256m -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=18090 -Djava.io.tmpdir=/home/hadoop/hadoop-2.2.0/tmp/nm-local-dir/usercache/hadoop/appcache/application_1397006359464_1605/container_1397006359464_1605_01_000002/tmp -Dlog4j.configuration=container-log4j.properties -Dyarn.app.container.log.dir=/home/hadoop/hadoop-2.2.0/logs/userlogs/application_1397006359464_1605/container_1397006359464_1605_01_000002 -Dyarn.app.container.log.filesize=0 -Dhadoop.root.logger=INFO,CLA org.apache.hadoop.mapred.YarnChild 10.18.97.143 57576 attempt_1397006359464_1605_m_000000_0 2 1&gt;/home/hadoop/hadoop-2.2.0/logs/userlogs/application_1397006359464_1605/container_1397006359464_1605_01_000002/stdout 2&gt;/home/hadoop/hadoop-2.2.0/logs/userlogs/application_1397006359464_1605/container_1397006359464_1605_01_000002/stderr 
</span><span class='line'>hadoop   23522  0.0  0.0 605136 15728 ?        Sl   18:11   0:00 /home/java/jdk1.7.0_45/bin/java -Djava.net.preferIPv4Stack=true -Dhadoop.metrics.log.level=WARN -Xmx256m -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=18090 -Djava.io.tmpdir=/home/hadoop/hadoop-2.2.0/tmp/nm-local-dir/usercache/hadoop/appcache/application_1397006359464_1605/container_1397006359464_1605_01_000002/tmp -Dlog4j.configuration=container-log4j.properties -Dyarn.app.container.log.dir=/home/hadoop/hadoop-2.2.0/logs/userlogs/application_1397006359464_1605/container_1397006359464_1605_01_000002 -Dyarn.app.container.log.filesize=0 -Dhadoop.root.logger=INFO,CLA org.apache.hadoop.mapred.YarnChild 10.18.97.143 57576 attempt_1397006359464_1605_m_000000_0 2
</span><span class='line'>hadoop   23665  0.0  0.0  63856  1264 ?        Ss   18:21   0:00 bash -c ps aux|grep java | grep 18090
</span><span class='line'>umcc97-144</span></code></pre></td></tr></table></div></figure>


<p>仅打印运行map的节点名称</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[hadoop@umcc97-44 ~]$ for h in `cat hadoop-2.2.0/etc/hadoop/slaves` ; do ssh $h 'if ps aux|grep -v grep | grep java | grep 18090 | grep -v bash 2&gt;&1 1&gt;/dev/null ; then echo `hostname`; fi'; done
</span><span class='line'>umcc97-142
</span><span class='line'>[hadoop@umcc97-44 ~]$ </span></code></pre></td></tr></table></div></figure>


<p>后面的操作就和普通的java程序调试步骤一样了。不再赘述。</p>

<h2>任务运行过程中的数据</h2>

<h4>辅助运行的两个bash程序</h4>

<p>运行的第一个程序（000001）为AppMaster，第二程序（000002）才是我们提交job的map任务。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[hadoop@umcc97-143 ~]$ cd hadoop-2.2.0/tmp/nm-local-dir/nmPrivate
</span><span class='line'>[hadoop@umcc97-143 nmPrivate]$ ls -Rl
</span><span class='line'>.:
</span><span class='line'>total 12
</span><span class='line'>drwxrwxr-x 4 hadoop hadoop 4096 Apr 21 18:34 application_1397006359464_1606
</span><span class='line'>-rw-rw-r-- 1 hadoop hadoop    6 Apr 21 18:34 container_1397006359464_1606_01_000001.pid
</span><span class='line'>-rw-rw-r-- 1 hadoop hadoop    6 Apr 21 18:34 container_1397006359464_1606_01_000002.pid
</span><span class='line'>
</span><span class='line'>./application_1397006359464_1606:
</span><span class='line'>total 8
</span><span class='line'>drwxrwxr-x 2 hadoop hadoop 4096 Apr 21 18:34 container_1397006359464_1606_01_000001
</span><span class='line'>drwxrwxr-x 2 hadoop hadoop 4096 Apr 21 18:34 container_1397006359464_1606_01_000002
</span><span class='line'>
</span><span class='line'>./application_1397006359464_1606/container_1397006359464_1606_01_000001:
</span><span class='line'>total 8
</span><span class='line'>-rw-r--r-- 1 hadoop hadoop   95 Apr 21 18:34 container_1397006359464_1606_01_000001.tokens
</span><span class='line'>-rw-r--r-- 1 hadoop hadoop 3121 Apr 21 18:34 launch_container.sh
</span><span class='line'>
</span><span class='line'>./application_1397006359464_1606/container_1397006359464_1606_01_000002:
</span><span class='line'>total 8
</span><span class='line'>-rw-r--r-- 1 hadoop hadoop  129 Apr 21 18:34 container_1397006359464_1606_01_000002.tokens
</span><span class='line'>-rw-r--r-- 1 hadoop hadoop 3532 Apr 21 18:34 launch_container.sh
</span><span class='line'>[hadoop@umcc97-143 nmPrivate]$ 
</span><span class='line'>[hadoop@umcc97-143 nmPrivate]$ jps
</span><span class='line'>4692 NodeManager
</span><span class='line'>4173 DataNode
</span><span class='line'>13497 YarnChild
</span><span class='line'>7538 HRegionServer
</span><span class='line'>13376 MRAppMaster
</span><span class='line'>13574 Jps
</span><span class='line'>[hadoop@umcc97-143 nmPrivate]$ cat *.pid
</span><span class='line'>13366
</span><span class='line'>13491
</span><span class='line'>[hadoop@umcc97-143 nmPrivate]$ ps aux | grep 13366
</span><span class='line'>hadoop   13366  0.0  0.0  63868  1088 ?        Ss   18:34   0:00 /bin/bash -c /home/java/jdk1.7.0_45/bin/java -Dlog4j.configuration=container-log4j.properties -Dyarn.app.container.log.dir=/home/hadoop/hadoop-2.2.0/logs/userlogs/application_1397006359464_1606/container_1397006359464_1606_01_000001 -Dyarn.app.container.log.filesize=0 -Dhadoop.root.logger=INFO,CLA  -Xmx1024m org.apache.hadoop.mapreduce.v2.app.MRAppMaster 1&gt;/home/hadoop/hadoop-2.2.0/logs/userlogs/application_1397006359464_1606/container_1397006359464_1606_01_000001/stdout 2&gt;/home/hadoop/hadoop-2.2.0/logs/userlogs/application_1397006359464_1606/container_1397006359464_1606_01_000001/stderr 
</span><span class='line'>hadoop   13594  0.0  0.0  61204   760 pts/2    S+   18:36   0:00 grep 13366
</span><span class='line'>[hadoop@umcc97-143 nmPrivate]$ ps aux | grep 13491
</span><span class='line'>hadoop   13491  0.0  0.0  63868  1100 ?        Ss   18:34   0:00 /bin/bash -c /home/java/jdk1.7.0_45/bin/java -Djava.net.preferIPv4Stack=true -Dhadoop.metrics.log.level=WARN  -Xmx256m -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=18090 -Djava.io.tmpdir=/home/hadoop/hadoop-2.2.0/tmp/nm-local-dir/usercache/hadoop/appcache/application_1397006359464_1606/container_1397006359464_1606_01_000002/tmp -Dlog4j.configuration=container-log4j.properties -Dyarn.app.container.log.dir=/home/hadoop/hadoop-2.2.0/logs/userlogs/application_1397006359464_1606/container_1397006359464_1606_01_000002 -Dyarn.app.container.log.filesize=0 -Dhadoop.root.logger=INFO,CLA org.apache.hadoop.mapred.YarnChild 10.18.97.143 52046 attempt_1397006359464_1606_m_000000_0 2 1&gt;/home/hadoop/hadoop-2.2.0/logs/userlogs/application_1397006359464_1606/container_1397006359464_1606_01_000002/stdout 2&gt;/home/hadoop/hadoop-2.2.0/logs/userlogs/application_1397006359464_1606/container_1397006359464_1606_01_000002/stderr 
</span><span class='line'>hadoop   13599  0.0  0.0  61204   760 pts/2    S+   18:37   0:00 grep 13491
</span><span class='line'>[hadoop@umcc97-143 nmPrivate]$ </span></code></pre></td></tr></table></div></figure>


<h4>程序运行本地缓存数据</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[hadoop@umcc97-143 container_1397006359464_1606_01_000002]$ ls -l
</span><span class='line'>total 28
</span><span class='line'>-rw-r--r-- 1 hadoop hadoop  129 Apr 21 18:34 container_tokens
</span><span class='line'>-rwx------ 1 hadoop hadoop  516 Apr 21 18:34 default_container_executor.sh
</span><span class='line'>lrwxrwxrwx 1 hadoop hadoop   65 Apr 21 18:34 filter.io -&gt; /home/hadoop/hadoop-2.2.0/tmp/nm-local-dir/filecache/10/filter.io
</span><span class='line'>lrwxrwxrwx 1 hadoop hadoop  120 Apr 21 18:34 job.jar -&gt; /home/hadoop/hadoop-2.2.0/tmp/nm-local-dir/usercache/hadoop/appcache/application_1397006359464_1606/filecache/10/job.jar
</span><span class='line'>lrwxrwxrwx 1 hadoop hadoop  120 Apr 21 18:34 job.xml -&gt; /home/hadoop/hadoop-2.2.0/tmp/nm-local-dir/usercache/hadoop/appcache/application_1397006359464_1606/filecache/13/job.xml
</span><span class='line'>-rwx------ 1 hadoop hadoop 3532 Apr 21 18:34 launch_container.sh
</span><span class='line'>drwx--x--- 2 hadoop hadoop 4096 Apr 21 18:34 tmp
</span><span class='line'>[hadoop@umcc97-143 container_1397006359464_1606_01_000002]$ </span></code></pre></td></tr></table></div></figure>


<h2>处理问题方法</h2>

<ul>
<li>打印DEBUG日志：<code>export HADOOP_ROOT_LOGGER=DEBUG,console</code>

<ul>
<li>日志文件放置在nodemanager节点的logs/userlogs目录下。</li>
</ul>
</li>
<li>打印DEBUG日志也搞不定时，可以在源码里面sysout信息然后把<strong>class覆盖</strong>，来进行定位配置的问题。</li>
<li>如果不清楚shell的执行过程，可以通过<code>sh -x [CMD]</code>，或者在脚本文件的操作前加上<code>set -x</code>。相当于windows-batch的<code>echo on</code>功能。</li>
</ul>


<h2>参考</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/975271/remote-debugging-a-java-application">remote debugger opts</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hadoop2学习过程/资源]]></title>
    <link href="http://winse.github.io/blog/2014/04/22/hadoop-category/"/>
    <updated>2014-04-22T06:37:20+08:00</updated>
    <id>http://winse.github.io/blog/2014/04/22/hadoop-category</id>
    <content type="html"><![CDATA[<p>接触集群，起始为毕业论文觉得做一个SSH的内容管理系统觉得无趣，选择了Hadoop相关的选题。尽管做的很烂，但是当时做出来一个东西还是挺开心的。中间断了近一年，但是在鼎象做游戏的时刻部署系统/维护查日志，对linux熟悉了不少。在科韵开始做插件开发，神马都的看源码。而后，真正的做了一个hadoop的项目，相比2年前，对编程和学习的方式都有了提升。hadoop，kettle这些都是很牛掰的很火热软件，但是中文资料相对较少，变化也很快。慢慢的觉得自己看代码和英文的资源都过得去。</p>

<p>再碌碌无为的过了一年，而今又接触hadoop，时代变了，但是基本的技术还是相同的。从hadoop1升级到hadoop2，尽管变化很大，熟悉的过程中再次遇到很多的问题。觉得无能无力，原来的日子好似白过了！记录是一种美德，不仅是走过路过的足迹，亦是摘树后人乘凉的盛举。</p>

<p>要弄hadoop，首先得把对english的偏见放下！如果还是baidu查找你遇到的问题，那或许你会多走很多的弯路！</p>

<h2>书籍</h2>

<p>开始还是推荐下中文资料：</p>

<ul>
<li>[Hadoop权威指南/Hadoop The Definitive Guide] 大师写的书，值的膜拜</li>
<li>[hadoop实战/Hadoop in Action] 相对来说是也是一本不错的</li>
</ul>


<h2>网页资源</h2>

<ol>
<li>Linux部署Hadoop

<ul>
<li><a href="http://developer.yahoo.com/hadoop/tutorial/">Hadoop Tutorial - YDN</a></li>
<li><a href="http://shiyanjun.cn/archives/561.html">Hadoop-2.2.0集群安装配置实践</a></li>
<li><a href="http://www.cnblogs.com/i80386/p/3548132.html">hadoop2.2.0 单机伪分布式（含64位hadoop编译）及 eclipse hadoop开发环境搭建</a></li>
</ul>
</li>
<li>Windows部署Hadoop

<ul>
<li><a href="http://yangshangchuan.iteye.com/blog/1839812">配置Cygwin支持无密码SSH登陆</a></li>
<li><a href="http://wiki.apache.org/hadoop/Hadoop2OnWindows">Hadoop2OnWindows - Hadoop Wiki</a></li>
<li><a href="https://issues.apache.org/jira/browse/MAPREDUCE-5655">[MAPREDUCE-5655] job submit from windows to a linux hadoop cluster fails due to wrong classpath</a></li>
<li><a href="http://stackoverflow.com/questions/11821378/what-does-bashno-job-control-in-this-shell-mean">linux - what does &ldquo;bash:no job control in this shell” mean? - Stack Overflow</a></li>
<li><a href="http://stackoverflow.com/questions/18630019/running-apache-hadoop-2-1-0-on-windows">Running Apache Hadoop 2.1.0 on Windows - Stack Overflow</a></li>
<li><a href="http://stackoverflow.com/questions/10888391/error-link-fatal-error-lnk1123-failure-during-conversion-to-coff-file-inval">Error &lsquo;LINK : fatal error LNK1123: failure during conversion to COFF: file invalid or corrupt&rsquo;</a></li>
<li><a href="http://blog.csdn.net/xzz_hust/article/details/9450289">VS2010 error: LINK : fatal error LNK1123: failure during conversion to COFF: file invalid or corrupt</a></li>
<li><a href="https://issues.apache.org/jira/browse/HADOOP-10144">[HADOOP-10144] Error on build in windows 7 box</a></li>
<li><a href="http://www.srccodes.com/p/article/38/build-install-configure-run-apache-hadoop-2.2.0-microsoft-windows-os#comment-1150229068">Build, Install, Configure and Run Apache Hadoop 2.2.0 in Microsoft Windows OS</a></li>
<li><a href="http://blog.csdn.net/bamuta/article/details/13506843">hadoop2.2.0遇到NativeLibraries错误的解决过程</a></li>
<li><a href="http://blog.csdn.net/bamuta/article/details/13506893">hadoop2.2.0遇到64位操作系统平台报错，重新编译hadoop</a></li>
<li><a href="http://stackoverflow.com/questions/19943766/hadoop-unable-to-load-native-hadoop-library-for-your-platform-error-on-centos">Hadoop &ldquo;Unable to load native-hadoop library for your platform&rdquo; error on CentOS</a></li>
</ul>
</li>
<li>eclipse直接访问HDFS/提交任务

<ul>
<li><a href="http://zy19982004.iteye.com/blog/2031172">Hadoop学习三十二：Win7下无法提交MapReduce Job到集群环境</a></li>
<li><a href="http://blog.csdn.net/fansy1990/article/details/22896249">Eclipse调用hadoop2运行MR程序</a></li>
</ul>
</li>
<li>cygwin部署hadoop

<ul>
<li><a href="http://blog.csdn.net/needle2/article/details/5416571">cygwin sshd 安装配置</a></li>
<li><a href="http://www.ipv6bbs.cn/thread-209-1-1.html">如何确定自己是否已接入IPv6网络及故障分析（提问必看）</a></li>
<li><a href="http://www.ipv6bbs.cn/thread-151-1-1.html">在IPv4网络下接入IPv6网络的方法（隧道与第三方软件）</a></li>
</ul>
</li>
<li>hdfs脚本文件系统</li>
<li>编译源码

<ul>
<li><a href="http://blog.163.com/universsky@126/blog/static/112760232201362743156735/">maven工程pom添加log4j依赖 Missing artifact javax.jms:jms:jar:1.1:compile 为pom.xml添加dependency，编译报错缺少jar包，但是本地库中有这个包</a></li>
<li><a href="http://www.cnblogs.com/sysuys/p/3492791.html">找不到org.mortbay.component.AbstractLifeCycle的类文件</a></li>
<li><a href="https://issues.apache.org/jira/browse/HADOOP-10110">[HADOOP-10110]hadoop-auth has a build break due to missing dependency</a></li>
<li><a href="http://blog.csdn.net/superye1983/article/details/16884097">Hadoop CDH5 手动安装伪分布式模式 </a></li>
</ul>
</li>
<li>远程调试

<ul>
<li><a href="http://stackoverflow.com/questions/975271/remote-debugging-a-java-application">Remote debugging a Java application</a></li>
<li><a href="http://liugang594.iteye.com/blog/154710">Eclipse调试框架的学习与理解</a></li>
<li><a href="http://duming115.iteye.com/blog/791218">Java的远程debug</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/opensource/os-eclipse-javadebug/index.html">使用 Eclipse 远程调试 Java 应用程序</a></li>
</ul>
</li>
<li>与正式环境有关

<ul>
<li><a href="http://cn.mzcart.com/2012/04/24.html">putty – 使用putty命令行参数</a></li>
<li><a href="http://www.ctohome.com/FuWuQi/0b/301.html">Windows下使用ssh代理来访问国外的youtube和twitter/fackbook等网站</a></li>
<li><a href="http://hejianhuacn.iteye.com/blog/1972033">使用SecureCRT的SSH端口转发，使用PLSQL访问内网数据库</a></li>
<li><a href="http://qn-lf.iteye.com/blog/859662">用ssh端口转发功能访问远程服务器</a></li>
<li><a href="http://blog.csdn.net/linuxoostudy/article/details/7097418">SecureCRT设置SSH端口转发详解</a></li>
</ul>
</li>
<li>开发参考的资源/代码访问集群

<ul>
<li><a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-hadoop-yarn/">Hadoop 新 MapReduce 框架 Yarn 详解</a></li>
<li><a href="http://dongxicheng.org/mapreduce-nextgen/hadoop-2-0-jobhistory-log/">Hadoop 2.0中作业日志收集原理以及配置方法</a></li>
<li><a href="http://dongxicheng.org/mapreduce-nextgen/hadoop-logs-placement/">Hadoop日志到底存在哪里？</a></li>
<li><a href="http://dongxicheng.org/mapreduce-nextgen/hadoop-distributedcache-details/">Hadoop DistributedCache详解</a></li>
<li><a href="http://hpuxtbjvip0.blog.163.com/blog/static/3674131320132794940734/">Hadoop DistributedCache使用及原理</a></li>
</ul>
</li>
</ol>


<h2>工具</h2>

<ul>
<li>lrzsz</li>
<li>SecureCRT</li>
<li>WinSCP</li>
<li>w3m # 最后使用SSH代理访问取代！</li>
</ul>


<h2>思维</h2>

<ul>
<li>化整为零</li>
</ul>


<h2>技巧</h2>

<ul>
<li>查看jar列表：<code>jar tvf JAR</code></li>
<li>ssh-copy-id</li>
<li>rsync</li>
<li>find</li>
<li>ls -Sl</li>
<li>while/for</li>
<li><p><code>cat unknown.txt | cut -b 62- | sort | uniq</code></p></li>
<li><p>持续的更新 -</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Windows下部署/配置/调试hadoop2]]></title>
    <link href="http://winse.github.io/blog/2014/04/21/hadoop2-windows-startguide/"/>
    <updated>2014-04-21T16:27:11+08:00</updated>
    <id>http://winse.github.io/blog/2014/04/21/hadoop2-windows-startguide</id>
    <content type="html"><![CDATA[<p>Windows作为开发屌丝必备，在windows上如何跑集群方便开发调试，以及怎么把eclipse写好的任务mapreduce提交到测试的集群(linux)上面去跑？这些都是需要直面并解决的问题。</p>

<p>本文主要记录在windows上hadoop集群的环境准备，以及eclipse调试功能等。</p>

<ol>
<li>windows伪分布式部署

<ul>
<li>cmd</li>
<li>cygwin shell</li>
</ul>
</li>
<li>windows-eclipse提交任务到linux集群</li>
<li>导入源码到eclipse</li>
</ol>


<p>这篇文章并非按照操作的时间顺序来进行编写。而是，如果再安装第二遍的话，自己应该如何去操作来组织下文。</p>

<h2>一、Windows伪分布式部署</h2>

<p>尽管一直用windows，但是对windows自带的cmd命令很是不屑！想在cygwin下部署，现在想来，最终用的是windows的java！在cygwin下不就是把路径转换后再传给java执行吗！</p>

<p>所以，如果把cygwin环境搭建好了的话，其实已经把windows的环境也搭建好了！同样hadoop的windows环境配置好了，cygwin环境也同样配置好了。但是，在cygwin下面提交mapreduce任务会有各种&#8221;凌乱&#8221;的问题！</p>

<p>先说说在windows环境搭建的步骤，然后再讲cygwin下运行。</p>

<ol>
<li>需要用到的软件环境</li>
<li>编译windows环境变量配置</li>
<li>编译hadoop-common源代码生成本地依赖库</li>
<li>伪分布式配置</li>
<li>windows下运行</li>
<li>cygwin下运行</li>
</ol>


<h3>1.1 需要用到的软件环境</h3>

<ul>
<li>Win7-x86</li>
<li>hadoop-2.2.0.tar.gz</li>
<li>git</li>
<li>cygwin (源码编译时需要执行sh命令)</li>
<li>visual studio 2010（如果与.net framework4有关的问题请查阅： <a href="http://stackoverflow.com/questions/10888391/error-link-fatal-error-lnk1123-failure-during-conversion-to-coff-file-inval">[*]</a> <a href="http://stackoverflow.com/questions/12267158/failure-during-conversion-to-coff-file-invalid-or-corrupt">[*]</a> <a href="http://social.msdn.microsoft.com/Forums/vstudio/en-US/eb4a7699-0f3c-4701-9790-199787f1b359/vs-2010-error-lnk1123-failure-during-conversion-to-coff-file-invalid-or-corrupt?forum=vcgeneral">[*]</a>）</li>
<li>protoc(protoc-2.5.0-win32.zip)(<strong>解压，然后把路径加入到PATH</strong>)</li>
</ul>


<p>搭建环境之前，<strong>建议您看看<a href="http://wiki.apache.org/hadoop/Hadoop2OnWindows">wiki-Hadoop2OnWindows</a></strong>。最终有用的步骤都在上面了！不过在自己瞎折腾的过程中也弄了不少东西，记录下来！</p>

<h3>1.2 编译windows环境变量配置</h3>

<table>
<thead>
<tr>
<th style="text-align:left;"> 变量              </th>
<th style="text-align:left;"> windows</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> Platform          </td>
<td style="text-align:left;"> Win32</td>
</tr>
<tr>
<td style="text-align:left;"> ANT_HOME          </td>
<td style="text-align:left;"> D:\local\usr\apache-ant-1.9.0</td>
</tr>
<tr>
<td style="text-align:left;"> MAVEN_HOME        </td>
<td style="text-align:left;"> D:\local\usr\apache-maven-3.0.4</td>
</tr>
<tr>
<td style="text-align:left;"> JAVA_HOME         </td>
<td style="text-align:left;"> D:\Java\jdk1.7.0_02</td>
</tr>
<tr>
<td style="text-align:left;"> PATH              </td>
<td style="text-align:left;"> C:\cygwin\bin;C:\protoc;D:\local\usr\apache-maven-3.0.4\bin;D:\local\usr\apache-ant-1.9.0/bin;D:\Java\jdk1.7.0_02\bin;%PATH%</td>
</tr>
</tbody>
</table>


<p><del>编译时，在打开的命令行加入cygwin的路径即可。</del>
在maven编译最后需要用到sh的shell命令，需要把<code>c:\cygwin\bin</code>目录加入到path环境变量。
这里先不配置hadoop的环境变量，因为我只需要用到编译后的本地库而已！！</p>

<h3>1.3 编译源代码生成本地依赖库(dll, exe)</h3>

<p>hadoop2.2.0操作本地文件针对平台的进行了处理。也就是只要在windows运行集群，不管怎么样，你都得先把winutils.exe、hadoop.dll编译出来，用来处理对本地文件赋权、软链接等（类似Linux-Shell的功能）。否则会看到下面的错误：</p>

<ul>
<li><p>命令执行出错，少了winutils.exe</p>

<pre><code class="``">  14/04/14 20:07:58 ERROR util.Shell: Failed to locate the winutils binary in the hadoop binary path
  java.io.IOException: Could not locate executable null\bin\winutils.exe in the Hadoop binaries.
      at org.apache.hadoop.util.Shell.getQualifiedBinPath(Shell.java:278)
      at org.apache.hadoop.util.Shell.getWinUtilsPath(Shell.java:300)
      at org.apache.hadoop.util.Shell.&lt;clinit&gt;(Shell.java:293)

  14/04/17 21:22:32 INFO service.AbstractService: Service org.apache.hadoop.yarn.server.nodemanager.LocalDirsHandlerServic
  e failed in state INITED; cause: java.lang.NullPointerException
  java.lang.NullPointerException
          at java.lang.ProcessBuilder.start(ProcessBuilder.java:1010)
          at org.apache.hadoop.util.Shell.runCommand(Shell.java:404)
          at org.apache.hadoop.util.Shell.run(Shell.java:379)
          at org.apache.hadoop.util.Shell$ShellCommandExecutor.execute(Shell.java:589)
          at org.apache.hadoop.util.Shell.execCommand(Shell.java:678)
          at org.apache.hadoop.util.Shell.execCommand(Shell.java:661)
          at org.apache.hadoop.fs.RawLocalFileSystem.setPermission(RawLocalFileSystem.java:639)
          at org.apache.hadoop.fs.RawLocalFileSystem.mkdirs(RawLocalFileSystem.java:435)
</code></pre></li>
<li><p>少了hadoop.dll的本地库文件</p>

<pre><code class="``">  14/04/17 21:30:27 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-ja
  va classes where applicable
  14/04/17 21:30:29 FATAL datanode.DataNode: Exception in secureMain
  java.lang.UnsatisfiedLinkError: org.apache.hadoop.io.nativeio.NativeIO$Windows.access0(Ljava/lang/String;I)Z
          at org.apache.hadoop.io.nativeio.NativeIO$Windows.access0(Native Method)
          at org.apache.hadoop.io.nativeio.NativeIO$Windows.access(NativeIO.java:435)
          at org.apache.hadoop.fs.FileUtil.canRead(FileUtil.java:977)
          at org.apache.hadoop.util.DiskChecker.checkAccessByFileMethods(DiskChecker.java:177)
          at org.apache.hadoop.util.DiskChecker.checkDirAccess(DiskChecker.java:164)
          at org.apache.hadoop.util.DiskChecker.checkDir(DiskChecker.java:147)
          at org.apache.hadoop.hdfs.server.datanode.DataNode$DataNodeDiskChecker.checkDir(DataNode.java:1698)
</code></pre></li>
</ul>


<h4>下载源码进行编译</h4>

<p>下面需要用到visual studio修改项目配置信息（或者直接修改sln文件也行），然后再使用maven进行编译。</p>

<p>这里仅编译hadoop-common项目，最后把生成winutils.exe/hadoop.dll放到hadoop程序bin目录下。</p>

<p>第一步 下载源码</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/*  https://github.com/apache/hadoop-common.git  */
</span><span class='line'>
</span><span class='line'>Administrator@WINSELIU /e/git/hadoop-common (master)
</span><span class='line'>$ git checkout branch-2.2.0
</span><span class='line'>Checking out files: 100% (5536/5536), done.
</span><span class='line'>Branch branch-2.2.0 set up to track remote branch branch-2.2.0 from origin.
</span><span class='line'>Switched to a new branch 'branch-2.2.0'</span></code></pre></td></tr></table></div></figure>


<p>第二步 应用补丁patch-native-win32</p>

<p>jira: <a href="https://issues.apache.org/jira/browse/HADOOP-9922">https://issues.apache.org/jira/browse/HADOOP-9922</a>   <br/>
patch: <a href="https://issues.apache.org/jira/secure/attachment/12600760/HADOOP-9922.patch">https://issues.apache.org/jira/secure/attachment/12600760/HADOOP-9922.patch</a></p>

<p>native.sln-patch有点问题下面通过vs修改，使用Visual Studio修改native的活动平台</p>

<p><img src="http://farm4.staticflickr.com/3784/13895015882_c7cd95ece5_o.png" alt="" /></p>

<p>第三步 在<code>Visual Studio 命令提示(2010)</code>命令行进行Maven编译(仅需编译hadoop-common)</p>

<p><img src="http://farm4.staticflickr.com/3704/13918439233_8b2693c462_o.png" alt="" /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>E:\git\hadoop-common\hadoop-common-project\hadoop-common&gt;mvn package -Pdist,native-win -DskipTests -Dtar -Dmaven.javadoc.skip=true
</span><span class='line'>
</span><span class='line'>/*  native files  */
</span><span class='line'>
</span><span class='line'>Administrator@winseliu /cygdrive/e/git/hadoop-common/hadoop-common-project/hadoop-common
</span><span class='line'>$ ls -1 target/bin/
</span><span class='line'>hadoop.dll
</span><span class='line'>hadoop.exp
</span><span class='line'>hadoop.lib
</span><span class='line'>hadoop.pdb
</span><span class='line'>libwinutils.lib
</span><span class='line'>winutils.exe
</span><span class='line'>winutils.pdb
</span><span class='line'>
</span><span class='line'>Administrator@winseliu /cygdrive/e/git/hadoop-common/hadoop-common-project/hadoop-common
</span><span class='line'>$ cp target/bin/* ~/hadoop/bin/</span></code></pre></td></tr></table></div></figure>


<p>windows的本地库的路径就是PATH环境变量。所以<strong>windows下最好还是把dll放到bin目录下，同时把<code>HADOOP_HOME/bin</code>加入到环境变量中！！</strong>
修改PATH环境变量。</p>

<p>可以把dll放到自定义的位置，但是同样最好把该路径加入到PATH环境变量。java默认会到PATH路径下找动态链接库dll。</p>

<h3>1.4 修改hadoop配置，部署伪分布式环境</h3>

<p>可以直接把linux伪分布式的配置cp过来用。然后修改namenode/datanode/yarn文件的存储路径就可以了。
这里有个坑，<code>hdfs-default.xml</code>中的路径前面都加了<code>file://</code>前缀！所以hdfs配置中涉及到路径的，这里都得进行了修改。</p>

<p><del>Notepad++的Ctrl+D是一个好功能啊</del></p>

<table>
<thead>
<tr>
<th style="text-align:left;"> 属性                                    </th>
<th style="text-align:left;"> 值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> <strong>slaves</strong></td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> localhost</td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> <strong>core-site.xml</strong></td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> fs.defaultFS                            </td>
<td style="text-align:left;"> hdfs://localhost:9000</td>
</tr>
<tr>
<td style="text-align:left;"> io.file.buffer.size                     </td>
<td style="text-align:left;"> 10240</td>
</tr>
<tr>
<td style="text-align:left;"> hadoop.tmp.dir                          </td>
<td style="text-align:left;"> file:///e:/tmp/hadoop</td>
</tr>
<tr>
<td style="text-align:left;"> <strong>hdfs-site.xml</strong></td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> dfs.replication                         </td>
<td style="text-align:left;"> 1</td>
</tr>
<tr>
<td style="text-align:left;"> dfs.namenode.secondary.http-address     </td>
<td style="text-align:left;"> localhost:9001 #设置为空可以禁用</td>
</tr>
<tr>
<td style="text-align:left;"> dfs.namenode.name.dir                   </td>
<td style="text-align:left;"> ${hadoop.tmp.dir}/dfs/name</td>
</tr>
<tr>
<td style="text-align:left;"> dfs.datanode.data.dir                   </td>
<td style="text-align:left;"> ${hadoop.tmp.dir}/dfs/data</td>
</tr>
<tr>
<td style="text-align:left;"> dfs.namenode.checkpoint.dir             </td>
<td style="text-align:left;"> ${hadoop.tmp.dir}/dfs/namesecondary</td>
</tr>
<tr>
<td style="text-align:left;"> <del>dfs.namenode.shared.edits.dir</del>       </td>
<td style="text-align:left;"> ${hadoop.tmp.dir}/dfs/shared/edits</td>
</tr>
<tr>
<td style="text-align:left;"> <strong>mapred-site.xml</strong></td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> mapreduce.framework.name                </td>
<td style="text-align:left;"> yarn</td>
</tr>
<tr>
<td style="text-align:left;"> mapreduce.jobhistory.address            </td>
<td style="text-align:left;"> localhost:10020</td>
</tr>
<tr>
<td style="text-align:left;"> mapreduce.jobhistory.webapp.address     </td>
<td style="text-align:left;"> localhost:19888</td>
</tr>
<tr>
<td style="text-align:left;"> <strong>yarn-site.xml</strong></td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> yarn.nodemanager.aux-services           </td>
<td style="text-align:left;"> mapreduce_shuffle</td>
</tr>
<tr>
<td style="text-align:left;"> yarn.nodemanager.aux-services.mapreduce_shuffle.class  </td>
<td style="text-align:left;"> org.apache.hadoop.mapred.ShuffleHandler</td>
</tr>
<tr>
<td style="text-align:left;"> yarn.resourcemanager.address            </td>
<td style="text-align:left;"> localhost:8032</td>
</tr>
<tr>
<td style="text-align:left;"> yarn.resourcemanager.scheduler.address  </td>
<td style="text-align:left;"> localhost:8030</td>
</tr>
<tr>
<td style="text-align:left;"> yarn.resourcemanager.resource-tracker.address  </td>
<td style="text-align:left;"> localhost:8031</td>
</tr>
<tr>
<td style="text-align:left;"> yarn.resourcemanager.admin.address      </td>
<td style="text-align:left;"> localhost:8033</td>
</tr>
<tr>
<td style="text-align:left;"> yarn.resourcemanager.webapp.address     </td>
<td style="text-align:left;"> localhost:8088</td>
</tr>
<tr>
<td style="text-align:left;"> yarn.application.classpath              </td>
<td style="text-align:left;"> %HADOOP_CONF_DIR%, %HADOOP_COMMON_HOME%/share/hadoop/common/<em>, %HADOOP_COMMON_HOME%/share/hadoop/common/lib/</em>, %HADOOP_HDFS_HOME%/share/hadoop/hdfs/<em>, %HADOOP_HDFS_HOME%/share/hadoop/hdfs/lib/</em>, %HADOOP_YARN_HOME%/share/hadoop/yarn/<em>, %HADOOP_YARN_HOME%/share/hadoop/yarn/lib/</em></td>
</tr>
</tbody>
</table>


<p>注意点：</p>

<ul>
<li>yarn.application.classpath必须定义！尽管程序中有判断不同平台的默认值不同，但是在yarn-default.xml中已经有值了！

<ul>
<li>yarn.application.classpath对启动程序没影响，但是在运行mapreduce时影响巨大破坏力极强！</li>
</ul>
</li>
<li>自定library的路径是个坑！！

<ul>
<li>在windows下，执行java程序java.library.path默认到PATH路径找。这也是需要定义环境变量HADOOP_HOME，以及把bin加入到PATH的原因吧！</li>
</ul>
</li>
</ul>


<hr />

<h3>1.5 Windows直接运行cmd启动</h3>

<p>如果是用windows的cmd的话，到这里已经基本ok了！<strong>格式化namenode</strong>（<code>hadoop namenode -format</code>），启动就ok了！
<del>发现自己其实很傻×，固执的要用cygwin启动运行！用windows的cmd启动，然后用cygwin的终端查看数据不就行了！两不耽误！</del></p>

<p>cmd命令<strong>默认</strong>是去bin目录下找hadoop.dll的，同时hadoop命令会把bin加入到java.library.path路径下。可以直接把hadoop.dll放到bin路径（强烈推荐）。
设置环境变量，启动文件系统：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/* **设置环境变量** */
</span><span class='line'>HADOOP_HOME=E:\local\libs\big\hadoop-2.2.0 
</span><span class='line'>PATH=%HADOOP_HOME%\bin;%PATH%
</span><span class='line'>
</span><span class='line'>/* 格式化namenode */
</span><span class='line'>hadoop namenode -format
</span><span class='line'>
</span><span class='line'>/* 操作HDFS */
</span><span class='line'>set HADOOP_ROOT_LOGGER=DEBUG,console
</span><span class='line'>
</span><span class='line'>E:\local\libs\big\hadoop-2.2.0&gt;sbin\start-dfs.cmd
</span><span class='line'>
</span><span class='line'>E:\local\libs\big\hadoop-2.2.0&gt;hdfs dfs -put README.txt /   # 很弱，fs简化操作都不兼容！
</span><span class='line'>
</span><span class='line'>E:\local\libs\big\hadoop-2.2.0&gt;hdfs dfs -ls /
</span><span class='line'>Found 1 items
</span><span class='line'>-rw-r--r--   1 Administrator supergroup       1366 2014-04-22 22:20 /README.txt</span></code></pre></td></tr></table></div></figure>


<p>JAVA_HOME的路径中最好不要有空格！</p>

<blockquote><p>instead e.g. c:\Progra~1\Java&#8230; instead of c:\Program Files\Java.&hellip;</p></blockquote>

<p><img src="http://farm8.staticflickr.com/7460/13923348422_494288017b_o.png" alt="" /></p>

<p>好处也是明显的，直接是windows执行，可以使用jdk自带的工具查看运行情况。</p>

<p><img src="http://farm4.staticflickr.com/3668/13946643214_8e4666d636_o.png" alt="" /></p>

<p>?疑问： log日志都写在hadoop.log文件中了？反正我是没看到hadoop.log的文件！</p>

<p>HDFS操作文件OK，如果按照上面步骤或者<a href="http://wiki.apache.org/hadoop/Hadoop2OnWindows">官网的wiki</a>操作，则运行mapreduce也是不会出问题的!!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>E:\local\libs\big\hadoop-2.2.0&gt;sbin\start-yarn.cmd
</span><span class='line'>
</span><span class='line'>E:\local\libs\big\hadoop-2.2.0&gt;hadoop org.apache.hadoop.examples.WordCount /README.txt /out
</span><span class='line'>
</span><span class='line'>E:\local\libs\big\hadoop-2.2.0&gt;hdfs dfs -ls /out
</span><span class='line'>Found 2 items
</span><span class='line'>-rw-r--r--   1 Administrator supergroup          0 2014-04-22 22:22 /out/_SUCCESS
</span><span class='line'>-rw-r--r--   1 Administrator supergroup       1306 2014-04-22 22:22 /out/part-r-00000</span></code></pre></td></tr></table></div></figure>


<p>如果你使用上面的hadoop命令执行不了命令，请把hadoop.cmd的换行（下载下来后是unix的）转成windows的换行！</p>

<h4>问题原因分析</h4>

<p>如果你运行mapreduce失败，不外乎三种情况：没有定义HADOOP_HOME系统环境变量，hadoop.dll没有放在PATH路径下，以及yarn.application.classpath没有设置。这三个问题导致。如果你不幸碰到了，那我们如何来确认问题呢？</p>

<p>下面一步步的来解读这个处理过程。在运行mapreduce时报错，可以使用远程调试方式来确认发生的具体位置。（如果你还没有弄好本地开发环境，请先看[三、导入源码到eclipse]）</p>

<p>第一步 调试NodeManager，从根源下手</p>

<p>由于windows的hadoop的程序都是<strong>直接</strong>运行的，不像linux还要ssh再登陆然后在启动。所以这里直接设置HADOOP_NODEMANAGER_OPTS就可以了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>set HADOOP_NODEMANAGER_OPTS="-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=8092"
</span><span class='line'>
</span><span class='line'>E:\local\libs\big\hadoop-2.2.0\sbin\start-yarn.cmd
</span><span class='line'>starting yarn daemons
</span><span class='line'>
</span><span class='line'>E:\&gt;hadoop org.apache.hadoop.examples.WordCount /in /out</span></code></pre></td></tr></table></div></figure>


<p>运行任务之前，在ContainerLaunch#call#171行打个断点（可以查看执行的java命令脚本内容，#254writeLaunchEnv写入cmd文件）。同时可以去到<code>nm-local-dir/nmPrivate</code>目录下查看任务的本地临时文件。application_XXX/containter_XXX/launch_container.cmd文件是MRAppMaster/YarnChild/YarnChild的启动脚本。</p>

<ul>
<li><p>调试。备份生成的脚本文件，开启死循环拷贝模式，把缓存留下来慢慢看</p>

<pre><code class="``">  while true ; do cp -rf nm-local-dir/ backup/ ; sleep 0.5; done
</code></pre>

<p>  <img src="http://farm3.staticflickr.com/2897/13977296505_22cc6b1ca5_o.png" alt="" /></p></li>
<li><p>查看缓存文件</p>

<ul>
<li>真正启动Mapreduce(yarnchild)的脚本文件launch_container.cmd</li>
<li><p>查看系统日志，确定错误</p>

<p>  <img src="http://farm8.staticflickr.com/7396/13977741284_54a3abccf7_o.png" alt="" /></p></li>
<li><p>classpath路径</p>

<p>  <img src="http://farm3.staticflickr.com/2904/13977751494_f5520c5899_o.png" alt="" /></p></li>
<li><p>Job任务类型。第三个参数！</p>

<p>  <img src="http://farm3.staticflickr.com/2914/13977758184_bc40407385_o.png" alt="" /></p></li>
</ul>
</li>
</ul>


<p>这里可以查看脚本，确认HADOOP的相关目录是否正确！以及查看classpath的MANIFEST.MF查看依赖的jar是否完整！也可以通过任务的名称了解相关信息。</p>

<ul>
<li>路径问题，不影响大局（可以不关注/不修改）</li>
</ul>


<p><img src="http://farm4.staticflickr.com/3764/13947513865_da5c490c9e_o.png" alt="" /></p>

<ul>
<li>调试map/reduce</li>
</ul>


<p>调试程序mapreduce比较好办了，毕竟代码都是自己写的好弄。可以使用mrunit。</p>

<p>map和reduce的进程都是动态的，既不能通过命令行的OPTS参数指定。如果要调试map/reduce需要在opts中传递给它们。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hadoop org.apache.hadoop.examples.WordCount  "-Dmapreduce.map.java.opts=-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=8090" /in /out</span></code></pre></td></tr></table></div></figure>


<ul>
<li>library问题</li>
</ul>


<p>如果因为library的问题报access$0的错，提交任务都不成功，可以把自定义的dll路径加入java.library.path尝试一下。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hadoop org.apache.hadoop.examples.WordCount "-Dmapreduce.map.java.opts= -Djava.library.path=E:\local\libs\big\hadoop-2.2.0\lib\native" "-Dmapreduce.reduce.java.opts=-Djava.library.path=E:\local\libs\big\hadoop-2.2.0\lib\native"  /in /out</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>1.6 cygwin下运行</h3>

<p>要在cygwin下面把hadoop弄起来，你要把cygwin与java的路径区分，理清楚路径，配置工作就成功一半咯！既然用的还是windows的java程序。配置文件也是最终提供给java执行的，所以配置都不需要修改。</p>

<p>要在cygwin中运行hadoop，仅仅搞定脚本就ok了！在执行java命令之前，把cygwin的路径转换为windows。</p>

<ul>
<li>修改了hadoop-env.sh的内容：</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export JAVA_HOME=/cygdrive/d/Java/jdk1.7.0_02 #本来已经在环境变量中定义了，但是执行后台批处理的时刻不会调用环境变量的配置！
</span><span class='line'>export HADOOP_HEAPSIZE=512
</span><span class='line'>export HADOOP_PID_DIR=${HADOOP_PID_DIR:-${HADOOP_LOG_DIR}}</span></code></pre></td></tr></table></div></figure>


<p>cygwin也就是linux的默认加载native的路径是libs/native！！拷一份过去把！！或者配置JAVA_LIBRARY_PATH，参见下面的修改Shell脚本部分。</p>

<p>cygwin自带的工具有个优势：运行脚本和java命令都不出现乱码。（或许把SecureCRT改成GBK编码也行）</p>

<ul>
<li>修改shell脚本命令</li>
</ul>


<p>由于java在windows和linux在识别文件路径上也有差异。如/data传给java，在windows会加上当前路径的盘符(e.g. E)，那写入数据目录就为<code>e:/data</code>。</p>

<p>同时，不同操作系统的classpath的组织方式也不同。(1)需要对classpath已经文件夹的路径进行转换，才能在cygwin下正常的运行java程序。
所以，只要在执行java命令之前对路径和classpath进行转换即可。(2)还需要对getconf返回值的换行符进行处理。涉及到下列的文件：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>libexec/hadoop-config.sh
</span><span class='line'>bin/hadoop
</span><span class='line'>bin/hdfs
</span><span class='line'>bin/mapred
</span><span class='line'>bin/yarn
</span><span class='line'>sbin/start-dfs.sh
</span><span class='line'>sbin/stop-dfs.sh</span></code></pre></td></tr></table></div></figure>


<p>重点修改两个问题如下：</p>

<ul>
<li>配置</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/* hadoop-config.sh */
</span><span class='line'>
</span><span class='line'># 定义时注意，处理cygwin路径时只处理了以/cygdrive开头的路径！ 
</span><span class='line'>export JAVA_LIBRARY_PATH=/cygdrive/e/local/libs/big/hadoop-2.2.0/bin</span></code></pre></td></tr></table></div></figure>


<p>由于windows配置时，把hadoop.dll的动态链接库放到bin目录下，而linux（cygwin）的sh脚本默认是去lib/native下面，所以需要定义一下链接库的查找路径。</p>

<ul>
<li>脚本</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/* hadoop-config.sh */
</span><span class='line'>
</span><span class='line'>/* 在调用java命令前，调用该方法 */
</span><span class='line'>function Cygwin_Patch_PathConvert() {
</span><span class='line'>
</span><span class='line'>  cygwin=false
</span><span class='line'>  case "`uname`" in
</span><span class='line'>  CYGWIN*) cygwin=true;;
</span><span class='line'>  esac
</span><span class='line'>
</span><span class='line'>  # cygwin path translation
</span><span class='line'>  if $cygwin; then
</span><span class='line'>      CLASSPATH=`cygpath -p -w "$CLASSPATH"`
</span><span class='line'>      # ssh过来执行命令是不从.bash_profile获取参数！
</span><span class='line'>      if [ "X$HADOOP_HOME" != "X" ]; then
</span><span class='line'>          HADOOP_HOME=`cygpath -w "$HADOOP_HOME"`
</span><span class='line'>      fi
</span><span class='line'>      HADOOP_LOG_DIR=`cygpath -w "$HADOOP_LOG_DIR"`
</span><span class='line'>      if [ "X$TOOL_PATH" != "X" ]; then
</span><span class='line'>          TOOL_PATH=`cygpath -p -w "$TOOL_PATH"`
</span><span class='line'>      fi
</span><span class='line'>      
</span><span class='line'>HADOOP_COMMON_HOME=`cygpath -w "$HADOOP_COMMON_HOME"`
</span><span class='line'>JAVA_HOME=`cygpath -w "$JAVA_HOME"`
</span><span class='line'>HADOOP_YARN_HOME=`cygpath -w "$HADOOP_YARN_HOME"`
</span><span class='line'>HADOOP_HDFS_HOME=`cygpath -w "$HADOOP_HDFS_HOME"`
</span><span class='line'>HADOOP_CONF_DIR=`cygpath -w "$HADOOP_CONF_DIR"`
</span><span class='line'>
</span><span class='line'># HOME
</span><span class='line'>      
</span><span class='line'>      # 把带/cygdrive/[abc]形式的路径转换为windows路径
</span><span class='line'>      HADOOP_OPTS=`echo $HADOOP_OPTS | awk -F" " '{for(i=1;i&lt;=NF;i++)print $i}' | awk -F"=" ' {if($2~/^\/cygdrive\/[a|b|c|d|e]/){print $1;system("cygpath -w -p " $2 )}else{ print $0 }; print ""}' | awk 'BEGIN{opt="";last=""}{if($0~/^$/){ opt=opt " "; last="" }else{ if(last!=""){ opt=opt "="} opt=opt $0; last=$0; }; }END{ print opt }' `
</span><span class='line'>      
</span><span class='line'>      YARN_OPTS=`echo $YARN_OPTS | awk -F" " '{for(i=1;i&lt;=NF;i++)print $i}' | awk -F"=" ' {if($2~/^\/cygdrive\/[a|b|c|d|e]/){print $1;system("cygpath -w -p " $2 )}else{ print $0 }; print ""}' | awk 'BEGIN{opt="";last=""}{if($0~/^$/){ opt=opt " "; last="" }else{ if(last!=""){ opt=opt "="} opt=opt $0; last=$0; }; }END{ print opt }' `
</span><span class='line'>
</span><span class='line'>      JAVA_LIBRARY_PATH=`cygpath -p -w "$JAVA_LIBRARY_PATH"`
</span><span class='line'>      
</span><span class='line'>  fi
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>/* 系统的换行符不同，需要转换 */
</span><span class='line'>SECONDARY_NAMENODES=$($HADOOP_PREFIX/bin/hdfs getconf -secondarynamenodes 2&gt;/dev/null | sed 's/^M//g' )</span></code></pre></td></tr></table></div></figure>


<p>在解析OPTS时执行cygpath转换的时刻，也需要加上-p的参数！OPTS中有java.library.path的环境变量！</p>

<ul>
<li>HDFS文件系统测试</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bin/hadoop namenode -format
</span><span class='line'>sbin/start-dfs.sh
</span><span class='line'>ps</span></code></pre></td></tr></table></div></figure>


<p>jps没有作用了；或者也可以通过任务管理器/<strong>ProcessExplorer</strong>查看java.exe，命令行列还可以查看具体的执行命令，对应的什么服务。</p>

<table>
<thead>
<tr>
<th style="text-align:left;"> 映像名称     </th>
<th style="text-align:left;"> 用户名         </th>
<th style="text-align:left;"> 命令行</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> java.exe     </td>
<td style="text-align:left;"> Administrator  </td>
<td style="text-align:left;"> D:\Java\jdk1.7.0_02\bin\java.exe -Dproc_namenode -Xmx512m &hellip; org.apache.hadoop.hdfs.server.namenode.NameNode</td>
</tr>
<tr>
<td style="text-align:left;"> java.exe     </td>
<td style="text-align:left;"> Administrator  </td>
<td style="text-align:left;"> D:\Java\jdk1.7.0_02\bin\java.exe -Dproc_datanode -Xmx512m &hellip; org.apache.hadoop.hdfs.server.datanode.DataNode</td>
</tr>
<tr>
<td style="text-align:left;"> java.exe     </td>
<td style="text-align:left;"> Administrator  </td>
<td style="text-align:left;"> D:\Java\jdk1.7.0_02\bin\java.exe -Dproc_secondarynamenode &hellip; org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode</td>
</tr>
</tbody>
</table>


<p>修改了hadoop的脚本，启动环境（cygwin下启动和windows启动都可以），就可以操作HDFS了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@winseliu ~
</span><span class='line'>$ hadoop/bin/hadoop fs -put job.xml /
</span><span class='line'>14/04/22 23:53:31 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
</span><span class='line'>
</span><span class='line'>Administrator@winseliu ~
</span><span class='line'>$ export JAVA_LIBRARY_PATH=/cygdrive/e/local/libs/big/hadoop-2.2.0/bin
</span><span class='line'>
</span><span class='line'>Administrator@winseliu ~
</span><span class='line'>$ hadoop/bin/hadoop fs -ls /
</span><span class='line'>Found 4 items
</span><span class='line'>-rw-r--r--   1 Administrator supergroup       1366 2014-04-22 22:20 /README.txt
</span><span class='line'>-rw-r--r--   1 Administrator supergroup      66539 2014-04-22 23:53 /job.xml
</span><span class='line'>drwxr-xr-x   - Administrator supergroup          0 2014-04-22 23:34 /out
</span><span class='line'>drwx------   - Administrator supergroup          0 2014-04-22 22:21 /tmp</span></code></pre></td></tr></table></div></figure>


<p>如果执行权限问题，可以使用设置HADOOP_USER_NAME的方式处理：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@winseliu ~/hadoop
</span><span class='line'>$ export HADOOP_USER_NAME=Administrator
</span><span class='line'>
</span><span class='line'>Administrator@winseliu ~/hadoop
</span><span class='line'>$ bin/hadoop fs -rmr /out</span></code></pre></td></tr></table></div></figure>


<h4>MapReduce任务测试</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sbin/start-yarn.sh
</span><span class='line'>ps</span></code></pre></td></tr></table></div></figure>


<p>yarn资源框架启动后，任务管理又会添加两个java的程序：</p>

<table>
<thead>
<tr>
<th style="text-align:left;"> 映像名称     </th>
<th style="text-align:left;"> 用户名         </th>
<th style="text-align:left;"> 命令行</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> java.exe     </td>
<td style="text-align:left;"> Administrator  </td>
<td style="text-align:left;"> D:\Java\jdk1.7.0_02\bin\java.exe -Dproc_resourcemanager &hellip;  org.apache.hadoop.yarn.server.resourcemanager.ResourceManager</td>
</tr>
<tr>
<td style="text-align:left;"> java.exe     </td>
<td style="text-align:left;"> Administrator  </td>
<td style="text-align:left;"> D:\Java\jdk1.7.0_02\bin\java.exe -Dproc_nodemanager &hellip; org.apache.hadoop.yarn.server.nodemanager.NodeManager</td>
</tr>
</tbody>
</table>


<h4>提交任务，执行任务处理</h4>

<p>在cygwin环境下，hdfs和yarn都启动成功了，并且能传文件到HDFS中。但是由于cygwin环境最终还是使用windows的java程序集群执行任务！</p>

<p>（可考虑[2.2 Eclipse提交MapReduce]）</p>

<ul>
<li>已处理问题一： cygwin下启动nodemanager，路径没转换</li>
</ul>


<p>由于在cygwin下面启动，大部分的环境变量都是从cygwin带过来的！解析conf中的变量时会使用nodemanager中对应变量的值，如HADOOP_MAPRED_HOME等。</p>

<p>在cygwin使用start-yarn.sh调用java启动程序之前需要转换路径为windows下的路径。在上面的操作已经进行了处理。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 在临时目录下生成了launch_container.cmd文件，用于执行命令，而里面环境变量的值有些cygwin环境下的！
</span><span class='line'>
</span><span class='line'># 设置端口调试nodemanager
</span><span class='line'>Administrator@winseliu ~/hadoop
</span><span class='line'>$ grep "8092" etc/hadoop/*
</span><span class='line'>etc/hadoop/yarn-env.sh:export YARN_NODEMANAGER_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8092"
</span><span class='line'>
</span><span class='line'>## windows下这个方法大有文章，会把客户端传递的CLASSPATH写入jar的MANIFEST.MF中！
</span><span class='line'>org.apache.hadoop.yarn.server.nodemanager.containermanager.launcher.ContainerLaunch.sanitizeEnv()</span></code></pre></td></tr></table></div></figure>


<ul>
<li>已处理问题二：执行mapreduce任务时，缺少环境变量（使用Process Explorer工具查看）</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 设置远程调试map
</span><span class='line'>hadoop org.apache.hadoop.examples.WordCount  "-Dmapreduce.map.java.opts=-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=8090" /job.xml /out
</span><span class='line'>
</span><span class='line'># mapred-site.xml设置超时时间
</span><span class='line'>  &lt;property&gt;
</span><span class='line'>      &lt;name&gt;mapred.task.timeout&lt;/name&gt;
</span><span class='line'>      &lt;value&gt;1800000&lt;/value&gt;
</span><span class='line'>  &lt;/property&gt;
</span><span class='line'>
</span><span class='line'># 结束任务
</span><span class='line'>Administrator@winseliu ~/hadoop
</span><span class='line'>$ bin/hadoop job -kill job_1398407971082_0003</span></code></pre></td></tr></table></div></figure>


<ul>
<li>取不到HADOOP_HOME环境变量，查找winutils.exe时报错！

<ul>
<li>在hadoop-env.sh中增加定义HADOOP_HOME！</li>
</ul>
</li>
<li>library路径问题，解析动态链接库hadoop.dll失败！

<ul>
<li>增加-D参数吧！</li>
</ul>
</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hadoop org.apache.hadoop.examples.WordCount "-Dmapreduce.map.java.opts= -Djava.library.path=E:\local\libs\big\hadoop-2.2.0\bin" "-Dmapreduce.reduce.java.opts=-Djava.library.path=E:\local\libs\big\hadoop-2.2.0\bin"  /job.xml /out</span></code></pre></td></tr></table></div></figure>


<p>windows泽腾啊。</p>

<ul>
<li>问题二：直接提交任务到linux集群，环境变量不匹配</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@winseliu ~/hadoop
</span><span class='line'>$ bin/hadoop  fs -ls hdfs://192.168.1.104:9000/
</span><span class='line'>
</span><span class='line'>Administrator@winseliu ~/hadoop
</span><span class='line'>$ export HADOOP_USER_NAME=hadoop
</span><span class='line'>
</span><span class='line'>Administrator@winseliu ~/hadoop
</span><span class='line'>$  bin/hadoop  org.apache.hadoop.examples.WordCount   -fs hdfs://192.168.1.104:9000 -jt 192.168.1.104 /in /out</span></code></pre></td></tr></table></div></figure>


<p>由于本地是windows的java执行任务提交到集群，所以使用了<code>%JAVA_HOME%</code>，以及windows下的CLASSPATH！执行任务时，同时把nodemanager节点的临时目录备份下来再慢慢查看：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[hadoop@slave temp]$ while true ; do cp -rf nm-local-dir/ backup/ ; sleep 0.1; done
</span><span class='line'>[hadoop@slave temp]$ find . -name "*.sh"</span></code></pre></td></tr></table></div></figure>


<p>修复该问题，可以参考[2.2 Eclipse提交MapReduce]。</p>

<h3>参考</h3>

<hr />

<h2>二、Windows下使用eclipse连接linux集群</h2>

<h3>2.1 java代码操作HDFS</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class HelloHdfs {
</span><span class='line'>
</span><span class='line'>  public static boolean FINISH_CLEAN = true;
</span><span class='line'>
</span><span class='line'>  public static void main(String[] args) throws IOException {
</span><span class='line'>      System.setProperty("HADOOP_USER_NAME", "hadoop"); // 设置用户，否则会有读取权限的问题
</span><span class='line'>      
</span><span class='line'>      FileSystem fs = FileSystem.get(new Configuration());
</span><span class='line'>
</span><span class='line'>      fs.mkdirs(new Path("/java/folder"));
</span><span class='line'>      OutputStream os = fs.create(new Path("/java/folder/hello.txt"));
</span><span class='line'>      Writer w = new BufferedWriter(new OutputStreamWriter(os, "UTF-8"));
</span><span class='line'>      w.write("hello hadoop!");
</span><span class='line'>      w.flush();
</span><span class='line'>      w.close();
</span><span class='line'>      os.close();
</span><span class='line'>
</span><span class='line'>      FSDataInputStream is = fs.open(new Path("/java/folder/hello.txt"));
</span><span class='line'>      BufferedReader br = new BufferedReader(new InputStreamReader(is, "UTF-8"));
</span><span class='line'>      System.out.println(br.readLine());
</span><span class='line'>      br.close();
</span><span class='line'>      is.close();
</span><span class='line'>
</span><span class='line'>      // IOUtils.copyBytes(in, out, 4096, true);
</span><span class='line'>
</span><span class='line'>      if (FINISH_CLEAN)
</span><span class='line'>          fs.delete(new Path("/java"), true);
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>对于访问linux集群的hdfs，只要编译通过，对集群HDFS文件系统的CRUD基本没有不会遇到什么问题。写代码过程中遇到过下面两个问题：</p>

<ul>
<li><p>如果你也引入了hive的包，可能会抛不能重写final方法的错误！由于hive中也就了proto的代码（final），调整下顺序先加载proto的包就可以了！</p>

<pre><code class="``">  log4j:WARN Please initialize the log4j system properly.
  Exception in thread "main" java.lang.VerifyError: class org.apache.hadoop.security.proto.SecurityProtos$CancelDelegationTokenRequestProto overrides final method getUnknownFields.()Lcom/google/protobuf/UnknownFieldSet;
      at java.lang.ClassLoader.defineClass1(Native Method)
      at java.lang.ClassLoader.defineClass(ClassLoader.java:791)
</code></pre></li>
<li><p>Permission denied: user=Administrator, access=WRITE, inode=&ldquo;/&rdquo;:hadoop:supergroup:drwxr-xr-x
  这个问题的处理方式有很多。</p>

<ul>
<li>hadoop fs -chmod 777 /</li>
<li>在hdfs的配置文件中，将dfs.permissions修改为False</li>
<li>System.setProperty(&ldquo;user.name&rdquo;, &ldquo;hduser&rdquo;)/System.setProperty(&ldquo;HADOOP_USER_NAME&rdquo;, &ldquo;hduser&rdquo;)/configuration.set(&ldquo;hadoop.job.ugi&rdquo;, &ldquo;hduser&rdquo;);</li>
</ul>
</li>
</ul>


<h3>2.2 Eclipse提交MapReduce</h3>

<ul>
<li><p>需要设置HADOOP_HOME/hadoop.home.dir的环境变量，即在该目录下面有bin\winutils.exe的文件。否则会报错：</p>

<pre><code class="``">  14/04/14 20:07:57 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
  14/04/14 20:07:58 ERROR util.Shell: Failed to locate the winutils binary in the hadoop binary path
  java.io.IOException: Could not locate executable null\bin\winutils.exe in the Hadoop binaries.
      at org.apache.hadoop.util.Shell.getQualifiedBinPath(Shell.java:278)
      at org.apache.hadoop.util.Shell.getWinUtilsPath(Shell.java:300)
      at org.apache.hadoop.util.Shell.&lt;clinit&gt;(Shell.java:293)
</code></pre></li>
<li><p>任务端(map/reduce)执行命令的classpath变量在客户端Client拼装的！</p>

<p>  浏览官网的<a href="https://issues.apache.org/jira/browse/MAPREDUCE-5655" title="Remote job submit from windows to a linux hadoop cluster fails due to wrong classpath">jira</a>，然后下载并应用<a href="https://issues.apache.org/jira/secure/attachment/12616981/MRApps.patch">MRApps.patch</a>和<a href="https://issues.apache.org/jira/secure/attachment/12616982/YARNRunner.patch">YARNRunner.patch</a>两个补丁。</p>

<p>  其实就是修改Apps#addToEnvironment(Map&lt;String, String>, String, String)来拼装特定操作系统的classpath。以及JAVA_HOME等一些环境变量的值（<code>$JAVA_HOME</code> or <code>%JAVA_HOME%</code>）</p>

<p>  使用<code>patch -p1 &lt; PATCH</code>进行修复。如果patch文件不在项目根路径，可以删除补丁内容前面文件夹路径，直接与源文件放一起然后应用patch就行了。当然你根据修改的内容手动修改也是OK的。</p></li>
</ul>


<p>如果仅仅是作为客户端client提交任务时使用。如仅在eclipse中运行main提交任务，那么就没有必要打包！直接放到需要项目源码中即可。</p>

<pre><code>* 把应用了补丁的YARNRunner和MRApps加入到项目中
* 然后再configuration中加入`config.set("mapred.remote.os", "Linux")`
* 把mapreduce的任务打包为jar，然后`job.setJar("helloyarn.jar")`
* 最后`Run As -&gt; Java Application`运行提交
</code></pre>

<p>如果很多项目使用，可以打包出来，然后把它添加到classpath中，同时添加加入自定义的xml配置。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lib-ext&gt;jar tvf window-client-mapreduce-patch.jar
</span><span class='line'>  25 Wed Apr 16 11:21:26 CST 2014 META-INF/MANIFEST.MF
</span><span class='line'> 26684 Wed Apr 16 10:10:16 CST 2014 org/apache/hadoop/mapred/YARNRunner.class
</span><span class='line'> 24397 Tue Apr 15 10:32:28 CST 2014 org/apache/hadoop/mapred/YARNRunner.java
</span><span class='line'>  1406 Wed Apr 16 10:10:16 CST 2014 org/apache/hadoop/mapreduce/v2/util/MRApps$1.class
</span><span class='line'>  2450 Wed Apr 16 10:10:16 CST 2014 org/apache/hadoop/mapreduce/v2/util/MRApps$TaskAttemptStateUI.class
</span><span class='line'> 19887 Wed Apr 16 10:10:16 CST 2014 org/apache/hadoop/mapreduce/v2/util/MRApps.class
</span><span class='line'> 18879 Tue Apr 15 11:42:42 CST 2014 org/apache/hadoop/mapreduce/v2/util/MRApps.java</span></code></pre></td></tr></table></div></figure>


<p><img src="http://farm3.staticflickr.com/2935/13958663143_a434fb0da7_o.png" alt="" /></p>

<h3>参考：</h3>

<ul>
<li><a href="http://zy19982004.iteye.com/blog/2031172">Hadoop学习三十二：Win7下无法提交MapReduce Job到集群环境</a></li>
<li><a href="http://blog.csdn.net/fansy1990/article/details/22896249">Eclipse调用hadoop2运行MR程序</a></li>
<li><a href="https://issues.apache.org/jira/browse/MAPREDUCE-5655">jira-Remote job submit from windows to a linux hadoop cluster fails due to wrong classpath</a></li>
</ul>


<hr />

<h2>三、导入源码到eclipse</h2>

<h3>环境</h3>

<p>参考前面的【window伪分布式部署】</p>

<h3>打开Visual Studio的命令行工具</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>启动\所有程序\Microsoft Visual Studio 2010\Visual Studio Tools\Visual Studio 命令提示(2010)</span></code></pre></td></tr></table></div></figure>


<h3>获取源码，检查2.2.0的分支</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git@github.com:apache/hadoop-common.git
</span><span class='line'>git checkout branch-2.2.0</span></code></pre></td></tr></table></div></figure>


<p>也可以下载src的源码包，但是如果想修改点东西的话，clone源码应该是最佳的选择了。</p>

<ul>
<li>前面说的win32的patch，如果记得打上哦！参见[1.3 编译源代码生成本地依赖库(dll, exe)]</li>
<li>编译hadoop-auth项目的时刻报错，需要在pom中添加jetty-util的依赖，参考<a href="http://www.cnblogs.com/sysuys/p/3492791.html">找不到org.mortbay.component.AbstractLifeCycle的类文件</a>。</li>
</ul>


<h3>编译生成打包</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>set PATH=c:\cygwin\bin;%PATH%
</span><span class='line'>mvn package -Pdist,native-win -DskipTests -Dmaven.javadoc.skip=true</span></code></pre></td></tr></table></div></figure>


<p>最好加上skipTests条件，不然编译等待时间不是一般的长！！</p>

<h3>导入eclipse</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mvn eclipse:eclipse</span></code></pre></td></tr></table></div></figure>


<p>然后使用eclipse导入已经存在的工程(existing projects into workspace)，导入后存在两个问题：</p>

<ol>
<li>stream工程的conf源码包找不到。修改为在.project文件中引用，然后把conf引用加入到.classpath。</li>
<li>common下的test代码报错。把<code>target/generated-test-sources/java</code>文件夹的也作为源码包即可。</li>
</ol>


<p><img src="http://farm8.staticflickr.com/7295/13945793574_1d5c0ea62e_o.png" alt="" /></p>

<p>eclipse的maven插件你得安装了（要用到M2_REPO路径），同时引用正确conf\settings.xml的Maven配置路径。</p>

<p>注意： 不要使用eclipse导入已经存在的maven方式！eclipse的m2e有些属性和插件还不支持，导入后会报很多错！而使用<code>mvn eclipse:eclipse</code>的方式是把依赖的jar加入到<code>.classpath</code>。</p>

<h3>参考</h3>

<ul>
<li><a href="http://www.cnblogs.com/zhengcong/p/3592490.html">使用Maven将Hadoop2.2.0源码编译成Eclipse项目</a></li>
</ul>


<hr />

<h2>四、胡乱噗噗</h2>

<h3>查看Debug日志</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[hadoop@umcc97-44 ~]$ export HADOOP_ROOT_LOGGER=DEBUG,console
</span><span class='line'>[hadoop@umcc97-44 ~]$ hadoop fs -ls /</span></code></pre></td></tr></table></div></figure>


<h3>java加载动态链接库的环境变量java.library.path</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>D:\local\cygwin\Administrator\test&gt;java LoadLib
</span><span class='line'>
</span><span class='line'>D:\local\cygwin\Administrator\test&gt;java -Djava.library.path=. LoadLib
</span><span class='line'>Exception in thread "main" java.lang.UnsatisfiedLinkError: no hadoop in java.library.path
</span><span class='line'>        at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1860)
</span><span class='line'>        at java.lang.Runtime.loadLibrary0(Runtime.java:845)
</span><span class='line'>        at java.lang.System.loadLibrary(System.java:1084)
</span><span class='line'>        at LoadLib.main(LoadLib.java:3)
</span><span class='line'>
</span><span class='line'>D:\local\cygwin\Administrator\test&gt;java -Djava.library.path=".;%PATH%" LoadLib
</span></code></pre></td></tr></table></div></figure>


<p>没有定义的时刻，会去PATH路径下找。一旦定义了java.library.path只会在给定的路径下查找！</p>

<h3>hadoop的本地native-library的位置</h3>

<p>文件具体放什么位置，随便运行一个命令，通过debug的日志就可以看到默认Library的路径。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@winseliu ~/hadoop
</span><span class='line'>$ export HADOOP_ROOT_LOGGER=DEBUG,console
</span><span class='line'>
</span><span class='line'>Administrator@winseliu ~/hadoop
</span><span class='line'>$ bin/hadoop fs -ls /
</span><span class='line'>
</span><span class='line'>14/04/18 09:48:39 DEBUG util.NativeCodeLoader: java.library.path=E:\local\libs\big\hadoop-2.2.0\lib\native
</span><span class='line'>14/04/18 09:48:39 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span></code></pre></td></tr></table></div></figure>


<h3>cygwin下运行java程序，路径问题</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@winseliu ~/test
</span><span class='line'>$ ls
</span><span class='line'>ENV.class  ENV.java  w3m-0.5.2
</span><span class='line'>
</span><span class='line'>Administrator@winseliu ~/test
</span><span class='line'>$ java ENV
</span><span class='line'>Windows 7
</span><span class='line'>
</span><span class='line'>Administrator@winseliu ~/test
</span><span class='line'>$ jar cvf test.jar *.class
</span><span class='line'>已添加清单
</span><span class='line'>正在添加: ENV.class(输入 = 475) (输出 = 307)(压缩了 35%)
</span><span class='line'>
</span><span class='line'>Administrator@winseliu ~/test
</span><span class='line'>$ ls -l
</span><span class='line'>总用量 18
</span><span class='line'>-rwxr-xr-x  1 Administrator None 475 四月  4 15:00 ENV.class
</span><span class='line'>-rw-r--r--  1 Administrator None 117 四月  4 15:00 ENV.java
</span><span class='line'>-rwxr-xr-x  1 Administrator None 758 四月 19 12:03 test.jar
</span><span class='line'>drwxr-xr-x+ 1 Administrator None   0 四月 12 20:31 w3m-0.5.2
</span><span class='line'>
</span><span class='line'>Administrator@winseliu ~/test
</span><span class='line'>$ java -cp test.jar ENV
</span><span class='line'>Windows 7
</span><span class='line'>
</span><span class='line'>Administrator@winseliu ~/test
</span><span class='line'>$ java -cp /home/Administrator/test/test.jar ENV
</span><span class='line'>错误: 找不到或无法加载主类 ENV
</span><span class='line'>
</span><span class='line'>Administrator@winseliu ~/test
</span><span class='line'>$ set -x
</span><span class='line'>
</span><span class='line'>Administrator@winseliu ~/test
</span><span class='line'>$ java -cp `cygpath -w /home/Administrator/test/test.jar` ENV
</span><span class='line'>++ cygpath -w /home/Administrator/test/test.jar
</span><span class='line'>+ java -cp 'D:\local\cygwin\Administrator\test\test.jar' ENV
</span><span class='line'>Windows 7</span></code></pre></td></tr></table></div></figure>


<h3>[cygwin]ssh单独用户权限问题</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@winseliu ~
</span><span class='line'>$ hadoop/bin/hadoop  fs -put .bash_profile /bash.info
</span><span class='line'>put: Permission denied: user=Administrator, access=WRITE, inode="/":cyg_server:supergroup:drwxr-xr-x</span></code></pre></td></tr></table></div></figure>


<ul>
<li>设置环境变量<code>HADOOP_USER_NAME=hadoop</code></li>
<li>可以使用dfs.permissions属性设置为false。</li>
<li>给位置chown/chmod赋权: <code>hadoop fs -chmod 777 /</code></li>
<li>也可以使用ssh-host-config的<code>Should privilege separation be used? (yes/no) no</code>设置为<strong>no</strong>。使用当前用户进行管理。
  <code>
  Administrator@winseliu /var
  $ chown Administrator:None empty/
  Administrator@winseliu ~
  $ /usr/sbin/sshd.exe # 启动，也可以弄个脚本到启动项，开机启动
  Administrator@winseliu ~/hadoop
  $ ps | grep ssh
       4384       1    4384       4384  ?        500 02:41:21 /usr/sbin/sshd
 </code></li>
</ul>


<h3>Visual Studio处理winutils工程</h3>

<ul>
<li><p>winutils的32位编译
  .net framework4, vs2010, 属性修改设置
  <a href="http://stackoverflow.com/questions/12267158/failure-during-conversion-to-coff-file-invalid-or-corrupt">http://stackoverflow.com/questions/12267158/failure-during-conversion-to-coff-file-invalid-or-corrupt</a>
  <a href="http://stackoverflow.com/questions/10888391/error-link-fatal-error-lnk1123-failure-during-conversion-to-coff-file-inval">http://stackoverflow.com/questions/10888391/error-link-fatal-error-lnk1123-failure-during-conversion-to-coff-file-inval</a>
  <a href="http://social.msdn.microsoft.com/Forums/vstudio/en-US/eb4a7699-0f3c-4701-9790-199787f1b359/vs-2010-error-lnk1123-failure-during-conversion-to-coff-file-invalid-or-corrupt?forum=vcgeneral">http://social.msdn.microsoft.com/Forums/vstudio/en-US/eb4a7699-0f3c-4701-9790-199787f1b359/vs-2010-error-lnk1123-failure-during-conversion-to-coff-file-invalid-or-corrupt?forum=vcgeneral</a></p>

<p>  <a href="http://hi.baidu.com/dreamthief/item/aa690d1494e2caca38cb306d">http://hi.baidu.com/dreamthief/item/aa690d1494e2caca38cb306d</a></p>

<p>  在cygwin安装的时刻也看过这篇，用64位环境maven的是可以编译的
  <a href="http://www.srccodes.com/p/article/38/build-install-configure-run-apache-hadoop-2.2.0-microsoft-windows-os">http://www.srccodes.com/p/article/38/build-install-configure-run-apache-hadoop-2.2.0-microsoft-windows-os</a></p>

<p>  <a href="http://stackoverflow.com/questions/18630019/running-apache-hadoop-2-1-0-on-windows">http://stackoverflow.com/questions/18630019/running-apache-hadoop-2-1-0-on-windows</a></p></li>
</ul>


<h3>[cygwin]ipv6的问题，改成ipv4后不能登陆！</h3>

<p>可能是新版本的openssh的bug！！！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@winseliu /cygdrive/h/documents
</span><span class='line'>$ ssh -o AddressFamily=inet localhost -v
</span><span class='line'>OpenSSH_6.5, OpenSSL 1.0.1g 7 Apr 2014
</span><span class='line'>debug1: Reading configuration data /etc/ssh_config
</span><span class='line'>debug1: Connecting to localhost [127.0.0.1] port 22.
</span><span class='line'>debug1: Connection established.
</span><span class='line'>debug1: identity file /home/Administrator/.ssh/id_rsa type 1
</span><span class='line'>debug1: identity file /home/Administrator/.ssh/id_rsa-cert type -1
</span><span class='line'>debug1: identity file /home/Administrator/.ssh/id_dsa type -1
</span><span class='line'>debug1: identity file /home/Administrator/.ssh/id_dsa-cert type -1
</span><span class='line'>debug1: identity file /home/Administrator/.ssh/id_ecdsa type -1
</span><span class='line'>debug1: identity file /home/Administrator/.ssh/id_ecdsa-cert type -1
</span><span class='line'>debug1: identity file /home/Administrator/.ssh/id_ed25519 type -1
</span><span class='line'>debug1: identity file /home/Administrator/.ssh/id_ed25519-cert type -1
</span><span class='line'>debug1: Enabling compatibility mode for protocol 2.0
</span><span class='line'>debug1: Local version string SSH-2.0-OpenSSH_6.5
</span><span class='line'>ssh_exchange_identification: read: Connection reset by peer
</span><span class='line'>
</span><span class='line'>Administrator@winseliu ~
</span><span class='line'>$ ping localhost
</span><span class='line'>
</span><span class='line'>正在 Ping winseliu [::1] 具有 32 字节的数据:
</span><span class='line'>来自 ::1 的回复: 时间&lt;1ms
</span><span class='line'>来自 ::1 的回复: 时间&lt;1ms
</span></code></pre></td></tr></table></div></figure>


<p>还不能再hosts文件中加！如，指定localhost为127.0.0.1后，得到结果为：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@winseliu ~/hadoop
</span><span class='line'>$ ssh localhost
</span><span class='line'>ssh_exchange_identification: read: Connection reset by peer</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GIT操作记录手册]]></title>
    <link href="http://winse.github.io/blog/2014/03/30/git-cheatsheet/"/>
    <updated>2014-03-30T22:15:11+08:00</updated>
    <id>http://winse.github.io/blog/2014/03/30/git-cheatsheet</id>
    <content type="html"><![CDATA[<p>Git的每次提交都有一个<strong>唯一的ID</strong>与之对应，所有的TAG/Branch/Master/HEAD等等，都是一个<strong>软链接/别名</strong>而已！这个是理解好Git的基础！</p>

<h2>提交最佳实践</h2>

<ul>
<li>commit 只改一件事情。</li>
<li>如果一个文档有多个变更，使用<code>git add --patch</code>只选择文档中的<strong>部分变更</strong>进入stage。具体怎么使用，键入命令后在输入<code>?</code></li>
<li>写清楚 commit message</li>
</ul>


<h2>配置</h2>

<h3>内建的图形化 git：</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gitk</span></code></pre></td></tr></table></div></figure>


<h3>git服务器</h3>

<p>搭建git服务器也很方便，有很多web-server的版本，我试用了下<a href="http://www.scm-manager.org/download/">scm-manager</a>使用挺简单的！
如果已经有了SVN的服务器，可以直接使用git-svn检出到本地！！</p>

<h3>配置环境</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git config --global user.email "XXX"
</span><span class='line'>git config --global user.name "XXX"</span></code></pre></td></tr></table></div></figure>


<h3>换行（\r\n）提交检出均不转换</h3>

<p>基本上都在windows操作系统上工作，不需要进行转换！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git config --global core.autocrlf false</span></code></pre></td></tr></table></div></figure>


<ul>
<li>true 提交时转换为LF，检出时转换为CRLF</li>
<li>input 提交时转换为LF，检出时不转换</li>
<li>false 提交检出均不转换</li>
</ul>


<h3>core.safecrlf</h3>

<ul>
<li>true 拒绝提交包含混合换行符的文件</li>
<li>false 允许提交包含混合换行符的文件</li>
<li>warn 提交包含混合换行符的文件时给出警告</li>
</ul>


<h3>默认分支</h3>

<p>.git/config如下的内容：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[branch "master"]
</span><span class='line'>    remote = origin
</span><span class='line'>    merge = refs/heads/master</span></code></pre></td></tr></table></div></figure>


<p>这等于告诉git两件事:
1. 当你处于master branch, 默认的remote就是origin。
2. 当你在master branch上使用git pull时，没有指定remote和branch，那么git就会采用默认的remote（也就是origin）来merge在master branch上所有的改变</p>

<p>如果不想或者不会编辑config文件的话，可以在bush上输入如下命令行：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git config branch.master.remote origin 
</span><span class='line'>$ git config branch.master.merge refs/heads/master </span></code></pre></td></tr></table></div></figure>


<p>之后再重新git pull下。最后git push你的代码，到此步顺利完成时，则可以在Github上看到你新建的仓库以及你提交到仓库中文件了OK。</p>

<h3>修改默认Git编辑器</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git config core.editor vim
</span><span class='line'>
</span><span class='line'>$ git config --global core.editor vi</span></code></pre></td></tr></table></div></figure>


<h2>常用基本操作</h2>

<table>
<thead>
<tr>
<th style="text-align:left;"> 操作                                          </th>
<th style="text-align:left;"> 说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> git init                                      </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git init &ndash;bare                               </td>
<td style="text-align:left;"> 服务端使用bare（空架子，赤裸）的方式</td>
</tr>
<tr>
<td style="text-align:left;"> git status                                    </td>
<td style="text-align:left;"> 使用git打的最多的就是status命令，查看状态的同时会提示下一步的操作！</td>
</tr>
<tr>
<td style="text-align:left;"> git diff                                      </td>
<td style="text-align:left;"> 工作空间和index/stage进行对比</td>
</tr>
<tr>
<td style="text-align:left;"> git diff &ndash;cached                             </td>
<td style="text-align:left;"> index/stage与本地仓库进行对比</td>
</tr>
<tr>
<td style="text-align:left;"><strong>增加到变更(index/stage)</strong>                    </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git add .                                     </td>
<td style="text-align:left;"> 将当前目录添加到git仓库中，常用命令！</td>
</tr>
<tr>
<td style="text-align:left;"> git add -A                                    </td>
<td style="text-align:left;"> 添加所有改动的文档</td>
</tr>
<tr>
<td style="text-align:left;"> git add -u                                    </td>
<td style="text-align:left;"> 只加修改过的文件,新增的文件不加入</td>
</tr>
<tr>
<td style="text-align:left;"> git rm &ndash;cached <file>&hellip;                     </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"><strong>添加到本地库</strong>                               </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git commit                                    </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git commit -m &ldquo;msg&rdquo;                           </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git commit -a                                 </td>
<td style="text-align:left;"> -a是把所有的修改的（tracked）文件都commit</td>
</tr>
<tr>
<td style="text-align:left;"> git commit &ndash;amend -m &ldquo;commit message.&rdquo;       </td>
<td style="text-align:left;"> 未push到远程分支的提交，快捷的回退再提交。修补提交（修补最近一次的提交而不创建新的提交），可结合git add使用！</td>
</tr>
<tr>
<td style="text-align:left;"> git commit -v                                 </td>
<td style="text-align:left;"> -v 可以看到文件哪些内容被修改</td>
</tr>
<tr>
<td style="text-align:left;"> git reset                                     </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git reset HEAD^                               </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git reset &ndash;hard HEAD^                        </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git checkout file                             </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git rebase                                    </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git merge                                     </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"><strong>日志</strong>                                       </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git log                                       </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git log &ndash;oneline &ndash;decorate &ndash;graph          </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git log &ndash;stat                                </td>
<td style="text-align:left;"> 查看提交信息及更新的文件</td>
</tr>
<tr>
<td style="text-align:left;"> git log &ndash;stat -p -1 &ndash;format=raw          </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git log -3 <file-name>                        </td>
<td style="text-align:left;"> 文件的最近3次提交的历史版本记录</td>
</tr>
<tr>
<td style="text-align:left;"> git log &ndash;stat -2                             </td>
<td style="text-align:left;"> 查看最近两次的提交描述及修改文件信息</td>
</tr>
<tr>
<td style="text-align:left;"> git log -p -2                                 </td>
<td style="text-align:left;"> 展开显示每次提交的内容差异，类似git show功能</td>
</tr>
<tr>
<td style="text-align:left;"> git log &ndash;name-status                         </td>
<td style="text-align:left;"> 仅显示文件的D/M/A的状态</td>
</tr>
<tr>
<td style="text-align:left;"> git log &ndash;summary                             </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git log &ndash;dirstat -5                          </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git log &ndash;pretty=format:&ldquo;%h %s&rdquo; &ndash;graph       </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git log &ndash;pretty=oneline                      </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git reflog                                    </td>
<td style="text-align:left;"> 查看本地操作历史。 ref log</td>
</tr>
<tr>
<td style="text-align:left;"> git show                                      </td>
<td style="text-align:left;"> 查看某版本文件的内容，版本库中最新提交的diff！</td>
</tr>
<tr>
<td style="text-align:left;"> git show master:index.md                      </td>
<td style="text-align:left;"> 查看历史版本的文件内容</td>
</tr>
<tr>
<td style="text-align:left;"> git show &lt;哈希值:文件目录/文件>               </td>
<td style="text-align:left;"> 查看内容</td>
</tr>
<tr>
<td style="text-align:left;"> git cat-file                                  </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"><strong>分支</strong>                                       </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git branch                                    </td>
<td style="text-align:left;"> 查看本地分支</td>
</tr>
<tr>
<td style="text-align:left;"> git branch <branch>                           </td>
<td style="text-align:left;"> 添加新分支，新分支创建后不会自动切换！！</td>
</tr>
<tr>
<td style="text-align:left;"> git branch &ndash;set-upstream branch-name origin/branch-name      </td>
<td style="text-align:left;"> * 建立本地分支和远程分支的关联</td>
</tr>
<tr>
<td style="text-align:left;"> git branch -a                                 </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git branch &ndash;list &ndash;merged                    </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git branch -r                                 </td>
<td style="text-align:left;"> 查看远程分支</td>
</tr>
<tr>
<td style="text-align:left;"> git checkout &ndash;orphan <new-branch>            </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git checkout <branch>                         </td>
<td style="text-align:left;"> 切换分支</td>
</tr>
<tr>
<td style="text-align:left;"> git checkout -b [new_branch_name]             </td>
<td style="text-align:left;"> 创建新分支并立即切换到新分支。git checkout -b branch-name origin/branch-name，本地和远程分支的名称最好一致</td>
</tr>
<tr>
<td style="text-align:left;"> git branch -d branch_name                     </td>
<td style="text-align:left;"> -d选项只能删除已经参与了合并的分支，对于未有合并的分支是无法删除的。如果想强制删除一个分支，可以使用-D选项</td>
</tr>
<tr>
<td style="text-align:left;"> git branch -d -r remote_name/branch_name      </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git merge origin/local-branch                 </td>
<td style="text-align:left;"> 本地分支与主分支合并</td>
</tr>
<tr>
<td style="text-align:left;"><strong>推/拉</strong>                                      </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git pull                                      </td>
<td style="text-align:left;"> * 等价于git fetch &amp;&amp; git merge</td>
</tr>
<tr>
<td style="text-align:left;"> git fetch                                     </td>
<td style="text-align:left;"> 先把git的东西fetch到你本地然后merge后再push</td>
</tr>
<tr>
<td style="text-align:left;"> git push &ndash;rebase                             </td>
<td style="text-align:left;"> *</td>
</tr>
<tr>
<td style="text-align:left;"> git push                                      </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git push &ndash;set-upstream origin <branch>       </td>
<td style="text-align:left;"> To push the current branch and set the remote as upstream</td>
</tr>
<tr>
<td style="text-align:left;"> git push origin branch-name                   </td>
<td style="text-align:left;"> 创建远程分支(本地分支push到远程)，从本地推送分支。如果推送失败，先用git pull抓取远程的新提交</td>
</tr>
<tr>
<td style="text-align:left;"> git push -u origin master                     </td>
<td style="text-align:left;"> 将代码从本地回传到仓库</td>
</tr>
<tr>
<td style="text-align:left;"> git push origin test:master                   </td>
<td style="text-align:left;"> 提交本地test分支作为远程的master分支</td>
</tr>
<tr>
<td style="text-align:left;"> git push -f                                   </td>
<td style="text-align:left;"> * 强推(&ndash;force)，即利用强覆盖方式用你本地的代码替代git仓库内的内容，这种方式不建议使用。</td>
</tr>
<tr>
<td style="text-align:left;"> git pull [remoteName] [localBranchName]       </td>
<td style="text-align:left;"> 获取远程版本库提交与本地提交进行合并</td>
</tr>
<tr>
<td style="text-align:left;"> git push [remoteName] [localBranchName]       </td>
<td style="text-align:left;"> 提交、推送远程仓库</td>
</tr>
<tr>
<td style="text-align:left;"> git push &ndash;tags                               </td>
<td style="text-align:left;"> 提交时带上标签信息</td>
</tr>
<tr>
<td style="text-align:left;"> git push <git-url> master                     </td>
<td style="text-align:left;"> 把本地仓库提交到远程仓库的master分支中</td>
</tr>
<tr>
<td style="text-align:left;"> git push origin :branch_name                  </td>
<td style="text-align:left;"> 删除远端分支,(如果:左边的分支为空，那么将删除:右边的远程的分支。)远程的test将被删除，但是本地还会保存的，不用担心。</td>
</tr>
<tr>
<td style="text-align:left;"> git push origin :/refs/tags/tagname           </td>
<td style="text-align:left;"> 删除远端标签</td>
</tr>
<tr>
<td style="text-align:left;"> git clone <a href="http://path/to/git.git">http://path/to/git.git</a>              </td>
<td style="text-align:left;"> clone的内容会放在当前目录下的新目录</td>
</tr>
<tr>
<td style="text-align:left;"> git clone &ndash;branch <remote-branch> <git-url>  </td>
<td style="text-align:left;"> 获取指定分支，检出远程版本的分支。 git clone &ndash;branch unity /d/winsegit/hello helloclone</td>
</tr>
<tr>
<td style="text-align:left;"><strong>TAG</strong>                                        </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git tag                                       </td>
<td style="text-align:left;"> 查看标签</td>
</tr>
<tr>
<td style="text-align:left;"> git tag <tag>                                 </td>
<td style="text-align:left;"> 添加标签</td>
</tr>
<tr>
<td style="text-align:left;"> git tag -d <tag>                              </td>
<td style="text-align:left;"> 删除标签</td>
</tr>
<tr>
<td style="text-align:left;"> git tag -r                                    </td>
<td style="text-align:left;"> 查看远程标签</td>
</tr>
<tr>
<td style="text-align:left;"> git show <tag>                                </td>
<td style="text-align:left;"> 查看标签的信息</td>
</tr>
<tr>
<td style="text-align:left;"> git tag -a <tag> <msg>                        </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"><strong>REMOTE</strong>                                     </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git remote [show]                             </td>
<td style="text-align:left;"> 查看远程仓库</td>
</tr>
<tr>
<td style="text-align:left;"> git remote -v                                 </td>
<td style="text-align:left;"> 查看远程仓库</td>
</tr>
<tr>
<td style="text-align:left;"> git remote add [name] [url]                   </td>
<td style="text-align:left;"> 添加远程仓库</td>
</tr>
<tr>
<td style="text-align:left;"> git remote set-url &ndash;push[name][newUrl]       </td>
<td style="text-align:left;"> 修改远程仓库</td>
</tr>
<tr>
<td style="text-align:left;"> git remote show origin                        </td>
<td style="text-align:left;"> 远程库origin的详细信息。缺省值推送分支，有哪些远端分支还没有同步到本地，哪些已同步到本地的远端分支在远端服务器上已被删除，git pull 时将自动合并哪些分支！</td>
</tr>
<tr>
<td style="text-align:left;"> git remote show <remote-name>                 </td>
<td style="text-align:left;"> 远程版本信息查看</td>
</tr>
<tr>
<td style="text-align:left;"> git remote add origin <git-url>               </td>
<td style="text-align:left;"> 设置仓库</td>
</tr>
<tr>
<td style="text-align:left;"> git remote rm [name]                          </td>
<td style="text-align:left;"> 删除远程仓库</td>
</tr>
<tr>
<td style="text-align:left;"><strong>打包</strong>                                       </td>
<td></td>
</tr>
<tr>
<td style="text-align:left;"> git archive &ndash;format tar &ndash;output <tar> master</td>
<td style="text-align:left;"> 将 master以tar格式打包到指定文件</td>
</tr>
</tbody>
</table>


<h2>按功能点完整的操作步骤</h2>

<h3>查看指定版本文件内容</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@WINSELIU /e/git/hello (master)
</span><span class='line'>$ git ls-tree master
</span><span class='line'>100644 blob 139b30f9054cf77bd2eeabcebaf6ca3f32cd1d50    abc
</span><span class='line'>
</span><span class='line'>Administrator@WINSELIU /e/git/hello (master)
</span><span class='line'>$ git cat-file -p 139b30f9054cf77bd2eeabcebaf6ca3f32cd1d50</span></code></pre></td></tr></table></div></figure>


<h3>查看提交版本的指定文件内容</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git log abc  # 获取文件提交ID
</span><span class='line'>git cat-file -p &lt;commit-id&gt;  # 获取treeID
</span><span class='line'>git cat-file -p &lt;tree-id&gt;  # 获取当前tree的列表
</span><span class='line'>git cat-file -p &lt;file-blob-id&gt;</span></code></pre></td></tr></table></div></figure>


<h3>根据格式输出日志</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git log --pretty=oneline
</span><span class='line'>$ git log --pretty=short
</span><span class='line'>$ git log --pretty=format:'%h was %an, %ar, message: %s'
</span><span class='line'>$ git log --pretty=format:'%h : %s' --graph
</span><span class='line'>$ git log --pretty=format:'%h : %s' --topo-order --graph
</span><span class='line'>$ git log --pretty=format:'%h : %s' --date-order --graph</span></code></pre></td></tr></table></div></figure>


<p>你也可用‘medium&#8217;,&lsquo;full&rsquo;,&lsquo;fuller&rsquo;,&lsquo;email&rsquo; 或‘raw&#8217;. 如果这些格式不完全符合你的相求， 你也可以用‘&ndash;pretty=format&#8217;参数(参见：git log)来创建你自己的&#8221;格式“.</p>

<h3>本地提交后再次修改</h3>

<p><strong>修改注释</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git commit --amend </span></code></pre></td></tr></table></div></figure>


<p><strong>内容修改</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> # edit file
</span><span class='line'>git add file
</span><span class='line'>git commit --amend</span></code></pre></td></tr></table></div></figure>


<p><strong>提交了不该提交的，并撤回</strong></p>

<p>刚刚提交的不完整，想修改一些东西，加到刚才的提交中</p>

<p>commit -> modify -> add -> amend</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git reset HEAD^
</span><span class='line'>git status
</span><span class='line'>cat abc
</span><span class='line'>git diff
</span><span class='line'>git commit -a -m "for test reset"
</span><span class='line'>git log
</span><span class='line'>git diff
</span><span class='line'>
</span><span class='line'>vi abc
</span><span class='line'>git add abc
</span><span class='line'>git commit --amend
</span><span class='line'>
</span><span class='line'>git status
</span><span class='line'>git diff
</span><span class='line'>git show master:abc
</span><span class='line'>git log</span></code></pre></td></tr></table></div></figure>


<h3>没有push到远程库的提交，本地可以做的事情</h3>

<ul>
<li>git reset: 用于回溯，回到原来的提交节点，多次提交合并为一个</li>
<li>git rebase <origin>：在origin分支的基础上，合并当前分支上的提交，形成线性提交历史。 会把当前分支的提交保存为patch，然后切到origin分支应用patch，形成线性的提交，common-origin-current。</li>
</ul>


<p>rebase冲突处理时，使用git add &amp;&amp; git rebase &ndash;continue。如果你使用了git add &amp;&amp; git commit，那么当前冲突使用git rebase &ndash;skip即可。</p>

<h3>处理本地和服务器之间冲突的方式</h3>

<ul>
<li>以本地为主。 git push -f</li>
<li>归并merge。 git pull 或者 git fetch &amp;&amp; git merge</li>
<li></li>
</ul>


<h3>从Github远程服务上拿其他分支：</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@WINSELIU /e/git/to-markdown (master)
</span><span class='line'>$ git branch -r
</span><span class='line'>  origin/HEAD -&gt; origin/master
</span><span class='line'>  origin/gh-pages
</span><span class='line'>  origin/jquery
</span><span class='line'>  origin/master
</span><span class='line'>
</span><span class='line'>$ git checkout -b jquery origin/jquery</span></code></pre></td></tr></table></div></figure>


<h3>把本地的git项目发布到Github</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>touch README.md
</span><span class='line'>git init
</span><span class='line'>git add README.md
</span><span class='line'>git commit -m "first commit"
</span><span class='line'>git remote add origin git@github.com:winse/flickr-uploader.git
</span><span class='line'>git push -u origin master</span></code></pre></td></tr></table></div></figure>


<p>Push an existing repository from the command line：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git remote add origin git@github.com:winse/flickr-uploader.git
</span><span class='line'>git push -u origin master</span></code></pre></td></tr></table></div></figure>


<p>如果已经存在remote origin，使用下面的方式修改远程的地址：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@WINSELIU /d/winsegit/flickr_uploader/chrome (master)
</span><span class='line'>$ git remote set-url --add origin  git@github.com:winse/flickr-uploader.git
</span><span class='line'>
</span><span class='line'>Administrator@WINSELIU /d/winsegit/flickr_uploader/chrome (master)
</span><span class='line'>$ git remote show origin
</span><span class='line'>Warning: Permanently added 'github.com,192.30.252.128' (RSA) to the list of known hosts.
</span><span class='line'>* remote origin
</span><span class='line'>  Fetch URL: git@github.com:winse/flickr-uploader.git
</span><span class='line'>  Push  URL: git@github.com:winse/flickr-uploader.git
</span><span class='line'>  HEAD branch: (unknown)</span></code></pre></td></tr></table></div></figure>


<h3>git查看本地领先远程的提交</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@WINSELIU /d/winsegit/winse.github.com (master)
</span><span class='line'>$ git status
</span><span class='line'># On branch master
</span><span class='line'># Your branch is ahead of 'origin/master' by 2 commits.
</span><span class='line'>#   (use "git push" to publish your local commits)
</span><span class='line'>#
</span><span class='line'># Changes not staged for commit:
</span><span class='line'>#   (use "git add &lt;file&gt;..." to update what will be committed)
</span><span class='line'>#   (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)
</span><span class='line'>#
</span><span class='line'>#       modified:   about.md
</span><span class='line'>#       modified:   blog/_posts/2014-01-21-monitoring-mobile-networks.md
</span><span class='line'>#
</span><span class='line'># Untracked files:
</span><span class='line'>#   (use "git add &lt;file&gt;..." to include in what will be committed)
</span><span class='line'>#
</span><span class='line'>#       default.html
</span><span class='line'>no changes added to commit (use "git add" and/or "git commit -a")
</span><span class='line'>
</span><span class='line'>Administrator@WINSELIU /d/winsegit/winse.github.com (master)
</span><span class='line'>$ git log --oneline --decorate -5
</span><span class='line'>0425ec5 (HEAD, master) 增加日志Github修改历史功能
</span><span class='line'>f3a4a58 把TAG定位到首页，并分页以及按照年分类
</span><span class='line'>d5097e3 (origin/master, origin/HEAD) plugins disabled in github page!
</span><span class='line'>e75d62b test
</span><span class='line'>876dd42 修复根目录下的md不能通过npp-windows请求编辑的BUG
</span><span class='line'>
</span><span class='line'>Administrator@WINSELIU /d/winsegit/winse.github.com (master)
</span><span class='line'>$ git cherry
</span><span class='line'>+ f3a4a58cfead3aa76e4b92de3342bee5970accb7
</span><span class='line'>+ 0425ec548aa4e3dd29cd6fbfa1b656543e85058e</span></code></pre></td></tr></table></div></figure>


<h3>找回游离的提交</h3>

<p><strong>绑定到新分支</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git reflog # 查看本地操作历史
</span><span class='line'>git branch head23 HEAD@{23} # 把分支head23指向/绑定到游离的提交</span></code></pre></td></tr></table></div></figure>


<p>git的版本都是从分支开始查找的，如果没有被分支管理的提交就游离在版本库中！
所以在reset重新修改时，最好建立分支然后再提交！
如果发现类似的提交问题，就需要尽快的修复，不然提交的ID找不到就S了！</p>

<blockquote><p>那些老的提交会被丢弃。 如果运行垃圾收集命令(pruning garbage collection), 这些被丢弃的提交就会删除. （请查看 git gc)</p></blockquote>

<p><strong>重置HEAD</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git reset --hard HEAD@{23}</span></code></pre></td></tr></table></div></figure>


<h3>删除提交</h3>

<p>删除提交E：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git tag F
</span><span class='line'>$ git tag E HEAD^
</span><span class='line'>$ git tag D HEAD^^
</span><span class='line'>$ git checkout D
</span><span class='line'>$ git cherry-pick master # 把master-patch应用到TAG-D
</span><span class='line'># fix conflicts
</span><span class='line'>$ git status # 提交
</span><span class='line'>$ git checkout master # checkout到master分支
</span><span class='line'>$ git reset --hard HEAD@{1} # 重置master到删除E后的提交
</span></code></pre></td></tr></table></div></figure>


<h3>Git浏览特定版本的文件列表</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git ls-tree --name-only  -rt &lt;SHA-ID&gt;</span></code></pre></td></tr></table></div></figure>


<h3>删除没有被git track的文件</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clean -fd # -f force branch switch/ignore unmerged entries， -d if you have new directory
</span><span class='line'>git clean -x -fd
</span><span class='line'>
</span><span class='line'>git reset --hard ( or git reset then back to 1. )
</span><span class='line'>git checkout . ( or specify with file names )
</span><span class='line'>git reset --hard ( or git reset then back to 3. )</span></code></pre></td></tr></table></div></figure>


<h3>检出SVN项目</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@ZGC-20130605LYE /e/git
</span><span class='line'>$ git svn clone http://chrome-hosts-manager.googlecode.com/svn/trunk/</span></code></pre></td></tr></table></div></figure>


<p><a href="http://www.worldhello.net/2010/02/01/339.html">http://www.worldhello.net/2010/02/01/339.html</a>下面提到的有意思：</p>

<blockquote><p>Git-svn 是 Subversion 的最佳伴侣，可以用 Git 来操作 Subversion 版本库。这带来一个非常有意思的副产品——部分检出：
可以用 git-svn 来对 Subversion 代码库的任何目录进行克隆，克隆出来的是一个git版本库
可以在部分克隆的版本库中用 Git 进行本地提交。
部分克隆版本库中的本地提交可以提交到上游 Subversion 版本库的相应目录中</p></blockquote>

<h3>Github添加项目主页github page(gh-pages)</h3>

<p>提交后就可以访问了<a href="http://winse.github.io/flickr-uploader/popup.html">页面</a>了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@WINSELIU /d/winsegit/flickr_uploader/chrome (master)
</span><span class='line'>$ git branch -a
</span><span class='line'>* master
</span><span class='line'>  remotes/origin/master
</span><span class='line'>
</span><span class='line'>Administrator@WINSELIU /d/winsegit/flickr_uploader/chrome (master)
</span><span class='line'>$ git push origin master:gh-pages
</span><span class='line'>Warning: Permanently added 'github.com,192.30.252.128' (RSA) to the list of known hosts.
</span><span class='line'>Total 0 (delta 0), reused 0 (delta 0)
</span><span class='line'>To git@github.com:winse/flickr-uploader.git
</span><span class='line'> * [new branch]      master -&gt; gh-pages
</span><span class='line'>
</span><span class='line'>Administrator@WINSELIU /d/winsegit/flickr_uploader/chrome (master)
</span><span class='line'>$ git branch -a
</span><span class='line'>* master
</span><span class='line'>  remotes/origin/gh-pages
</span><span class='line'>  remotes/origin/master
</span></code></pre></td></tr></table></div></figure>


<p><strong><a href="https://help.github.com/articles/creating-project-pages-manually">Creating Project Pages manually</a></strong></p>

<blockquote><pre><code>  cd repository

  git checkout --orphan gh-pages
  # Creates our branch, without any parents (it's an orphan!)
  # Switched to a new branch 'gh-pages'

  git rm -rf .
  # Remove all files from the old working tree
  # rm '.gitignore'

  echo "My GitHub Page" &gt; index.html
  git add index.html
  git commit -a -m "First pages commit"
  git push origin gh-pages
</code></pre></blockquote>

<h3>子模块操作</h3>

<p><a href="http://josephjiang.com/entry.php?id=342">git-submodule教程！</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@WINSELIU /d/winsegit/jae_winse (master)
</span><span class='line'>$ git submodule add git@github.com:winse/flickr-uploader.git src/main/webapp/flickr
</span><span class='line'>
</span><span class='line'>Administrator@WINSELIU /d/winsegit/jae_winse (master)
</span><span class='line'>$ git submodule status
</span><span class='line'> 635090c5a754eebf5ce6566b7f8c65446b764f51 src/main/webapp/flickr (heads/master)
</span><span class='line'>
</span><span class='line'>Administrator@WINSELIU /d/winsegit/jae_winse (master)
</span><span class='line'>$ git commit -m "add submodule"
</span><span class='line'>[master c7dc8c7] add submodule
</span><span class='line'>warning: LF will be replaced by CRLF in .gitmodules.
</span><span class='line'>The file will have its original line endings in your working directory.
</span><span class='line'> 2 files changed, 4 insertions(+)
</span><span class='line'> create mode 100644 .gitmodules
</span><span class='line'> create mode 160000 src/main/webapp/flickr</span></code></pre></td></tr></table></div></figure>


<p>如：$ git submodule add git://github.com/soberh/ui-libs.git src/main/webapp/ui-libs</p>

<p>初始化子模块：$ git submodule init &mdash;-只在首次检出仓库时运行一次就行</p>

<p>更新子模块：$ git submodule update &mdash;-每次更新或切换分支后都需要运行一下</p>

<p>删除子模块：（分4步走哦）</p>

<ol>
<li>$ git rm &ndash;cached [path]</li>
<li>编辑“.gitmodules”文件，将子模块的相关配置节点删除掉</li>
<li>编辑“.git/config”文件，将子模块的相关配置节点删除掉</li>
<li>手动删除子模块残留的目录</li>
</ol>


<h2>其他偶尔使用命令</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git diff --check # 检查行尾有没有多余的空白
</span><span class='line'>git remote prune &lt;remotename&gt;
</span><span class='line'>git ls-remote --heads origin
</span><span class='line'>git gc --prune=now
</span><span class='line'>git ls-remote --heads &lt;remote-name&gt;
</span><span class='line'>git rm -r --cached *</span></code></pre></td></tr></table></div></figure>


<h2>参考</h2>

<ul>
<li><a href="http://blog.csdn.net/trochiluses/article/details/8996431">回溯 与 合并:git rebase与git reset</a></li>
<li><a href="http://ihower.tw/git/">git教程的一个站点</a></li>
<li><a href="http://ihower.tw/git/basic.html">git基本操作</a></li>
<li><a href="http://ihower.tw/git/vcs.html">版本管理介绍</a></li>
<li><a href="http://blog.csdn.net/ithomer/article/details/7529841">速查表</a></li>
<li><a href="http://git-scm.com/book/zh/Git-%E5%9F%BA%E7%A1%80-%E6%9F%A5%E7%9C%8B%E6%8F%90%E4%BA%A4%E5%8E%86%E5%8F%B2">Git 基础 - 查看提交历史</a></li>
<li><p><a href="http://gitbook.liuhui998.com/3_4.html">查看历史 －Git日志</a></p></li>
<li><p><a href="http://git-scm.com/book/zh/Git-%E5%B7%A5%E5%85%B7-%E9%87%8D%E5%86%99%E5%8E%86%E5%8F%B2">http://git-scm.com/book/zh/Git-%E5%B7%A5%E5%85%B7-%E9%87%8D%E5%86%99%E5%8E%86%E5%8F%B2</a></p></li>
<li><a href="http://ihower.tw/blog/archives/2622">http://ihower.tw/blog/archives/2622</a></li>
<li><a href="http://git-scm.com/docs/git-rebase">http://git-scm.com/docs/git-rebase</a></li>
<li><a href="http://xiewenbo.iteye.com/blog/1285693">http://xiewenbo.iteye.com/blog/1285693</a></li>
<li><a href="http://gitready.com/">http://gitready.com/</a></li>
<li><a href="http://git-scm.com/book/zh/Git-%E5%9F%BA%E7%A1%80-%E6%9F%A5%E7%9C%8B%E6%8F%90%E4%BA%A4%E5%8E%86%E5%8F%B2">http://git-scm.com/book/zh/Git-%E5%9F%BA%E7%A1%80-%E6%9F%A5%E7%9C%8B%E6%8F%90%E4%BA%A4%E5%8E%86%E5%8F%B2</a></li>
<li><a href="http://josephjiang.com/entry.php?id=342">http://josephjiang.com/entry.php?id=342</a> git-submodule没有更好的教程了</li>
<li><a href="http://www.cnblogs.com/william9/archive/2012/09/01/2666767.html">http://www.cnblogs.com/william9/archive/2012/09/01/2666767.html</a></li>
<li><a href="http://marklodato.github.io/visual-git-guide/index-zh-cn.html">http://marklodato.github.io/visual-git-guide/index-zh-cn.html</a></li>
<li><a href="http://www.16kan.com/question/detail/321093.html">http://www.16kan.com/question/detail/321093.html</a></li>
<li><a href="http://gitbook.liuhui998.com/3_4.html">http://gitbook.liuhui998.com/3_4.html</a></li>
<li><a href="http://www.bootcss.com/p/git-guide/">http://www.bootcss.com/p/git-guide/</a></li>
<li><a href="http://blog.csdn.net/ithomer/article/details/7529022">http://blog.csdn.net/ithomer/article/details/7529022</a></li>
<li><a href="http://git-scm.com/book/zh/Git-%E5%88%86%E6%94%AF-%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF">http://git-scm.com/book/zh/Git-%E5%88%86%E6%94%AF-%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF</a></li>
<li><a href="http://git-scm.com/book/zh/Git-%E5%9F%BA%E7%A1%80-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8">http://git-scm.com/book/zh/Git-%E5%9F%BA%E7%A1%80-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8</a></li>
<li><a href="http://blog.csdn.net/trochiluses/article/details/14517379">http://blog.csdn.net/trochiluses/article/details/14517379</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Jekyll按照tag分页面]]></title>
    <link href="http://winse.github.io/blog/2014/03/20/jekyll-tag-per-page/"/>
    <updated>2014-03-20T06:21:36+08:00</updated>
    <id>http://winse.github.io/blog/2014/03/20/jekyll-tag-per-page</id>
    <content type="html"><![CDATA[<h2>单页实现</h2>

<p>从jekll-bootstrap检出的代码中，<code>tags.html</code>实现了标签的显示。但是所有的标签和日志列表都码在一个文件里面，总感觉有点太拥挤。</p>

<pre><code>&lt;div class="page-header"&gt;
    &lt;h1&gt;{{ page.title }} {% if page.tagline %} &lt;small&gt;{{ page.tagline }}&lt;/small&gt;{% endif %}&lt;/h1&gt;
&lt;/div&gt;

&lt;ul class="tag_box inline"&gt;
    {% assign tags_list = site.tags %}  

    {% if tags_list.first[0] == null %}
        {% for tag in tags_list %} 
        &lt;li&gt;&lt;a href="#{{ tag }}-ref"&gt;{{ tag }} &lt;span&gt;{{ site.tags[tag].size }}&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
        {% endfor %}
    {% else %}
        {% for tag in tags_list %} 
        &lt;li&gt;&lt;a href="#{{ tag[0] }}-ref"&gt;{{ tag[0] }} &lt;span&gt;{{ tag[1].size }}&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
        {% endfor %}
    {% endif %}

    {% assign tags_list = nil %}
&lt;/ul&gt;

{% for tag in site.tags %} 
&lt;h2 id="{{ tag[0] }}-ref"&gt;{{ tag[0] }}&lt;/h2&gt;
&lt;ul class="index"&gt;
    {% assign pages_list = tag[1] %}  

    {% if site.JB.pages_list.provider == "custom" %}
        {% include custom/pages_list %}
    {% else %}
        {% for node in pages_list %}
            {% if node.title != null %}
                {% if group == null or group == node.group %}
                    {% if page.url == node.url %}
                    &lt;li class="active"&gt;
                        &lt;a href="{{ BASE_PATH }}{{ node.url }}" class="active"&gt;{{ node.title | xml_escape }}&lt;/a&gt;
                        &lt;span&gt;&lt;time datetime="{{ node.date | date: "%Y-%m-%d" }}"&gt;{{ node.date | date: "%Y/%m/%d" }}&lt;/time&gt;&lt;/span&gt;
                    &lt;/li&gt;
                    {% else %}
                    &lt;li&gt;
                        &lt;a href="{{ BASE_PATH }}{{ node.url }}" class="active"&gt;{{ node.title | xml_escape }}&lt;/a&gt;
                        &lt;span&gt;&lt;time datetime="{{ node.date | date: "%Y-%m-%d" }}"&gt;{{ node.date | date: "%Y/%m/%d" }}&lt;/time&gt;&lt;/span&gt;
                    &lt;/li&gt;
                    {% endif %}
                {% endif %}
            {% endif %}
        {% endfor %}
    {% endif %}

    {% assign pages_list = nil %}
    {% assign group = nil %}   
&lt;/ul&gt;
{% endfor %}
</code></pre>

<h2>插件实现分页面</h2>

<p>找了一些资料，使用plugin的方式可以生成文件，以及页面的自定义标签。在<code>_plugins</code>目录下新增<code>jekyll-tag-page.rb</code> :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>module Jekyll
</span><span class='line'>
</span><span class='line'>  class TagPage &lt; Page
</span><span class='line'>      def initialize(site, base, dir, tag)
</span><span class='line'>          @site = site
</span><span class='line'>          @base = base
</span><span class='line'>          @dir = dir
</span><span class='line'>          @name = 'index.html'
</span><span class='line'>
</span><span class='line'>          self.process(@name)
</span><span class='line'>          self.read_yaml(File.join(base, '_layouts'), 'tag_index.html')
</span><span class='line'>
</span><span class='line'>          self.data['tags'] = tag
</span><span class='line'>      end
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  class TagPageGenerator &lt; Generator
</span><span class='line'>      safe true
</span><span class='line'>
</span><span class='line'>      def generate(site)
</span><span class='line'>          if site.layouts.key? 'tag_index'
</span><span class='line'>              dir = site.config['tag_dir'] || 'tags'
</span><span class='line'>              site.tags.keys.each do |tag|
</span><span class='line'>                  site.pages &lt;&lt; TagPage.new(site, site.source, File.join(dir, tag), tag)
</span><span class='line'>              end
</span><span class='line'>          end
</span><span class='line'>      end
</span><span class='line'>  end
</span><span class='line'>end
</span></code></pre></td></tr></table></div></figure>


<p>生成插件为每个TAG生成了一个页面，<code>_layout</code>模板设置为tag_index.html，在模板中可以根据当前页面的tags过滤并只显示该tag的日志列表。文件默认保存到<code>tags/TAG</code>目录下。</p>

<pre><code>{% for tag in site.tags %} 
    {% if page.tags == tag[0] %}
    &lt;h2&gt;{{ tag[0] }}&lt;/h2&gt;
    &lt;ul class="index"&gt;
        {% assign pages_list = tag[1] %}  

        {% for node in pages_list %}
            {% if node.title != null %}
            &lt;li&gt;
                &lt;a href="{{ BASE_PATH }}{{ node.url }}"&gt;{{ node.title | xml_escape }}&lt;/a&gt;
                &lt;span&gt;&lt;time datetime="{{ node.date | date: "%Y-%m-%d" }}"&gt;{{ node.date | date: "%Y/%m/%d" }}&lt;/time&gt;&lt;/span&gt;
            &lt;/li&gt;
            {% endif %}
        {% endfor %}

        {% assign pages_list = nil %}
    &lt;/ul&gt;
    {% endif %}
{% endfor %}
</code></pre>

<h2>使用脚本生成目录和md文件来实现</h2>

<p>但是由于github不支持自定义插件功能，也就是说，就算我提交了<code>_plugin</code>的代码也是无效的。<strong>最终最后的实现</strong>，使用Shell脚本在tags目录下生成文件夹和内容：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd $tools/../tags
</span><span class='line'>
</span><span class='line'>find * -type d -exec rm -rf {} +
</span><span class='line'>
</span><span class='line'>for tag in `cat tags`; do 
</span><span class='line'>mkdir $tag
</span><span class='line'>cat &gt; $tag/index.md &lt;&lt;EOF
</span><span class='line'>---
</span><span class='line'>layout: tag
</span><span class='line'>categories: [$tag]
</span><span class='line'>---
</span><span class='line'>
</span><span class='line'>EOF
</span><span class='line'>done;
</span></code></pre></td></tr></table></div></figure>


<p>脚本列表tags文件内容生成目录和index.md文件。</p>

<p>layout模板tag.html页面代码如下：</p>

<pre><code>&lt;h3&gt;Tag: {{ page.categories[-1] }}&lt;/h3&gt;
&lt;ul class="archive-list"&gt;

{% for tag in site.tags %}
{% if page.categories[-1] == tag[0] %}

{% assign pages_list = tag[1] %} 
{% for node in pages_list %}
    {% if node.title != null %}
        &lt;li class="archive"&gt;
            &lt;span&gt;
                &lt;time datetime="{{ node.date | date: "%Y-%m-%d" }}"&gt;
                    {{ node.date | date: "%Y/%m/%d" }}
                &lt;/time&gt;
            &lt;/span&gt;
            &lt;a href="{{ BASE_PATH }}{{ node.url }}" class="archive-link"&gt;{{ node.title | xml_escape }}&lt;/a&gt;
        &lt;/li&gt;
    {% endif %}
{% endfor %}
{% assign pages_list = nil %} 

{% endif %}
{% endfor %}

&lt;/ul&gt;
</code></pre>

<p>&ndash;END</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Jekyll页面添加编辑按钮]]></title>
    <link href="http://winse.github.io/blog/2014/03/18/jekyll-edit-link-in-web-page/"/>
    <updated>2014-03-18T05:56:53+08:00</updated>
    <id>http://winse.github.io/blog/2014/03/18/jekyll-edit-link-in-web-page</id>
    <content type="html"><![CDATA[<p>近期把其他博客的日志导出成Markdown后导入到自己的blog。想在本地预览后，看到不好的地方就进行修改，想法是美好的，现实是残酷的！<strong>找文件太麻烦</strong>了，定位到了文件夹，还需要找文件。反正就是觉得很不爽！最终通过<a href="https://gist.github.com/4548d6c182f8162497fa.git">自定义URL协议的方式完美的解决</a>。</p>

<h3>尝试ActiveXObject</h3>

<p>IE下可以通过<a href="http://iask.sina.com.cn/b/8583473.html?sudaref=www.google.com.hk&amp;retcode=0">ActiveXObject调用本地的程序</a>打开文件。尽管局限于IE，但是如果能实现的话将就下也OK的。
理所当然认为IE下是没有问题，就找chrome下能否执行<a href="http://stackoverflow.com/questions/7022568/javascript-activexobject-in-firefox-or-chrome-not-ie">ActiveXObject的兼容对象</a>。</p>

<p>在chrome下，没啥很好的替代实现。同时在IE11下，ActiveXObject调用shell对象报<a href="http://www.cnblogs.com/dongyongjing/archive/2007/04/18/718629.html"><strong>automation服务器不能创建对象</strong></a>，需要额外开启功能、降低IE的安全性等等，也很麻烦！！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>function callShellApplication(){
</span><span class='line'>  var objShell = new ActiveXObject("WScript.shell");
</span><span class='line'>  objShell.run('"C:\Program Files (x86)\wkhtmltopdf\wkhtmltopdf.exe" "c:\PDFTestPage.html" "c:\TEST.pdf"');
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>尝试Flash</h3>

<p>有想过使用flash解决，毕竟剪贴板复制功能的<code>ZeroClipboard.swf</code>是那么的完美^_^。但是<a href="http://www.cnblogs.com/yao/archive/2008/01/02/1022721.html">swf不能执行exe程序</a>，没办法只能再寻求其他办法。</p>

<h3>自定义URL协议</h3>

<p>最后看到了<a href="http://hi.baidu.com/pluto632/item/5007737da31344326f29f666"><strong>URL Protocol的实现方式</strong></a>，是的哦，Github-Windows、以及QQ等这些网页的工具不都是调用系统的程序吗？！</p>

<p>然后试着按照网页的教程，试着弄弄！<del>又是一个新鲜事物，有挑战的事情做起来就更有激情！</del></p>

<p>添加注册表项<code>reg-npp-windows.bat</code>：（可以先导出github-windows的注册表项参考。这里使用用bat来实现，注册脚本中可以通过<strong>相对路径</strong>指向执行的程序）</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>set NPP_APP=%~dp0npp-windows.bat
</span><span class='line'>set NPP_ARG=%%1
</span><span class='line'>
</span><span class='line'>set "NPP_CMD=\"%NPP_APP%\" \"%NPP_ARG%\""
</span><span class='line'>
</span><span class='line'>reg add "HKEY_CLASSES_ROOT\npp-windows" /f
</span><span class='line'>reg add "HKEY_CLASSES_ROOT\npp-windows" /ve /t REG_SZ /d "URL:npp-windows Protocol" /f
</span><span class='line'>reg add "HKEY_CLASSES_ROOT\npp-windows" /v "URL Protocol" /t REG_SZ /d "" /f
</span><span class='line'>
</span><span class='line'>reg add "HKEY_CLASSES_ROOT\npp-windows\DefaultIcon"  /f
</span><span class='line'>reg add "HKEY_CLASSES_ROOT\npp-windows\DefaultIcon"  /ve /t REG_SZ /d "" /f
</span><span class='line'>
</span><span class='line'>reg add "HKEY_CLASSES_ROOT\npp-windows\shell" /f
</span><span class='line'>reg add "HKEY_CLASSES_ROOT\npp-windows\shell\open" /f
</span><span class='line'>reg add "HKEY_CLASSES_ROOT\npp-windows\shell\open\command" /f
</span><span class='line'>reg add "HKEY_CLASSES_ROOT\npp-windows\shell\open\command" /ve /t REG_SZ /d "%NPP_CMD%" /f
</span><span class='line'>
</span><span class='line'>pause
</span></code></pre></td></tr></table></div></figure>


<p>点击URL真正调用的是<code>npp-windows.bat</code>命令（即上面的注册脚本的<code>NPP_APP</code>）:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@echo off
</span><span class='line'>
</span><span class='line'>set fileRelativePath=%1
</span><span class='line'>set filepath="%~dp0..\..\..\%fileRelativePath:~17,-1%"
</span><span class='line'>
</span><span class='line'>start D:\local\usr\npp\notepad++.exe %filepath%
</span><span class='line'>exit
</span></code></pre></td></tr></table></div></figure>


<p><code>start</code>命令新起一个子进程打开程序，这样可以启动后面的程序，同时关闭/退出掉黑窗口！
请求参数有整个url加上双引号，如<code>"npp-windows://e/about.md"</code>。数字<code>17,-1</code>获取真正的路径。由于根下的文件会被自动加反斜杠<code>"npp-windows://about.md/"</code>，所以加上<code>e/</code>进行修复。</p>

<p>在网页使用链接，然后加上<code>npp-windows</code>的协议就可以打开文件进行修改编辑了。</p>

<pre><code>&lt;a class="shellExecuteLink" href="npp-windows://e/{{ page.path }}" title="本地编辑"&gt;&lt;i class="icon-edit"&gt; &lt;/i&gt;&lt;/a&gt;
</code></pre>

<p>对BAT的命令相当的迷惑：</p>

<ul>
<li><code>"D:\local\usr\npp\notepad++.exe" "%~dp0..\..\..\%fileRelativePath:~17,-1%"</code> OK</li>
<li><code>start D:\local\usr\npp\notepad++.exe "%~dp0..\..\..\%fileRelativePath:~17,-1%"</code> OK</li>
<li><code>start "D:\local\usr\npp\notepad++.exe" "%~dp0..\..\..\%fileRelativePath:~17,-1%"</code> 弹出<strong>Windows无法打开此文件</strong>的框</li>
</ul>


<h3>闪黑窗口优化尝试</h3>

<p>功能已经实现了，但是仍然有一个黑窗口一闪而过！</p>

<p>爱折腾的程序员啊！！</p>

<p>找啊找，发现<strong>vbs可以后台执行命令</strong>。直接在命令行是可以执行<strong>npp-windows.vbs</strong>的，同时那种不弹窗的效果也是自己想要的！！但把vbs作为url-protocol协议的执行程序时，点击页面链接却没一点反应！但是运行bat和exe程序是没有问题的。</p>

<p>其实windows下的bat和vbs程序都是可以转成exe的。
下载了<a href="http://www.abyssmedia.com/scriptcryptor/">ScriptCryptor Compiler</a><a href="http://www.sdbeta.com/uploads/soft/131002/1-131002113S7.rar">破解版</a>，把vbs转成exe后就可以被url-protocol调用了，且没有闪窗的现象了！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Dim CurrPath
</span><span class='line'>CurrPath=WScript.Createobject("Scripting.FileSystemObject").GetFile(Wscript.ScriptFullName).ParentFolder.Path
</span><span class='line'>
</span><span class='line'>Dim fileRelativePath
</span><span class='line'>fileRelativePath=WScript.Arguments(0)
</span><span class='line'>
</span><span class='line'>Dim filepath
</span><span class='line'>filepath=Mid(fileRelativePath,17)
</span><span class='line'>
</span><span class='line'>Dim Wsh
</span><span class='line'>Set Wsh = WScript.CreateObject("WScript.Shell")
</span><span class='line'>
</span><span class='line'>Wsh.Run "D:\local\usr\npp\notepad++.exe " + CurrPath + "\..\..\..\" + filepath,0,True
</span><span class='line'>
</span><span class='line'>Set Wsh=NoThing
</span><span class='line'>WScript.quit
</span></code></pre></td></tr></table></div></figure>


<p>同时上面的vbs程序有一个与bat同样的问题：在<strong>文件</strong>没有关闭的前，vbs程序是一直等待的！如果使用这种方式，编辑很多文件就会存在很多进程。</p>

<p>而直接在<code>Wsh.Run</code>后面加上<code>start</code>前缀就报<strong>系统找不到指定的文件</strong>的错误！整来整去最后还是调用bat文件，解决主进程一直等待的问题。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Dim CurrPath
</span><span class='line'>CurrPath=WScript.Createobject("Scripting.FileSystemObject").GetFile(Wscript.ScriptFullName).ParentFolder.Path
</span><span class='line'>
</span><span class='line'>Dim fileRelativePath
</span><span class='line'>fileRelativePath=WScript.Arguments(0)
</span><span class='line'>
</span><span class='line'>Dim Wsh
</span><span class='line'>Set Wsh = WScript.CreateObject("WScript.Shell")
</span><span class='line'>
</span><span class='line'>Wsh.Run CurrPath + "\npp-windows.bat """ + fileRelativePath + """",0,True
</span><span class='line'>
</span><span class='line'>Set Wsh=NoThing
</span><span class='line'>WScript.quit
</span></code></pre></td></tr></table></div></figure>


<p>然后修改<strong>添加注册表项的命令</strong>reg-npp-windows.bat，重新覆盖注册下就可以了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>set NPP_APP=%~dp0npp-windows.vbs.exe</span></code></pre></td></tr></table></div></figure>


<p>尽管没有黑窗口了闪现，但是速度慢了很多！！
两种方式换着用呗，修改也简单： 改下程序的名字，重新注册下就行了。</p>

<h2>其他</h2>

<p>URL-protocol的用户选择设置会被chrome缓冲，可以通过<code>C:\Users\Administrator\AppData\Local\Google\Chrome\User Data\Local State</code>文件的<code>protocol_handler</code>节点来修改。</p>

<h2>参考</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/15351508/using-a-wscript-shell-activex-to-execute-a-command-line">Using a WScript.shell activeX to execute a command line</a></li>
<li><a href="http://huagenli.iteye.com/blog/552447">在html中利用WScript.Shell启用本地程序</a></li>
<li><a href="http://blog.csdn.net/insidekernel/article/details/2033175">通过网页链接打开应用程序客户端的两种实现方式</a></li>
<li><a href="http://hi.baidu.com/pluto632/item/5007737da31344326f29f666">浏览器打开本地程序，全面支持ie,firefox,opera,chrome,自定义url protocol</a></li>
<li><a href="http://blog.csdn.net/lockelk/article/details/7541374">自定义URL Protocol调用Winfrom程序（exe）并实现传值——类似网页链接调用QQ、旺旺</a></li>
<li><a href="http://www.cnblogs.com/zjneter/archive/2008/01/08/1030066.html">自定义URL Protocol Handler</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tomcat源码阅读-批处理解读]]></title>
    <link href="http://winse.github.io/blog/2014/03/15/tomcat-batch-startup/"/>
    <updated>2014-03-15T18:03:03+08:00</updated>
    <id>http://winse.github.io/blog/2014/03/15/tomcat-batch-startup</id>
    <content type="html"><![CDATA[<h3>常用Tomcat批处理文件</h3>

<p>在windows系统下，双击bin/startup.bat即可启动tomcat。但核心的批处理文件是<strong>catalina.bat</strong>，最终调用的就是catalina.bat文件。</p>

<p>version.bat、shutdown.bat、startup.bat、configtest.bat都只是增加version/stop/start/configtest命令参数，然后调用catalina.bat批处理文件。</p>

<h3>catalina.bat</h3>

<p>批处理文件中最重要的非catalina.bat莫属了！包含非常多的操作！</p>

<h4>1 关闭优化</h4>

<p><strong> Suppress(止住) Terminate batch job on CTRL+C </strong></p>

<p>在第一个参数<code>%1</code>为run操作时，同时拥有%TEMP%目录写权限，执行<code>call "%~f0" %* &lt;"%TEMP%\%~nx0.Y"</code>，好像也就是调用自身，如果检测到<code>"%TEMP%\%~nx0.run"</code>存在就跳到脚本主体去执行。完成后退出。<strong>Tomcat7才加上的！</strong></p>

<p>在按了CTRL+C后，<strong>去掉提示用户确认操作</strong>！！！对比下Tomcat6和Tomcat7一切都明白了！在命令行里面调用call的重定向输入<code>%TEMP%\%~nx0.Y</code>的就是Y！！就是提示行的输入啊！</p>

<blockquote><p>Suppress anoying Terminate batch job prompt when hitting CTRL+C. Note however that it leaves the file named yes in the bin directory</p>

<p>git-svn-id: <a href="https://svn.apache.org/repos/asf/tomcat/trunk@922223">https://svn.apache.org/repos/asf/tomcat/trunk@922223</a> 13f79535-47bb-0310-9956-ffa450edef68</p></blockquote>

<h4>2 验证主目录</h4>

<ul>
<li><p>获取CATALINA_HOME</p>

<ul>
<li>CATALINA_HOME环境变量存在</li>
<li>当前目录<code>%cd%</code>，如果<code>%CATALINA_HOME%\bin\catalina.bat</code>存在，跳到<strong>验证EXECUTABLE</strong>操作</li>
<li>当前目录父目录。</li>
</ul>
</li>
<li><p>验证CATALINA_HOME</p>

<p>  如果<code>%CATALINA_HOME%\bin\catalina.bat</code>不存在，打印错误信息，退出</p></li>
<li><p>验证EXECUTABLE</p>

<p>  其实就是验证%CATALINA_HOME%\bin\catalina.bat是否存在（个人觉得相当多余，到达这一部，已经保证了catalina.bat的存在）。</p>

<p>  不存在则报错。每个文件都要获取并设置CATALINA_HOME，其实shell的sh文件也一样，每个sh文件都需要获取一遍当前dirname。</p></li>
</ul>


<h4>3 设置环境变量/参数</h4>

<ul>
<li>设置CATALINA_BASE为CATALINA_HOME（如果没定义）</li>
<li>调用setenv.bat脚本设置环境变量（如果存在）。先检测调用CATALINA_BASE目录下的，没有才调用CATALINA_HOME下的。</li>
<li>调用CATALINA_HOME下面的setclasspath.bat脚本（必须存在，否则会报错退出）</li>
<li>获取CLASSPATH，并添加bootstrap.jar</li>
<li>设置CATALINA_TMPDIR为<code>%CATALINA_BASE%\temp</code>（如果没定义）</li>
<li>如果tomcat-juli.jar存在则添加到CLASSPATH</li>
<li>把<code>%LOGGING_CONFIG%</code>加入JAVA_OPTS

<ol>
<li> <code>%LOGGING_CONFIG%</code></li>
<li> <code>-Dnop</code></li>
<li> <code>-Djava.util.logging.config.file="%CATALINA_BASE%\conf\logging.properties"</code></li>
</ol>
</li>
<li>把<code>%LOGGING_MANAGER%</code>加入JAVA_OPTS

<ol>
<li> <code>%LOGGING_MANAGER%</code></li>
<li> <code>-Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager</code></li>
</ol>
</li>
<li>输出环境变量信息</li>
</ul>


<h4>4 组装执行命令</h4>

<p>接下来的变量直接牵涉到怎么去运行tomcat！ 这些变量包括： MAINCLASS、ACTION、JDPA、_EXECJAVA、SECURITY_POLICY_FILE</p>

<ul>
<li><p>MAINCLASS设置了Java调用的主类org.apache.catalina.startup.Bootstrap</p>

<p>  除了version直接调用org.apache.catalina.util.ServerInfo外，其他命令的入口都是这个类。</p></li>
<li><p>ACTION默认的操作为start</p>

<p>  另外命令对应是stop/configtest。</p></li>
<li><p>JDPA(<a href="http://www.ibm.com/developerworks/cn/java/j-lo-jpda1/">Java Platform Debugger Architecture</a>)</p>

<p>  使用<code>jpda [start|run|stop|configtest]</code>即可启用远程调试功能。默认为<code>-agentlib:jdwp=transport=dt_socket,address=8000,server=y,suspend=n</code>。也可以通过JPDA_TRANSPORT，JPDA_ADDRESS，JPDA_SUSPEND环境变量来指定部分参数，或者直接指定JPDA_OPTS完整的JPDA选项。</p></li>
<li><p>_EXECJAVA： 默认为<code>%_RUNJAVA%</code>，debug时设置为<code>%_RUNJDB%</code>，start时指定TITLE设置为<code>start "%TITLE%" %_RUNJAVA%</code>。</p></li>
<li>SECURITY_POLICY_FILE： debug/run/start后跟<code>-security</code>时，设置为<code>%CATALINA_BASE%\conf\catalina.policy</code> [TODO]</li>
</ul>


<p>最后就是_EXECJAVA、Jpda、Security进行组合来执行调用Java类，<code>ACTION</code>作为最后一个参数传给java的main方法。</p>

<p><strong>其他一些参数可以通过JAVA_OPTS，CATALINA_OPTS环境变量指定。</strong></p>

<hr />

<h3>其他注意点</h3>

<ul>
<li><p>如果第一个参数为debug命令，一定要用JDK！</p>

<p>  在打印输出信息的时刻，会输出JAVA_HOME，而不是JRE_HOME</p>

<p>  看到的一些不足：
在打印信息的时刻，%1判断是否为debug。接下来检测取出jpda，再判读其他执行操作（debug/run/start/configtest/stop/version）。
但是呢，jdpa后不能跟debug的！执行了<code>catalina.bat debug</code>会调用jdb，而 -agentlib:jdwp不在jdb允许的选项之列！</p></li>
<li><p>网上很多教程都是，安装tomcat都会去设置环境变量！</p>

<p>  JAVA_HOME和TOMCAT_HOME的环境变量（全局），其实可以在startup.bat中设置即可（本地）。这样，可以很好的运行多个不同版本的tomcat。</p></li>
<li><p>run和start的区别</p>

<p>  start命令会<code>start %_RUNJAVA%</code>另起一个进程，而run是直接调用<code>%_RUNJAVA%</code>。
在windows系统start命令会弹出一个新窗口，但是在linux下面start会在调用的时刻添加<code>&amp;</code>后台运行，打印的信息都得去日志文件中查看。</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Jekyll页面实现上/下一篇文章导航]]></title>
    <link href="http://winse.github.io/blog/2014/03/14/jekyll-page-implement-navigate/"/>
    <updated>2014-03-14T08:03:23+08:00</updated>
    <id>http://winse.github.io/blog/2014/03/14/jekyll-page-implement-navigate</id>
    <content type="html"><![CDATA[<p>在博客页面在内容会有上一遍和下一遍文章的链接。
在jekyll的page对象包含上下篇的引用 <a href="http://jekyllbootstrap.com/api/template-data-api.html">Template Data Api</a> ，只需要在页面进行展示即可。</p>

<p>默认主题中jekyll-bootstrap的twitter主题中包含上下篇文章的实现如下：</p>

<pre><code>&lt;hr&gt;
&lt;div class="pagination"&gt;
  &lt;ul&gt;
  {% if page.previous %}
    &lt;li class="prev"&gt;&lt;a href="{{ BASE_PATH }}{{ page.previous.url }}" title="{{ page.previous.title }}"&gt;&amp;larr; Previous&lt;/a&gt;&lt;/li&gt;
  {% else %}
    &lt;li class="prev disabled"&gt;&lt;a&gt;&amp;larr; Previous&lt;/a&gt;&lt;/li&gt;
  {% endif %}
    &lt;li&gt;&lt;a href="{{ BASE_PATH }}{{ site.JB.archive_path }}"&gt;Archive&lt;/a&gt;&lt;/li&gt;
  {% if page.next %}
    &lt;li class="next"&gt;&lt;a href="{{ BASE_PATH }}{{ page.next.url }}" title="{{ page.next.title }}"&gt;Next &amp;rarr;&lt;/a&gt;&lt;/li&gt;
  {% else %}
    &lt;li class="next disabled"&gt;&lt;a&gt;Next &amp;rarr;&lt;/a&gt;
  {% endif %}
  &lt;/ul&gt;
&lt;/div&gt;
&lt;hr&gt;
</code></pre>

<p><strong>注意点</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{ % highlight % }{ % endhighlight % }
</span><span class='line'>
</span><span class='line'># 用于直接输出liquid标签源码，但是raw不能嵌套使用
</span><span class='line'>{ % raw % } { % endraw % }</span></code></pre></td></tr></table></div></figure>


<h2>参考</h2>

<ul>
<li><a href="http://docs.shopify.com/themes/liquid-basics/output#date">liquid-date output</a></li>
<li><a href="http://joshbranchaud.com/blog/2012/12/24/Date-Formatting-in-Jekyll.html">日期格式化</a></li>
<li><a href="http://blog.segmentfault.com/skyinlayer/1190000000406013">使用Jekyll在Github上搭建个人博客</a></li>
<li><a href="http://blog.segmentfault.com/skyinlayer/1190000000406015">分页</a></li>
<li><a href="http://jser.me/2013/07/28/%E6%97%A7blog%E8%BF%81%E7%A7%BB%E5%88%B0jekyll%2Bgithub.html">旧blog迁移到jekyll+github</a></li>
<li><a href="http://jekyllrb.com/docs/variables/">jekyll可以使用的参数</a></li>
<li><a href="https://github.com/shopify/liquid/wiki/liquid-for-designers">liquid页面渲染语言</a></li>
<li><a href="http://www.open-open.com/lib/view/open1361323129134.html">javascript-liquid</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[在windows操作系统安装jekyll服务]]></title>
    <link href="http://winse.github.io/blog/2014/03/14/windows-install-jekyll/"/>
    <updated>2014-03-14T07:35:32+08:00</updated>
    <id>http://winse.github.io/blog/2014/03/14/windows-install-jekyll</id>
    <content type="html"><![CDATA[<p>如果windows安装了<strong>cygwin</strong>，那就不要折腾了，参考本文最后，按照类似linux的安装是最方便简单的了！</p>

<h2>参考文档：</h2>

<ul>
<li><a href="http://chxt6896.github.io/blog/2011/11/30/blog-jekyll-install.html">安装 Jekyll</a></li>
<li><a href="https://github.com/oneclick/rubyinstaller/wiki/development-kit">Development Kit</a></li>
<li><a href="http://blog.ownlinux.net/2012/08/fix-gem-install-jekyll-problem.html">解决GEM INSTALL JEKYLL的问题</a></li>
</ul>


<p>我首先把安装过程中参考的链接放上来，下面的操作其实是对他们的一个梳理。</p>

<h2>下载 &amp; 安装包</h2>

<ul>
<li><a href="https://code.google.com/p/msysgit/">MsysGit</a> Git-1.8.3-preview20130601.exe</li>
<li><a href="http://rubyforge.org/frs/?group_id=167">ruby</a> rubyinstaller-1.9.3-p392.exe</li>
<li><a href="https://github.com/oneclick/rubyinstaller/downloads/">rubydev</a> DevKit-tdm-32-4.5.2-20111229-1559-sfx.exe</li>
</ul>


<p>安装的路径根据自己的需要进行选择即可。我这里选择的是：</p>

<ul>
<li>C:\Program Files\Git</li>
<li>C:\Ruby193</li>
<li>C:\rubydev</li>
</ul>


<h2>设置环境变量，并初始化安装rubydev</h2>

<p>打开git命令窗口(bash命令行)，操作如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Winseliu@WINSE ~
</span><span class='line'>$ export PATH=/c/Ruby193/bin:/c/rubydev/bin:$PATH
</span><span class='line'>
</span><span class='line'>Winseliu@WINSE ~
</span><span class='line'>$ cd /c/rubydev/
</span><span class='line'>
</span><span class='line'>Winseliu@WINSE /c/rubydev
</span><span class='line'>$ ruby dk.rb  init
</span><span class='line'>[INFO] found RubyInstaller v1.9.3 at C:/Ruby193
</span><span class='line'>
</span><span class='line'>Initialization complete! Please review and modify the auto-generated
</span><span class='line'>'config.yml' file to ensure it contains the root directories to all
</span><span class='line'>of the installed Rubies you want enhanced by the DevKit.
</span><span class='line'>
</span><span class='line'>Winseliu@WINSE /c/rubydev
</span><span class='line'>$ ruby dk.rb install
</span><span class='line'>[INFO] Updating convenience notice gem override for 'C:/Ruby193'
</span><span class='line'>[INFO] Installing 'C:/Ruby193/lib/ruby/site_ruby/devkit.rb'</span></code></pre></td></tr></table></div></figure>


<h2>安装jekyll</h2>

<p>安装的过程并非一路顺风，rubygems的官网好像被禁了。需要更新源。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Winseliu@WINSE /c
</span><span class='line'>$ gem install jekyll
</span><span class='line'>ERROR:  Could not find a valid gem 'jekyll' (&gt;= 0) in any repository
</span><span class='line'>ERROR:  Possible alternatives: jekyll
</span><span class='line'>
</span><span class='line'>Winseliu@WINSE /c
</span><span class='line'>$ gem sources --remove http://rubygems.org/
</span><span class='line'>http://rubygems.org/ removed from sources
</span><span class='line'>
</span><span class='line'>Winseliu@WINSE /c
</span><span class='line'>$ gem sources -a http://ruby.taobao.org/
</span><span class='line'>http://ruby.taobao.org/ added to sources
</span><span class='line'>
</span><span class='line'>Winseliu@WINSE /c
</span><span class='line'>$ gem sources -l
</span><span class='line'>*** CURRENT SOURCES ***
</span><span class='line'>
</span><span class='line'>http://ruby.taobao.org/
</span><span class='line'>
</span><span class='line'>Winseliu@WINSE /c
</span><span class='line'>$ gem install rack
</span><span class='line'>Fetching: rack-1.5.2.gem (100%)
</span><span class='line'>Successfully installed rack-1.5.2
</span><span class='line'>1 gem installed
</span><span class='line'>Installing ri documentation for rack-1.5.2...
</span><span class='line'>Installing RDoc documentation for rack-1.5.2...</span></code></pre></td></tr></table></div></figure>


<h2>真正安装jekyll</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Winseliu@WINSE /c/rubydev
</span><span class='line'>$ gem install jekyll
</span><span class='line'>Temporarily enhancing PATH to include DevKit...
</span><span class='line'>Building native extensions.  This could take a while...
</span><span class='line'>Fetching: classifier-1.3.3.gem (100%)
</span><span class='line'>Fetching: directory_watcher-1.4.1.gem (100%)
</span><span class='line'>Fetching: syntax-1.0.0.gem (100%)
</span><span class='line'>Fetching: maruku-0.6.1.gem (100%)
</span><span class='line'>Fetching: kramdown-1.0.2.gem (100%)
</span><span class='line'>Fetching: yajl-ruby-1.1.0-x86-mingw32.gem (100%)
</span><span class='line'>Fetching: posix-spawn-0.3.6.gem (100%)
</span><span class='line'>Building native extensions.  This could take a while...
</span><span class='line'>Fetching: pygments.rb-0.5.1.gem (100%)
</span><span class='line'>Fetching: highline-1.6.19.gem (100%)
</span><span class='line'>Fetching: commander-4.1.3.gem (100%)
</span><span class='line'>Fetching: safe_yaml-0.7.1.gem (100%)
</span><span class='line'>Fetching: colorator-0.1.gem (100%)
</span><span class='line'>Fetching: jekyll-1.0.3.gem (100%)
</span><span class='line'>Successfully installed fast-stemmer-1.0.2
</span><span class='line'>Successfully installed classifier-1.3.3
</span><span class='line'>Successfully installed directory_watcher-1.4.1
</span><span class='line'>Successfully installed syntax-1.0.0
</span><span class='line'>Successfully installed maruku-0.6.1
</span><span class='line'>Successfully installed kramdown-1.0.2
</span><span class='line'>Successfully installed yajl-ruby-1.1.0-x86-mingw32
</span><span class='line'>Successfully installed posix-spawn-0.3.6
</span><span class='line'>Successfully installed pygments.rb-0.5.1
</span><span class='line'>Successfully installed highline-1.6.19
</span><span class='line'>Successfully installed commander-4.1.3
</span><span class='line'>Successfully installed safe_yaml-0.7.1
</span><span class='line'>Successfully installed colorator-0.1
</span><span class='line'>Successfully installed jekyll-1.0.3
</span><span class='line'>14 gems installed
</span><span class='line'>Installing ri documentation for fast-stemmer-1.0.2...
</span><span class='line'>Installing ri documentation for classifier-1.3.3...
</span><span class='line'>Installing ri documentation for directory_watcher-1.4.1...
</span><span class='line'>Installing ri documentation for syntax-1.0.0...
</span><span class='line'>Installing ri documentation for maruku-0.6.1...
</span><span class='line'>Couldn't find file to include 'MaRuKu.txt' from lib/maruku.rb
</span><span class='line'>Installing ri documentation for kramdown-1.0.2...
</span><span class='line'>Installing ri documentation for yajl-ruby-1.1.0-x86-mingw32...
</span><span class='line'>Installing ri documentation for posix-spawn-0.3.6...
</span><span class='line'>Installing ri documentation for pygments.rb-0.5.1...
</span><span class='line'>Installing ri documentation for highline-1.6.19...
</span><span class='line'>Installing ri documentation for commander-4.1.3...
</span><span class='line'>Installing ri documentation for safe_yaml-0.7.1...
</span><span class='line'>Installing ri documentation for colorator-0.1...
</span><span class='line'>Installing ri documentation for jekyll-1.0.3...
</span><span class='line'>Installing RDoc documentation for fast-stemmer-1.0.2...
</span><span class='line'>Installing RDoc documentation for classifier-1.3.3...
</span><span class='line'>Installing RDoc documentation for directory_watcher-1.4.1...
</span><span class='line'>Installing RDoc documentation for syntax-1.0.0...
</span><span class='line'>Installing RDoc documentation for maruku-0.6.1...
</span><span class='line'>Couldn't find file to include 'MaRuKu.txt' from lib/maruku.rb
</span><span class='line'>Installing RDoc documentation for kramdown-1.0.2...
</span><span class='line'>Installing RDoc documentation for yajl-ruby-1.1.0-x86-mingw32...
</span><span class='line'>Installing RDoc documentation for posix-spawn-0.3.6...
</span><span class='line'>Installing RDoc documentation for pygments.rb-0.5.1...
</span><span class='line'>Installing RDoc documentation for highline-1.6.19...
</span><span class='line'>Installing RDoc documentation for commander-4.1.3...
</span><span class='line'>Installing RDoc documentation for safe_yaml-0.7.1...
</span><span class='line'>Installing RDoc documentation for colorator-0.1...
</span><span class='line'>Installing RDoc documentation for jekyll-1.0.3...</span></code></pre></td></tr></table></div></figure>


<p></p>

<h2>创建新博客</h2>

<p>（2014年3月19日更新 Cygwin）</p>

<p><strong>建立新的本地测试文件夹</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@winseliu /cygdrive/c/Users/Administrator/target
</span><span class='line'>$ rm -rf export
</span><span class='line'>
</span><span class='line'>Administrator@winseliu /cygdrive/c/Users/Administrator/target
</span><span class='line'>$ jekyll new export
</span><span class='line'>New jekyll site installed in /cygdrive/c/Users/Administrator/target/export.
</span><span class='line'>
</span><span class='line'>Administrator@winseliu /cygdrive/c/Users/Administrator/target
</span><span class='line'>$ cd export/
</span></code></pre></td></tr></table></div></figure>


<p><strong>修改配置_config.yml</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>name: Your New Jekyll Site
</span><span class='line'>markdown: rdiscount
</span><span class='line'>pygments: false
</span></code></pre></td></tr></table></div></figure>


<p><strong>启动服务</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Administrator@winseliu /cygdrive/c/Users/Administrator/target/export
</span><span class='line'>$ jekyll serve --trace -w -P 8000
</span><span class='line'>Configuration file: /cygdrive/c/Users/Administrator/target/export/_config.yml
</span><span class='line'>            Source: /cygdrive/c/Users/Administrator/target/export
</span><span class='line'>       Destination: /cygdrive/c/Users/Administrator/target/export/_site
</span><span class='line'>      Generating... done.
</span><span class='line'> Auto-regeneration: enabled
</span><span class='line'>[Listen warning]:
</span><span class='line'>  Listen will be polling for changes. Learn more at https://github.com/guard/listen#polling-fallback.
</span><span class='line'>
</span><span class='line'>    Server address: http://0.0.0.0:8000
</span><span class='line'>  Server running... press ctrl-c to stop.
</span></code></pre></td></tr></table></div></figure>


<h2>注意点</h2>

<h3>出现编码问题</h3>

<p>参考：<a href="http://www.duzengqiang.com/blog/post/979.html">http://www.duzengqiang.com/blog/post/979.html</a></p>

<p>文件在对应的文件夹下：
C:\Ruby193\lib\ruby\gems\1.9.1\gems\jekyll-1.0.3\lib\jekyll\convertible.rb</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-        self.content = File.read(File.join(base, name))
</span><span class='line'>+        self.content = File.read(File.join(base, name), :encoding=&gt;"utf-8")</span></code></pre></td></tr></table></div></figure>


<p>（2014-3-13更新）重装系统后，jekyll-1.3.1版本的代码不同了，修改如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def read_yaml(base, name, opts = {:encoding=&gt;"utf-8"})
</span><span class='line'>  begin</span></code></pre></td></tr></table></div></figure>


<p><strong><em>OR</em></strong></p>

<p><a href="http://www.dewen.org/q/5893">http://www.dewen.org/q/5893</a></p>

<blockquote><p>要指定文件的编码格式
在文件开头加上
<code># -*- coding:utf-8 -*-</code></p>

<p>指定运行环境的编码
使用
<code>ruby --encoding=utf-8</code></p></blockquote>

<p><strong>启动</strong>：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Winseliu@WINSE ~
</span><span class='line'>$ cd /c/Users/Winseliu/Documents/GitHub/winse.github.com/
</span><span class='line'>
</span><span class='line'>Winseliu@WINSE ~/Documents/GitHub/winse.github.com (master)
</span><span class='line'>$ jekyll serve --trace -w</span></code></pre></td></tr></table></div></figure>


<p>然后访问 <a href="http://localhost:4000">http://localhost:4000</a> 即可。</p>

<p><strong>本地调试</strong></p>

<ul>
<li>ruby使用<code>puts</code>输出，可以用来打印调试！</li>
<li>在本地免不了要写一些<strong>中文名的文件</strong>，可以直接增加try-catch（post.rb#self.valid, cleaner.rb#existing_files）！但网上有讲ruby2.0可以处理中文文件名了！</li>
<li>当然本地调试可以通过<strong>修改<code>_config.xml</code>的exclude</strong>排除掉，修改好需要发布时再修改为英文文件名即可！</li>
</ul>


<p>post.rb</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def self.valid?(name)
</span><span class='line'>begin
</span><span class='line'>  name =~ MATCHER
</span><span class='line'>rescue =&gt; err
</span><span class='line'>  puts err
</span><span class='line'>  puts name
</span><span class='line'>end
</span><span class='line'>end
</span></code></pre></td></tr></table></div></figure>


<h3>编写文件头需要注意的地方；</h3>

<p><a href="http://cache.baiducontent.com/c?m=9f65cb4a8c8507ed4fece763105392230e54f733779c954228c3933fc239045c0535b6ec3a5d1219b2c176631cab4358e8f43d6537747af1c4969c0f80fbc42777df7e7f2e429141639144ee8d5124b137902dfeae69a7eae733e3b9d3a0c85523cd58127af1abd74d00659133ab526ab0f8c200424810cbaa6c33a80d2c75c87557b636a6b774345ad7e1dd2d16906bc7606180a841a73f62ec44ef&amp;p=8973d716d9c106ff57ee96744c53a5&amp;newp=8349d103929a12a05abd9b7d0f1c8f231615d70e3fd3d111&amp;user=baidu&amp;fm=sc&amp;query=jekyll++post%2Erb%3A59+in+initialize+undefined+method+has_key&amp;qid=&amp;p1=1">诡异的jekyll空格</a></p>

<blockquote><p>忽然想起之前看过的一篇博客，这篇文章中说起“YAML格局默认是：参数＋：＋空格，若是忘怀写空格描画编译报错。”。<br/>
在这里，恰是因为忘怀了空格导致了HTML文件无法生成的题目。</p></blockquote>

<h3>maruku的不足</h3>

<p>使用rdiscount ( <code>gem install rdiscount</code> ) 替换。</p>

<ul>
<li><a href="http://nepshi.com/2012-10-08/chinese-characters-in-jekyll/">Jekyll对中文问题的处理</a></li>
<li><a href="http://chxt6896.github.io/blog/2012/02/13/blog-jekyll-native.html">Jekyll本地调试之若干问题</a></li>
</ul>


<h2>参考</h2>

<ul>
<li><a href="http://chxt6896.github.io/blog/2012/02/13/blog-jekyll-native.html">http://chxt6896.github.io/blog/2012/02/13/blog-jekyll-native.html</a></li>
</ul>


<hr />

<h1>WINDOW直接在cygwin中安装jekyll</h1>

<ol>
<li>使用cygwin setup.exe安装ruby，以及libyaml，最好也把git安装一下。配置环境变量。</li>
<li>使用<code>gem install jekyll</code>安装。</li>
<li>安装依赖<code>gem install rdiscount</code>。</li>
<li>启动<code>jekyll serve --trace -w</code>。</li>
</ol>


<p>由于cygwin下默认是utf8编码，并且已经有了linux的各种命令，安装起来很简单。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Windows运行]快速打开程序]]></title>
    <link href="http://winse.github.io/blog/2014/02/23/quickly-open-program-in-windows/"/>
    <updated>2014-02-23T00:00:00+08:00</updated>
    <id>http://winse.github.io/blog/2014/02/23/quickly-open-program-in-windows</id>
    <content type="html"><![CDATA[<p>由于种种原因，一直都在Windows下进行编程。如eclipse/Office/QQ/&hellip;的软件拖住了切换平台的决心！</p>

<p>在使用windows的同时，形成了一些自己的习惯。使用<code>WIN + r</code>来快速打开应用，如regedit/notepad/mspaint/magnify/cmd等。</p>

<p>希望能直接运行Git Shell/Cygwin Terminal这些在<strong>开始</strong>中的菜单。但，在<strong>运行</strong>窗口直接输入的命令都得在PATH所在的路径下。如果把路径全部加入到PATH又没有这个必要，并且命令都是以lnk的快捷方式存储。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>C:\Users\Administrator\AppData\Local\GitHub\GitHub.appref-ms --open-shell
</span><span class='line'>
</span><span class='line'>C:\cygwin\bin\mintty.exe -i /Cygwin-Terminal.ico -
</span><span class='line'>
</span><span class='line'>"C:\Program Files\Vim\vim74\vim.exe"
</span><span class='line'>"C:\Program Files\Vim\vim74\gvim.exe"
</span></code></pre></td></tr></table></div></figure>


<p>在已经打开命令行窗口情况下，可以通过定义alias（别名）来实现。具体请<a href="http://blog.sina.com.cn/s/blog_9bf4cb690101byho.html">参考</a>。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>C:\Users\Administrator&gt;doskey cygwin=C:\cygwin\bin\mintty.exe -i /Cygwin-Terminal.ico -
</span><span class='line'>
</span><span class='line'>C:\Users\Administrator&gt;doskey /MACROS
</span><span class='line'>cygwin=C:\cygwin\bin\mintty.exe -i /Cygwin-Terminal.ico -
</span><span class='line'>
</span><span class='line'>C:\Users\Administrator&gt;cygwin
</span></code></pre></td></tr></table></div></figure>


<p>通过别名可以简化命令，但是必须在已经打开命令行窗口的情况下！！</p>

<p><strong>解决办法：</strong>
最后妥协了，定义一个路径<code>D:\local\bin</code>，加入到<em>PATH</em>环境变量。把需要使用通过<strong>运行</strong>打开的程序在<em>bin</em>目录下建立一个快键指向。使用mklink是一个软链接。（当然也可以创建个快捷方式，然后改名称）</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>D:\local\bin&gt;mklink git.lnk "C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\GitHub, Inc\Git Shell.lnk"
</span><span class='line'>
</span><span class='line'>D:\local\bin&gt;mklink cygwin.lnk "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Cygwin\Cygwin Terminal.lnk"
</span><span class='line'>
</span><span class='line'>D:\local\bin&gt;mklink vim.lnk "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Vim 7.4\Vim.lnk"
</span></code></pre></td></tr></table></div></figure>


<p>建立指向后的效果如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>D:\local\bin&gt;dir
</span><span class='line'> 驱动器 D 中的卷是 Software
</span><span class='line'> 卷的序列号是 C83F-14A7
</span><span class='line'>
</span><span class='line'> D:\local\bin 的目录
</span><span class='line'>
</span><span class='line'>2014/02/01  01:57    &lt;DIR&gt;          .
</span><span class='line'>2014/02/01  01:57    &lt;DIR&gt;          ..
</span><span class='line'>2014/02/01  01:56    &lt;SYMLINK&gt;      cygwin.lnk [C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Cygwin\Cygwin Terminal.lnk]
</span><span class='line'>2014/02/01  01:55    &lt;SYMLINK&gt;      git.lnk [C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\GitHub, Inc\Git Shell.lnk]
</span><span class='line'>2014/02/01  01:57    &lt;SYMLINK&gt;      vim.lnk [C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Vim 7.4\Vim.lnk]
</span><span class='line'>               3 个文件              0 字节
</span><span class='line'>               2 个目录  9,673,441,280 可用字节
</span></code></pre></td></tr></table></div></figure>


<p>按照上面的操作[解决办法]，就可以通过<code>WIN + r</code>然后输入<code>git</code>打开<em>Git Shell</em>。</p>

<p>本文所处理的问题，在Windows下有<strong>现成的工具</strong><a href="http://www.launchy.net/">Launcher</a>可以查找指定路径下的所有程序/文档。</p>

<h2>其他快键</h2>

<p>通过<code>WIN + ↑</code>可以最大化当前窗口。</p>

<h2>参考</h2>

<ul>
<li><a href="http://xbeta.info/win-run.htm">最绿色最高效，用win+r启动常用程序和文档</a></li>
</ul>


<hr />

<p><a href="http://winseliu.logdown.com/posts/2014/02/23/quickly-open-program-in-windows">【原文地址】</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Maven合并打包依赖的git项目]]></title>
    <link href="http://winse.github.io/blog/2014/02/19/maven-package-dependent-git-projects/"/>
    <updated>2014-02-19T09:56:00+08:00</updated>
    <id>http://winse.github.io/blog/2014/02/19/maven-package-dependent-git-projects</id>
    <content type="html"><![CDATA[<p>JD的云引擎可以提供一个网站搭建的Java编译发布环境。但是所有源码都要放在下面。
我只是想把JD提供的环境作为一个门面，来展现内容。自己的东西自己管理。（网上解决是使用submodule，强烈推荐看看.<a href="http://josephjiang.com/entry.php?id=342">戳</a>）</p>

<p>我建了一个源码库flickrUpload在Github上，如果我想把它放到JD的云引擎上运行，需要复制代码然后再提交一次到jd-code。但不想源码版本库分支混乱，并且JD云上仅仅是为了展示，不进行修改。最终实现使用Maven来检出依赖项目，再进行编译打包实现在JD的展示功能。</p>

<h2>本地环境使用scm和antrun插件，实现先更新依赖源码再打包</h2>

<h3>检出依赖源码库</h3>

<p>由于对Maven不太熟悉，首先想到的是额外执行系统的命令。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;project&gt;
</span><span class='line'>    &lt;profiles&gt;
</span><span class='line'>        &lt;profile&gt;
</span><span class='line'>            &lt;id&gt;win&lt;/id&gt;
</span><span class='line'>            &lt;activation&gt;
</span><span class='line'>                &lt;activeByDefault&gt;false&lt;/activeByDefault&gt;
</span><span class='line'>                &lt;os&gt;
</span><span class='line'>                    &lt;family&gt;Windows&lt;/family&gt;
</span><span class='line'>                &lt;/os&gt;
</span><span class='line'>            &lt;/activation&gt;
</span><span class='line'>            &lt;properties&gt;
</span><span class='line'>                &lt;flickrUploader&gt;uploader-git-clone.bat&lt;/flickrUploader&gt;
</span><span class='line'>            &lt;/properties&gt;
</span><span class='line'>        &lt;/profile&gt;
</span><span class='line'>        &lt;profile&gt;
</span><span class='line'>            &lt;id&gt;linux&lt;/id&gt;
</span><span class='line'>            &lt;activation&gt;
</span><span class='line'>                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
</span><span class='line'>                &lt;os&gt;
</span><span class='line'>                    &lt;family&gt;Linux&lt;/family&gt;
</span><span class='line'>                &lt;/os&gt;
</span><span class='line'>            &lt;/activation&gt;
</span><span class='line'>            &lt;properties&gt;
</span><span class='line'>                &lt;flickrUploader&gt;uploader-git-clone.sh&lt;/flickrUploader&gt;
</span><span class='line'>            &lt;/properties&gt;
</span><span class='line'>        &lt;/profile&gt;
</span><span class='line'>    &lt;/profiles&gt;
</span><span class='line'>
</span><span class='line'>    &lt;build&gt;
</span><span class='line'>        &lt;finalName&gt;product&lt;/finalName&gt;
</span><span class='line'>
</span><span class='line'>        &lt;plugins&gt;
</span><span class='line'>            &lt;plugin&gt;
</span><span class='line'>                &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
</span><span class='line'>                &lt;configuration&gt;
</span><span class='line'>                    &lt;webResources&gt;
</span><span class='line'>                        &lt;resource&gt;
</span><span class='line'>                            &lt;directory&gt;dist&lt;/directory&gt;
</span><span class='line'>                        &lt;/resource&gt;
</span><span class='line'>                    &lt;/webResources&gt;
</span><span class='line'>                &lt;/configuration&gt;
</span><span class='line'>            &lt;/plugin&gt;
</span><span class='line'>            &lt;plugin&gt;
</span><span class='line'>                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
</span><span class='line'>                &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;
</span><span class='line'>                &lt;version&gt;1.1.1&lt;/version&gt;
</span><span class='line'>                &lt;executions&gt;
</span><span class='line'>                    &lt;execution&gt;
</span><span class='line'>                        &lt;id&gt;some-execution&lt;/id&gt;
</span><span class='line'>                        &lt;phase&gt;compile&lt;/phase&gt;
</span><span class='line'>                        &lt;goals&gt;
</span><span class='line'>                            &lt;goal&gt;exec&lt;/goal&gt;
</span><span class='line'>                        &lt;/goals&gt;
</span><span class='line'>                    &lt;/execution&gt;
</span><span class='line'>                &lt;/executions&gt;
</span><span class='line'>                &lt;configuration&gt;
</span><span class='line'>                    &lt;executable&gt;${basedir}/script/${flickrUploader}&lt;/executable&gt;
</span><span class='line'>                &lt;/configuration&gt;
</span><span class='line'>            &lt;/plugin&gt;
</span><span class='line'>        &lt;/plugins&gt;
</span><span class='line'>    &lt;/build&gt;
</span></code></pre></td></tr></table></div></figure>


<p>根据profile来配置来判断环境，执行特定的命令（bat/sh）。</p>

<ul>
<li>Windows脚本</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># uploader-git-clone.bat
</span><span class='line'>del /s /q /f dist\Hello-World
</span><span class='line'>rmdir /s /q dist\Hello-World
</span><span class='line'>"C:\Program Files\Git\bin\git.exe" clone https://github.com/octocat/Hello-World.git dist\Hello-World</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Linux脚本</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># uploader-git-clone.sh
</span><span class='line'>rm -rf dist/Hello-World
</span><span class='line'>git clone https://github.com/octocat/Hello-World.git dist/Hello-World</span></code></pre></td></tr></table></div></figure>


<p>测试在本地window已经能实现自己的要求，能把checkout项目的内容放在了发布包的根目录下面。</p>

<p>执行<code>mvn package</code>后的target目录结构如下：
<img src="http://farm8.staticflickr.com/7371/12624988843_ccce073e1a_o.png" alt="" /></p>

<h3>源码库路径重定位</h3>

<p>发布时把源码库文件放置到war的根目录下面，有考虑过COPY：如<a href="http://evgeny-goldin.com/wiki/Copy-maven-plugin">Copy-maven-plugin</a>，还有如下outputDirectory的形式（<a href="http://outofmemory.cn/code-snippet/2547/maven-copy-file-card-usage">参考</a>）：</p>

<blockquote><pre><code>&lt;project&gt;
  ...
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.6&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;copy-resources&lt;/id&gt;
            &lt;!-- here the phase you need --&gt;
            &lt;phase&gt;validate&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;copy-resources&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;outputDirectory&gt;${basedir}/target/extra-resources&lt;/outputDirectory&gt;
              &lt;resources&gt;          
                &lt;resource&gt;
                  &lt;directory&gt;src/non-packaged-resources&lt;/directory&gt;
                  &lt;filtering&gt;true&lt;/filtering&gt;
                &lt;/resource&gt;
              &lt;/resources&gt;              
            &lt;/configuration&gt;            
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
    ...
  &lt;/build&gt;
  ...
&lt;/project&gt;
</code></pre></blockquote>

<h2>最终实现</h2>

<p>上面就要解决两个问题：源码检出和资源重定位。</p>

<p>后面发现war可以<strong>包含</strong>特定目录的资源，资源重定位实现就用war的webResources实现了。
同时为了把检出源码的清理工作提取到clean任务下，添加使用antrun插件。同时发现scm插件就实现了检出源码的功能<a href="http://maven.apache.org/scm/maven-scm-plugin/">maven-scm-plugin</a>。</p>

<p>使用antrun和scm完全使用Maven实现，最终的插件配置如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;project&gt;
</span><span class='line'>    &lt;build&gt;
</span><span class='line'>        &lt;finalName&gt;product&lt;/finalName&gt;
</span><span class='line'>
</span><span class='line'>        &lt;plugins&gt;
</span><span class='line'>
</span><span class='line'>            &lt;plugin&gt;
</span><span class='line'>                &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
</span><span class='line'>                &lt;executions&gt;
</span><span class='line'>                    &lt;execution&gt;
</span><span class='line'>                        &lt;phase&gt;clean&lt;/phase&gt;
</span><span class='line'>                        &lt;configuration&gt;
</span><span class='line'>                            &lt;tasks&gt;
</span><span class='line'>                                &lt;delete includeEmptyDirs="true"&gt;
</span><span class='line'>                                    &lt;fileset dir="${scm-dist}" /&gt;
</span><span class='line'>                                &lt;/delete&gt;
</span><span class='line'>
</span><span class='line'>                                &lt;mkdir dir="${scm-dist}" /&gt;
</span><span class='line'>                            &lt;/tasks&gt;
</span><span class='line'>                        &lt;/configuration&gt;
</span><span class='line'>                        &lt;goals&gt;
</span><span class='line'>                            &lt;goal&gt;run&lt;/goal&gt;
</span><span class='line'>                        &lt;/goals&gt;
</span><span class='line'>                    &lt;/execution&gt;
</span><span class='line'>                &lt;/executions&gt;
</span><span class='line'>            &lt;/plugin&gt;
</span><span class='line'>
</span><span class='line'>            &lt;plugin&gt;
</span><span class='line'>                &lt;artifactId&gt;maven-scm-plugin&lt;/artifactId&gt;
</span><span class='line'>                &lt;version&gt;1.9&lt;/version&gt;
</span><span class='line'>                &lt;configuration&gt;
</span><span class='line'>                    &lt;skipCheckoutIfExists&gt;true&lt;/skipCheckoutIfExists&gt;
</span><span class='line'>                    &lt;checkoutDirectory&gt;${scm-dist}/flikr&lt;/checkoutDirectory&gt;
</span><span class='line'>                    &lt;connectionUrl&gt;scm:git:https://github.com/octocat/Hello-World.git&lt;/connectionUrl&gt;
</span><span class='line'>                &lt;/configuration&gt;
</span><span class='line'>                &lt;executions&gt;
</span><span class='line'>                    &lt;execution&gt;
</span><span class='line'>                        &lt;phase&gt;clean&lt;/phase&gt;
</span><span class='line'>                        &lt;goals&gt;
</span><span class='line'>                            &lt;goal&gt;checkout&lt;/goal&gt;
</span><span class='line'>                        &lt;/goals&gt;
</span><span class='line'>                    &lt;/execution&gt;
</span><span class='line'>                &lt;/executions&gt;
</span><span class='line'>            &lt;/plugin&gt;
</span><span class='line'>
</span><span class='line'>            &lt;plugin&gt;
</span><span class='line'>                &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
</span><span class='line'>                &lt;configuration&gt;
</span><span class='line'>                    &lt;webResources&gt;
</span><span class='line'>                        &lt;resource&gt;
</span><span class='line'>                            &lt;directory&gt;${scm-dist}&lt;/directory&gt;
</span><span class='line'>                        &lt;/resource&gt;
</span><span class='line'>                    &lt;/webResources&gt;
</span><span class='line'>                &lt;/configuration&gt;
</span><span class='line'>            &lt;/plugin&gt;
</span><span class='line'>
</span><span class='line'>        &lt;/plugins&gt;
</span><span class='line'>    &lt;/build&gt;
</span><span class='line'>
</span><span class='line'>    &lt;properties&gt;
</span><span class='line'>        &lt;!-- for scm --&gt;
</span><span class='line'>        &lt;scm-dist&gt;dist&lt;/scm-dist&gt;
</span><span class='line'>    &lt;/properties&gt;
</span></code></pre></td></tr></table></div></figure>


<p>现在使用<code>mvn clean package</code>就可以实现先checkout项目再打包发布了。最终效果全部使用maven实现，无需额外考虑平台之间的差异处理。</p>

<h2>JD的云引擎Maven编译不支持scm插件</h2>

<blockquote><p>不支持的插件：&#8217;maven-scm-plugin&#8217; 在pom文件中被发现,编译将终止,请检查并更新代码!</p></blockquote>

<p>然后部署到云引擎的时刻，发现antrun和scm的插件都不行，exec也不行！
也尝试过submodule，但是邮件JD的回复说是云上引用内部的才有效！</p>

<p>发布到云引擎最终还是用最土的方法，先删除旧的版本库，然后检出，在提交到云引擎的版本库中。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># flickr-upload-commit.sh
</span><span class='line'>rm -rf src/main/webapp/flickr
</span><span class='line'>git clone git@github.com:winse/flickr-uploader.git src/main/webapp/flickr
</span><span class='line'>rm -rf src/main/webapp/flickr/.git
</span><span class='line'>git add -A && git commit -m "update uploader, please see https://github.com/winse/flickr-uploader" && git push
</span></code></pre></td></tr></table></div></figure>


<h2>其他</h2>

<ul>
<li>子模块基本操作命令</li>
</ul>


<blockquote><p>$ git submodule add <a href="mailto:%67%69%74@%67%69%74%68%75%62.%63%6f%6d">git@github.com</a>:josephj/javascript-platform-yui.git static/platform <br/>
$ git add .gitmodules static/platform
$ git submodule init</p>

<p>$ cd static/platform<br/>
$ git pull origin master<br/>
$ cd ../../ <br/>
$ git add static/platform   <br/>
$ git commit -m &ldquo;static/platform submodule updated&rdquo;</p>

<p>$ git submodule init    <br/>
$ git submodule update</p>

<p>$ cd static/platform<br/>
$ vim README # 做些修改 <br/>
$ git add README<br/>
$ git commit -m &ldquo;Add comments&rdquo;  <br/>
$ git push  <br/>
$ git add static/platform   <br/>
$ git commit -m &lsquo;Submodule updated  <br/>
$ git push</p>

<p>$ git rm &ndash;cached [欲移除的目錄]  <br/>
$ rm -rf [欲移除的目錄]   <br/>
$ vim .gitmodules   <br/>
$ vim .git/config   <br/>
$ git add .gitmodules   <br/>
$ git commit -m &ldquo;Remove a submodule&rdquo;<br/>
$ git submodule sync</p></blockquote>

<h3>参考</h3>

<ul>
<li><a href="http://gavin-chen.iteye.com/blog/336607">Maven plugin中的lifecycle、phase、goal、mojo概念及作用的理解</a></li>
<li><a href="http://stackoverflow.com/questions/9571859/how-to-use-master-pom-file-to-checkout-all-modules-of-a-web-application-and-buil">How to use master pom file to checkout all modules of a web application and build all modules</a> 这个和我要实现的问题类似</li>
<li><a href="http://stackoverflow.com/questions/520546/ant-task-to-run-an-ant-target-only-if-a-file-exists">Ant task to run an Ant target only if a file exists?</a></li>
<li><a href="http://blog.csdn.net/eg366/article/details/9398681">MAVEN常用插件</a> 牛逼啊！</li>
<li><a href="http://stackoverflow.com/questions/15021439/maven-antrun-plugin-skip-target-if-any-of-two-possible-conditions-holds">maven-antrun-plugin skip target if any of two possible conditions holds</a></li>
<li><a href="http://stackoverflow.com/questions/1971912/how-to-execute-tasks-conditionally-using-the-maven-antrun-plugin">How to execute tasks conditionally using the maven-antrun-plugin?</a></li>
<li><a href="http://maven.apache.org/scm-archives/scm-LATEST/maven-scm-providers/maven-scm-providers-git/maven-scm-provider-jgit/">maven-scm-provider-jgit</a></li>
<li><a href="http://josephjiang.com/entry.php?id=342">Git Submodule 的認識與正確使用！</a> 非常详尽</li>
</ul>


<hr />

<p><a href="http://winseliu.logdown.com/posts/2014/02/19/using-maven-checkout-dependent-git-projects">【原文地址】</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cygwin兼容配置]]></title>
    <link href="http://winse.github.io/blog/2013/11/24/cygwin-compatible-setting/"/>
    <updated>2013-11-24T20:20:00+08:00</updated>
    <id>http://winse.github.io/blog/2013/11/24/cygwin-compatible-setting</id>
    <content type="html"><![CDATA[<p>换了新电脑后，以及hadoop2/hbase/zookeeper都提供了基于windows的命令。使用cygwin的驱动力弱化了。现在主要用于git/jekyll/sed/awk/find等基础工具的使用。同时多窗口运行需求比较少。当前主要使用自带的mintty。</p>

<h2>.vimrc</h2>

<p>默认Vim的insert模式下使用上下方向键使用会变成其他的输入(方向键变成ABCD)，操作很麻烦。需要对vim进行一些设置。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Winseliu@WINSE ~
</span><span class='line'>$ cat .vimrc 
</span><span class='line'>set nocompatible 
</span><span class='line'>set backspace=indent,eol,start 
</span><span class='line'>set bs=2 </span></code></pre></td></tr></table></div></figure>


<p><strong>参考</strong> ： <a href="http://ruby-china.org/topics/4866">http://ruby-china.org/topics/4866</a> 第19楼的回复</p>

<h2>/etc/fstab 文件权限</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>none /cygdrive cygdrive binary,noacl,posix=0,user 0 0    </span></code></pre></td></tr></table></div></figure>


<h2>打开windows窗口</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>explorer '/select,' "$(cygpath -C ANSI -w "$XPATH")"</span></code></pre></td></tr></table></div></figure>


<p><strong>参考</strong> ： <a href="http://oldratlee.com/post/2012-12-22/stunning-cygwin">http://oldratlee.com/post/2012-12-22/stunning-cygwin</a></p>

<h2>SecureCRT</h2>

<h2>java查找文件路径</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Winseliu@WINSE /cygdrive/d/winsegit
</span><span class='line'>$ antlr4
</span><span class='line'>Error: Unable to access jarfile /cygdrive/d/winsegit/lib/antlr-4.1-complete.jar</span></code></pre></td></tr></table></div></figure>


<p>由于java在window环境下需要的路径是c:\，需要通过cygpath进行转换。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>alias antlr4='java -jar `cygpath -w $WINSE_HOME/lib/antlr-*-complete.jar`'
</span><span class='line'>export CLASSPATH=".;`cygpath -w $WINSE_HOME/lib/antlr-*-complete.jar`;$CLASSPATH"</span></code></pre></td></tr></table></div></figure>


<h2>字符集</h2>

<p>Linux和window不同，Linux默认的字符集是UTF8，而Windows为GBK。
为了统一两个环境的字符，需要对Cygwin的字符集进行设置。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#.bashrc
</span><span class='line'>export LANG="zh_CN.GB2312"
</span><span class='line'>export OUTPUT_CHARSET="GB2312"</span></code></pre></td></tr></table></div></figure>


<p>还需要把连接工具的编码也改成gb2312。</p>

<p><strong>参考</strong> ： <a href="http://www.cygwin.cn/site/info/show.php?IID=1006">http://www.cygwin.cn/site/info/show.php?IID=1006</a></p>

<h2>参考</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/13427288/cygdrive-prefix-does-not-work-in-bash-script">http://stackoverflow.com/questions/13427288/cygdrive-prefix-does-not-work-in-bash-script</a></li>
<li><a href="http://www.cygwin.com/ml/cygwin/2008-01/msg00095.html">http://www.cygwin.com/ml/cygwin/2008-01/msg00095.html</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Git实现多地多版本协作]]></title>
    <link href="http://winse.github.io/blog/2013/10/27/git-implement-multi-place-version-collaborate/"/>
    <updated>2013-10-27T20:20:00+08:00</updated>
    <id>http://winse.github.io/blog/2013/10/27/git-implement-multi-place-version-collaborate</id>
    <content type="html"><![CDATA[<h2>具体情况：</h2>

<ul>
<li>网络的版本库 github.com/winse/winse.github.com</li>
<li>笔记本       /d/winsegit/winse.github.com/</li>
<li>U盘          /?/works/winse.github.com  (盘符会变化)</li>
</ul>


<p>想实现：以笔记本电脑上的更新为主，辅之U盘上的修改（上班时可能进行更新）。</p>

<p>使用SVN基本没法实现这种功能的。原来也没有深入的学习git，看了《Git权威指南》后豁然开朗！</p>

<ul>
<li><strong>Git允许一个版本库和任意多个的版本库进行交互</strong> （第十九章 远程版本库）</li>
<li>Git本地库即可以作为客户端，也可以作为其他库的服务端！</li>
</ul>


<h2>实际操作</h2>

<ul>
<li>把笔记本的<em>winse.github.com</em>程序拷贝到U盘中</li>
<li>为U盘的版本库添加远程版本库notebook</li>
<li>U盘版本库建立新分支</li>
<li>U盘修改提交并push到远程版本库notebook</li>
<li>笔记本的版本库把新分支merge到master</li>
</ul>


<p>第一步也可以直接使用<code>git clone /d/winsegit/winse.github.com/</code>，后面添加github网络的远程版本库remote-repo就是了。</p>

<h2>命令</h2>

<p>U盘数据更新提交到笔记本</p>

<pre><code>$ git branch usb
$ git checkout usb
$ git add *got-git*
$ git commit -m definitive-guide-of-git

Winseliu@WINSE /i/works/winse.github.com (usb)
$ git remote add notebook /d/winsegit/winse.github.com/

Winseliu@WINSE /i/works/winse.github.com (usb)
$ git fetch notebook
From d:/winsegit/winse.github.com
 * [new branch]      master     -&gt; notebook/master

Winseliu@WINSE /i/works/winse.github.com (usb)
$ git remote
notebook
origin

Winseliu@WINSE /i/works/winse.github.com (usb)
$ git  branch -r
  notebook/master
  origin/HEAD -&gt; origin/master
  origin/master

Winseliu@WINSE /i/works/winse.github.com (usb)
$ git push notebook usb
Counting objects: 8, done.
Delta compression using up to 2 threads.
Compressing objects: 100% (4/4), done.
Writing objects: 100% (5/5), 490 bytes | 0 bytes/s, done.
Total 5 (delta 1), reused 0 (delta 0)
To d:/winsegit/winse.github.com/
 * [new branch]      usb -&gt; usb
</code></pre>

<p>笔记本合并U盘提交的数据</p>

<pre><code>Winseliu@WINSE /d/winsegit/winse.github.com (master)
$ git branch
* master
  usb

Winseliu@WINSE /d/winsegit/winse.github.com (master)
$ git cherry usb

Winseliu@WINSE /d/winsegit/winse.github.com (master)
$ git merge usb
Updating 9f7dff3..31ffaa9
Fast-forward
 bookreview/_posts/2013-10-27-got-git-the-definitive-guide-of-git.md | 5 +++++
 1 file changed, 5 insertions(+)
 create mode 100644 bookreview/_posts/2013-10-27-got-git-the-definitive-guide-of-git.md
</code></pre>

<p>U盘重新获取笔记本的数据合并到usb分支</p>

<pre><code>Winseliu@WINSE /i/works/winse.github.com (usb)
$ git fetch notebook
From d:/winsegit/winse.github.com
   9f7dff3..31ffaa9  master     -&gt; notebook/master

Winseliu@WINSE /i/works/winse.github.com (usb)
$ git merge master
Already up-to-date.
</code></pre>

<h2>其他实践命令</h2>

<p>远程版本库中包含的分支</p>

<pre><code>Winseliu@WINSE /i/works/winse.github.com (usb)
$ git ls-remote --heads /d/winsegit/winse.github.com
9f7dff396b357ca23e1cd765a6dae4ade3417e15        refs/heads/master
</code></pre>

<p>查看远程分支</p>

<pre><code>Winseliu@WINSE /i/works/winse.github.com (usb)
$ git branch -r
  new-remote/master
  origin/HEAD -&gt; origin/master
  origin/master
</code></pre>

<p>添加的远程版本库重命名</p>

<pre><code>Winseliu@WINSE /i/works/winse.github.com (usb)
$ git remote rename new-remote notebook
</code></pre>

<p>Git查看远程库路径</p>

<pre><code>Administrator@WINSELIU /e/git/hello-clone (master)
$ git remote -v
origin  e:/git/hello (fetch)
origin  e:/git/hello (push)
</code></pre>

<p>查看全部的本地引用</p>

<pre><code>Winseliu@WINSE /i/works/winse.github.com (usb)
$ git show-ref
9f7dff396b357ca23e1cd765a6dae4ade3417e15 refs/heads/master
31ffaa98d45eaccf8f9d0949fc1d4375f36f9edb refs/heads/usb
06f6c285b7402fb23a50ccb929b7cd84d98028e7 refs/remotes/origin/HEAD
06f6c285b7402fb23a50ccb929b7cd84d98028e7 refs/remotes/origin/master
</code></pre>

<p>查看哪些提交领先（未被推送到上游跟踪分支中）</p>

<pre><code>Winseliu@WINSE /i/works/winse.github.com (usb)
$ git cherry master
+ 31ffaa98d45eaccf8f9d0949fc1d4375f36f9edb
</code></pre>

<p>各种引用ID之间转换</p>

<pre><code>Winseliu@WINSE /d/winsegit/winse.github.com (master)
$ git rev-parse usb master
31ffaa98d45eaccf8f9d0949fc1d4375f36f9edb
9f7dff396b357ca23e1cd765a6dae4ade3417e15
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Java反编译工具使用记录]]></title>
    <link href="http://winse.github.io/blog/2013/10/24/java-decompiler-tools/"/>
    <updated>2013-10-24T20:20:00+08:00</updated>
    <id>http://winse.github.io/blog/2013/10/24/java-decompiler-tools</id>
    <content type="html"><![CDATA[<h2>工具</h2>

<ul>
<li><a href="http://varaneckas.com/jad/">jad</a></li>
<li><a href="http://jd.benow.ca/">JD-core</a></li>
<li>参考 <a href="http://zhouliang.pro/2010/06/26/jad/">http://zhouliang.pro/2010/06/26/jad/</a></li>
</ul>


<h2>差异</h2>

<p>JD-Core还是比较与时俱进的，对泛型/foreach等新的语法都支持。Jad则只支持到only 45.3(1.1), 46.0 and 47.0(1.3)。  <br/>
任何事物都不是完美的，结合两个工具来看反编译后的源码能更好的回归源码的真相。</p>

<ul>
<li>JD-Core解析双for循环是存在问题！结合jad可能更好的明白源码。</li>
<li>内部类解析<strong>都</strong>不够好，JD-Core相对错误少一些</li>
</ul>


<h2>对比</h2>

<p>这里就[for循环]/[双层for循环]/[内部类]进行对比。</p>

<h3>单for循环</h3>

<p><strong>源码</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>List&lt;String&gt; list = Arrays.asList("abc", "bcd");
</span><span class='line'>
</span><span class='line'>public void testForEach() {
</span><span class='line'>  for (String ele : list) { // for编译成字节码后使用iterator的形式
</span><span class='line'>      System.out.println(ele);
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p><strong>JD-Core v0.3.5 JD-GUI v0.6.2</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>List&lt;String&gt; list = Arrays.asList(new String[] { "abc", "bcd" });
</span><span class='line'>
</span><span class='line'>public void testForEach() {
</span><span class='line'>for (String ele : this.list)
</span><span class='line'>  System.out.println(ele);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p><strong>Jad v1.5.8e2.</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public JavaDecompilerTest()
</span><span class='line'>{
</span><span class='line'>  list = Arrays.asList(new String[] {
</span><span class='line'>      "abc", "bcd"
</span><span class='line'>  });
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>public void testForEach()
</span><span class='line'>{
</span><span class='line'>  String ele;
</span><span class='line'>  for(Iterator iterator = list.iterator(); iterator.hasNext(); System.out.println(ele))
</span><span class='line'>      ele = (String)iterator.next();
</span><span class='line'>
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>List list;</span></code></pre></td></tr></table></div></figure>


<h3>双层for循环</h3>

<p><strong>源码</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>List&lt;Map&lt;String, String&gt;&gt; list = new ArrayList&lt;Map&lt;String, String&gt;&gt;();
</span><span class='line'>{
</span><span class='line'>  Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();
</span><span class='line'>  map.put("12", "23");
</span><span class='line'>  list.add(map);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>public void testForIndex() {
</span><span class='line'>  for (int i = 0; i &lt; list.size(); i++) {
</span><span class='line'>      Map&lt;String, String&gt; map = list.get(i);
</span><span class='line'>      for (String key : map.keySet())
</span><span class='line'>          System.out.println(map.get(key));
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>public void testForEach() {
</span><span class='line'>  for (Map&lt;String, String&gt; map : list) {
</span><span class='line'>      for (String key : map.keySet())
</span><span class='line'>          System.out.println(map.get(key));
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p><strong>JD-Core v0.3.5 JD-GUI v0.6.2</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  List&lt;Map&lt;String, String&gt;&gt; list;
</span><span class='line'>
</span><span class='line'>  public JavaDecompilerTest2()
</span><span class='line'>  {
</span><span class='line'>  this.list = new ArrayList();
</span><span class='line'>
</span><span class='line'>  Map map = new HashMap();
</span><span class='line'>  map.put("12", "23");
</span><span class='line'>  this.list.add(map);
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  public void testForIndex() {
</span><span class='line'>  for (int i = 0; i &lt; this.list.size(); i++) {
</span><span class='line'>    Map map = (Map)this.list.get(i);
</span><span class='line'>    for (String key : map.keySet())
</span><span class='line'>      System.out.println((String)map.get(key));
</span><span class='line'>  }
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  public void testForEach()
</span><span class='line'>  {
</span><span class='line'>  Iterator localIterator2;
</span><span class='line'>  for (Iterator localIterator1 = this.list.iterator(); localIterator1.hasNext(); 
</span><span class='line'>    localIterator2.hasNext())
</span><span class='line'>  {
</span><span class='line'>    Map map = (Map)localIterator1.next();
</span><span class='line'>    localIterator2 = map.keySet().iterator(); continue; String key = (String)localIterator2.next();
</span><span class='line'>    System.out.println((String)map.get(key));
</span><span class='line'>  }
</span><span class='line'>  }</span></code></pre></td></tr></table></div></figure>


<p><strong>Jad v1.5.8e2.</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public JavaDecompilerTest2()
</span><span class='line'>{
</span><span class='line'>  list = new ArrayList();
</span><span class='line'>  Map map = new HashMap();
</span><span class='line'>  map.put("12", "23");
</span><span class='line'>  list.add(map);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>public void testForIndex()
</span><span class='line'>{
</span><span class='line'>  for(int i = 0; i &lt; list.size(); i++)
</span><span class='line'>  {
</span><span class='line'>      Map map = (Map)list.get(i);
</span><span class='line'>      String key;
</span><span class='line'>      for(Iterator iterator = map.keySet().iterator(); iterator.hasNext(); System.out.println((String)map.get(key)))
</span><span class='line'>          key = (String)iterator.next();
</span><span class='line'>
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>public void testForEach()
</span><span class='line'>{
</span><span class='line'>  for(Iterator iterator = list.iterator(); iterator.hasNext();)
</span><span class='line'>  {
</span><span class='line'>      Map map = (Map)iterator.next();
</span><span class='line'>      String key;
</span><span class='line'>      for(Iterator iterator1 = map.keySet().iterator(); iterator1.hasNext(); System.out.println((String)map.get(key)))
</span><span class='line'>          key = (String)iterator1.next();
</span><span class='line'>
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>List list;</span></code></pre></td></tr></table></div></figure>


<h3>内部类</h3>

<p><strong>源码</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class JavaDecompilerTest3 {
</span><span class='line'>
</span><span class='line'>  private class Test2 {}
</span><span class='line'>  
</span><span class='line'>  Test2 test = new Test2();
</span><span class='line'>  
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p><strong>JD-Core v0.3.5 JD-GUI v0.6.2</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class JavaDecompilerTest3
</span><span class='line'>{
</span><span class='line'>  JavaDecompilerTest3.Test2 test = new JavaDecompilerTest3.Test2(null);
</span><span class='line'>
</span><span class='line'>  private class Test2
</span><span class='line'>  {
</span><span class='line'>  private Test2()
</span><span class='line'>  {
</span><span class='line'>  }
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p><strong>Jad v1.5.8e2.</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class JavaDecompilerTest3
</span><span class='line'>{
</span><span class='line'>  private class Test2
</span><span class='line'>  {
</span><span class='line'>
</span><span class='line'>      final JavaDecompilerTest3 this$0;
</span><span class='line'>
</span><span class='line'>      private Test2()
</span><span class='line'>      {
</span><span class='line'>          this$0 = JavaDecompilerTest3.this;
</span><span class='line'>          super();
</span><span class='line'>      }
</span><span class='line'>
</span><span class='line'>      Test2(Test2 test2)
</span><span class='line'>      {
</span><span class='line'>          this();
</span><span class='line'>      }
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  public JavaDecompilerTest3()
</span><span class='line'>  {
</span><span class='line'>      test = new Test2(null);
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  Test2 test;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h2>后记</h2>

<p>工具javap可以查看class的方法签名，通过jd-gui和jad可以反编译得到源码，如果代码没有混淆的话，多半就能了解代码的功能了。</p>
]]></content>
  </entry>
  
</feed>
