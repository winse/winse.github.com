<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Tools | Winse Blog]]></title>
  <link href="http://winseliu.com/blog/categories/tools/atom.xml" rel="self"/>
  <link href="http://winseliu.com/"/>
  <updated>2015-09-25T20:06:54+08:00</updated>
  <id>http://winseliu.com/</id>
  <author>
    <name><![CDATA[Winse Liu]]></name>
    <email><![CDATA[winseliu@foxmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Nagios监控主机]]></title>
    <link href="http://winseliu.com/blog/2015/09/25/nagios-start-guide/"/>
    <updated>2015-09-25T17:40:58+08:00</updated>
    <id>http://winseliu.com/blog/2015/09/25/nagios-start-guide</id>
    <content type="html"><![CDATA[<p>和Cacti查看时间序列图形不同，Nagios更多的是状态的预警。</p>

<ul>
<li>下载应用</li>
</ul>


<p>到<a href="http://sourceforge.net/projects/nagios/files/?source=navbar">sourceforge</a>下面最新版的应用。</p>

<pre><code>[root@cu2 nagios]# cat /etc/redhat-release 
CentOS release 6.6 (Final)
[root@cu2 nagios]# ll
-rw-r--r--  1 root root 11206656 Sep 23 12:47 nagios-4.1.1.tar.gz
-rw-r--r--  1 root root  2677352 Sep 23 12:47 nagios-plugins-2.1.1.tar.gz
-rw-r--r--  1 root root   419695 Sep 23 15:18 nrpe-2.15.tar.gz
</code></pre>

<ul>
<li>新增nagios用户</li>
</ul>


<pre><code>[root@cu2 nagios]# useradd nagios
[root@cu2 nagios]# passwd nagios
[root@cu2 nagios]# groupadd nagcmd
[root@cu2 nagios]# usermod -G nagcmd nagios
[root@cu2 nagios]# usermod -G nagcmd apache
</code></pre>

<ul>
<li>编译Nagios服务端</li>
</ul>


<p>由于前面安装Cacti已经把依赖都安装了，如gcc、gd。</p>

<pre><code>[root@cu2 nagios]# cd nagios-4.1.1/
[root@cu2 nagios-4.1.1]# ./configure --with-command-group=nagcmd
...
Creating sample config files in sample-config/ ...


*** Configuration summary for nagios 4.1.1 08-19-2015 ***:

 General Options:
 -------------------------
        Nagios executable:  nagios
        Nagios user/group:  nagios,nagios
       Command user/group:  nagios,nagcmd
             Event Broker:  yes
        Install ${prefix}:  /usr/local/nagios
    Install ${includedir}:  /usr/local/nagios/include/nagios
                Lock file:  ${prefix}/var/nagios.lock
   Check result directory:  ${prefix}/var/spool/checkresults
           Init directory:  /etc/rc.d/init.d
  Apache conf.d directory:  /etc/httpd/conf.d
             Mail program:  /bin/mail
                  Host OS:  linux-gnu
          IOBroker Method:  epoll

 Web Interface Options:
 ------------------------
                 HTML URL:  http://localhost/nagios/
                  CGI URL:  http://localhost/nagios/cgi-bin/
 Traceroute (used by WAP):  


Review the options above for accuracy.  If they look okay,
type 'make all' to compile the main program and CGIs.

[root@cu2 nagios-4.1.1]# make all
...

*** Compile finished ***

If the main program and CGIs compiled without any errors, you
can continue with installing Nagios as follows (type 'make'
without any arguments for a list of all possible options):

  make install
     - This installs the main program, CGIs, and HTML files

  make install-init
     - This installs the init script in /etc/rc.d/init.d

  make install-commandmode
     - This installs and configures permissions on the
       directory for holding the external command file

  make install-config
     - This installs *SAMPLE* config files in /usr/local/nagios/etc
       You'll have to modify these sample files before you can
       use Nagios.  Read the HTML documentation for more info
       on doing this.  Pay particular attention to the docs on
       object configuration files, as they determine what/how
       things get monitored!

  make install-webconf
     - This installs the Apache config file for the Nagios
       web interface

  make install-exfoliation
     - This installs the Exfoliation theme for the Nagios
       web interface

  make install-classicui
     - This installs the classic theme for the Nagios
       web interface


*** Support Notes *******************************************

If you have questions about configuring or running Nagios,
please make sure that you:

     - Look at the sample config files
     - Read the documentation on the Nagios Library at:
           https://library.nagios.com

before you post a question to one of the mailing lists.
Also make sure to include pertinent information that could
help others help you.  This might include:

     - What version of Nagios you are using
     - What version of the plugins you are using
     - Relevant snippets from your config files
     - Relevant error messages from the Nagios log file

For more information on obtaining support for Nagios, visit:

       https://support.nagios.com

*************************************************************

Enjoy.

[root@cu2 nagios-4.1.1]# make install
...

*** Main program, CGIs and HTML files installed ***

You can continue with installing Nagios as follows (type 'make'
without any arguments for a list of all possible options):

  make install-init
     - This installs the init script in /etc/rc.d/init.d

  make install-commandmode
     - This installs and configures permissions on the
       directory for holding the external command file

  make install-config
     - This installs sample config files in /usr/local/nagios/etc

make[1]: Leaving directory `/data/nagios/nagios-4.1.1'
[root@cu2 nagios-4.1.1]# make install-init
/usr/bin/install -c -m 755 -d -o root -g root /etc/rc.d/init.d
/usr/bin/install -c -m 755 -o root -g root daemon-init /etc/rc.d/init.d/nagios

*** Init script installed ***

[root@cu2 nagios-4.1.1]# make install-config
...

*** Config files installed ***

Remember, these are *SAMPLE* config files.  You'll need to read
the documentation for more information on how to actually define
services, hosts, etc. to fit your particular needs.

[root@cu2 nagios-4.1.1]# make install-commandmode
/usr/bin/install -c -m 775 -o nagios -g nagcmd -d /usr/local/nagios/var/rw
chmod g+s /usr/local/nagios/var/rw

*** External command directory configured ***

[root@cu2 nagios-4.1.1]# vi /usr/local/nagios/etc/objects/contacts.cfg 
...修改define contact定义中的mail为你邮件。
define contact{
        contact_name                    nagiosadmin             ; Short name of user
        use                             generic-contact         ; Inherit default values from generic-contact template (defined above)
        alias                           Nagios Admin            ; Full name of user

        email                           1234@XXX.cn      ; &lt;&lt;***** CHANGE THIS TO YOUR EMAIL ADDRESS ******
        }

[root@cu2 nagios-4.1.1]# make install-webconf
/usr/bin/install -c -m 644 sample-config/httpd.conf /etc/httpd/conf.d/nagios.conf

*** Nagios/Apache conf file installed ***

[root@cu2 nagios-4.1.1]# htpasswd -c /usr/local/nagios/etc/htpasswd.users nagiosadmin
New password: 
Re-type new password: 
Adding password for user nagiosadmin
[root@cu2 nagios-4.1.1]# service httpd restart
Stopping httpd:                                            [  OK  ]
Starting httpd: httpd: Could not reliably determine the server's fully qualified domain name, using 192.168.0.214 for ServerName
                                                           [  OK  ]
</code></pre>

<ul>
<li>编译nagios-plugin</li>
</ul>


<pre><code>[root@cu2 nagios]# cd nagios-plugins-2.1.1/
[root@cu2 nagios-plugins-2.1.1]# ./configure --with-nagios-user=nagios --with-nagios-group=nagios
...
            --with-apt-get-command: 
              --with-ping6-command: /bin/ping6 -n -U -w %d -c %d %s
               --with-ping-command: /bin/ping -n -U -w %d -c %d %s
                       --with-ipv6: yes
                      --with-mysql: /usr/bin/mysql_config
                    --with-openssl: yes
                     --with-gnutls: no
               --enable-extra-opts: yes
                       --with-perl: /usr/bin/perl
             --enable-perl-modules: no
                     --with-cgiurl: /nagios/cgi-bin
               --with-trusted-path: /usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
                   --enable-libtap: no
[root@cu2 nagios-plugins-2.1.1]# make 
[root@cu2 nagios-plugins-2.1.1]# make install
</code></pre>

<p>打开浏览器，使用nagiosadmin和刚刚用htpasswd设置的密码登录就可以localhost的状态了。</p>

<p>手动制造一点异常，如登录用户超过50个。然后看刚刚设置的邮箱是否收到邮件提醒。</p>

<pre><code>[root@cu2 nagios]# service nagios status
nagios (pid 53764) is running...
[root@cu2 nagios]# lsof -p 53764
nagios  53764 nagios    4u   REG                8,3    12715   280762 /usr/local/nagios/var/nagios.log

[root@cu2 nagios]# less /usr/local/nagios/var/nagios.log
看看是否有错误，然后做相应的处理

[root@cu2 nagios]# yum install mail -y
</code></pre>

<ul>
<li>被监控机器安装nrpe</li>
</ul>


<p>程序编译都在cu2上面操作，编译完后，把编译安装的程序直接scp到其他机器就可以了。被监控机器需要nagios-plugin和nrpe。</p>

<pre><code>[root@cu2 nagios-plugins-2.1.1]# cd ../nrpe-2.15
[root@cu2 nrpe-2.15]# ./configure 
...

*** Configuration summary for nrpe 2.15 09-06-2013 ***:

 General Options:
 -------------------------
 NRPE port:    5666
 NRPE user:    nagios
 NRPE group:   nagios
 Nagios user:  nagios
 Nagios group: nagios


Review the options above for accuracy.  If they look okay,
type 'make all' to compile the NRPE daemon and client.

[root@cu2 nrpe-2.15]# make all
cd ./src/; make ; cd ..
make[1]: Entering directory `/data/nagios/nrpe-2.15/src'
gcc -g -O2 -I/usr/include/openssl -I/usr/include -DHAVE_CONFIG_H -I ../include -I ./../include -o nrpe ./nrpe.c ./utils.c ./acl.c -L/usr/lib64  -lssl -lcrypto -lnsl -lwrap  
gcc -g -O2 -I/usr/include/openssl -I/usr/include -DHAVE_CONFIG_H -I ../include -I ./../include -o check_nrpe ./check_nrpe.c ./utils.c -L/usr/lib64  -lssl -lcrypto -lnsl 
make[1]: Leaving directory `/data/nagios/nrpe-2.15/src'

*** Compile finished ***

If the NRPE daemon and client compiled without any errors, you
can continue with the installation or upgrade process.

Read the PDF documentation (NRPE.pdf) for information on the next
steps you should take to complete the installation or upgrade.

[root@cu2 nrpe-2.15]# make install-plugin
cd ./src/ &amp;&amp; make install-plugin
make[1]: Entering directory `/data/nagios/nrpe-2.15/src'
/usr/bin/install -c -m 775 -o nagios -g nagios -d /usr/local/nagios/libexec
/usr/bin/install -c -m 775 -o nagios -g nagios check_nrpe /usr/local/nagios/libexec
make[1]: Leaving directory `/data/nagios/nrpe-2.15/src'
[root@cu2 nrpe-2.15]# make install-daemon
cd ./src/ &amp;&amp; make install-daemon
make[1]: Entering directory `/data/nagios/nrpe-2.15/src'
/usr/bin/install -c -m 775 -o nagios -g nagios -d /usr/local/nagios/bin
/usr/bin/install -c -m 775 -o nagios -g nagios nrpe /usr/local/nagios/bin
make[1]: Leaving directory `/data/nagios/nrpe-2.15/src'
[root@cu2 nrpe-2.15]# make install-daemon-config
/usr/bin/install -c -m 775 -o nagios -g nagios -d /usr/local/nagios/etc
/usr/bin/install -c -m 644 -o nagios -g nagios sample-config/nrpe.cfg /usr/local/nagios/etc

# 启动nrpe服务
[root@cu2 nrpe-2.15]#  /usr/local/nagios/bin/nrpe -c /usr/local/nagios/etc/nrpe.cfg -d

[root@cu2 nrpe-2.15]# /usr/local/nagios/libexec/check_nrpe -H localhost
CHECK_NRPE: Error - Could not complete SSL handshake.
[root@cu2 nrpe-2.15]# /usr/local/nagios/libexec/check_nrpe -H 127.0.0.1
NRPE v2.15
</code></pre>

<p>拷贝程序到其他机器：</p>

<pre><code>[root@cu2 local]# scp -r nagios cu3:/usr/local/

[root@cu3 ~]# cd /usr/local/nagios/
[root@cu3 nagios]# bin/nrpe -c etc/nrpe.cfg -d
[root@cu3 nagios]# 
[root@cu3 nagios]# libexec/check_nrpe -H 127.0.0.1
NRPE v2.15
</code></pre>

<p>修改配置，添加可以访问nrpe的白名单：</p>

<pre><code>[root@cu3 nagios]# vi etc/nrpe.cfg 
...修改
allowed_hosts=127.0.0.1,192.168.0.0/24
...查看
command[check_users]=/usr/local/nagios/libexec/check_users -w 5 -c 10
command[check_load]=/usr/local/nagios/libexec/check_load -w 15,10,5 -c 30,25,20
command[check_hda1]=/usr/local/nagios/libexec/check_disk -w 20% -c 10% -p /dev/hda1
command[check_zombie_procs]=/usr/local/nagios/libexec/check_procs -w 5 -c 10 -s Z
command[check_total_procs]=/usr/local/nagios/libexec/check_procs -w 150 -c 200 

nrpe.cfg最下面是nrpe的command，nagios配置中会用到

[root@cu3 nagios]# pkill nrpe
[root@cu3 nagios]# bin/nrpe -c etc/nrpe.cfg -d
</code></pre>

<p>再回到cu2，把cu3加入nagios管理列表中：</p>

<p>首先，nagios的配置入口为etc/nagios.cfg。其他配置文件都是通过cfg_file去定位的。</p>

<pre><code>[root@cu2 nagios]# vi etc/nagios.cfg 
...添加
cfg_file=/usr/local/nagios/etc/objects/hosts.cfg
cfg_file=/usr/local/nagios/etc/objects/localhost.cfg
cfg_file=/usr/local/nagios/etc/objects/cu3.cfg


[root@cu2 nagios]# vi etc/objects/commands.cfg 
...添加
# 'check_nrpe' command definition
define command{
        command_name check_nrpe
        command_line $USER1$/check_nrpe -H $HOSTADDRESS$ -c $ARG1$
}

[root@cu2 nagios]# vi etc/objects/cu3.cfg 
...新增

define host{
        use                     linux-server            ; Name of host template to use
                                                        ; This host definition will inherit all variables that are defined
                                                        ; in (or inherited by) the linux-server host template definition.
        host_name               cu3
        alias                   cu3
        address                 192.168.0.148
        }

define service{
        use                             generic-service         ; Name of service template to use
        host_name                       cu3
        service_description             PING
        check_command                   check_ping!100.0,20%!500.0,60%
        }

define service{
        use                             generic-service         ; Name of service template to use
        host_name                       cu3
        service_description             Root Partition
        check_command                   check_nrpe!check_hda1
        }

define service{
        use                             generic-service         ; Name of service template to use
        host_name                       cu3
        service_description             Current Users
        check_command                   check_nrpe!check_users
        }

define service{
        use                             generic-service         ; Name of service template to use
        host_name                       cu3
        service_description             Total Processes
        check_command                   check_nrpe!check_total_procs
        }


define service{
        use                             generic-service         ; Name of service template to use
        host_name                       cu3
        service_description             Current Load
        check_command                   check_nrpe!check_load
        }

[root@cu2 nagios]# vi etc/objects/hosts.cfg 
... 新增
define hostgroup{
        hostgroup_name  linux-servers ; The name of the hostgroup
        alias           Linux Servers ; Long name of the group
        members         localhost,cu3,cu4,cu5,cu1     ; Comma separated list of hosts that belong to this group
        }
</code></pre>

<p>配置完后，校验配置，然后重启nagios。然后就可以打开浏览器查看cu3状态。</p>

<pre><code>[root@cu2 nagios]# bin/nagios -v etc/nagios.cfg 

Nagios Core 4.1.1
Copyright (c) 2009-present Nagios Core Development Team and Community Contributors
Copyright (c) 1999-2009 Ethan Galstad
Last Modified: 08-19-2015
License: GPL

Website: https://www.nagios.org
Reading configuration data...
   Read main config file okay...
   Read object config files okay...

Running pre-flight check on configuration data...

Checking objects...
        Checked 23 services.
        Checked 4 hosts.
        Checked 1 host groups.
        Checked 0 service groups.
        Checked 1 contacts.
        Checked 1 contact groups.
        Checked 25 commands.
        Checked 5 time periods.
        Checked 0 host escalations.
        Checked 0 service escalations.
Checking for circular paths...
        Checked 4 hosts
        Checked 0 service dependencies
        Checked 0 host dependencies
        Checked 5 timeperiods
Checking global event handlers...
Checking obsessive compulsive processor commands...
Checking misc settings...

Total Warnings: 0
Total Errors:   0

Things look okay - No serious problems were detected during the pre-flight check
[root@cu2 nagios]# service nagios restart
Running configuration check...
Stopping nagios: done.
Starting nagios: done.
</code></pre>

<h2>后记</h2>

<p>基本功能就算配置好了，如果出现异常就能得到邮件提醒。</p>

<h2>参考</h2>

<ul>
<li><a href="http://nagios-cn.sourceforge.net/nagios-cn/beginning.html#quickstart-fedora">http://nagios-cn.sourceforge.net/nagios-cn/beginning.html#quickstart-fedora</a></li>
<li><a href="http://skypegnu1.blog.51cto.com/8991766/1532948">http://skypegnu1.blog.51cto.com/8991766/1532948</a></li>
<li><a href="http://nagios-cn.sourceforge.net/nagios-cn/beginning.html#monitoring-linux">http://nagios-cn.sourceforge.net/nagios-cn/beginning.html#monitoring-linux</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cacti监控主机]]></title>
    <link href="http://winseliu.com/blog/2015/09/22/cacti-start-guide/"/>
    <updated>2015-09-22T14:33:36+08:00</updated>
    <id>http://winseliu.com/blog/2015/09/22/cacti-start-guide</id>
    <content type="html"><![CDATA[<p>其实通过yum好依赖的php、rrdtool、snmp后，安装配置Cacti其实很简单。</p>

<h2>环境说明</h2>

<p>五台机器：cu1~cu5(centos6.6)， 其中仅cu2作为cacti服务器，所有服务器都安装snmp服务。</p>

<pre><code>cu1     192.168.0.37 
cu2     192.168.0.214 
cu3     192.168.0.148 
cu4     192.168.0.30 
cu5     192.168.0.174 
</code></pre>

<h2>软件安装</h2>

<p>版本信息在贴的内容中体现。PHP不会，仅仅作为一个工具来使用。</p>

<h3>Cacti服务器机器安装</h3>

<p>mysql数据库5.1</p>

<pre><code>[root@cu2 ~]# rpm -q mysql 
mysql-5.1.73-5.el6_6.x86_64
</code></pre>

<p>首先用yum安装依赖软件php，httpd，snmp和<strong>rrdtool</strong>。</p>

<pre><code>[root@cu2 ~]# yum install epel-release

[root@cu2 ~]# yum install httpd php php-devel php-mysql php-pear php-common php-gd php-mbstring php-cli php-snmp net-snmp-utils net-snmp-libs rrdtool 
...

Installed:
  net-snmp-libs.x86_64 1:5.5-54.el6_7.1 net-snmp-utils.x86_64 1:5.5-54.el6_7.1 php.x86_64 0:5.3.3-46.el6_6          php-cli.x86_64 0:5.3.3-46.el6_6   php-common.x86_64 0:5.3.3-46.el6_6
  php-devel.x86_64 0:5.3.3-46.el6_6     php-gd.x86_64 0:5.3.3-46.el6_6         php-mbstring.x86_64 0:5.3.3-46.el6_6 php-mysql.x86_64 0:5.3.3-46.el6_6 php-pear.noarch 1:1.9.4-4.el6     
  php-snmp.x86_64 0:5.3.3-46.el6_6      rrdtool.x86_64 0:1.3.8-7.el6          

Dependency Installed:
  autoconf.noarch 0:2.63-5.1.el6               automake.noarch 0:1.11.1-4.el6                  dejavu-fonts-common.noarch 0:2.33-1.el6   dejavu-lgc-sans-mono-fonts.noarch 0:2.33-1.el6  
  dejavu-sans-mono-fonts.noarch 0:2.33-1.el6   fontpackages-filesystem.noarch 0:1.41-1.1.el6   lm_sensors-libs.x86_64 0:3.1.1-17.el6     net-snmp.x86_64 1:5.5-54.el6_7.1                
  php-pdo.x86_64 0:5.3.3-46.el6_6             

Updated:
  httpd.x86_64 0:2.2.15-47.el6.centos                                                                                                                                                       

Dependency Updated:
  httpd-tools.x86_64 0:2.2.15-47.el6.centos                                                                                                                                                 

Complete!

[root@cu2 ~]# service httpd start
Starting httpd: httpd: Could not reliably determine the server's fully qualified domain name, using 192.168.0.214 for ServerName
                                                           [  OK  ]
[root@cu2 ~]# service snmpd start
Starting snmpd:                                            [  OK  ]

[root@cu2 ~]# vi /etc/snmp/snmpd.conf 
     41 #com2sec notConfigUser  default       public
     42 com2sec notConfigUser  192.168.0.214       public
     ...
     63 #access  notConfigGroup ""      any       noauth    exact  systemview none none
     64 access  notConfigGroup ""      any       noauth    exact  all none none
     ...
     86 ##           incl/excl subtree                          mask
     87 view all    included  .1                               80    

[root@cu2 ~]# service snmpd restart

# 使用snmpwalk可以得到数据
[root@cu2 ~]# snmpwalk -Os -c public -v 1 cu2 system
[root@cu2 ~]# snmpwalk -v 1 -c public localhost IP-MIB::ipAdEntIfIndex
</code></pre>

<p>然后，把Cacti应用解压到httpd默认目录下/var/www/html。同时配置cacti连接到数据库。</p>

<pre><code>[root@cu2 ~]# cd /var/www/html/
[root@cu2 html]# tar zxvf cacti-0.8.8f.tar.gz 

[root@cu2 html]# ln -s cacti-0.8.8f cacti

[root@cu2 html]$ mysql -u root -p -h 127.0.0.1
Enter password: 
mysql&gt; 
mysql&gt; create database cacti character set UTF8;
mysql&gt; grant all on cacti.* to cacti@'%' identified by cacti;
mysql&gt; flush privileges;
mysql&gt; source /var/www/html/cacti/cacti.sql;

[root@cu2 html]# vi cacti/include/config.php 
$database_type = "mysql";
$database_default = "cacti";
$database_hostname = "127.0.0.1";
$database_username = "cacti";
$database_password = "cacti";
$database_port = "3306";

[root@cu2 html]$ vi /etc/php.ini 
date.timezone = "Asia/Shanghai"

# 重启httpd服务

[root@cu2 cacti]# php poller.php 

[root@cu2 cacti]# crontab -e
* * * * * php /var/www/html/cacti/poller.php &gt; /var/www/html/cacti/log/cron.log 2&gt;&amp;1
</code></pre>

<p>打开浏览器访问：<a href="http://cu2/cacti/">http://cu2/cacti/</a> 首先会进入到install步骤，按照提示一步下一步，最后输入admin/admin登录。</p>

<p>如果启动错误，查看日志文件看日志：</p>

<pre><code>[root@cu2 cacti]# less /var/log/httpd/error_log 
[root@cu2 cacti]# less log/cacti.log 
</code></pre>

<h3>添加插件</h3>

<p>（网上很多文章都要打补丁，我这里的版本是最新的，同时plugin的补丁没有对应的版本，这里直接安装插件）</p>

<p>从<a href="http://docs.cacti.net/plugins">http://docs.cacti.net/plugins</a>下载<a href="http://docs.cacti.net/plugin:monitor">monitor</a>。把下载文件解压到plugins目录下：</p>

<pre><code>[root@cu2 plugins]# pwd
/var/www/html/cacti/plugins
[root@cu2 plugins]# ll
-rw-r--r-- 1 1000 users   44 Jul 20 21:42 index.php
drwxr-xr-x 4 root root  4096 Oct  6  2011 monitor
</code></pre>

<p>然后进入Plugin Management页面<a href="http://cu2/cacti/plugins.php">http://cu2/cacti/plugins.php</a>，就能看到Monitor插件。点击表格Actions列的<strong>安装和启用</strong>图标（按钮），启用后，最上面页签会增加新的页签项monitor。</p>

<p>点击monitor页签，可以查看机器存活的状态。</p>

<p>同时Settings页面多了Misc选项卡，可以配置修改monitor属性。</p>

<p>注意：网上版本资料都有配置config.php添加plugins变量。我这里没进行这个操作也是ok的，安装-启用成功后会把monitor下面的sql更新到数据库，不需要手动执行。</p>

<h3>安装spine</h3>

<pre><code>[root@cu2 ~] tar zxvf cacti-spine-0.8.8f.tar.gz

[root@cu2 cacti-spine-0.8.8f]# yum install -y mysql-devel
[root@cu2 cacti-spine-0.8.8f]# yum install net-snmp-devel

[root@cu2 cacti-spine-0.8.8f]# ./configuration --prefix=/usr/local/cacti-spine
[root@cu2 cacti-spine-0.8.8f]# make &amp;&amp; make install

[root@cu2 cacti-spine-0.8.8f]# cd /usr/local/cacti-spine/etc
[root@cu2 etc]# mv spine.conf.dist spine.conf
[root@cu2 etc]# vi spine.conf 
DB_Host         127.0.0.1
DB_Database     cacti
DB_User         cacti
DB_Pass         cacti
DB_Port         3306
</code></pre>

<p>然后修改<a href="http://hadoop-master2/cacti/settings.php">Cacti</a>使用spine来获取信息。</p>

<p>在[Settings]-[Paths]添加Spine Poller File Path为<code>/usr/local/cacti-spine/bin/spine</code>。在[Poller]选项卡，[Poller Type]修改为spine，[Poller Interval]和[Cron Interval]修改为一分钟即Every Minute。</p>

<p>添加“每分钟”流量视图，点击Console -> Data Templates -> Interface -> Traffic 添加“每分钟”流量视图，将轮询时间设置为60秒，Heartbeat时间设置为120秒(traffic_out里面的Heartbeat时间也设置为120秒)</p>

<h2>被监控机器配置</h2>

<p>被监控的机器，仅仅需要安装snmp即可。然后配置snpmd.conf即可。</p>

<pre><code>[root@cu5 ~]# yum install  net-snmp net-snmp-utils net-snmp-libs -y
[root@cu5 ~]# vi /etc/snmp/snmpd.conf 
     41 #com2sec notConfigUser  default       public
     42 com2sec notConfigUser  192.168.0.214       public
     ...
     63 #access  notConfigGroup ""      any       noauth    exact  systemview none none
     64 access  notConfigGroup ""      any       noauth    exact  all none none
     ...
     86 ##           incl/excl subtree                          mask
     87 view all    included  .1                               80    

[root@cu2 ~]# service snmpd restart
</code></pre>

<p>然后在Cacti的web页面添加Device(主机)：</p>

<ul>
<li>点击Console->Devices，打开设备管理页面。</li>
<li>点击右上角的add，添加一个新的机器</li>
<li>当主机的信息填好之后，点击Create

<ul>
<li>Host Template就是一个模板，会事先建立一些Associated Graph Templates和Associated Data Queries的数据，如Load Average，Memory Uages等。如果不确定直接选None即可。</li>
<li>SNMP Version选<code>Version 2</code>，SNMP Community与snmpd.conf中对应，如果安装上面操作，默认即可。</li>
</ul>
</li>
<li>此时你的页面左上角应该显示：Save Successful，并且已经显示出了主机信息和SNMP信息，如果SNMP信息显示 SNMP error，请查看最后的问题综述。</li>
<li>这时我们就可以添加相应的监控项了，在页面最下方的Associated Graph Templates中添加图形模板，在Associated Data Queries中添加数据模板。</li>
<li>保存，点击右上角的Create Graphs for this Host，来为刚才通过模板所获得到的数据进行画图。</li>
<li>选择好需要画图的项目后，点击右下角的Create，左上角会出现被创建出来的画图项。</li>
</ul>


<p>总结就是添加设备，然后生成图形，最后等待生成画图查看。</p>

<p>在Graphs界面左边显示树新添加主机。</p>

<ul>
<li>在Cacti界面Graph Trees中，选择进入节点(或者系统默认的Default Tree)。</li>
<li>添加一个新的显示项，在Tree Item Type中选择Host，然后在下面的Host中选择我们刚才创建的主机。点击Create。</li>
</ul>


<p><a href="http://docs.cacti.net/templates">http://docs.cacti.net/templates</a></p>

<h2>进阶</h2>

<p><a href="http://skypegnu1.blog.51cto.com/8991766/1537374">http://skypegnu1.blog.51cto.com/8991766/1537374</a></p>

<blockquote><p>cacti是如何获取数据呢？  <br/>
    其实cacti获取数据的方式是多样化的，通过周期性的执行某个脚本，或者使用snmp，更或者是ssh，这些都是根据实际需要以及方便性来抉择。cacti需要周期性的驱动这些获取数据的脚本执行，并把取得的数据保存至相应的rrd数据库中。
cacti是如何保存数据（创建rrd，并更新数据）呢？
    这就是数据模板的功能。
cacti是如何展示数据（绘图）呢？
    这就是图形模板的功能。</p></blockquote>

<p><a href="http://skypegnu1.blog.51cto.com/8991766/1537615">http://skypegnu1.blog.51cto.com/8991766/1537615</a>
<a href="http://skypegnu1.blog.51cto.com/8991766/1538459">http://skypegnu1.blog.51cto.com/8991766/1538459</a>
<a href="http://skypegnu1.blog.51cto.com/8991766/1547029">http://skypegnu1.blog.51cto.com/8991766/1547029</a></p>

<h2>资料</h2>

<p>入门的文档不错，可以到<a href="http://vdisk.weibo.com/u/1554831624">微盘</a>下载。</p>

<pre><code>Cacti.0.8_Beginner.Guide.pdf

Cacti实战指南--备份还原.pdf
Cacti实战指南-完美部署.pdf
Cacti实战指南-巧设轮询.pdf
Cacti实战指南-插件安装.pdf
Cacti实战指南-用户权限.pdf
Cacti实战指南-邮件预警.pdf
Cacti实战指南-阀值预警.pdf
</code></pre>

<h2>参考</h2>

<ul>
<li><p>先看这个文档 <a href="http://blog.chinaunix.net/attachment/attach/21/08/97/212108972176206e1112f29600926449bdeedb3970.pdf">http://blog.chinaunix.net/attachment/attach/21/08/97/212108972176206e1112f29600926449bdeedb3970.pdf</a></p></li>
<li><p><a href="http://blog.csdn.net/chen3888015/article/details/8233125">http://blog.csdn.net/chen3888015/article/details/8233125</a></p></li>
<li><p><a href="http://www.cacti.net/downloads/docs/pdf/manual.pdf">http://www.cacti.net/downloads/docs/pdf/manual.pdf</a></p></li>
<li><p><a href="http://wenku.baidu.com/view/57aa69487fd5360cba1adb40.html?re=view">http://wenku.baidu.com/view/57aa69487fd5360cba1adb40.html?re=view</a></p></li>
<li><p><a href="http://wenku.baidu.com/view/b2d1f6c689eb172ded63b7f9.html?re=view">http://wenku.baidu.com/view/b2d1f6c689eb172ded63b7f9.html?re=view</a></p></li>
<li><p><a href="http://www.ehowstuff.com/how-to-install-and-configure-epel-repository-on-centos-6-2/">http://www.ehowstuff.com/how-to-install-and-configure-epel-repository-on-centos-6-2/</a></p></li>
<li><a href="http://www.ehowstuff.com/how-to-install-cacti-on-centos-6-2-using-epel-repository/">http://www.ehowstuff.com/how-to-install-cacti-on-centos-6-2-using-epel-repository/</a></li>
<li><a href="http://www.ehowstuff.com/how-to-setup-and-configure-cacti-on-centos-6-2/">http://www.ehowstuff.com/how-to-setup-and-configure-cacti-on-centos-6-2/</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[解决SecureCRT【zmodem Transfer Canceled by Remote Side】问题]]></title>
    <link href="http://winseliu.com/blog/2015/09/21/solve-securecrt-zmodem-transfer-canceled-by-remote-side/"/>
    <updated>2015-09-21T16:02:18+08:00</updated>
    <id>http://winseliu.com/blog/2015/09/21/solve-securecrt-zmodem-transfer-canceled-by-remote-side</id>
    <content type="html"><![CDATA[<p>处理方法很简单，解决后，对于ssh机器之间多次跳转的文件传输操作会方便很多。</p>

<pre><code>写到/etc/profile以后就可以直接使用了
[root@af042cb4b34c ~]# alias rz="rz -e"

[root@af042cb4b34c ~]# cd /usr/share/cacti/
[root@af042cb4b34c cacti]# cd plugins
[root@af042cb4b34c plugins]# rz
rz waiting to receive.
Starting zmodem transfer.  Press Ctrl+C to cancel.
Transferring monitor-v1.3-1.tgz...
  100%     231 KB     231 KB/sec    00:00:01       0 Errors  

[root@af042cb4b34c plugins]# ll
total 236
-rw-r--r-- 1 root root     44 Aug  7  2013 index.php
-rw-r--r-- 1 root root 236682 Sep 21 07:54 monitor-v1.3-1.tgz
</code></pre>

<p>zmoden还是有比较多的限制。sftp还是不能少啊！！</p>

<h2>参考</h2>

<ul>
<li><a href="http://iamhere1.blog.163.com/blog/static/23612284201372322622902/">http://iamhere1.blog.163.com/blog/static/23612284201372322622902/</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[安装http代理服务器squid]]></title>
    <link href="http://winseliu.com/blog/2015/09/06/squid-http-proxy-server-install/"/>
    <updated>2015-09-06T23:22:50+08:00</updated>
    <id>http://winseliu.com/blog/2015/09/06/squid-http-proxy-server-install</id>
    <content type="html"><![CDATA[<h2>环境说明</h2>

<ul>
<li>squid-3.3.14.tar.gz</li>
<li>centos6.6</li>
</ul>


<h2>安装</h2>

<pre><code>yum install gcc gcc-c++
cd squid-3.3.14
./configure
make
make install

cd /usr/local/squid
#不修改会有权限的问题
chmod 777 var/logs
sbin/squid 
sbin/squid -k shutdown
</code></pre>

<h2>使用</h2>

<p>在浏览器中设置Http代理。端口为3128</p>

<h2>参考</h2>

<ul>
<li><a href="ftp://ftp.cuhk.edu.hk/pub/packages/info-systems/www/squid/">ftp://ftp.cuhk.edu.hk/pub/packages/info-systems/www/squid/</a></li>
<li><a href="http://www.educity.cn/linux/517165.html">http://www.educity.cn/linux/517165.html</a></li>
<li><a href="http://www.ajaxstu.com/Proxyfuwuqi/283731.html">http://www.ajaxstu.com/Proxyfuwuqi/283731.html</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_537b9caa010185xo.html">http://blog.sina.com.cn/s/blog_537b9caa010185xo.html</a></li>
<li><a href="http://blog.163.com/sword_111/blog/static/6658941620114163458435/">http://blog.163.com/sword_111/blog/static/6658941620114163458435/</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[手动安装supervisor]]></title>
    <link href="http://winseliu.com/blog/2015/08/24/manual-install-supervisor/"/>
    <updated>2015-08-24T16:24:25+08:00</updated>
    <id>http://winseliu.com/blog/2015/08/24/manual-install-supervisor</id>
    <content type="html"><![CDATA[<h2>下载依赖以及安装包，并安装</h2>

<pre><code>python -V

tar zxvf setuptools-18.2.tar.gz 
cd setuptools-18.2
python setup.py install

tar zxvf meld3-0.6.5.tar.gz 
cd meld3-0.6.5
python setup.py install

tar zxvf elementtree-1.2.6-20050316.tar.gz 
cd elementtree-1.2.6-20050316
python setup.py install

tar zxvf supervisor-3.1.3.tar.gz 
cd supervisor-3.1.3
python setup.py  install
</code></pre>

<h2>配置启动</h2>

<pre><code>[root@master supervisor-3.1.3]# echo_supervisord_conf &gt;/etc/supervisord.conf
[root@master supervisor-3.1.3]# supervisord

[root@master supervisor-3.1.3]# ps aux | grep supervisor | grep -v grep
root      6123  0.0  0.7 207292 13296 ?        Ss   08:15   0:00 /usr/bin/python /usr/bin/supervisord

[root@master supervisor-3.1.3]# supervisorctl shutdown
Shut down
</code></pre>

<h2>参考</h2>

<ul>
<li><a href="http://supervisord.org/installing.html#installing-to-a-system-without-internet-access">http://supervisord.org/installing.html#installing-to-a-system-without-internet-access</a></li>
<li><a href="http://supervisord.org/configuration.html#programx-section">http://supervisord.org/configuration.html#programx-section</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
